"use strict";var e,t=this&&this.t||function(e,t,s,r){var i,n=arguments.length,c=3>n?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(c=(3>n?i(c):n>3?i(t,s,c):i(t,s))||c);return n>3&&c&&Object.defineProperty(t,s,c),c},s=this&&this.i||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"o",{value:!0}),exports.SessionRefreshScheduler=void 0;const r=require("@nestjs/common"),i=require("@nestjs/schedule"),n=require("./bank.service"),c=require("../device/device.service"),o=require("./session-management.service");let f=e=class{constructor(t,s,i){this.bankService=t,this.deviceService=s,this.sessionManagement=i,this.logger=new r.Logger(e.name)}async refreshSessions(){try{if("active"!==await this.deviceService.getServiceStatus())return;const e=(await this.deviceService.listDevices()).filter(e=>"active"===e.status&&e.bankCode);for(const t of e){const e=t.bankCode.toUpperCase();try{await this.bankService.refreshSessionIfNeeded(t.udid,e)}catch(s){this.logger.error(`Error refreshing session for device ${t.udid}, bank ${e}: ${s.message}`)}}}catch(e){this.logger.error("Error in session refresh scheduler: "+e.message)}}};exports.SessionRefreshScheduler=f,t([(0,i.Cron)(i.CronExpression.EVERY_30_SECONDS),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],f.prototype,"refreshSessions",null),exports.SessionRefreshScheduler=f=e=t([(0,r.Injectable)(),s("design:paramtypes",[n.BankService,c.DeviceService,o.SessionManagementService])],f);