"use strict";Object.defineProperty(exports,"t",{value:!0}),exports.withCronLock=void 0;const e=require("ioredis"),t=require("../constants/config"),s=new e.default({host:t.config.redis.host,port:t.config.redis.port,password:t.config.redis.password,db:t.config.redis.db}),r=async(e,t,r)=>{const n=`${process.pid}:${Date.now()}`;if(await s.set(e,n,"PX",t,"NX"))try{await r()}finally{const t='\n      if redis.call("GET", KEYS[1]) == ARGV[1] then\n        return redis.call("DEL", KEYS[1])\n      end\n      return 0\n    ';await s.eval(t,1,e,n)}};exports.withCronLock=r;