function a0_0x2633(_0x326cd8,_0x3766e1){_0x326cd8=_0x326cd8-0xf8;const _0x49ff75=a0_0x49ff();let _0x2633b9=_0x49ff75[_0x326cd8];return _0x2633b9;}(function(_0x300f4c,_0x3bacd3){const _0x376cbb=a0_0x2633,_0x9e4f64=_0x300f4c();while(!![]){try{const _0x6ec771=-parseInt(_0x376cbb(0x324))/0x1*(-parseInt(_0x376cbb(0x339))/0x2)+-parseInt(_0x376cbb(0x344))/0x3+-parseInt(_0x376cbb(0x175))/0x4+-parseInt(_0x376cbb(0x210))/0x5+parseInt(_0x376cbb(0x1d5))/0x6*(parseInt(_0x376cbb(0x273))/0x7)+-parseInt(_0x376cbb(0x119))/0x8+-parseInt(_0x376cbb(0x1e1))/0x9*(-parseInt(_0x376cbb(0x106))/0xa);if(_0x6ec771===_0x3bacd3)break;else _0x9e4f64['push'](_0x9e4f64['shift']());}catch(_0x4e87d6){_0x9e4f64['push'](_0x9e4f64['shift']());}}}(a0_0x49ff,0xdf0bf),((()=>{'use strict';var _0x5c484f=[,_0x3bb9b0=>{const _0x567f87=a0_0x2633;_0x3bb9b0[_0x567f87(0x10b)]=require('@nestjs/core');},_0xd210c0=>{_0xd210c0['exports']=require('@nestjs/common');},_0x3accf0=>{_0x3accf0['exports']=require('@nestjs/swagger');},_0x4aa3c1=>{const _0x6e0431=a0_0x2633;_0x4aa3c1[_0x6e0431(0x10b)]=require('path');},function(_0x270a4a,_0x573de1,_0x190f77){const _0x4f39af=a0_0x2633;var _0xbbf8e0=this&&this['__decorate']||function(_0x2e6b34,_0x1eae1c,_0x44c93a,_0x3e35b7){const _0x54abb3=a0_0x2633;var _0x5f4bfb,_0x4a0ecd=arguments['length'],_0x2ba7ff=_0x4a0ecd<0x3?_0x1eae1c:null===_0x3e35b7?_0x3e35b7=Object['getOwnPropertyDescriptor'](_0x1eae1c,_0x44c93a):_0x3e35b7;if(_0x54abb3(0x26d)==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x2ba7ff=Reflect['decorate'](_0x2e6b34,_0x1eae1c,_0x44c93a,_0x3e35b7);else{for(var _0x4754f1=_0x2e6b34['length']-0x1;_0x4754f1>=0x0;_0x4754f1--)(_0x5f4bfb=_0x2e6b34[_0x4754f1])&&(_0x2ba7ff=(_0x4a0ecd<0x3?_0x5f4bfb(_0x2ba7ff):_0x4a0ecd>0x3?_0x5f4bfb(_0x1eae1c,_0x44c93a,_0x2ba7ff):_0x5f4bfb(_0x1eae1c,_0x44c93a))||_0x2ba7ff);}return _0x4a0ecd>0x3&&_0x2ba7ff&&Object['defineProperty'](_0x1eae1c,_0x44c93a,_0x2ba7ff),_0x2ba7ff;};Object['defineProperty'](_0x573de1,'__esModule',{'value':!0x0}),_0x573de1['AppModule']=void 0x0;const _0x2a9baa=_0x190f77(0x2),_0x258313=_0x190f77(0x6),_0x48d578=_0x190f77(0x7),_0x140ddd=_0x190f77(0x8),_0x1a7a1f=_0x190f77(0x9),_0x11f93a=_0x190f77(0x33),_0x452f6d=_0x190f77(0x34),_0x5abc9d=_0x190f77(0x16),_0x3210bb=_0x190f77(0x3a),_0x1ab265=_0x190f77(0xf),_0x537371=_0x190f77(0x38),_0xef773e=_0x190f77(0x3f);let _0x2191ea=class{};_0x573de1['AppModule']=_0x2191ea,_0x573de1['AppModule']=_0x2191ea=_0xbbf8e0([(0x0,_0x2a9baa['Module'])({'imports':[_0x258313['BullModule'][_0x4f39af(0x249)]({'redis':{'host':_0x1ab265['config']['redis']['host'],'port':_0x1ab265['config']['redis'][_0x4f39af(0x160)],'db':_0x1ab265[_0x4f39af(0x30b)]['redis']['db'],'password':_0x1ab265['config']['redis']['password']},'defaultJobOptions':{'removeOnComplete':0xa,'removeOnFail':0x32,'attempts':0x3,'backoff':{'type':'exponential','delay':0x7d0}}}),_0x48d578[_0x4f39af(0x30f)]['forRoot'](),_0x140ddd['HttpModule'],_0x1a7a1f['WithdrawalModule'],_0x11f93a['HcBoxModule'],_0x452f6d['DeviceModule'],_0x3210bb['WebSocketModule'],_0x537371['BankModule'],_0xef773e['OCRModule']],'providers':[_0x5abc9d[_0x4f39af(0x18c)]],'exports':[_0x5abc9d[_0x4f39af(0x18c)]]})],_0x2191ea);},_0x5bceec=>{_0x5bceec['exports']=require('@nestjs/bull');},_0x3bc2dd=>{_0x3bc2dd['exports']=require('@nestjs/schedule');},_0x7369ed=>{const _0x3c44f2=a0_0x2633;_0x7369ed[_0x3c44f2(0x10b)]=require('@nestjs/axios');},function(_0x5675f1,_0x5bbc33,_0x2bdfcd){const _0xe39783=a0_0x2633;var _0x37adec=this&&this['__decorate']||function(_0x5b9e27,_0x1abcba,_0x18a8a0,_0x145262){const _0x4c43b3=a0_0x2633;var _0x39cbd5,_0x35b026=arguments['length'],_0x1fd4d1=_0x35b026<0x3?_0x1abcba:null===_0x145262?_0x145262=Object[_0x4c43b3(0x2c5)](_0x1abcba,_0x18a8a0):_0x145262;if(_0x4c43b3(0x26d)==typeof Reflect&&'function'==typeof Reflect[_0x4c43b3(0x2a1)])_0x1fd4d1=Reflect['decorate'](_0x5b9e27,_0x1abcba,_0x18a8a0,_0x145262);else{for(var _0x2c0e6d=_0x5b9e27['length']-0x1;_0x2c0e6d>=0x0;_0x2c0e6d--)(_0x39cbd5=_0x5b9e27[_0x2c0e6d])&&(_0x1fd4d1=(_0x35b026<0x3?_0x39cbd5(_0x1fd4d1):_0x35b026>0x3?_0x39cbd5(_0x1abcba,_0x18a8a0,_0x1fd4d1):_0x39cbd5(_0x1abcba,_0x18a8a0))||_0x1fd4d1);}return _0x35b026>0x3&&_0x1fd4d1&&Object['defineProperty'](_0x1abcba,_0x18a8a0,_0x1fd4d1),_0x1fd4d1;};Object[_0xe39783(0x1c8)](_0x5bbc33,'__esModule',{'value':!0x0}),_0x5bbc33['WithdrawalModule']=void 0x0;const _0x5ca271=_0x2bdfcd(0x2),_0x26d4ff=_0x2bdfcd(0x6),_0x3c57b6=_0x2bdfcd(0x7),_0x308e7b=_0x2bdfcd(0xa),_0x2ef3e6=_0x2bdfcd(0x2e),_0x443c0d=_0x2bdfcd(0x32),_0x37e87a=_0x2bdfcd(0xb),_0x8010a=_0x2bdfcd(0x16),_0x1525f4=_0x2bdfcd(0x33),_0x33f1a0=_0x2bdfcd(0x34),_0x407845=_0x2bdfcd(0x38),_0x49b8a7=_0x2bdfcd(0x8);let _0x472cc4=class{};_0x5bbc33[_0xe39783(0x22f)]=_0x472cc4,_0x5bbc33['WithdrawalModule']=_0x472cc4=_0x37adec([(0x0,_0x5ca271['Module'])({'imports':[_0x26d4ff['BullModule']['registerQueue']({'name':_0xe39783(0x297)}),_0x3c57b6['ScheduleModule'],_0x1525f4['HcBoxModule'],(0x0,_0x5ca271['forwardRef'])(()=>_0x33f1a0['DeviceModule']),_0x407845[_0xe39783(0x109)],_0x49b8a7['HttpModule']],'controllers':[_0x443c0d['WithdrawalController']],'providers':[_0x308e7b['WithdrawalService'],_0x2ef3e6['WithdrawalJobManagerService'],_0x37e87a['EzpayBeClientService'],_0x8010a[_0xe39783(0x18c)]],'exports':[_0x308e7b['WithdrawalService']]})],_0x472cc4);},function(_0x43426e,_0x559674,_0x1fbf03){const _0x4cef9a=a0_0x2633;var _0x389bad,_0x11888a,_0x246c5c,_0x537ed8,_0x25ac37,_0x5e539c,_0x148e6b=this&&this['__decorate']||function(_0x31e384,_0x50c6fa,_0x3bd46e,_0x2ce142){const _0x251b62=a0_0x2633;var _0x5dea80,_0x1d1c6b=arguments['length'],_0x4d055d=_0x1d1c6b<0x3?_0x50c6fa:null===_0x2ce142?_0x2ce142=Object[_0x251b62(0x2c5)](_0x50c6fa,_0x3bd46e):_0x2ce142;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x4d055d=Reflect['decorate'](_0x31e384,_0x50c6fa,_0x3bd46e,_0x2ce142);else{for(var _0x572af1=_0x31e384[_0x251b62(0x1e6)]-0x1;_0x572af1>=0x0;_0x572af1--)(_0x5dea80=_0x31e384[_0x572af1])&&(_0x4d055d=(_0x1d1c6b<0x3?_0x5dea80(_0x4d055d):_0x1d1c6b>0x3?_0x5dea80(_0x50c6fa,_0x3bd46e,_0x4d055d):_0x5dea80(_0x50c6fa,_0x3bd46e))||_0x4d055d);}return _0x1d1c6b>0x3&&_0x4d055d&&Object['defineProperty'](_0x50c6fa,_0x3bd46e,_0x4d055d),_0x4d055d;},_0x3b8880=this&&this['__metadata']||function(_0x5e60d1,_0x9f0499){const _0xf8bd1f=a0_0x2633;if('object'==typeof Reflect&&_0xf8bd1f(0x269)==typeof Reflect[_0xf8bd1f(0x331)])return Reflect[_0xf8bd1f(0x331)](_0x5e60d1,_0x9f0499);},_0x4f921b=this&&this[_0x4cef9a(0x248)]||function(_0x5ae52f,_0x779dc6){return function(_0x40bbc1,_0x1609b7){_0x779dc6(_0x40bbc1,_0x1609b7,_0x5ae52f);};};Object['defineProperty'](_0x559674,_0x4cef9a(0x209),{'value':!0x0}),_0x559674['WithdrawalService']=void 0x0;const _0x3e33a2=_0x1fbf03(0x2),_0x3f74d0=_0x1fbf03(0xb),_0x543714=_0x1fbf03(0x12),_0x7c1047=_0x1fbf03(0x15),_0x2e1f1b=_0x1fbf03(0x2c),_0x52d39b=_0x1fbf03(0x16),_0x37067e=_0x1fbf03(0x14),_0x28f952=_0x1fbf03(0x19),_0x35d9a4=_0x1fbf03(0x2a);let _0xe65957=class{constructor(_0x3be3cc,_0x47408b,_0x3f6808,_0x51e4a7,_0x503859,_0x5e2cd0){const _0x519fb8=_0x4cef9a;this['ezpayBeClient']=_0x3be3cc,this['wsService']=_0x47408b,this['bankService']=_0x3f6808,this['deviceService']=_0x51e4a7,this['deviceLock']=_0x503859,this[_0x519fb8(0x240)]=_0x5e2cd0,this['logger']=new _0x3e33a2[(_0x519fb8(0x1da))]('WithdrawalService'),this['REDIS_PROCESSED_PREFIX']=_0x519fb8(0x327),this['PROCESSING_TTL']=0xf731400,this[_0x519fb8(0x204)]=0xf731400;}async['checkIfProcessed'](_0x187c2e){const _0x4dab6f=_0x4cef9a;try{const _0x23b3f4=''+this[_0x4dab6f(0x223)]+_0x187c2e,_0x54f4e9=await this['redisService']['get'](_0x23b3f4);return'completed'===_0x54f4e9?(this['logger']['warn']('Withdrawal\x20'+_0x187c2e+'\x20already\x20completed'),!0x0):_0x4dab6f(0x11e)===_0x54f4e9&&(this['logger']['warn']('Withdrawal\x20'+_0x187c2e+_0x4dab6f(0x130)),!0x0);}catch(_0x2be430){return this['logger']['error']('Error\x20checking\x20processed\x20status\x20for\x20'+_0x187c2e+':\x20'+_0x2be430[_0x4dab6f(0x26b)]),!0x1;}}async['markAsProcessing'](_0x525151){const _0x5d2259=_0x4cef9a;try{const _0x2bc595=''+this['REDIS_PROCESSED_PREFIX']+_0x525151;return'OK'===await this[_0x5d2259(0x240)]['setnx'](_0x2bc595,_0x5d2259(0x11e),this['PROCESSING_TTL'])?(this['logger']['debug']('Marked\x20withdrawal\x20'+_0x525151+_0x5d2259(0x20c)),!0x0):(this['logger']['warn']('Withdrawal\x20'+_0x525151+'\x20is\x20already\x20being\x20processed\x20by\x20another\x20instance'),!0x1);}catch(_0x278ca0){return this['logger'][_0x5d2259(0x25a)]('Error\x20marking\x20withdrawal\x20'+_0x525151+'\x20as\x20processing:\x20'+_0x278ca0[_0x5d2259(0x26b)]),!0x0;}}async[_0x4cef9a(0x2d4)](_0x3a208c){const _0x3c43e=_0x4cef9a;try{const _0x14ecff=''+this[_0x3c43e(0x223)]+_0x3a208c;await this[_0x3c43e(0x240)]['set'](_0x14ecff,'completed',this[_0x3c43e(0x204)]),this[_0x3c43e(0x329)]['log']('Marked\x20withdrawal\x20'+_0x3a208c+_0x3c43e(0x2aa));}catch(_0x41ba64){this['logger']['error']('Error\x20marking\x20withdrawal\x20'+_0x3a208c+'\x20as\x20completed:\x20'+_0x41ba64['message']);}}async['markAsFailed'](_0x27a829){const _0x58e5c3=_0x4cef9a;try{const _0x66417=''+this['REDIS_PROCESSED_PREFIX']+_0x27a829;await this['redisService']['del'](_0x66417),this['logger']['log']('Marked\x20withdrawal\x20'+_0x27a829+'\x20as\x20failed\x20(removed\x20from\x20processed\x20list)');}catch(_0x1482ab){this['logger']['error']('Error\x20marking\x20withdrawal\x20'+_0x27a829+_0x58e5c3(0x18d)+_0x1482ab[_0x58e5c3(0x26b)]);}}async['processWithdrawal'](_0x188742,_0x283c2b){const _0x43d643=_0x4cef9a,{withdrawalId:_0x1aa5d5,bankCode:_0x474863,amount:_0x177325}=_0x188742;if(await this['checkIfProcessed'](_0x1aa5d5))return void this['logger']['warn']('Withdrawal\x20'+_0x1aa5d5+'\x20already\x20processed\x20or\x20being\x20processed,\x20skipping');if(!await this['markAsProcessing'](_0x1aa5d5)){const _0x5599ea='Withdrawal\x20'+_0x1aa5d5+'\x20is\x20being\x20processed\x20by\x20another\x20instance';throw this['logger']['warn'](_0x5599ea),new _0x35d9a4['WithdrawalProcessingError'](_0x5599ea,_0x35d9a4[_0x43d643(0x2f8)]['TEMPORARY'],_0x1aa5d5);}let _0x10032c=!0x0,_0x589972=!0x1;try{this[_0x43d643(0x329)][_0x43d643(0x349)](_0x43d643(0x180)+_0x1aa5d5+_0x43d643(0x190)+_0x474863+',\x20amount:\x20'+_0x177325+'\x20on\x20assigned\x20device:\x20'+_0x283c2b);const _0xacaf4a=await this['deviceService']['getDeviceConfig'](_0x283c2b);if(!_0xacaf4a||'active'!==_0xacaf4a['status']){const _0x2a47e3='Assigned\x20device\x20'+_0x283c2b+'\x20is\x20not\x20active\x20or\x20not\x20found';throw this[_0x43d643(0x329)]['error'](_0x2a47e3),await this['markAsFailed'](_0x1aa5d5),_0x10032c=!0x1,new _0x35d9a4['WithdrawalProcessingError'](_0x2a47e3,_0x35d9a4['ErrorType']['TEMPORARY'],_0x1aa5d5);}if(_0xacaf4a['availableAmount']<_0x177325){const _0x35812b='Assigned\x20device\x20'+_0x283c2b+'\x20has\x20insufficient\x20amount.\x20Available:\x20'+_0xacaf4a['availableAmount']+',\x20Required:\x20'+_0x177325;throw this['logger']['error'](_0x35812b),await this['markAsFailed'](_0x1aa5d5),_0x10032c=!0x1,await this['deviceService'][_0x43d643(0x142)](_0x283c2b,{'status':'deactive'}),new _0x35d9a4['WithdrawalProcessingError'](_0x35812b,_0x35d9a4['ErrorType']['TEMPORARY'],_0x1aa5d5);}if(!await this[_0x43d643(0x1d2)]['isSessionValid'](_0x283c2b,_0xacaf4a['bankCode'])){const _0x123d3b='Assigned\x20device\x20'+_0x283c2b+'\x20does\x20not\x20have\x20valid\x20session\x20for\x20bank\x20'+_0xacaf4a[_0x43d643(0x15a)];throw this['logger']['error'](_0x123d3b),await this['markAsFailed'](_0x1aa5d5),_0x10032c=!0x1,new _0x35d9a4[(_0x43d643(0x1fa))](_0x123d3b,_0x35d9a4[_0x43d643(0x2f8)]['TEMPORARY'],_0x1aa5d5);}const _0x189041=_0x283c2b;await this['bankService']['executeTransferWithQRCode'](_0x188742,_0xacaf4a,_0xacaf4a['bankCode']),this['deviceService']['deductDeviceAmount'](_0x189041,_0x177325)['catch'](()=>{}),await this['markAsCompleted'](_0x1aa5d5),_0x589972=!0x0,_0x10032c=!0x1;const _0x189174=await this['bankService']['analyzeTransferBill'](_0xacaf4a['bankCode'],_0x188742);this['notifyEzpayBe'](_0x188742,_0x189174,_0xacaf4a)[_0x43d643(0xfb)](()=>{}),'unknown'===_0x189174['analyzedStatus']&&await this['bankService']['login'](_0xacaf4a['bankCode'],_0x189041,!0x0),this[_0x43d643(0x329)]['log']('Successfully\x20processed\x20withdrawal:\x20'+_0x1aa5d5);}catch(_0x1e1ea8){if(_0x1e1ea8 instanceof _0x35d9a4['WithdrawalProcessingError'])throw _0x1e1ea8;throw this['logger'][_0x43d643(0x25a)](_0x43d643(0x30c)+_0x1aa5d5+':\x20'+_0x1e1ea8['message'],_0x1e1ea8['stack']),await this['markAsFailed'](_0x1aa5d5),_0x10032c=!0x1,new _0x35d9a4['WithdrawalProcessingError'](_0x1e1ea8['message']||'Unknown\x20error',_0x35d9a4['ErrorType']['UNKNOWN'],_0x1aa5d5);}finally{await this['deviceLock']['releaseLock'](_0x283c2b),_0x10032c&&!_0x589972&&await this['markAsFailed'](_0x1aa5d5);}}async['notifyEzpayBe'](_0x5599a7,_0x472129,_0x2f09af){const _0x188615=_0x4cef9a;this['ezpayBeClient']['updateWithdrawalStatus'](_0x5599a7['_id'],{'analyzedStatus':_0x472129['analyzedStatus'],'sourceAccountNo':_0x2f09af['accountNo'],'sourceBankCode':_0x2f09af['bankCode'],'sourceAccountName':_0x2f09af[_0x188615(0x206)]})['catch'](_0x363f31=>{const _0x4a7bff=_0x188615;this['logger'][_0x4a7bff(0x25a)]('['+_0x5599a7[_0x4a7bff(0x2a2)]+_0x4a7bff(0x17a)+_0x5599a7[_0x4a7bff(0x2db)]+'\x20-\x20'+_0x363f31['stack']);}),this[_0x188615(0x1a0)]['uploadReceipt'](_0x5599a7['_id'],_0x472129[_0x188615(0x332)])['catch'](_0x460d01=>{const _0x3e89e4=_0x188615;this[_0x3e89e4(0x329)][_0x3e89e4(0x25a)]('['+_0x5599a7[_0x3e89e4(0x2a2)]+_0x3e89e4(0x135)+_0x5599a7['_id']+'\x20-\x20'+_0x460d01['stack']);});}};_0x559674['WithdrawalService']=_0xe65957,_0x559674['WithdrawalService']=_0xe65957=_0x148e6b([(0x0,_0x3e33a2[_0x4cef9a(0x144)])(),_0x4f921b(0x1,(0x0,_0x3e33a2['Inject'])(_0x37067e[_0x4cef9a(0x2a4)])),_0x4f921b(0x3,(0x0,_0x3e33a2['Inject'])((0x0,_0x3e33a2['forwardRef'])(()=>_0x7c1047['DeviceService']))),_0x3b8880(_0x4cef9a(0x1b9),[_0x4cef9a(0x269)==typeof(_0x389bad=void 0x0!==_0x3f74d0['EzpayBeClientService']&&_0x3f74d0[_0x4cef9a(0x287)])?_0x389bad:Object,'function'==typeof(_0x11888a=void 0x0!==_0x28f952['IWebSocketService']&&_0x28f952['IWebSocketService'])?_0x11888a:Object,_0x4cef9a(0x269)==typeof(_0x246c5c=void 0x0!==_0x543714['BankService']&&_0x543714['BankService'])?_0x246c5c:Object,'function'==typeof(_0x537ed8=void 0x0!==_0x7c1047['DeviceService']&&_0x7c1047['DeviceService'])?_0x537ed8:Object,'function'==typeof(_0x25ac37=void 0x0!==_0x2e1f1b[_0x4cef9a(0xff)]&&_0x2e1f1b['DeviceLockService'])?_0x25ac37:Object,'function'==typeof(_0x5e539c=void 0x0!==_0x52d39b['RedisService']&&_0x52d39b['RedisService'])?_0x5e539c:Object])],_0xe65957);},function(_0x42e68d,_0x1996c8,_0x16e6d9){const _0x466dbf=a0_0x2633;var _0xa9fe97,_0x201d3d=this&&this['__decorate']||function(_0x5e9b34,_0x170079,_0x511408,_0x256ca3){const _0x594ad4=a0_0x2633;var _0x4a9430,_0x5678d3=arguments[_0x594ad4(0x1e6)],_0xdd39f4=_0x5678d3<0x3?_0x170079:null===_0x256ca3?_0x256ca3=Object[_0x594ad4(0x2c5)](_0x170079,_0x511408):_0x256ca3;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0xdd39f4=Reflect['decorate'](_0x5e9b34,_0x170079,_0x511408,_0x256ca3);else{for(var _0x5114b4=_0x5e9b34['length']-0x1;_0x5114b4>=0x0;_0x5114b4--)(_0x4a9430=_0x5e9b34[_0x5114b4])&&(_0xdd39f4=(_0x5678d3<0x3?_0x4a9430(_0xdd39f4):_0x5678d3>0x3?_0x4a9430(_0x170079,_0x511408,_0xdd39f4):_0x4a9430(_0x170079,_0x511408))||_0xdd39f4);}return _0x5678d3>0x3&&_0xdd39f4&&Object['defineProperty'](_0x170079,_0x511408,_0xdd39f4),_0xdd39f4;},_0x2f3e0d=this&&this['__metadata']||function(_0x40494a,_0x36bbdb){const _0x1be1fa=a0_0x2633;if(_0x1be1fa(0x26d)==typeof Reflect&&_0x1be1fa(0x269)==typeof Reflect[_0x1be1fa(0x331)])return Reflect['metadata'](_0x40494a,_0x36bbdb);};Object['defineProperty'](_0x1996c8,_0x466dbf(0x209),{'value':!0x0}),_0x1996c8['EzpayBeClientService']=void 0x0;const _0x20b280=_0x16e6d9(0x2),_0x35bb05=_0x16e6d9(0x8),_0x15396a=_0x16e6d9(0xc),_0x23655b=_0x16e6d9(0xd),_0x3f4277=_0x16e6d9(0xe),_0x17db21=_0x16e6d9(0xf),_0x545f96=_0x16e6d9(0x11);let _0x23e4b0=class{constructor(_0x3f9b61){const _0x5c3a9c=_0x466dbf;this[_0x5c3a9c(0x282)]=_0x3f9b61,this['logger']=new _0x20b280['Logger']('EzpayBeClientService'),this['apiUrl']=_0x17db21['config'][_0x5c3a9c(0x312)][_0x5c3a9c(0xfe)]??'http://localhost:3001',this['apiKey']=_0x17db21['config']['ezpayBe']['apiKey']??'';}async[_0x466dbf(0x245)](_0x3e950f,_0x4e62d0){const _0x45787f=_0x466dbf;for(let _0x2a6b44=0x0;_0x2a6b44<=0x3;_0x2a6b44++)try{const _0x579337=this['apiUrl']+'/api/internal/withdrawals/complete/'+_0x3e950f;this['logger']['log'](_0x45787f(0x1fe)+_0x3e950f+_0x45787f(0x2d5)+_0x4e62d0['analyzedStatus']+_0x45787f(0x309)+(_0x2a6b44+0x1)+'/4)');const _0x1ef952={'analyzedStatus':_0x4e62d0[_0x45787f(0x1e2)],'sourceBankCode':_0x4e62d0['sourceBankCode'],'sourceAccountNo':_0x4e62d0['sourceAccountNo'],'sourceAccountName':_0x4e62d0['sourceAccountName']},_0x34dc98=await(0x0,_0x15396a['firstValueFrom'])(this['httpService'][_0x45787f(0x123)](_0x579337,_0x1ef952,{'headers':{'Content-Type':_0x45787f(0x201),'X-API-Key':this['apiKey'],'x-internal-secret-key':'uHqE5X9H0QEBsqlZpdTHG0fOyvmMtHjCGgsG4ouls3Gz9WvaWg4w9HV3sqETGWfE'},'timeout':0x4e20}));if(0xc8===_0x34dc98[_0x45787f(0x253)]||0xcc===_0x34dc98['status'])return void this['logger'][_0x45787f(0x349)]('Successfully\x20updated\x20withdrawal\x20'+_0x3e950f+_0x45787f(0x2d5)+_0x4e62d0['analyzedStatus']);this[_0x45787f(0x329)]['warn'](_0x45787f(0x173)+_0x34dc98[_0x45787f(0x253)]+'\x20when\x20updating\x20withdrawal\x20'+_0x3e950f);}catch(_0xd46046){const _0x245e83=_0xd46046,_0x36de73=_0x245e83['response']?.['data'],_0x2793d0=_0x245e83['message'];if(_0x2a6b44<0x3){const _0x6ce689=0x7d0*Math['pow'](0x2,_0x2a6b44);this['logger'][_0x45787f(0x134)]('Failed\x20to\x20update\x20withdrawal\x20'+_0x3e950f+'\x20(attempt\x20'+(_0x2a6b44+0x1)+_0x45787f(0x18e)+_0x2793d0+'.\x20Payload:\x20'+JSON[_0x45787f(0x2be)](_0x36de73)+_0x45787f(0x33c)+_0x6ce689+'ms'),await(0x0,_0x545f96['sleep'])(_0x6ce689);}else this[_0x45787f(0x329)][_0x45787f(0x25a)]('Failed\x20to\x20update\x20withdrawal\x20'+_0x3e950f+_0x45787f(0x2a5)+JSON['stringify'](_0x36de73)+',\x20Error:\x20'+_0x2793d0);}}async['uploadReceipt'](_0x116e98,_0x244788){const _0x2a849f=_0x466dbf;for(let _0x22f53c=0x0;_0x22f53c<=0x3;_0x22f53c++)try{const _0x280802=this[_0x2a849f(0xfe)]+'/api/internal/withdrawals/upload-receipt/'+_0x116e98;if(this['logger']['log']('Uploading\x20bill\x20for\x20withdrawal\x20'+_0x116e98+'\x20(attempt\x20'+(_0x22f53c+0x1)+'/4)'),!_0x244788)return void this['logger']['warn']('No\x20receipt\x20path\x20provided\x20for\x20withdrawal\x20'+_0x116e98);const _0x813a2a=new _0x23655b();_0x813a2a['append']('receipt',(0x0,_0x3f4277['createReadStream'])(_0x244788));const _0x559c67=await(0x0,_0x15396a['firstValueFrom'])(this['httpService']['patch'](_0x280802,_0x813a2a,{'headers':{..._0x813a2a['getHeaders'](),'X-API-Key':this['apiKey'],'x-internal-secret-key':'uHqE5X9H0QEBsqlZpdTHG0fOyvmMtHjCGgsG4ouls3Gz9WvaWg4w9HV3sqETGWfE'},'timeout':0x4e20}));if(0xc8===_0x559c67['status']||0xcc===_0x559c67[_0x2a849f(0x253)])return void this['logger'][_0x2a849f(0x349)](_0x2a849f(0x320)+_0x116e98);this[_0x2a849f(0x329)]['warn']('Unexpected\x20status\x20code\x20'+_0x559c67[_0x2a849f(0x253)]+'\x20when\x20uploading\x20bill\x20for\x20withdrawal\x20'+_0x116e98);}catch(_0x2126f1){const _0x1b272f=_0x2126f1,_0x5d5cb1=_0x1b272f[_0x2a849f(0x1aa)]?.['data'],_0x176697=_0x1b272f[_0x2a849f(0x26b)];if(_0x22f53c<0x3){const _0x1c1dd1=0x7d0*Math['pow'](0x2,_0x22f53c);this['logger'][_0x2a849f(0x134)](_0x2a849f(0x21f)+_0x116e98+_0x2a849f(0x309)+(_0x22f53c+0x1)+_0x2a849f(0x18e)+_0x176697+_0x2a849f(0x1de)+JSON['stringify'](_0x5d5cb1)+',\x20Retrying\x20in\x20'+_0x1c1dd1+'ms'),await(0x0,_0x545f96[_0x2a849f(0x23d)])(_0x1c1dd1);}else this['logger'][_0x2a849f(0x25a)]('Failed\x20to\x20upload\x20bill\x20for\x20withdrawal\x20'+_0x116e98+_0x2a849f(0x2c7)+JSON['stringify'](_0x5d5cb1)+',\x20Error:\x20'+_0x176697);}}};_0x1996c8[_0x466dbf(0x287)]=_0x23e4b0,_0x1996c8['EzpayBeClientService']=_0x23e4b0=_0x201d3d([(0x0,_0x20b280[_0x466dbf(0x144)])(),_0x2f3e0d('design:paramtypes',['function'==typeof(_0xa9fe97=void 0x0!==_0x35bb05[_0x466dbf(0x23e)]&&_0x35bb05['HttpService'])?_0xa9fe97:Object])],_0x23e4b0);},_0x3337bc=>{const _0x3ecb94=a0_0x2633;_0x3337bc[_0x3ecb94(0x10b)]=require('rxjs');},_0x53928e=>{_0x53928e['exports']=require('form-data');},_0x5f5873=>{_0x5f5873['exports']=require('fs');},(_0x279b5b,_0x1a3a49,_0x3bee10)=>{const _0x2707e1=a0_0x2633;Object['defineProperty'](_0x1a3a49,'__esModule',{'value':!0x0}),_0x1a3a49['config']=void 0x0;const _0x1d5277=_0x3bee10(0x10),_0x512c05=_0x3bee10(0x4);(0x0,_0x1d5277['config'])({'path':(0x0,_0x512c05['join'])(process['cwd'](),'.env')}),_0x1a3a49[_0x2707e1(0x30b)]={'boxType':'PANDA','redis':{'host':process[_0x2707e1(0x126)]['REDIS_HOST']??_0x2707e1(0x341),'port':parseInt(process[_0x2707e1(0x126)]['REDIS_PORT']??'6888'),'db':0x3,'password':process[_0x2707e1(0x126)]['REDIS_PWD']??_0x2707e1(0x2d1)},'ezpayBe':{'apiUrl':process[_0x2707e1(0x126)]['EZZPAY_BE']??_0x2707e1(0x2cc),'apiKey':process['env'][_0x2707e1(0x145)]??_0x2707e1(0x343)},'ocr':{'poolSize':parseInt(process['env']['OCR_POOL_SIZE']||'4',0xa),'lang':process[_0x2707e1(0x126)]['OCR_LANG']||'vie','rois':{'singleLine':{'crop':{'x':parseFloat(process['env'][_0x2707e1(0x15b)]||'0'),'y':parseFloat(process['env'][_0x2707e1(0x29b)]||'0'),'width':parseFloat(process[_0x2707e1(0x126)]['OCR_ROI_SINGLE_WIDTH']||'1'),'height':parseFloat(process[_0x2707e1(0x126)]['OCR_ROI_SINGLE_HEIGHT']||'1')},'psm':parseInt(process[_0x2707e1(0x126)]['OCR_PSM_SINGLE']||'7',0xa),'charWhitelist':process['env']['OCR_WHITELIST_SINGLE']||'0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\x20.-','maxWidth':parseInt(process['env'][_0x2707e1(0x328)]||'800',0xa)},'block':{'crop':{'x':parseFloat(process['env']['OCR_ROI_BLOCK_X']||'0'),'y':parseFloat(process['env']['OCR_ROI_BLOCK_Y']||'0'),'width':parseFloat(process[_0x2707e1(0x126)]['OCR_ROI_BLOCK_WIDTH']||'1'),'height':parseFloat(process[_0x2707e1(0x126)]['OCR_ROI_BLOCK_HEIGHT']||'1')},'psm':parseInt(process['env']['OCR_PSM_BLOCK']||'6',0xa),'charWhitelist':process[_0x2707e1(0x126)]['OCR_WHITELIST_BLOCK']||void 0x0,'maxWidth':parseInt(process['env']['OCR_MAX_WIDTH_BLOCK']||_0x2707e1(0x257),0xa)},'full':{'crop':{'x':0x0,'y':0x0,'width':0x1,'height':0x1},'psm':parseInt(process['env']['OCR_PSM_FULL']||'6',0xa),'charWhitelist':void 0x0,'maxWidth':parseInt(process['env']['OCR_MAX_WIDTH_FULL']||'1200',0xa)}}},'spaceocr':{'datacenterPrimary':'https://apipro1.ocr.space/parse/image','datacenterSecond':_0x2707e1(0x347),'key':'G888CWKP2Y06X','keyFree':_0x2707e1(0x337)}};},_0x3f6dc2=>{_0x3f6dc2['exports']=require('dotenv');},(_0x80d13a,_0x3b27ec)=>{const _0x4364e0=a0_0x2633;Object['defineProperty'](_0x3b27ec,'__esModule',{'value':!0x0}),_0x3b27ec['sleep']=void 0x0,_0x3b27ec[_0x4364e0(0x23d)]=_0x2b58f5=>new Promise(_0xa4797e=>setTimeout(_0xa4797e,_0x2b58f5));},function(_0x545e15,_0x48eac2,_0x79f88a){const _0x4f4044=a0_0x2633;var _0x126e8f,_0x4a97f6,_0x4a949d,_0x25ef75,_0x32534c,_0x1b1add=this&&this['__decorate']||function(_0x11a003,_0xb86318,_0xfef510,_0x36fd6f){const _0xbd50=a0_0x2633;var _0x22c88e,_0x2b6431=arguments[_0xbd50(0x1e6)],_0x10fe8a=_0x2b6431<0x3?_0xb86318:null===_0x36fd6f?_0x36fd6f=Object['getOwnPropertyDescriptor'](_0xb86318,_0xfef510):_0x36fd6f;if('object'==typeof Reflect&&'function'==typeof Reflect[_0xbd50(0x2a1)])_0x10fe8a=Reflect['decorate'](_0x11a003,_0xb86318,_0xfef510,_0x36fd6f);else{for(var _0x122529=_0x11a003['length']-0x1;_0x122529>=0x0;_0x122529--)(_0x22c88e=_0x11a003[_0x122529])&&(_0x10fe8a=(_0x2b6431<0x3?_0x22c88e(_0x10fe8a):_0x2b6431>0x3?_0x22c88e(_0xb86318,_0xfef510,_0x10fe8a):_0x22c88e(_0xb86318,_0xfef510))||_0x10fe8a);}return _0x2b6431>0x3&&_0x10fe8a&&Object[_0xbd50(0x1c8)](_0xb86318,_0xfef510,_0x10fe8a),_0x10fe8a;},_0x346086=this&&this[_0x4f4044(0x233)]||function(_0x4f6718,_0x2326a0){const _0x5a57d8=_0x4f4044;if('object'==typeof Reflect&&_0x5a57d8(0x269)==typeof Reflect['metadata'])return Reflect['metadata'](_0x4f6718,_0x2326a0);};Object['defineProperty'](_0x48eac2,'__esModule',{'value':!0x0}),_0x48eac2['BankService']=void 0x0;const _0x5f39b6=_0x79f88a(0x2),_0x4ad46d=_0x79f88a(0x13),_0x50f22c=_0x79f88a(0x27),_0x19a482=_0x79f88a(0x15),_0x2c1fa1=_0x79f88a(0x2b),_0x39cb75=_0x79f88a(0x2c),_0x259a12=_0x79f88a(0x2a);let _0x446a84=class{constructor(_0x412bd4,_0x157efc,_0x18b575,_0x31a4b3,_0x22374c){const _0x177cde=_0x4f4044;this['acbService']=_0x412bd4,this[_0x177cde(0x2b0)]=_0x157efc,this[_0x177cde(0x1af)]=_0x18b575,this['sessionManagement']=_0x31a4b3,this['deviceLock']=_0x22374c,this[_0x177cde(0x329)]=new _0x5f39b6['Logger']('BankService'),this['bankServices']=new Map(),this[_0x177cde(0x2e6)](this[_0x177cde(0x1f9)]),this[_0x177cde(0x2e6)](this['pgService']);}['registerBankService'](_0x28de05){const _0x486703=_0x4f4044,_0x318565=_0x28de05['getBankCode']()[_0x486703(0x338)]();this['bankServices'][_0x486703(0x1e4)](_0x318565,_0x28de05),this['logger']['log']('Registered\x20bank\x20service:\x20'+_0x318565);}['getBankService'](_0x45ada7){const _0xda7916=_0x4f4044,_0x432e2c=this['bankServices']['get'](_0x45ada7[_0xda7916(0x338)]());return _0x432e2c||this['logger']['warn'](_0xda7916(0x1a7)+_0x45ada7),_0x432e2c||null;}['getSupportedBanks'](){const _0x34fa6b=_0x4f4044;return Array['from'](this['bankServices'][_0x34fa6b(0x235)]());}async['login'](_0x4d6ab4,_0x1218ad,_0x559c37=!0x1){const _0x362cb0=_0x4f4044;if(_0x559c37&&await this[_0x362cb0(0x342)]['releaseLock'](_0x1218ad),await this['deviceLock']['isLocked'](_0x1218ad)){const _0x358a03=await this[_0x362cb0(0x342)]['getLock'](_0x1218ad);throw new Error('Device\x20'+_0x1218ad+'\x20is\x20currently\x20locked\x20by\x20'+_0x358a03?.['lockType']+'\x20('+_0x358a03?.['lockedBy']+').\x20Cannot\x20login.');}const _0x382200='login:'+_0x4d6ab4+':'+_0x1218ad+':'+Date['now']();if(!await this['deviceLock']['acquireLock'](_0x1218ad,'login',_0x382200,0x41eb0))throw new Error(_0x362cb0(0x2c4)+_0x1218ad);try{await this['sessionManagement']['markLoggingIn'](_0x1218ad,_0x4d6ab4);const _0x122a7b=this['getBankService'](_0x4d6ab4);if(!_0x122a7b)throw new Error('Bank\x20service\x20not\x20found\x20for\x20bank\x20code:\x20'+_0x4d6ab4);this[_0x362cb0(0x329)]['log']('Logging\x20in\x20to\x20'+_0x4d6ab4+'\x20on\x20device\x20'+_0x1218ad),await _0x122a7b['login'](_0x1218ad),await this[_0x362cb0(0x2af)]['recordLogin'](_0x1218ad,_0x4d6ab4),this['logger']['log']('Successfully\x20logged\x20in\x20to\x20'+_0x4d6ab4+'\x20on\x20device\x20'+_0x1218ad);}catch(_0x5708e3){throw await this[_0x362cb0(0x2af)]['clearSession'](_0x1218ad,_0x4d6ab4),_0x5708e3;}finally{await this['deviceLock']['releaseLock'](_0x1218ad);}}async['loginAllActiveBanks'](){const _0x6652f3=_0x4f4044;try{const _0x337686=(await this[_0x6652f3(0x1af)]['listDevices']())['filter'](_0x311583=>'active'===_0x311583['status']&&_0x311583['bankCode']);if(0x0===_0x337686['length'])return void this[_0x6652f3(0x329)]['warn']('No\x20active\x20devices\x20found\x20to\x20login');this['logger']['log']('Logging\x20in\x20to\x20'+_0x337686[_0x6652f3(0x1e6)]+'\x20active\x20device(s)');for(const _0x168e17 of _0x337686){const _0x1330a0=_0x168e17['udid'];try{await this[_0x6652f3(0x342)][_0x6652f3(0x132)](_0x1330a0,'transfer');}catch(_0x24c364){this['logger']['warn']('Failed\x20to\x20release\x20transfer\x20lock\x20for\x20device\x20'+_0x1330a0+':\x20'+_0x24c364['message']);}}const _0x97eb4=[];for(const _0x5e97ae of _0x337686){const _0x10b77f=_0x5e97ae['bankCode']['toUpperCase'](),_0x437910=_0x5e97ae[_0x6652f3(0x268)];_0x97eb4[_0x6652f3(0x216)](this[_0x6652f3(0x2fa)](_0x10b77f,_0x437910,!0x0)[_0x6652f3(0xfb)](_0x5bb1c1=>{const _0x5dd69f=_0x6652f3;this[_0x5dd69f(0x329)][_0x5dd69f(0x25a)](_0x5dd69f(0x1ba)+_0x10b77f+_0x5dd69f(0x100)+_0x437910+':\x20'+_0x5bb1c1['message']);}));}await Promise[_0x6652f3(0x18a)](_0x97eb4),this['logger']['log'](_0x6652f3(0x187));}catch(_0x3519ac){throw this['logger']['error']('Error\x20logging\x20in\x20all\x20active\x20banks:\x20'+_0x3519ac[_0x6652f3(0x26b)]),_0x3519ac;}}['executeTransfer'](_0x7f08a2,_0x5907c8,_0x1a821f){const _0x21a24b=_0x4f4044;return this[_0x21a24b(0x2f7)](_0x1a821f)['executeTransfer'](_0x7f08a2,_0x5907c8);}['executeTransferWithQRCode'](_0x4460ca,_0x32c782,_0x12ccaf){const _0xf0e305=_0x4f4044,_0x16d451=this[_0xf0e305(0x2f7)](_0x12ccaf);return _0x16d451?_0x16d451['executeTransferWithQRCode'](_0x4460ca,_0x32c782):(this[_0xf0e305(0x329)][_0xf0e305(0x134)]('Bank\x20'+_0x12ccaf+'\x20not\x20supported,\x20cannot\x20execute\x20transfer\x20with\x20QR\x20code'),null);}async[_0x4f4044(0x1b3)](_0x87590f,_0x328072){return await this['sessionManagement']['isSessionValid'](_0x87590f,_0x328072);}async[_0x4f4044(0x149)](_0xcb5109,_0x16ec49){const _0x290d34=_0x4f4044,_0x4f296f=this['getBankService'](_0xcb5109);return _0x4f296f?await _0x4f296f['getBillImage'](_0x16ec49):(this[_0x290d34(0x329)]['warn']('Bank\x20'+_0xcb5109+'\x20not\x20supported,\x20cannot\x20get\x20bill\x20image'),null);}[_0x4f4044(0x1a4)](_0xd88099,_0x39cfcf){const _0x20f441=_0x4f4044,_0x2ced49=this['getBankService'](_0xd88099);return _0x2ced49?_0x2ced49[_0x20f441(0x1a4)](_0x39cfcf):(this['logger']['warn'](_0x20f441(0x277)+_0xd88099+_0x20f441(0x159)),null);}async[_0x4f4044(0x15d)](_0x32e452,_0x14b83f){const _0x53aafc=_0x4f4044,_0xf2fb02=await this[_0x53aafc(0x2af)]['getSession'](_0x32e452,_0x14b83f);if('logging_in'===_0xf2fb02?.['status'])return!0x1;const _0x3173e1=await this[_0x53aafc(0x2af)]['needsRefresh'](_0x32e452,_0x14b83f),_0x1381a4=await this['sessionManagement']['isSessionValid'](_0x32e452,_0x14b83f);if(!_0x3173e1&&_0x1381a4)return!0x1;if(await this['deviceLock']['isLocked'](_0x32e452))return this['logger']['warn']('Cannot\x20refresh\x20session\x20for\x20device\x20'+_0x32e452+'\x20-\x20device\x20is\x20locked'),!0x1;try{return _0x1381a4?this[_0x53aafc(0x329)]['log']('Refreshing\x20session\x20for\x20device\x20'+_0x32e452+',\x20bank\x20'+_0x14b83f):this['logger'][_0x53aafc(0x349)]('Session\x20expired\x20or\x20missing\x20for\x20device\x20'+_0x32e452+',\x20bank\x20'+_0x14b83f+'.\x20Retrying\x20login...'),await this['login'](_0x14b83f,_0x32e452),!0x0;}catch(_0x2b427b){return this['logger'][_0x53aafc(0x25a)]('Failed\x20to\x20refresh\x20session\x20for\x20device\x20'+_0x32e452+':\x20'+_0x2b427b['message']),!0x1;}}async['createQRCodeAndTransferTo'](_0x5c7454,_0x4d2445,_0xcc7441){const _0x5cf0f5=_0x4f4044,_0x15d08f=this['getBankService'](_0x5c7454);if(!_0x15d08f)throw new _0x259a12['WithdrawalProcessingError']('Bank\x20'+_0x5c7454+'\x20not\x20supported,\x20cannot\x20create\x20QR\x20code\x20and\x20transfer\x20to\x20device\x20'+_0x4d2445,_0x259a12['ErrorType'][_0x5cf0f5(0x24a)],_0xcc7441[_0x5cf0f5(0x207)]);await _0x15d08f['createQRCodeAndTransferTo'](_0x4d2445,_0xcc7441);}};_0x48eac2['BankService']=_0x446a84,_0x48eac2[_0x4f4044(0x111)]=_0x446a84=_0x1b1add([(0x0,_0x5f39b6[_0x4f4044(0x144)])(),_0x346086('design:paramtypes',[_0x4f4044(0x269)==typeof(_0x126e8f=void 0x0!==_0x4ad46d[_0x4f4044(0x1d0)]&&_0x4ad46d[_0x4f4044(0x1d0)])?_0x126e8f:Object,'function'==typeof(_0x4a97f6=void 0x0!==_0x50f22c['PgService']&&_0x50f22c[_0x4f4044(0x166)])?_0x4a97f6:Object,_0x4f4044(0x269)==typeof(_0x4a949d=void 0x0!==_0x19a482[_0x4f4044(0x214)]&&_0x19a482[_0x4f4044(0x214)])?_0x4a949d:Object,_0x4f4044(0x269)==typeof(_0x25ef75=void 0x0!==_0x2c1fa1['SessionManagementService']&&_0x2c1fa1['SessionManagementService'])?_0x25ef75:Object,_0x4f4044(0x269)==typeof(_0x32534c=void 0x0!==_0x39cb75[_0x4f4044(0xff)]&&_0x39cb75[_0x4f4044(0xff)])?_0x32534c:Object])],_0x446a84);},function(_0x4da5f0,_0x21d39f,_0x57a198){const _0x593872=a0_0x2633;var _0x2ec9ca,_0x18b7f5,_0x13c1b5,_0x48ec51=this&&this[_0x593872(0x32c)]||function(_0x55c0a8,_0x3f0d2f,_0x2f2834,_0x2d3cef){const _0x2b59e1=_0x593872;var _0x1fa84a,_0x182662=arguments[_0x2b59e1(0x1e6)],_0x207b18=_0x182662<0x3?_0x3f0d2f:null===_0x2d3cef?_0x2d3cef=Object[_0x2b59e1(0x2c5)](_0x3f0d2f,_0x2f2834):_0x2d3cef;if(_0x2b59e1(0x26d)==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x207b18=Reflect[_0x2b59e1(0x2a1)](_0x55c0a8,_0x3f0d2f,_0x2f2834,_0x2d3cef);else{for(var _0x4f54bb=_0x55c0a8[_0x2b59e1(0x1e6)]-0x1;_0x4f54bb>=0x0;_0x4f54bb--)(_0x1fa84a=_0x55c0a8[_0x4f54bb])&&(_0x207b18=(_0x182662<0x3?_0x1fa84a(_0x207b18):_0x182662>0x3?_0x1fa84a(_0x3f0d2f,_0x2f2834,_0x207b18):_0x1fa84a(_0x3f0d2f,_0x2f2834))||_0x207b18);}return _0x182662>0x3&&_0x207b18&&Object['defineProperty'](_0x3f0d2f,_0x2f2834,_0x207b18),_0x207b18;},_0x88bcf8=this&&this['__metadata']||function(_0x4a3707,_0x2a891c){const _0x116590=_0x593872;if(_0x116590(0x26d)==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0x4a3707,_0x2a891c);},_0x33627a=this&&this[_0x593872(0x248)]||function(_0x403372,_0x5316e4){return function(_0x8f6f7c,_0x5d1f8e){_0x5316e4(_0x8f6f7c,_0x5d1f8e,_0x403372);};};Object['defineProperty'](_0x21d39f,'__esModule',{'value':!0x0}),_0x21d39f['AcbService']=void 0x0;const _0x162e5a=_0x57a198(0x2),_0x489db2=_0x57a198(0x14),_0x346089=_0x57a198(0x15),_0x3ba9e2=_0x57a198(0x1a),_0x136d54=_0x57a198(0x19),_0x583a17=_0x57a198(0x11),_0x1ad0c8=_0x57a198(0x25),_0x2cdb80=_0x57a198(0x26),_0x173d02=_0x57a198(0x1d);let _0x3849e9=class extends _0x3ba9e2['BaseBankService']{constructor(_0x1a309a,_0x38fcb2,_0xbb9115){super(_0x1a309a,_0x38fcb2,_0xbb9115),this['wsService']=_0x1a309a,this['BANK_CODE']='ACB',this['BUNDLE_ID']='mobileapp.acb.com.vn';}['launchApp'](_0x157bb3){const _0x3e09bb=_0x593872;throw new Error(_0x3e09bb(0x107));}async['captureScreen'](_0x3c0df8,_0x39524c){}async['clickPasswordField'](_0x12077c){const _0x19bf41=_0x593872;try{const {x:_0x5c7f5c,y:_0x442bc8}=_0x2cdb80[_0x19bf41(0x25e)]['PASSWORD_FIELD'];this[_0x19bf41(0x329)][_0x19bf41(0x349)](_0x19bf41(0x1cf)+_0x12077c+'\x20at\x20coordinates\x20('+_0x5c7f5c+',\x20'+_0x442bc8+')'),await this['clickWithTransition'](_0x12077c,_0x5c7f5c,_0x442bc8,0.2),await(0x0,_0x583a17['sleep'])(0x3e8),this['logger'][_0x19bf41(0x349)]('Password\x20field\x20clicked\x20successfully\x20on\x20device\x20'+_0x12077c);}catch(_0xdb236c){throw this['logger'][_0x19bf41(0x25a)]('Error\x20clicking\x20password\x20field\x20on\x20device\x20'+_0x12077c+':\x20'+_0xdb236c['message']),_0xdb236c;}}async['inputPasswordFromConfig'](_0x2f103a){const _0x2605c9=_0x593872;try{const _0xf67afb=await this['deviceService'][_0x2605c9(0x151)](_0x2f103a);if(!_0xf67afb||!_0xf67afb['password'])throw new Error('Password\x20not\x20configured\x20for\x20device\x20'+_0x2f103a);await this[_0x2605c9(0x2e5)]['inputText'](_0x2f103a,_0xf67afb['password']);}catch(_0x324e91){throw this['logger']['error'](_0x2605c9(0x1e8)+_0x2f103a+':\x20'+_0x324e91['message']),_0x324e91;}}async['clickLoginButton'](_0x1cac09){const _0x2d7b6f=_0x593872;try{const {x:_0x27913a,y:_0x22d894}=_0x2cdb80['ACB_UI_COORDINATES']['LOGIN_BUTTON'];this['logger']['log']('Clicking\x20login\x20button\x20on\x20device\x20'+_0x1cac09+_0x2d7b6f(0x2c3)+_0x27913a+',\x20'+_0x22d894+')'),await this[_0x2d7b6f(0x2e5)]['click'](_0x1cac09,_0x27913a,_0x22d894,0.2),await(0x0,_0x583a17[_0x2d7b6f(0x23d)])(0x1388),this[_0x2d7b6f(0x329)][_0x2d7b6f(0x349)]('Login\x20button\x20clicked\x20successfully\x20on\x20device\x20'+_0x1cac09);}catch(_0x517fa5){throw this[_0x2d7b6f(0x329)][_0x2d7b6f(0x25a)](_0x2d7b6f(0x262)+_0x1cac09+':\x20'+_0x517fa5[_0x2d7b6f(0x26b)]),_0x517fa5;}}async[_0x593872(0x2fa)](_0x25dc83){const _0x437a96=_0x593872;try{await this['killApp'](_0x25dc83),await this['launchApp'](_0x25dc83);const {x:_0x5efc02,y:_0xfa5616}=_0x2cdb80[_0x437a96(0x25e)]['LOGIN_BUTTON'];this['logger']['log']('Clicking\x20login\x20button\x20on\x20device\x20'+_0x25dc83+_0x437a96(0x2c3)+_0x5efc02+',\x20'+_0xfa5616+')'),await this['wsService'][_0x437a96(0x237)](_0x25dc83,_0x5efc02,_0xfa5616,0.2),await(0x0,_0x583a17['sleep'])(0x7d0),await this[_0x437a96(0x2e3)](_0x25dc83),await(0x0,_0x583a17['sleep'])(0x7d0);const {x:_0x3a4ece,y:_0x248aa6}=_0x1ad0c8['COMMON_COORDINATES'][_0x437a96(0x125)];this['logger']['log']('Clicking\x20return\x20key\x20on\x20device\x20'+_0x25dc83+'\x20at\x20coordinates\x20('+_0x3a4ece+',\x20'+_0x248aa6+')'),await this[_0x437a96(0x2e5)]['click'](_0x25dc83,_0x3a4ece,_0x248aa6,0.2),await(0x0,_0x583a17['sleep'])(0x7d0),await this[_0x437a96(0x2e5)][_0x437a96(0x237)](_0x25dc83,0.5,0.62,0.2),await(0x0,_0x583a17['sleep'])(0x1388),await this[_0x437a96(0x2e5)]['click'](_0x25dc83,0.3,0.55,0.2),await this['wsService']['click'](_0x25dc83,0.5,0.65,0.2);}catch(_0x2b1c9d){throw this['logger'][_0x437a96(0x25a)]('Error\x20logging\x20in\x20on\x20device\x20'+_0x25dc83+':\x20'+_0x2b1c9d['message']),_0x2b1c9d;}}async['executeTransfer'](_0x165d0a,_0x253260){}async['executeTransferWithQRCode'](_0x1fcdc9,_0x181124){console['warn']('ACB\x20executeTransferWithQRCode');}async['executeInternalTransfer'](_0x26968c,_0x13c985){return this['executeExternalTransfer'](_0x26968c,_0x13c985);}async[_0x593872(0x2da)](_0x4fc0ea,_0x464a5f){const _0x489dcb=_0x593872;console['warn'](_0x489dcb(0x13c));}};_0x21d39f[_0x593872(0x1d0)]=_0x3849e9,_0x21d39f['AcbService']=_0x3849e9=_0x48ec51([(0x0,_0x162e5a['Injectable'])(),_0x33627a(0x0,(0x0,_0x162e5a[_0x593872(0x33e)])(_0x489db2[_0x593872(0x2a4)])),_0x88bcf8('design:paramtypes',['function'==typeof(_0x2ec9ca=void 0x0!==_0x136d54['IWebSocketService']&&_0x136d54['IWebSocketService'])?_0x2ec9ca:Object,'function'==typeof(_0x18b7f5=void 0x0!==_0x346089['DeviceService']&&_0x346089[_0x593872(0x214)])?_0x18b7f5:Object,'function'==typeof(_0x13c1b5=void 0x0!==_0x173d02[_0x593872(0x21e)]&&_0x173d02['OCRService'])?_0x13c1b5:Object])],_0x3849e9);},(_0x2732f4,_0x51ea45)=>{const _0x31597b=a0_0x2633;Object['defineProperty'](_0x51ea45,'__esModule',{'value':!0x0}),_0x51ea45[_0x31597b(0x2a4)]=void 0x0,_0x51ea45['WEBSOCKET_SERVICE']=Symbol('WEBSOCKET_SERVICE');},function(_0x4b3f4a,_0x4419b8,_0x55ab96){const _0x9c802d=a0_0x2633;var _0xad7363,_0x351a99,_0x32548c=this&&this['__decorate']||function(_0x3a3aa1,_0x2a3c4a,_0x986a2,_0x5cbc2e){const _0x3ee62c=a0_0x2633;var _0x10150d,_0xd3474b=arguments['length'],_0xd6cac5=_0xd3474b<0x3?_0x2a3c4a:null===_0x5cbc2e?_0x5cbc2e=Object[_0x3ee62c(0x2c5)](_0x2a3c4a,_0x986a2):_0x5cbc2e;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x3ee62c(0x2a1)])_0xd6cac5=Reflect['decorate'](_0x3a3aa1,_0x2a3c4a,_0x986a2,_0x5cbc2e);else{for(var _0x982e92=_0x3a3aa1['length']-0x1;_0x982e92>=0x0;_0x982e92--)(_0x10150d=_0x3a3aa1[_0x982e92])&&(_0xd6cac5=(_0xd3474b<0x3?_0x10150d(_0xd6cac5):_0xd3474b>0x3?_0x10150d(_0x2a3c4a,_0x986a2,_0xd6cac5):_0x10150d(_0x2a3c4a,_0x986a2))||_0xd6cac5);}return _0xd3474b>0x3&&_0xd6cac5&&Object['defineProperty'](_0x2a3c4a,_0x986a2,_0xd6cac5),_0xd6cac5;},_0x47d253=this&&this['__metadata']||function(_0x12df7a,_0x9dbee6){const _0x30f0e9=a0_0x2633;if('object'==typeof Reflect&&_0x30f0e9(0x269)==typeof Reflect['metadata'])return Reflect[_0x30f0e9(0x331)](_0x12df7a,_0x9dbee6);};Object['defineProperty'](_0x4419b8,'__esModule',{'value':!0x0}),_0x4419b8['DeviceService']=void 0x0;const _0x4b6355=_0x55ab96(0x2),_0x3b673a=_0x55ab96(0x16),_0x1c04ab=_0x55ab96(0x18);let _0x283859=class{constructor(_0x3fa515,_0x45a2a4){const _0x8b7052=a0_0x2633;this[_0x8b7052(0x240)]=_0x3fa515,this[_0x8b7052(0x293)]=_0x45a2a4,this[_0x8b7052(0x329)]=new _0x4b6355['Logger'](_0x8b7052(0x214)),this['REDIS_DEVICE_CONFIG_PREFIX']='device:',this[_0x8b7052(0x217)]=_0x8b7052(0x2e7),this[_0x8b7052(0x2eb)]=_0x8b7052(0x241);}async['onModuleInit'](){const _0x2ebd11=a0_0x2633;try{await this['setServiceStatus']('inactive'),this['logger'][_0x2ebd11(0x349)](_0x2ebd11(0xfa));}catch(_0x57d0bd){this['logger']['error']('Failed\x20to\x20initialize\x20service\x20status:\x20'+_0x57d0bd['message']);}}async['listDevices'](){const _0x45bb3b=a0_0x2633;try{const _0x366ce1=await this['hcBoxService'][_0x45bb3b(0x254)]();return await Promise[_0x45bb3b(0x271)](_0x366ce1['map'](async _0x4c65ae=>{const _0x1f62b8=_0x45bb3b,_0x1e0065=await this['getDeviceConfig'](_0x4c65ae['udid']);return{..._0x4c65ae,'bankCode':_0x1e0065?.['bankCode']||'','availableAmount':_0x1e0065?.['availableAmount']||0x0,'status':_0x1e0065?.['status']||'deactive','password':_0x1e0065?.['password']||'','smartOTP':_0x1e0065?.['smartOTP']||'','accountNo':_0x1e0065?.['accountNo']||'','accountName':_0x1e0065?.[_0x1f62b8(0x206)]||''};}));}catch(_0x102d1d){throw this['logger'][_0x45bb3b(0x25a)]('Error\x20listing\x20devices:\x20'+_0x102d1d[_0x45bb3b(0x26b)]),_0x102d1d;}}async['getDeviceConfig'](_0x6f7ca3){const _0x3b9504=a0_0x2633;try{const _0x47049e=''+this['REDIS_DEVICE_CONFIG_PREFIX']+_0x6f7ca3+this['REDIS_DEVICE_CONFIG_SUFFIX'],_0x50c305=await this['redisService']['get'](_0x47049e);return _0x50c305?JSON['parse'](_0x50c305):null;}catch(_0x2bcf2c){return this['logger']['error'](_0x3b9504(0x164)+_0x6f7ca3+':\x20'+_0x2bcf2c[_0x3b9504(0x26b)]),null;}}async[_0x9c802d(0x142)](_0x15a38c,_0x20ebae){const _0xe06599=_0x9c802d;try{const _0x24d633=''+this['REDIS_DEVICE_CONFIG_PREFIX']+_0x15a38c+this[_0xe06599(0x217)],_0x15853f=await this['getDeviceConfig'](_0x15a38c),_0x591ffe={'deviceId':_0x15a38c,'bankCode':void 0x0!==_0x20ebae['bankCode']?_0x20ebae['bankCode']:_0x15853f?.['bankCode']||'','availableAmount':void 0x0!==_0x20ebae[_0xe06599(0x1ec)]?_0x20ebae['availableAmount']:_0x15853f?.[_0xe06599(0x1ec)]||0x0,'status':void 0x0!==_0x20ebae[_0xe06599(0x253)]?_0x20ebae[_0xe06599(0x253)]:_0x15853f?.[_0xe06599(0x253)]||'deactive','password':void 0x0!==_0x20ebae['password']?_0x20ebae['password']:_0x15853f?.['password']||'','smartOTP':void 0x0!==_0x20ebae[_0xe06599(0x238)]?_0x20ebae['smartOTP']:_0x15853f?.['smartOTP']||'','accountNo':void 0x0!==_0x20ebae['accountNo']?_0x20ebae['accountNo']:_0x15853f?.['accountNo']||'','accountName':void 0x0!==_0x20ebae[_0xe06599(0x206)]?_0x20ebae['accountName']:_0x15853f?.[_0xe06599(0x206)]||''};return await this['redisService'][_0xe06599(0x1e4)](_0x24d633,JSON['stringify'](_0x591ffe)),this['logger'][_0xe06599(0x349)](_0xe06599(0x16f)+_0x15a38c+'\x20(bankCode:\x20'+(_0x591ffe['bankCode']||_0xe06599(0x1d7))+_0xe06599(0x18b)+JSON['stringify'](_0x591ffe)),_0x591ffe;}catch(_0x5b47df){throw this['logger']['error']('Error\x20updating\x20device\x20config\x20for\x20'+_0x15a38c+':\x20'+_0x5b47df['message']),_0x5b47df;}}async[_0x9c802d(0x202)](){const _0x38637d=_0x9c802d;try{return await this['redisService'][_0x38637d(0x192)](this[_0x38637d(0x2eb)])||'inactive';}catch(_0x2a5e84){return this['logger'][_0x38637d(0x25a)](_0x38637d(0x1a1)+_0x2a5e84[_0x38637d(0x26b)]),'inactive';}}async['setServiceStatus'](_0x7c20ed){const _0x4de22d=_0x9c802d;try{await this['redisService'][_0x4de22d(0x1e4)](this['REDIS_SERVICE_STATUS_KEY'],_0x7c20ed),this['logger'][_0x4de22d(0x349)]('Service\x20status\x20set\x20to:\x20'+_0x7c20ed);}catch(_0x39b3e3){throw this['logger'][_0x4de22d(0x25a)]('Error\x20setting\x20service\x20status:\x20'+_0x39b3e3['message']),_0x39b3e3;}}async['deductDeviceAmount'](_0x4211f8,_0x1a6eab){const _0x558fc3=_0x9c802d;try{const _0x1107b5=await this[_0x558fc3(0x151)](_0x4211f8);if(!_0x1107b5)return!0x1;const _0x51809d=_0x1107b5['availableAmount']-_0x1a6eab;return _0x51809d<0x0?(this['logger']['warn'](_0x558fc3(0x1a6)+_0x4211f8+_0x558fc3(0x2ea)+_0x1107b5['availableAmount']+',\x20Requested:\x20'+_0x1a6eab),!0x1):(await this['updateDeviceConfig'](_0x4211f8,{'availableAmount':_0x51809d}),!0x0);}catch(_0x351614){return this['logger'][_0x558fc3(0x25a)](_0x558fc3(0x230)+_0x4211f8+':\x20'+_0x351614[_0x558fc3(0x26b)]),!0x1;}}async['hasActiveDevice'](){const _0x51b568=_0x9c802d;try{return(await this['listDevices']())['some'](_0x25f3f5=>'active'===_0x25f3f5['status']);}catch(_0x59bcd2){return this[_0x51b568(0x329)]['error']('Error\x20checking\x20active\x20devices:\x20'+_0x59bcd2['message']),!0x1;}}};_0x4419b8[_0x9c802d(0x214)]=_0x283859,_0x4419b8['DeviceService']=_0x283859=_0x32548c([(0x0,_0x4b6355['Injectable'])(),_0x47d253('design:paramtypes',['function'==typeof(_0xad7363=void 0x0!==_0x3b673a[_0x9c802d(0x18c)]&&_0x3b673a[_0x9c802d(0x18c)])?_0xad7363:Object,'function'==typeof(_0x351a99=void 0x0!==_0x1c04ab['HcBoxService']&&_0x1c04ab['HcBoxService'])?_0x351a99:Object])],_0x283859);},function(_0x2f2ea3,_0x752c46,_0x4b809b){const _0x3aac04=a0_0x2633;var _0x26dbc8=this&&this['__decorate']||function(_0x30bdb4,_0x168538,_0x35f2ec,_0x4cf4e7){const _0x43be2e=a0_0x2633;var _0x3f4692,_0x39d30d=arguments['length'],_0x106a21=_0x39d30d<0x3?_0x168538:null===_0x4cf4e7?_0x4cf4e7=Object['getOwnPropertyDescriptor'](_0x168538,_0x35f2ec):_0x4cf4e7;if(_0x43be2e(0x26d)==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x106a21=Reflect[_0x43be2e(0x2a1)](_0x30bdb4,_0x168538,_0x35f2ec,_0x4cf4e7);else{for(var _0x27ff15=_0x30bdb4['length']-0x1;_0x27ff15>=0x0;_0x27ff15--)(_0x3f4692=_0x30bdb4[_0x27ff15])&&(_0x106a21=(_0x39d30d<0x3?_0x3f4692(_0x106a21):_0x39d30d>0x3?_0x3f4692(_0x168538,_0x35f2ec,_0x106a21):_0x3f4692(_0x168538,_0x35f2ec))||_0x106a21);}return _0x39d30d>0x3&&_0x106a21&&Object['defineProperty'](_0x168538,_0x35f2ec,_0x106a21),_0x106a21;},_0xaacf39=this&&this['__metadata']||function(_0x140649,_0x5c7047){const _0x1a2756=a0_0x2633;if(_0x1a2756(0x26d)==typeof Reflect&&'function'==typeof Reflect[_0x1a2756(0x331)])return Reflect['metadata'](_0x140649,_0x5c7047);};Object['defineProperty'](_0x752c46,'__esModule',{'value':!0x0}),_0x752c46['RedisService']=void 0x0;const _0x4c1c00=_0x4b809b(0x2),_0x32d9ce=_0x4b809b(0x17),_0x31c216=_0x4b809b(0xf);let _0x2c093c=class{constructor(){const _0x3a5fcb=a0_0x2633;this[_0x3a5fcb(0x329)]=new _0x4c1c00[(_0x3a5fcb(0x1da))](_0x3a5fcb(0x18c)),this['redisClient']=null;}async['getClient'](){const _0x53858e=a0_0x2633;if(this['redisClient'])return this[_0x53858e(0x1df)];const _0x5320a4=_0x31c216['config'][_0x53858e(0x336)][_0x53858e(0x16d)]??'localhost',_0x55d20a=_0x31c216['config'][_0x53858e(0x336)][_0x53858e(0x160)]??0x18eb,_0x3b1f0d=_0x31c216[_0x53858e(0x30b)][_0x53858e(0x336)]['password']??void 0x0,_0x39ce0f=_0x31c216['config']['redis']['db']??0x3;return this['redisClient']=new _0x32d9ce[(_0x53858e(0x330))]({'host':_0x5320a4,'port':_0x55d20a,'password':_0x3b1f0d,'db':_0x39ce0f,'enableReadyCheck':!0x1,'maxRetriesPerRequest':null,'lazyConnect':!0x0}),this['redisClient']['on']('error',_0x563d56=>{const _0x221d43=_0x53858e;this[_0x221d43(0x329)]['error'](_0x221d43(0x11a),_0x563d56[_0x221d43(0x267)]||_0x563d56['message']);}),this[_0x53858e(0x1df)]['on']('connect',()=>{this['logger']['log']('Redis\x20Client\x20Connected');}),this[_0x53858e(0x1df)]['on'](_0x53858e(0x1d4),()=>{const _0x46689c=_0x53858e;this[_0x46689c(0x329)]['log']('Redis\x20Client\x20Ready');}),this['redisClient']['on']('close',()=>{this['logger']['warn']('Redis\x20Client\x20Connection\x20Closed');}),this['redisClient']['on']('reconnecting',()=>{const _0x3c7caf=_0x53858e;this[_0x3c7caf(0x329)][_0x3c7caf(0x349)]('Redis\x20Client\x20Reconnecting...');}),await this[_0x53858e(0x1df)]['connect'](),this[_0x53858e(0x1df)];}async[_0x3aac04(0x1b1)](){this['redisClient']&&(await this['redisClient']['disconnect'](),this['redisClient']=null,this['logger']['log']('Redis\x20Client\x20Disconnected'));}async['onModuleDestroy'](){const _0x3cc355=_0x3aac04;await this[_0x3cc355(0x1b1)]();}async[_0x3aac04(0x192)](_0x1412f0){const _0x19fa27=_0x3aac04;return(await this[_0x19fa27(0x116)]())['get'](_0x1412f0);}async[_0x3aac04(0x1e4)](_0x17a6e9,_0x3a1c66,_0x563fec){const _0x338cf6=_0x3aac04,_0x555f88=await this['getClient']();if(_0x563fec){const _0x1f7715=Math[_0x338cf6(0x1cc)](_0x563fec/0x3e8);return _0x555f88[_0x338cf6(0x2d6)](_0x17a6e9,_0x1f7715,_0x3a1c66);}return _0x555f88['set'](_0x17a6e9,_0x3a1c66);}async['setex'](_0x3bd118,_0xa4cec6,_0x40a3c8){const _0x3a845f=await this['getClient'](),_0x4518fd=Math['ceil'](_0xa4cec6/0x3e8);return _0x3a845f['setex'](_0x3bd118,_0x4518fd,_0x40a3c8);}async[_0x3aac04(0x2fd)](_0x2d38ad){const _0x5bedc2=_0x3aac04;return(await this[_0x5bedc2(0x116)]())['del'](_0x2d38ad);}async['exists'](_0x4c78d4){const _0x3e04a6=_0x3aac04;return(await this[_0x3e04a6(0x116)]())['exists'](_0x4c78d4);}async['zadd'](_0x428468,_0x5aa8de,_0x2ba79a){return(await this['getClient']())['zadd'](_0x428468,_0x5aa8de,_0x2ba79a);}async['zrange'](_0x4007da,_0x492afd,_0x1ee0e1){return(await this['getClient']())['zrange'](_0x4007da,_0x492afd,_0x1ee0e1);}async['zrangebyscore'](_0x1803c6,_0x44ca9a,_0x30ec2d,_0x3c2d1e){const _0xcd89e1=_0x3aac04,_0x232ab2=await this['getClient']();return _0x3c2d1e?_0x232ab2['zrangebyscore'](_0x1803c6,_0x44ca9a,_0x30ec2d,'LIMIT',_0x3c2d1e[_0xcd89e1(0x30e)],_0x3c2d1e['count']):_0x232ab2['zrangebyscore'](_0x1803c6,_0x44ca9a,_0x30ec2d);}async['zrem'](_0x45eefb,..._0x38f685){const _0x455674=_0x3aac04;return(await this[_0x455674(0x116)]())['zrem'](_0x45eefb,..._0x38f685);}async['sadd'](_0x1e81f1,..._0x175069){return(await this['getClient']())['sadd'](_0x1e81f1,..._0x175069);}async['sismember'](_0x265803,_0x49a578){const _0x26a1ab=_0x3aac04;return(await this[_0x26a1ab(0x116)]())['sismember'](_0x265803,_0x49a578);}async['hset'](_0x45c207,_0x1a37be,_0x421cde){const _0x2b46ef=_0x3aac04;return(await this[_0x2b46ef(0x116)]())['hset'](_0x45c207,_0x1a37be,_0x421cde);}async['hget'](_0xf2def0,_0x54682c){const _0x1197e1=_0x3aac04;return(await this['getClient']())[_0x1197e1(0x197)](_0xf2def0,_0x54682c);}async['hgetall'](_0x557a44){const _0x50de8d=_0x3aac04;return(await this[_0x50de8d(0x116)]())['hgetall'](_0x557a44);}async['expire'](_0x12347c,_0x3f1a48){const _0x3c729d=_0x3aac04;return(await this[_0x3c729d(0x116)]())['expire'](_0x12347c,_0x3f1a48);}async['setnx'](_0x59ae2a,_0xf74ddf,_0x1333c1){const _0xcf9e86=_0x3aac04,_0x14b6bf=await this['getClient']();if(_0x1333c1){const _0xa171b2=Math[_0xcf9e86(0x1cc)](_0x1333c1/0x3e8);return await _0x14b6bf['set'](_0x59ae2a,_0xf74ddf,'EX',_0xa171b2,'NX');}return await _0x14b6bf['set'](_0x59ae2a,_0xf74ddf,'NX');}};_0x752c46['RedisService']=_0x2c093c,_0x752c46[_0x3aac04(0x18c)]=_0x2c093c=_0x26dbc8([(0x0,_0x4c1c00['Injectable'])(),_0xaacf39('design:paramtypes',[])],_0x2c093c);},_0xe90fc9=>{_0xe90fc9['exports']=require('ioredis');},function(_0x5689da,_0x2e77c1,_0x2d5aa9){const _0x38a464=a0_0x2633;var _0x4975a8,_0x3c7274=this&&this['__decorate']||function(_0x3f2445,_0x32938e,_0x2f1226,_0x58ed3b){const _0x36e9b2=a0_0x2633;var _0x17b920,_0x24ed56=arguments['length'],_0x27c86f=_0x24ed56<0x3?_0x32938e:null===_0x58ed3b?_0x58ed3b=Object['getOwnPropertyDescriptor'](_0x32938e,_0x2f1226):_0x58ed3b;if('object'==typeof Reflect&&_0x36e9b2(0x269)==typeof Reflect['decorate'])_0x27c86f=Reflect[_0x36e9b2(0x2a1)](_0x3f2445,_0x32938e,_0x2f1226,_0x58ed3b);else{for(var _0x84d70c=_0x3f2445['length']-0x1;_0x84d70c>=0x0;_0x84d70c--)(_0x17b920=_0x3f2445[_0x84d70c])&&(_0x27c86f=(_0x24ed56<0x3?_0x17b920(_0x27c86f):_0x24ed56>0x3?_0x17b920(_0x32938e,_0x2f1226,_0x27c86f):_0x17b920(_0x32938e,_0x2f1226))||_0x27c86f);}return _0x24ed56>0x3&&_0x27c86f&&Object['defineProperty'](_0x32938e,_0x2f1226,_0x27c86f),_0x27c86f;},_0x542143=this&&this['__metadata']||function(_0x443481,_0x24ffed){const _0x44a67b=a0_0x2633;if(_0x44a67b(0x26d)==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect[_0x44a67b(0x331)](_0x443481,_0x24ffed);},_0x1f179d=this&&this['__param']||function(_0x5d8175,_0x2fe785){return function(_0x339ae3,_0x4c3374){_0x2fe785(_0x339ae3,_0x4c3374,_0x5d8175);};};Object[_0x38a464(0x1c8)](_0x2e77c1,'__esModule',{'value':!0x0}),_0x2e77c1[_0x38a464(0x183)]=void 0x0;const _0x33ae54=_0x2d5aa9(0x2),_0x4b93bc=_0x2d5aa9(0x14),_0x173ab0=_0x2d5aa9(0x19),_0x521a0a=_0x2d5aa9(0x11);let _0x5a4dae=class{constructor(_0x2547a2){this['wsService']=_0x2547a2,this['logger']=new _0x33ae54['Logger']('HcBoxService');}async['listDevices'](){const _0x56c56e=_0x38a464;try{return await this[_0x56c56e(0x2e5)]['listDevices']();}catch(_0x590766){throw this['logger']['error']('Error\x20listing\x20devices:\x20'+_0x590766['message']),_0x590766;}}async['executeTransfer'](_0x195c7d,_0x13fc35){const _0xb6fee9=_0x38a464;try{this['logger']['log']('Executing\x20transfer\x20for\x20withdrawal\x20'+_0x195c7d[_0xb6fee9(0x207)]+'\x20on\x20device\x20'+_0x13fc35);const _0x12cc7c=this[_0xb6fee9(0x1a8)](_0x195c7d['bankCode']);return _0x12cc7c&&(await this['wsService']['launchApp'](_0x13fc35,_0x12cc7c),await(0x0,_0x521a0a[_0xb6fee9(0x23d)])(0xbb8)),await this['wsService']['click'](_0x13fc35,0.5,0.3,0.2),await(0x0,_0x521a0a['sleep'])(0x7d0),this['logger'][_0xb6fee9(0x134)]('Transfer\x20execution\x20flow\x20needs\x20to\x20be\x20customized\x20per\x20bank\x20app\x20UI'),this[_0xb6fee9(0x329)]['log']('Transfer\x20execution\x20completed\x20for\x20withdrawal\x20'+_0x195c7d[_0xb6fee9(0x207)]),!0x0;}catch(_0x44c7ca){throw this[_0xb6fee9(0x329)]['error']('Error\x20executing\x20transfer\x20for\x20withdrawal\x20'+_0x195c7d['withdrawalId']+':\x20'+_0x44c7ca['message']),_0x44c7ca;}}['getBankBundleId'](_0x4b7fbf){const _0x5ec987=_0x38a464;return{'VIETCOMBANK':_0x5ec987(0x1fb),'TPBANK':'com.tpbank.mobilebanking','TECHCOMBANK':'com.techcombank.mobilebanking'}[_0x4b7fbf]||null;}async[_0x38a464(0x237)](_0x2d177b,_0x447eeb,_0x5088cf,_0x382261=0.2){return this['wsService']['click'](_0x2d177b,_0x447eeb,_0x5088cf,_0x382261);}async['swipe'](_0x46726e,_0x1c6b81){return this['wsService']['swipe'](_0x46726e,_0x1c6b81);}async['screen'](_0x51e94a,_0x30a1a6){const _0x2fed88=_0x38a464;return this['wsService'][_0x2fed88(0x220)](_0x51e94a,_0x30a1a6);}async[_0x38a464(0x13e)](_0x18d54e){const _0x31ef89=_0x38a464;return this['wsService'][_0x31ef89(0x13e)](_0x18d54e);}async[_0x38a464(0x105)](_0x4c5abb,_0x99c149){const _0x2ea657=_0x38a464;return this['wsService'][_0x2ea657(0x105)](_0x4c5abb,_0x99c149);}['inputText'](_0x14c14c,_0x34a25b){return this['wsService']['inputText'](_0x14c14c,_0x34a25b);}};_0x2e77c1['HcBoxService']=_0x5a4dae,_0x2e77c1['HcBoxService']=_0x5a4dae=_0x3c7274([(0x0,_0x33ae54['Injectable'])(),_0x1f179d(0x0,(0x0,_0x33ae54[_0x38a464(0x33e)])(_0x4b93bc['WEBSOCKET_SERVICE'])),_0x542143(_0x38a464(0x1b9),['function'==typeof(_0x4975a8=void 0x0!==_0x173ab0[_0x38a464(0x1f2)]&&_0x173ab0['IWebSocketService'])?_0x4975a8:Object])],_0x5a4dae);},(_0x6b46c1,_0x4c6663)=>{const _0x1c647c=a0_0x2633;Object['defineProperty'](_0x4c6663,_0x1c647c(0x209),{'value':!0x0});},function(_0x4adaf7,_0x33a05a,_0x194893){const _0x5592d6=a0_0x2633;var _0x16404f,_0x31deac,_0x399665,_0x23618b,_0x1f1eb2=this&&this['__decorate']||function(_0xd65fd0,_0x415abd,_0x46146e,_0x5ea001){const _0x11febe=a0_0x2633;var _0x3de007,_0x5e8bc9=arguments['length'],_0x1feea0=_0x5e8bc9<0x3?_0x415abd:null===_0x5ea001?_0x5ea001=Object['getOwnPropertyDescriptor'](_0x415abd,_0x46146e):_0x5ea001;if('object'==typeof Reflect&&_0x11febe(0x269)==typeof Reflect['decorate'])_0x1feea0=Reflect['decorate'](_0xd65fd0,_0x415abd,_0x46146e,_0x5ea001);else{for(var _0x3b236a=_0xd65fd0[_0x11febe(0x1e6)]-0x1;_0x3b236a>=0x0;_0x3b236a--)(_0x3de007=_0xd65fd0[_0x3b236a])&&(_0x1feea0=(_0x5e8bc9<0x3?_0x3de007(_0x1feea0):_0x5e8bc9>0x3?_0x3de007(_0x415abd,_0x46146e,_0x1feea0):_0x3de007(_0x415abd,_0x46146e))||_0x1feea0);}return _0x5e8bc9>0x3&&_0x1feea0&&Object[_0x11febe(0x1c8)](_0x415abd,_0x46146e,_0x1feea0),_0x1feea0;},_0x33a665=this&&this[_0x5592d6(0x233)]||function(_0x4db75c,_0xa29f69){const _0x3cbb6e=_0x5592d6;if('object'==typeof Reflect&&_0x3cbb6e(0x269)==typeof Reflect['metadata'])return Reflect[_0x3cbb6e(0x331)](_0x4db75c,_0xa29f69);},_0x1b1543=this&&this[_0x5592d6(0x248)]||function(_0x423b47,_0x530f30){return function(_0x4877bf,_0x651f57){_0x530f30(_0x4877bf,_0x651f57,_0x423b47);};};Object['defineProperty'](_0x33a05a,'__esModule',{'value':!0x0}),_0x33a05a[_0x5592d6(0x10e)]=void 0x0;const _0x170e1a=_0x194893(0x2),_0x40246f=_0x194893(0x15),_0x18d228=_0x194893(0x19),_0x378cea=_0x194893(0x14),_0x4576d8=_0x194893(0x11),_0x2aee03=_0x194893(0xe),_0x2fc587=_0x194893(0x1b),_0x59487b=_0x194893(0x4),_0x4f4e37=_0x194893(0x1c),_0xf4f139=_0x194893(0x1d),_0x9ab204=_0x194893(0x23),_0x19fcf9=_0x194893(0x24);let _0xabab7=_0x16404f=class{constructor(_0x231725,_0x13a311,_0x769840){const _0xda3814=_0x5592d6;this['wsService']=_0x231725,this['deviceService']=_0x13a311,this['ocrService']=_0x769840,this[_0xda3814(0x28a)]='C:/EasyData',this['baseTransactionExecutionFolder']='C:/EasyTrx',this['logger']=new _0x170e1a[(_0xda3814(0x1da))](_0xda3814(0x10e)),_0x16404f['createTransactionFolder'](this['baseTransactionFolderPath'],this['logger']),_0x16404f['createTransactionFolder'](this[_0xda3814(0x1bc)],this['logger']);}static['createTransactionFolder'](_0x4ff2a1,_0x3424f1){const _0x46d160=_0x5592d6;if(!_0x16404f['folderCreated']){if(_0x16404f['folderCreationInProgress']){let _0x2baf88=0x0;const _0x2aab97=0xa;for(;_0x16404f['folderCreationInProgress']&&_0x2baf88<_0x2aab97;){_0x2baf88++;const _0x4557f6=Date['now']();for(;Date['now']()-_0x4557f6<0xa;);}if(_0x16404f['folderCreated']||(0x0,_0x2aee03[_0x46d160(0x228)])(_0x4ff2a1))return void(_0x16404f[_0x46d160(0x283)]=!0x0);}try{_0x16404f['folderCreationInProgress']=!0x0,(0x0,_0x2aee03[_0x46d160(0x228)])(_0x4ff2a1)?_0x3424f1['debug']('Base\x20folder\x20already\x20exists:\x20'+_0x4ff2a1):((0x0,_0x2aee03['mkdirSync'])(_0x4ff2a1,{'recursive':!0x0}),_0x3424f1[_0x46d160(0x349)]('Created\x20base\x20folder:\x20'+_0x4ff2a1)),_0x16404f['folderCreated']=!0x0;}catch(_0x5083e9){_0x46d160(0x193)!==_0x5083e9['code']?_0x3424f1['error'](_0x46d160(0xfc)+_0x4ff2a1+':\x20'+_0x5083e9[_0x46d160(0x26b)]):(_0x16404f['folderCreated']=!0x0,_0x3424f1['debug']('Base\x20folder\x20already\x20exists\x20(created\x20by\x20another\x20process):\x20'+_0x4ff2a1));}finally{_0x16404f['folderCreationInProgress']=!0x1;}}}['getBankCode'](){const _0xf5765f=_0x5592d6;return this[_0xf5765f(0x1f6)];}async['killApp'](_0x270f80){const _0x2e0629=_0x5592d6;this['logger']['log'](_0x2e0629(0x1a9)+this['BANK_CODE']+'\x20app\x20on\x20device\x20'+_0x270f80),await this[_0x2e0629(0x2e5)]['killApp'](_0x270f80,this['BUNDLE_ID']);}async[_0x5592d6(0x28b)](_0x4ef664,_0x4586dd,_0x21a9cd,_0x352282,_0x58d3d4=''){await this['wsService']['click'](_0x4ef664,_0x4586dd,_0x21a9cd,0.2),_0x58d3d4&&this['logger']['log'](_0x58d3d4),await(0x0,_0x4576d8['sleep'])(_0x352282);}async['verifyScreenState'](_0x3726bc,_0x553e01){const _0x2aa5f0=_0x5592d6,{expectedTexts:_0x237db2=[],unexpectedTexts:_0x1b0236=[],timeout:_0x521cce=0x7530,pollInterval:_0x3390fc=0x1f4,roi:_0x3470c4,fieldType:_0x43ee2c='full',preprocess:_0x2ee55d}=_0x553e01,_0x55de1e=Date['now']();let _0x35f6ca=0x0;const _0x4487a3=_0x3470c4?_0x2aa5f0(0x2d9)+_0x3470c4['x']+',\x20y='+_0x3470c4['y']+',\x20w='+_0x3470c4['width']+',\x20h='+_0x3470c4[_0x2aa5f0(0x152)]:_0x2aa5f0(0x2d7);for(this['logger']['debug']('['+_0x3726bc+']\x20Starting\x20screen\x20verification.\x20Expected:\x20['+_0x237db2['join'](',\x20')+'],\x20Unexpected:\x20['+_0x1b0236['join'](',\x20')+'],\x20'+_0x4487a3+',\x20Timeout:\x20'+_0x521cce+_0x2aa5f0(0x276)+_0x3390fc+'ms');Date['now']()-_0x55de1e<_0x521cce;){_0x35f6ca++;let _0xadc231=null;try{const _0x160db5=(0x0,_0x59487b[_0x2aa5f0(0x21c)])(this['baseTransactionExecutionFolder'],_0x2aa5f0(0x11b)+_0x3726bc);try{await(0x0,_0x2fc587[_0x2aa5f0(0x146)])(_0x160db5,{'recursive':!0x0});}catch(_0x4ffeae){}const _0x448c19=Date[_0x2aa5f0(0x292)]();await this['wsService'][_0x2aa5f0(0x220)](_0x3726bc,{'folderPath':_0x160db5}),await(0x0,_0x4576d8[_0x2aa5f0(0x23d)])(0x320);let _0xa12889=null,_0x241645=0x0;try{const _0x2c84af=(await(0x0,_0x2fc587['readdir'])(_0x160db5))[_0x2aa5f0(0x20e)](_0x25e080=>_0x25e080[_0x2aa5f0(0x11c)](_0x2aa5f0(0x12c)));if(0x0===_0x2c84af['length']){this['logger']['debug']('['+_0x3726bc+']\x20No\x20screenshot\x20files\x20found\x20in\x20folder,\x20retrying...'),await(0x0,_0x4576d8[_0x2aa5f0(0x23d)])(_0x3390fc);continue;}const _0x2f5910=Date[_0x2aa5f0(0x292)]();for(const _0x715432 of _0x2c84af){const _0xac4265=(0x0,_0x59487b['join'])(_0x160db5,_0x715432);try{const _0x165c9b=await(0x0,_0x2fc587['stat'])(_0xac4265);if(0x0===_0x165c9b['size'])continue;_0x2f5910-_0x165c9b[_0x2aa5f0(0x2f5)]<0x1388&&_0x165c9b['mtimeMs']>=_0x448c19-0x7d0&&_0x165c9b['mtimeMs']>_0x241645&&(_0x241645=_0x165c9b['mtimeMs'],_0xa12889=_0xac4265);}catch(_0x4d1ac1){continue;}}if(!_0xa12889){await(0x0,_0x4576d8['sleep'])(_0x3390fc);continue;}_0xadc231=_0xa12889;}catch(_0x44dc13){this['logger'][_0x2aa5f0(0x2ac)]('['+_0x3726bc+']\x20Cannot\x20read\x20screenshot\x20folder,\x20retrying...'),await(0x0,_0x4576d8['sleep'])(_0x3390fc);continue;}const _0x2cb40e=[..._0x237db2,..._0x1b0236],_0x24fa6f=await this['ocrService']['fastScreenOCR'](_0xadc231,_0x2cb40e,{'fieldType':_0x3470c4?'singleLine':_0x43ee2c,'customROI':_0x3470c4,'preprocess':_0x2ee55d});if(_0xadc231)try{await(0x0,_0x2fc587['unlink'])(_0xadc231),_0xadc231=null;}catch(_0x434e4e){}if(!_0x24fa6f||!_0x24fa6f[_0x2aa5f0(0x2bc)]){await(0x0,_0x4576d8['sleep'])(_0x3390fc);continue;}const _0x5ce64b=_0x24fa6f[_0x2aa5f0(0x2bc)],_0x2083e5=_0x1b0236['some'](_0x5cd9b1=>_0x24fa6f['matchedTexts']['includes'](_0x5cd9b1));if(_0x5ce64b&&!_0x2083e5)return!0x0;_0x35f6ca%0x5==0x0&&this['logger']['debug']('['+_0x3726bc+']\x20Screen\x20not\x20matched\x20yet\x20(attempt\x20'+_0x35f6ca+').\x20Matched\x20texts:\x20['+_0x24fa6f[_0x2aa5f0(0x165)]['join'](',\x20')+'],\x20Expected:\x20['+_0x237db2['join'](',\x20')+']'),await(0x0,_0x4576d8['sleep'])(_0x3390fc);}catch(_0x4b0f37){if(_0xadc231)try{await(0x0,_0x2fc587[_0x2aa5f0(0x120)])(_0xadc231);}catch{}this[_0x2aa5f0(0x329)]['debug']('['+_0x3726bc+']\x20Error\x20verifying\x20screen\x20(attempt\x20'+_0x35f6ca+_0x2aa5f0(0x18b)+_0x4b0f37['message']+',\x20retrying...'),await(0x0,_0x4576d8[_0x2aa5f0(0x23d)])(_0x3390fc);}}const _0x2d2e9b=Date[_0x2aa5f0(0x292)]()-_0x55de1e;return this['logger']['warn']('['+_0x3726bc+']\x20Screen\x20verification\x20timeout\x20after\x20'+_0x2d2e9b+'ms\x20('+_0x35f6ca+_0x2aa5f0(0x32e)+_0x237db2['join'](',\x20')+']'),!0x1;}async['clickAndWaitForScreen'](_0x44b2ab,_0x5689f2,_0x53ef7e,_0x21b360,_0x2d833e){const _0x4aa15f=_0x5592d6;await this[_0x4aa15f(0x2e5)]['click'](_0x44b2ab,_0x5689f2,_0x53ef7e,0.2),_0x2d833e&&this[_0x4aa15f(0x329)][_0x4aa15f(0x349)](_0x2d833e);const _0x398637=await this[_0x4aa15f(0x314)](_0x44b2ab,_0x21b360);return this['logger']['debug']('['+_0x44b2ab+']\x20Screen\x20verified\x20after\x20click\x20at\x20('+_0x5689f2+',\x20'+_0x53ef7e+')'),_0x398637;}async['createBillFolder'](_0x2bca76){const _0x1a2331=_0x5592d6,_0x7ab05f=(0x0,_0x59487b[_0x1a2331(0x27e)])(this[_0x1a2331(0x28a)],_0x2bca76);await(0x0,_0x2fc587['mkdir'])(_0x7ab05f,{'recursive':!0x0});}async[_0x5592d6(0x220)](_0x559dcd,_0x5a8ffb){const _0x1a7373=_0x5592d6;this['logger'][_0x1a7373(0x349)]('Capturing\x20screen\x20on\x20device\x20'+_0x559dcd+'\x20with\x20folderPath:\x20'+_0x5a8ffb['folderPath']);const _0x461e59=(0x0,_0x59487b['resolve'])(this['baseTransactionFolderPath'],_0x5a8ffb['folderPath']);await this[_0x1a7373(0x2e5)]['captureScreen'](_0x559dcd,{..._0x5a8ffb,'folderPath':_0x461e59});}async['getBillImage'](_0x24c5d4){const _0x2f1373=_0x5592d6;try{const _0xf72e6d=(0x0,_0x59487b[_0x2f1373(0x21c)])(this[_0x2f1373(0x28a)],_0x24c5d4),_0x514443=(await(0x0,_0x2fc587['readdir'])(_0xf72e6d))[0x0];if(!_0x514443)return this[_0x2f1373(0x329)]['warn']('No\x20image\x20file\x20found\x20in\x20folder:\x20'+_0x24c5d4),null;const _0x1e15fe=(0x0,_0x59487b['join'])(_0xf72e6d,_0x514443),_0x56d81d=(await(0x0,_0x2fc587['readFile'])(_0x1e15fe))['toString']('base64'),_0x3f1807=_0x514443[_0x2f1373(0x232)]()[_0x2f1373(0x10d)](_0x514443[_0x2f1373(0x311)]('.'));return'data:'+(0x0,_0x4f4e37['getMimeType'])(_0x3f1807)+';base64,'+_0x56d81d;}catch(_0x5ba8ae){throw this['logger'][_0x2f1373(0x25a)]('Error\x20loading\x20image\x20from\x20folder\x20'+_0x24c5d4+':\x20'+_0x5ba8ae[_0x2f1373(0x26b)]),_0x5ba8ae;}}async['getBillImagePath'](_0x54dd81,_0x4dab62=0x2710,_0x5a0eec=0x1f4){const _0x54ab1f=_0x5592d6;if(!_0x54dd81)return this[_0x54ab1f(0x329)]['warn'](_0x54ab1f(0x14e)),null;const _0x546142=(0x0,_0x59487b['join'])(this['baseTransactionFolderPath'],_0x54dd81),_0x5832bc=Date['now']();let _0x781ef9=0x0;for(this['logger']['debug']('Scanning\x20folder\x20for\x20bill\x20image:\x20'+_0x54dd81+',\x20timeout:\x20'+_0x4dab62+'ms,\x20pollInterval:\x20'+_0x5a0eec+'ms');Date['now']()-_0x5832bc<_0x4dab62;){_0x781ef9++;try{if(!(0x0,_0x2aee03[_0x54ab1f(0x228)])(_0x546142)){await(0x0,_0x4576d8['sleep'])(_0x5a0eec);continue;}const _0x20a6fe=await(0x0,_0x2fc587['readdir'])(_0x546142);if(0x0===_0x20a6fe[_0x54ab1f(0x1e6)]){await(0x0,_0x4576d8[_0x54ab1f(0x23d)])(_0x5a0eec);continue;}const _0x1fc235=(await Promise['all'](_0x20a6fe[_0x54ab1f(0x1eb)](async _0x793647=>{const _0x29fdbf=_0x54ab1f;try{const _0x48ba72=(0x0,_0x59487b['join'])(_0x546142,_0x793647),_0x4a963c=await(0x0,_0x2fc587['stat'])(_0x48ba72);return{'fullPath':_0x48ba72,'mtime':_0x4a963c['mtimeMs'],'size':_0x4a963c[_0x29fdbf(0x316)]};}catch(_0x5d9c12){return null;}})))['filter'](_0x14450c=>null!==_0x14450c&&_0x14450c[_0x54ab1f(0x316)]>0x0);if(0x0===_0x1fc235[_0x54ab1f(0x1e6)]){await(0x0,_0x4576d8['sleep'])(_0x5a0eec);continue;}_0x1fc235['sort']((_0x4919f0,_0x4a1b43)=>_0x4a1b43[_0x54ab1f(0x1b7)]-_0x4919f0['mtime']);const _0x322bf6=_0x1fc235[0x0]['fullPath'],_0x38de41=Date['now']()-_0x5832bc;return this['logger'][_0x54ab1f(0x349)]('Found\x20latest\x20bill\x20image:\x20'+_0x322bf6+_0x54ab1f(0x27a)+_0x38de41+'ms\x20('+_0x781ef9+_0x54ab1f(0x261)),_0x322bf6;}catch(_0x5e5b12){this['logger']['debug']('Error\x20scanning\x20folder\x20'+_0x54dd81+'\x20(attempt\x20'+_0x781ef9+'):\x20'+_0x5e5b12[_0x54ab1f(0x26b)]+_0x54ab1f(0x24e)),await(0x0,_0x4576d8['sleep'])(_0x5a0eec);}}const _0x36c852=Date['now']()-_0x5832bc;return this['logger']['warn']('Timeout\x20scanning\x20folder\x20for\x20bill\x20image:\x20'+_0x54dd81+'\x20after\x20'+_0x36c852+'ms\x20('+_0x781ef9+'\x20attempts)'),null;}async['analyzeTransferBill'](_0x4dfa56){const _0x3ab7a4=_0x5592d6,_0xad1f84=await this[_0x3ab7a4(0x2ed)](_0x4dfa56['withdrawalCode']);try{if(!_0xad1f84)return this['logger']['warn'](_0x3ab7a4(0x140)+_0x4dfa56['withdrawalCode']),{'rawPath':null,'analyzedStatus':'na'};const _0xb1f7b9=await this['ocrService']['fastScreenOCR'](_0xad1f84,[_0x3ab7a4(0x1be)],{'fieldType':_0x3ab7a4(0x2b8),'customROI':_0x19fcf9['PG_ROI_EXPECTED']['TRANSACTION_SUCCESS'],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}});return _0xb1f7b9['found']?{'rawPath':_0xad1f84,'analyzedStatus':_0xb1f7b9['found']?'success':'unknown'}:(this[_0x3ab7a4(0x329)]['warn'](_0x3ab7a4(0x17f)+_0x4dfa56['withdrawalCode']),{'rawPath':_0xad1f84,'analyzedStatus':'na'});}catch(_0x12980f){return this['logger']['error']('Error\x20analyzing\x20transfer\x20bill:\x20'+_0x12980f['message']),{'rawPath':_0xad1f84,'analyzedStatus':'na'};}}async['createQRCodeAndTransferTo'](_0x2dc2e5,_0x2346d3){const _0x23c84e=_0x5592d6,_0x459581=(0x0,_0x59487b['join'])(this[_0x23c84e(0x1bc)],'qrcode');await(0x0,_0x2fc587['mkdir'])(_0x459581,{'recursive':!0x0});const _0x3f1261=_0x23c84e(0x12f)+_0x2346d3['withdrawalCode']+_0x23c84e(0x12c),_0x13ea60=(0x0,_0x59487b['join'])(_0x459581,_0x3f1261);await(0x0,_0x9ab204['toFile'])(_0x13ea60,_0x2346d3['transferCode'],{'type':'png','width':0xe4,'margin':0x2}),this['logger']['log']('QR\x20code\x20created\x20for\x20withdrawal\x20'+_0x2346d3[_0x23c84e(0x2a2)]),await this['wsService'][_0x23c84e(0x274)](_0x2dc2e5,_0x13ea60,0x1),this[_0x23c84e(0x329)]['log']('['+_0x2dc2e5+_0x23c84e(0x2c6)+_0x2346d3['withdrawalId']);}};_0x33a05a['BaseBankService']=_0xabab7,_0xabab7[_0x5592d6(0x2d0)]=!0x1,_0xabab7['folderCreated']=!0x1,_0x33a05a['BaseBankService']=_0xabab7=_0x16404f=_0x1f1eb2([(0x0,_0x170e1a[_0x5592d6(0x144)])(),_0x1b1543(0x0,(0x0,_0x170e1a[_0x5592d6(0x33e)])(_0x378cea[_0x5592d6(0x2a4)])),_0x33a665('design:paramtypes',['function'==typeof(_0x31deac=void 0x0!==_0x18d228[_0x5592d6(0x1f2)]&&_0x18d228['IWebSocketService'])?_0x31deac:Object,'function'==typeof(_0x399665=void 0x0!==_0x40246f['DeviceService']&&_0x40246f['DeviceService'])?_0x399665:Object,_0x5592d6(0x269)==typeof(_0x23618b=void 0x0!==_0xf4f139[_0x5592d6(0x21e)]&&_0xf4f139[_0x5592d6(0x21e)])?_0x23618b:Object])],_0xabab7);},_0x5c109d=>{_0x5c109d['exports']=require('fs/promises');},(_0x535f5f,_0x2b582a)=>{const _0x412b7e=a0_0x2633;Object['defineProperty'](_0x2b582a,'__esModule',{'value':!0x0}),_0x2b582a[_0x412b7e(0x298)]=_0x2b582a[_0x412b7e(0x17b)]=void 0x0,_0x2b582a[_0x412b7e(0x17b)]=['.png'],_0x2b582a['getMimeType']=_0x10811b=>({'.png':'image/png'}[_0x10811b['toLowerCase']()]||_0x412b7e(0x2c0));},function(_0x1b1864,_0x3ac893,_0x49bb5f){const _0x155154=a0_0x2633;var _0x3434d4,_0x1ae8c2,_0x5d9a31,_0x5eb6da=this&&this[_0x155154(0x32c)]||function(_0x11baff,_0x1f5bb5,_0x11324d,_0x2a4613){var _0x564f99,_0x3d96a3=arguments['length'],_0x498347=_0x3d96a3<0x3?_0x1f5bb5:null===_0x2a4613?_0x2a4613=Object['getOwnPropertyDescriptor'](_0x1f5bb5,_0x11324d):_0x2a4613;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x498347=Reflect['decorate'](_0x11baff,_0x1f5bb5,_0x11324d,_0x2a4613);else{for(var _0x2e635e=_0x11baff['length']-0x1;_0x2e635e>=0x0;_0x2e635e--)(_0x564f99=_0x11baff[_0x2e635e])&&(_0x498347=(_0x3d96a3<0x3?_0x564f99(_0x498347):_0x3d96a3>0x3?_0x564f99(_0x1f5bb5,_0x11324d,_0x498347):_0x564f99(_0x1f5bb5,_0x11324d))||_0x498347);}return _0x3d96a3>0x3&&_0x498347&&Object['defineProperty'](_0x1f5bb5,_0x11324d,_0x498347),_0x498347;},_0x179f4f=this&&this['__metadata']||function(_0x4fbbb6,_0x16da36){const _0x1484c8=_0x155154;if(_0x1484c8(0x26d)==typeof Reflect&&'function'==typeof Reflect[_0x1484c8(0x331)])return Reflect['metadata'](_0x4fbbb6,_0x16da36);};Object['defineProperty'](_0x3ac893,'__esModule',{'value':!0x0}),_0x3ac893['OCRService']=_0x3ac893[_0x155154(0x30a)]=_0x3ac893['ROI']=void 0x0;const _0x2de68d=_0x49bb5f(0x2),_0x599891=_0x49bb5f(0x1b),_0x5c3bc0=_0x49bb5f(0x1e),_0x2da7c7=_0x49bb5f(0x20),_0x572d7c=_0x49bb5f(0x22),_0x3591ff=_0x49bb5f(0xf);var _0x88ab90=_0x49bb5f(0x20);Object[_0x155154(0x1c8)](_0x3ac893,'ROI',{'enumerable':!0x0,'get':function(){return _0x88ab90['ROI'];}}),Object['defineProperty'](_0x3ac893,'PreprocessOptions',{'enumerable':!0x0,'get':function(){return _0x88ab90['PreprocessOptions'];}});const _0x4343bf={'crop':{'x':0x0,'y':0x0,'width':0x1,'height':0x1},'psm':0x6,'charWhitelist':void 0x0,'maxWidth':0x4b0};let _0x2d126a=_0x3434d4=class{constructor(_0x30f146,_0x226d7a){const _0x5cf512=_0x155154;this['workerPoolService']=_0x30f146,this['imagePreprocessingService']=_0x226d7a,this['logger']=new _0x2de68d['Logger'](_0x3434d4[_0x5cf512(0x2f2)]),this['ocrConfig']={'poolSize':_0x3591ff[_0x5cf512(0x30b)]['ocr'][_0x5cf512(0x2b3)],'lang':_0x3591ff['config'][_0x5cf512(0x118)][_0x5cf512(0x318)],'rois':{'full':_0x4343bf,'singleLine':{..._0x4343bf,'psm':0x7},'block':{..._0x4343bf,'psm':0x6}}};}['validateROI'](_0x4bb82c){const _0x519a29=_0x155154;return{'x':Math[_0x519a29(0x27f)](0x0,Math['min'](0x1,_0x4bb82c['x']||0x0)),'y':Math['max'](0x0,Math[_0x519a29(0x194)](0x1,_0x4bb82c['y']||0x0)),'width':Math['max'](0.01,Math['min'](0x1,_0x4bb82c['width']||0x1)),'height':Math['max'](0.01,Math[_0x519a29(0x194)](0x1,_0x4bb82c['height']||0x1))};}['getROIConfig'](_0x263f82){const _0x52da31=_0x155154,_0x61dde0=this[_0x52da31(0x1a5)]['rois']?.[_0x263f82]||this['ocrConfig']['rois']?.['full']||_0x4343bf;return{'crop':_0x61dde0['crop']||_0x4343bf[_0x52da31(0x2bf)],'psm':_0x61dde0['psm']??_0x4343bf['psm'],'charWhitelist':_0x61dde0[_0x52da31(0x2e0)],'maxWidth':_0x61dde0[_0x52da31(0x340)]??_0x4343bf['maxWidth']};}async['recognizeFromFile'](_0x3d1869,_0x4e2e4d={}){const _0x46882f=_0x155154,_0x2bcbf0=Date[_0x46882f(0x292)](),_0x2b9437={'decodeImage':0x0,'preprocess':0x0,'ocrRecognize':0x0,'postprocess':0x0};try{const _0x13d1d4=Date['now'](),_0x49fde1=await(0x0,_0x599891['readFile'])(_0x3d1869);_0x2b9437['decodeImage']=Date['now']()-_0x13d1d4;const _0x24ed0f=_0x4e2e4d['fieldType']||_0x46882f(0x155),_0x4f8a88=this['getROIConfig'](_0x24ed0f),_0x4b7248=this['validateROI'](_0x4e2e4d['customROI']||_0x4f8a88['crop']),_0xd905eb=Date['now'](),_0x2d7258=await this['imagePreprocessingService']['preprocess'](_0x49fde1,_0x4b7248,_0x4f8a88['maxWidth'],_0x4e2e4d['preprocess']);_0x2b9437[_0x46882f(0x275)]=Date[_0x46882f(0x292)]()-_0xd905eb;const _0x5a2e8e=Date[_0x46882f(0x292)](),_0x50a8d0=await this[_0x46882f(0x20d)]['recognize'](_0x2d7258[_0x46882f(0x110)],{'psm':_0x4f8a88[_0x46882f(0x2ae)],'charWhitelist':_0x4f8a88[_0x46882f(0x2e0)]});_0x2b9437[_0x46882f(0x2b4)]=Date['now']()-_0x5a2e8e;const _0x3fe1bf=Date[_0x46882f(0x292)](),_0x9ac08a=this['postprocessText'](_0x50a8d0['text']);_0x2b9437['postprocess']=Date['now']()-_0x3fe1bf;const _0x45dd02=Date['now']()-_0x2bcbf0;return this['logTimingBreakdown'](_0x3d1869,_0x24ed0f,_0x45dd02,_0x2b9437,_0x50a8d0['confidence']),{'text':_0x9ac08a,'confidence':_0x50a8d0[_0x46882f(0x315)],'processingTime':_0x45dd02,'timingBreakdown':_0x2b9437};}catch(_0x22d613){return this['logger']['error']('OCR\x20error\x20for\x20'+_0x3d1869+':\x20'+_0x22d613['message'],_0x22d613[_0x46882f(0x267)]),null;}}async[_0x155154(0x32f)](_0x379407,_0x1d7bea={}){const _0x3d07e8=_0x155154,_0x381589=Date['now'](),_0x33dc7c={'decodeImage':0x0,'preprocess':0x0,'ocrRecognize':0x0,'postprocess':0x0};try{_0x33dc7c['decodeImage']=0x0;const _0x3836f8=_0x1d7bea['fieldType']||'full',_0x1ea5c4=this[_0x3d07e8(0x2a3)](_0x3836f8),_0x3c0d03=this['validateROI'](_0x1d7bea['customROI']||_0x1ea5c4[_0x3d07e8(0x2bf)]),_0x1d7440=Date['now'](),_0x55019c=await this['imagePreprocessingService']['preprocess'](_0x379407,_0x3c0d03,_0x1ea5c4[_0x3d07e8(0x340)],_0x1d7bea[_0x3d07e8(0x275)]);_0x33dc7c['preprocess']=Date['now']()-_0x1d7440;const _0x1aab4b=Date['now'](),_0xf82062=await this['workerPoolService']['recognize'](_0x55019c[_0x3d07e8(0x110)],{'psm':_0x1ea5c4['psm'],'charWhitelist':_0x1ea5c4['charWhitelist']});_0x33dc7c[_0x3d07e8(0x2b4)]=Date['now']()-_0x1aab4b;const _0x15ca35=Date[_0x3d07e8(0x292)](),_0x566763=this[_0x3d07e8(0x1d6)](_0xf82062['text']);_0x33dc7c['postprocess']=Date[_0x3d07e8(0x292)]()-_0x15ca35;const _0x1a80fb=Date['now']()-_0x381589;return this['logTimingBreakdown']('buffer',_0x3836f8,_0x1a80fb,_0x33dc7c,_0xf82062[_0x3d07e8(0x315)]),{'text':_0x566763,'confidence':_0xf82062[_0x3d07e8(0x315)],'processingTime':_0x1a80fb,'timingBreakdown':_0x33dc7c};}catch(_0x581ef4){return this['logger'][_0x3d07e8(0x25a)]('OCR\x20error\x20from\x20buffer:\x20'+_0x581ef4['message'],_0x581ef4['stack']),null;}}async['fastScreenOCR'](_0x1ce4f0,_0x5c3185,_0x41d004={}){const _0x1606cd=_0x155154,_0x5201bf=await this[_0x1606cd(0x1e7)](_0x1ce4f0,{'fieldType':_0x41d004['fieldType']||'full','customROI':_0x41d004[_0x1606cd(0x2f9)],'preprocess':_0x41d004['preprocess']});if(!_0x5201bf||!_0x5201bf['text'])return{'found':!0x1,'matchedTexts':[],'result':_0x5201bf};const _0x59f5c9=(0x0,_0x572d7c['normalizeBankAccountName'])(_0x5201bf['text']),_0xeac5c=_0x5c3185['filter'](_0x42549f=>_0x59f5c9['includes']((0x0,_0x572d7c['normalizeBankAccountName'])(_0x42549f)));return{'found':_0xeac5c['length']>0x0,'matchedTexts':_0xeac5c,'result':_0x5201bf};}['postprocessText'](_0xacc36a){return _0xacc36a['trim']()['replace'](/\s+/g,'\x20')['replace'](/\n{3,}/g,'\x0a\x0a');}['logTimingBreakdown'](_0x103884,_0x2a5f72,_0xf7db8a,_0x3d373f,_0x56db88){const _0x156829=_0x155154;['decode='+_0x3d373f['decodeImage']+'ms','preprocess='+_0x3d373f['preprocess']+'ms',_0x156829(0x2c9)+_0x3d373f['ocrRecognize']+'ms','postprocess='+_0x3d373f['postprocess']+'ms']['join'](_0x156829(0x174)),_0xf7db8a>0x3e8&&this['logger'][_0x156829(0x134)]('\x20OCR\x20latency\x20exceeded\x20target:\x20'+_0xf7db8a+_0x156829(0x348));}};_0x3ac893['OCRService']=_0x2d126a,_0x3ac893[_0x155154(0x21e)]=_0x2d126a=_0x3434d4=_0x5eb6da([(0x0,_0x2de68d[_0x155154(0x144)])(),_0x179f4f(_0x155154(0x1b9),['function'==typeof(_0x1ae8c2=void 0x0!==_0x5c3bc0[_0x155154(0x13d)]&&_0x5c3bc0[_0x155154(0x13d)])?_0x1ae8c2:Object,'function'==typeof(_0x5d9a31=void 0x0!==_0x2da7c7['ImagePreprocessingService']&&_0x2da7c7['ImagePreprocessingService'])?_0x5d9a31:Object])],_0x2d126a);},function(_0x4968f7,_0x29e7bb,_0x12e148){const _0x3805d8=a0_0x2633;var _0x469ce7=this&&this['__decorate']||function(_0x57058f,_0x4163f2,_0x1649a2,_0xe36828){const _0x1f77ba=a0_0x2633;var _0x3231c,_0x2e1990=arguments[_0x1f77ba(0x1e6)],_0x3d40c5=_0x2e1990<0x3?_0x4163f2:null===_0xe36828?_0xe36828=Object['getOwnPropertyDescriptor'](_0x4163f2,_0x1649a2):_0xe36828;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x1f77ba(0x2a1)])_0x3d40c5=Reflect['decorate'](_0x57058f,_0x4163f2,_0x1649a2,_0xe36828);else{for(var _0x38329f=_0x57058f['length']-0x1;_0x38329f>=0x0;_0x38329f--)(_0x3231c=_0x57058f[_0x38329f])&&(_0x3d40c5=(_0x2e1990<0x3?_0x3231c(_0x3d40c5):_0x2e1990>0x3?_0x3231c(_0x4163f2,_0x1649a2,_0x3d40c5):_0x3231c(_0x4163f2,_0x1649a2))||_0x3d40c5);}return _0x2e1990>0x3&&_0x3d40c5&&Object['defineProperty'](_0x4163f2,_0x1649a2,_0x3d40c5),_0x3d40c5;},_0x450d0e=this&&this['__metadata']||function(_0x3cf0fb,_0x43d09c){if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0x3cf0fb,_0x43d09c);};Object['defineProperty'](_0x29e7bb,'__esModule',{'value':!0x0}),_0x29e7bb['OCRWorkerPoolService']=void 0x0;const _0x567e5b=_0x12e148(0x2),_0x34833e=_0x12e148(0x1f),_0x43d794=_0x12e148(0xf);let _0x3ac7cf=class{constructor(){const _0x58c32b=a0_0x2633;this['logger']=new _0x567e5b['Logger'](_0x58c32b(0x13d)),this['pool']=[],this['waitingQueue']=[],this[_0x58c32b(0x305)]=0x1388,this[_0x58c32b(0x236)]=0xa,this['isInitializing']=!0x1,this['isDestroyed']=!0x1,this[_0x58c32b(0x128)]=!0x1,this['initializationPromise']=null,this['poolSize']=Math['max'](0x1,Math['min'](_0x43d794['config'][_0x58c32b(0x118)]['poolSize'],this[_0x58c32b(0x236)])),this['lang']=_0x43d794['config']['ocr'][_0x58c32b(0x318)],_0x43d794[_0x58c32b(0x30b)][_0x58c32b(0x118)]['poolSize']>this['maxPoolSize']&&this['logger'][_0x58c32b(0x134)](_0x58c32b(0x1f0)+_0x43d794['config']['ocr'][_0x58c32b(0x2b3)]+')\x20exceeds\x20maximum\x20('+this['maxPoolSize']+').\x20Using\x20'+this['maxPoolSize']+'.');}async['onModuleInit'](){await this['warmPool']();}async['onModuleDestroy'](){const _0x14c9c5=a0_0x2633;this[_0x14c9c5(0x32a)]=!0x0,this['rejectAllPending'](new Error('OCR\x20service\x20is\x20shutting\x20down')),await this['terminateAll']();}async['warmPool'](){const _0x3c22b3=a0_0x2633;if(this[_0x3c22b3(0x256)])return this['initializationPromise']||Promise[_0x3c22b3(0x27e)]();this[_0x3c22b3(0x256)]=!0x0,this['initializationPromise']=this['doWarmPool']();try{await this['initializationPromise'];}finally{this['isInitializing']=!0x1;}}async['doWarmPool'](){const _0x4af3a9=a0_0x2633,_0x3e43ba=Date['now']();this['logger']['log'](_0x4af3a9(0x1c0)+this['poolSize']+',\x20lang:\x20'+this['lang']+')...');const _0x45d113=Array['from']({'length':this['poolSize']},(_0x33806a,_0x4e1974)=>this['createWorker'](_0x4e1974));try{await Promise['all'](_0x45d113);const _0x275fa1=Date['now']()-_0x3e43ba;this['logger'][_0x4af3a9(0x349)]('OCR\x20worker\x20pool\x20warmed\x20up\x20successfully\x20in\x20'+_0x275fa1+'ms.\x20Pool\x20size:\x20'+this['pool'][_0x4af3a9(0x1e6)]);}catch(_0xe8c75a){throw this['logger']['error'](_0x4af3a9(0x226)+_0xe8c75a['message'],_0xe8c75a['stack']),await this[_0x4af3a9(0x10f)](),_0xe8c75a;}}async['createWorker'](_0x9898bc){const _0x494d0d=a0_0x2633;try{const _0xdace53=await _0x34833e[_0x494d0d(0x2b1)](this[_0x494d0d(0x318)],0x1,{'logger':_0x33cfac=>{const _0x4ed09f=_0x494d0d;_0x4ed09f(0x25a)===_0x33cfac[_0x4ed09f(0x253)]&&this['logger']['error']('Tesseract\x20worker\x20'+_0x9898bc+_0x4ed09f(0x2a7)+_0x33cfac[_0x4ed09f(0x26b)]);}});this['pool'][_0x494d0d(0x216)]({'id':_0x9898bc,'worker':_0xdace53,'inUse':!0x1,'lastUsed':Date['now']()}),this['logger'][_0x494d0d(0x2ac)]('Worker\x20'+_0x9898bc+'\x20created\x20successfully');}catch(_0x4a5596){throw this['logger']['error']('Failed\x20to\x20create\x20worker\x20'+_0x9898bc+':\x20'+_0x4a5596['message']),_0x4a5596;}}async[_0x3805d8(0x31e)](){const _0x1bf6ab=_0x3805d8;if(this['isDestroyed'])throw new Error(_0x1bf6ab(0x12a));return this['isInitializing']&&this['initializationPromise']&&await this[_0x1bf6ab(0xf9)],this['tryAcquireFromPool']()||this['waitForWorker']();}['tryAcquireFromPool'](){const _0x8d4bf0=_0x3805d8;if(this['isAcquiring'])return null;this['isAcquiring']=!0x0;try{for(const _0xd252c0 of this['pool'])if(!_0xd252c0['inUse'])return _0xd252c0['inUse']=!0x0,_0xd252c0['lastUsed']=Date[_0x8d4bf0(0x292)](),_0xd252c0;return null;}finally{this[_0x8d4bf0(0x128)]=!0x1;}}['waitForWorker'](){return new Promise((_0x25bd33,_0x1f3ad8)=>{const _0x209906=setTimeout(()=>{const _0x51a95a=a0_0x2633,_0x3c96f2=this['waitingQueue']['findIndex'](_0x314f9b=>_0x314f9b['resolve']===_0x25bd33);-0x1!==_0x3c96f2&&this[_0x51a95a(0x296)]['splice'](_0x3c96f2,0x1),this[_0x51a95a(0x329)][_0x51a95a(0x134)]('Timeout\x20waiting\x20for\x20worker,\x20creating\x20temporary\x20worker'),this[_0x51a95a(0x306)]()[_0x51a95a(0x11d)](_0x25bd33)['catch'](_0x1f3ad8);},this['maxWaitTime']);this['waitingQueue']['push']({'resolve':_0x25bd33,'reject':_0x1f3ad8,'timeout':_0x209906});});}async[_0x3805d8(0x306)](){const _0x15370b=_0x3805d8;return{'id':-0x1,'worker':await _0x34833e[_0x15370b(0x2b1)](this[_0x15370b(0x318)],0x1,{'logger':()=>{}}),'inUse':!0x0,'lastUsed':Date['now']()};}['releaseWorker'](_0x4c1178){const _0x40752d=_0x3805d8;if(this[_0x40752d(0x296)]['length']>0x0){const _0x1a24f1=this['waitingQueue']['shift']();clearTimeout(_0x1a24f1['timeout']),_0x4c1178[_0x40752d(0x141)]=Date[_0x40752d(0x292)](),_0x1a24f1[_0x40752d(0x27e)](_0x4c1178);}else _0x4c1178[_0x40752d(0x31f)]=!0x1,_0x4c1178[_0x40752d(0x141)]=Date[_0x40752d(0x292)]();}['rejectAllPending'](_0x486b97){const _0x236db8=_0x3805d8;for(;this[_0x236db8(0x296)][_0x236db8(0x1e6)]>0x0;){const _0x2c23a1=this[_0x236db8(0x296)]['shift']();clearTimeout(_0x2c23a1[_0x236db8(0x115)]),_0x2c23a1[_0x236db8(0x290)](_0x486b97);}}async[_0x3805d8(0x211)](_0x56ab7a,_0x36d3d4={}){const _0x200339=_0x3805d8,_0x503696=await this['acquireWorker'](),_0x285ae5=_0x503696['id']<0x0,{psm:_0x5d3a6e,charWhitelist:_0x61f985}=_0x36d3d4,_0x387c6c=void 0x0!==_0x5d3a6e||!!_0x61f985;try{const _0x2020c9={};void 0x0!==_0x5d3a6e&&(_0x2020c9['tessedit_pageseg_mode']=_0x5d3a6e),_0x61f985&&(_0x2020c9['tessedit_char_whitelist']=_0x61f985),Object['keys'](_0x2020c9)['length']>0x0&&await _0x503696['worker']['setParameters'](_0x2020c9);const {data:_0x172aad}=await _0x503696[_0x200339(0x323)]['recognize'](_0x56ab7a);return{'text':_0x172aad['text'],'confidence':_0x172aad['confidence']};}finally{if(_0x285ae5)try{await _0x503696['worker'][_0x200339(0x231)]();}catch(_0x13185f){this[_0x200339(0x329)]['warn'](_0x200339(0x186)+_0x13185f['message']);}else{if(_0x387c6c)try{await _0x503696['worker'][_0x200339(0x27c)]({'tessedit_pageseg_mode':0x6,'tessedit_char_whitelist':''});}catch(_0x28e319){this['logger']['warn'](_0x200339(0x2f3)+_0x28e319[_0x200339(0x26b)]);}this[_0x200339(0x2df)](_0x503696);}}}['getPoolStats'](){const _0xe79e1c=_0x3805d8;return{'total':this[_0xe79e1c(0x196)]['length'],'inUse':this[_0xe79e1c(0x196)]['filter'](_0x9e7d41=>_0x9e7d41['inUse'])[_0xe79e1c(0x1e6)],'waiting':this['waitingQueue']['length']};}async['terminateAll'](){const _0x651af8=_0x3805d8;if(0x0===this['pool']['length'])return;this['logger'][_0x651af8(0x349)]('Terminating\x20'+this['pool']['length']+'\x20OCR\x20workers...');const _0x27e155=this[_0x651af8(0x196)][_0x651af8(0x1eb)](_0x3a83d1=>_0x3a83d1['worker']['terminate']()[_0x651af8(0x11d)](()=>{const _0xbc6a83=_0x651af8;this[_0xbc6a83(0x329)]['debug'](_0xbc6a83(0x1ed)+_0x3a83d1['id']+'\x20terminated');})['catch'](_0xfe63c7=>{this['logger']['error']('Error\x20terminating\x20worker\x20'+_0x3a83d1['id']+':\x20'+_0xfe63c7['message']);}));await Promise['all'](_0x27e155),this['pool']['length']=0x0,this[_0x651af8(0x329)]['log']('All\x20OCR\x20workers\x20terminated');}};_0x29e7bb['OCRWorkerPoolService']=_0x3ac7cf,_0x29e7bb['OCRWorkerPoolService']=_0x3ac7cf=_0x469ce7([(0x0,_0x567e5b[_0x3805d8(0x144)])(),_0x450d0e('design:paramtypes',[])],_0x3ac7cf);},_0x2789e6=>{const _0x674b93=a0_0x2633;_0x2789e6[_0x674b93(0x10b)]=require('tesseract.js');},function(_0x1071a8,_0x412d44,_0x285d54){const _0x313d31=a0_0x2633;var _0x58cf2c=this&&this['__decorate']||function(_0x18743a,_0x54a7f5,_0x130eac,_0x195dc6){const _0x574b61=a0_0x2633;var _0x21fce4,_0x479efe=arguments[_0x574b61(0x1e6)],_0x33116b=_0x479efe<0x3?_0x54a7f5:null===_0x195dc6?_0x195dc6=Object['getOwnPropertyDescriptor'](_0x54a7f5,_0x130eac):_0x195dc6;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x574b61(0x2a1)])_0x33116b=Reflect['decorate'](_0x18743a,_0x54a7f5,_0x130eac,_0x195dc6);else{for(var _0x35a8fd=_0x18743a['length']-0x1;_0x35a8fd>=0x0;_0x35a8fd--)(_0x21fce4=_0x18743a[_0x35a8fd])&&(_0x33116b=(_0x479efe<0x3?_0x21fce4(_0x33116b):_0x479efe>0x3?_0x21fce4(_0x54a7f5,_0x130eac,_0x33116b):_0x21fce4(_0x54a7f5,_0x130eac))||_0x33116b);}return _0x479efe>0x3&&_0x33116b&&Object[_0x574b61(0x1c8)](_0x54a7f5,_0x130eac,_0x33116b),_0x33116b;};Object['defineProperty'](_0x412d44,'__esModule',{'value':!0x0}),_0x412d44['ImagePreprocessingService']=void 0x0;const _0x3d0b2f=_0x285d54(0x2),_0x386aa1=_0x285d54(0x21);let _0x20af7f=class{constructor(){const _0x424dc3=a0_0x2633;this['logger']=new _0x3d0b2f['Logger']('ImagePreprocessingService'),this[_0x424dc3(0x2bd)]=0xa;}[_0x313d31(0x322)](_0x44252e){const _0x38203a=_0x313d31;if(_0x44252e['x']<0x0||_0x44252e['x']>0x1)throw new Error('Invalid\x20ROI\x20x:\x20'+_0x44252e['x']+'\x20(must\x20be\x200-1)');if(_0x44252e['y']<0x0||_0x44252e['y']>0x1)throw new Error(_0x38203a(0x108)+_0x44252e['y']+'\x20(must\x20be\x200-1)');if(_0x44252e['width']<=0x0||_0x44252e[_0x38203a(0x2fc)]>0x1)throw new Error('Invalid\x20ROI\x20width:\x20'+_0x44252e['width']+_0x38203a(0x15f));if(_0x44252e['height']<=0x0||_0x44252e[_0x38203a(0x152)]>0x1)throw new Error('Invalid\x20ROI\x20height:\x20'+_0x44252e['height']+'\x20(must\x20be\x200-1)');if(_0x44252e['x']+_0x44252e[_0x38203a(0x2fc)]>1.001)throw new Error('ROI\x20extends\x20beyond\x20image:\x20x('+_0x44252e['x']+')\x20+\x20width('+_0x44252e['width']+')\x20>\x201');if(_0x44252e['y']+_0x44252e['height']>1.001)throw new Error('ROI\x20extends\x20beyond\x20image:\x20y('+_0x44252e['y']+')\x20+\x20height('+_0x44252e['height']+')\x20>\x201');}async['preprocess'](_0x310a75,_0x33e3f7,_0x23a5f8,_0x44d9bc={}){const _0x36caff=_0x313d31;Date['now']();try{this['validateROI'](_0x33e3f7);const _0x1ceebe=_0x386aa1(_0x310a75),_0xce677=await _0x1ceebe['metadata'](),_0x4b8472=_0xce677['width']||0x0,_0x382413=_0xce677[_0x36caff(0x152)]||0x0;if(0x0===_0x4b8472||0x0===_0x382413)throw new Error('Invalid\x20image\x20dimensions:\x20width\x20or\x20height\x20is\x200');if(_0x4b8472<this['MIN_DIMENSION']||_0x382413<this['MIN_DIMENSION'])throw new Error('Image\x20too\x20small:\x20'+_0x4b8472+'x'+_0x382413+_0x36caff(0x182)+this['MIN_DIMENSION']+'x'+this['MIN_DIMENSION']+')');const _0x2b94ee=Math[_0x36caff(0x23a)](_0x33e3f7['x']*_0x4b8472),_0x2d9b21=Math['floor'](_0x33e3f7['y']*_0x382413),_0x5f55a0=Math['floor'](_0x33e3f7['width']*_0x4b8472),_0x4d7330=Math[_0x36caff(0x23a)](_0x33e3f7['height']*_0x382413),_0x54eb46=Math[_0x36caff(0x27f)](0x0,Math['min'](_0x2b94ee,_0x4b8472-0x1)),_0x495c02=Math[_0x36caff(0x27f)](0x0,Math['min'](_0x2d9b21,_0x382413-0x1)),_0x8ea3a=Math['max'](this['MIN_DIMENSION'],Math[_0x36caff(0x194)](_0x5f55a0,_0x4b8472-_0x54eb46)),_0x1da651=Math['max'](this['MIN_DIMENSION'],Math[_0x36caff(0x194)](_0x4d7330,_0x382413-_0x495c02));let _0x13008b=_0x1ceebe['extract']({'left':_0x54eb46,'top':_0x495c02,'width':_0x8ea3a,'height':_0x1da651}),_0x46f8e5=_0x8ea3a,_0x1d7ae3=_0x1da651,_0x4228a2=0x1;return _0x23a5f8&&_0x8ea3a>_0x23a5f8&&(_0x4228a2=_0x23a5f8/_0x8ea3a,_0x46f8e5=_0x23a5f8,_0x1d7ae3=Math[_0x36caff(0x27f)](this['MIN_DIMENSION'],Math['floor'](_0x1da651*_0x4228a2)),_0x13008b=_0x13008b['resize'](_0x46f8e5,_0x1d7ae3,{'kernel':_0x386aa1['kernel']['lanczos3'],'withoutEnlargement':!0x0})),_0x44d9bc['grayscale']&&(_0x13008b=_0x13008b[_0x36caff(0x33d)]()),_0x44d9bc['enhanceContrast']&&(_0x13008b=_0x13008b['normalize']()),{'buffer':await _0x13008b['png']()['toBuffer'](),'metadata':{'originalWidth':_0x4b8472,'originalHeight':_0x382413,'processedWidth':_0x46f8e5,'processedHeight':_0x1d7ae3,'scaleFactor':_0x4228a2}};}catch(_0x329bea){throw this['logger']['error']('Image\x20preprocessing\x20error:\x20'+_0x329bea['message'],_0x329bea['stack']),_0x329bea;}}};_0x412d44['ImagePreprocessingService']=_0x20af7f,_0x412d44[_0x313d31(0x29f)]=_0x20af7f=_0x58cf2c([(0x0,_0x3d0b2f['Injectable'])()],_0x20af7f);},_0x9e57c6=>{_0x9e57c6['exports']=require('sharp');},(_0x50e957,_0x3ec4e6)=>{const _0x1b2a68=a0_0x2633;Object[_0x1b2a68(0x1c8)](_0x3ec4e6,'__esModule',{'value':!0x0}),_0x3ec4e6['normalizeBankAccountName']=_0x3ec4e6['removeVietnameseTones']=void 0x0,_0x3ec4e6['removeVietnameseTones']=_0x2a4429=>_0x2a4429?_0x2a4429['normalize']('NFD')['replace'](/[\u0300-\u036f]/g,'')['replace'](//g,'d')[_0x1b2a68(0x11f)](//g,'D'):'',_0x3ec4e6['normalizeBankAccountName']=_0x125e19=>_0x125e19?(0x0,_0x3ec4e6[_0x1b2a68(0x20f)])(_0x125e19)['trim']()[_0x1b2a68(0x11f)](/ /g,'')[_0x1b2a68(0x29d)]():'';},_0x385b9d=>{_0x385b9d['exports']=require('qrcode');},(_0x243e66,_0x430173)=>{const _0xa5573a=a0_0x2633;Object['defineProperty'](_0x430173,_0xa5573a(0x209),{'value':!0x0}),_0x430173['PG_ROI_EXPECTED']=void 0x0,_0x430173[_0xa5573a(0x2d8)]={'LAUNCH_APP':{'x':0.05,'y':0.54,'width':0.7,'height':0.1},'VERIFY_ACCOUNT_NAME':{'x':0.05,'y':0.55,'width':0.9,'height':0.25},'TRANSACTION_CONFIRM':{'x':0.05,'y':0.05,'width':0.9,'height':0.2},'TRANSACTION_VERIFY':{'x':0.05,'y':0.05,'width':0.9,'height':0.2},'TRANSACTION_SUCCESS':{'x':0.1,'y':0.2,'width':0.9,'height':0.3},'HOME_SCREEN':{'x':0.02,'y':0.7,'width':0.98,'height':0.3}};},(_0x1d383f,_0x898f7e,_0x514f91)=>{const _0x4d7dbb=a0_0x2633;Object['defineProperty'](_0x898f7e,'__esModule',{'value':!0x0}),_0x898f7e['NUMPAD_LAYOUT']=_0x898f7e['KEYBOARD_LAYOUT']=_0x898f7e['COMMON_COORDINATES']=_0x898f7e['scaleCoordinates']=void 0x0;const _0x465517=_0x514f91(0xf);_0x898f7e['scaleCoordinates']=(_0x373735,_0x22ad96=0x64)=>Object[_0x4d7dbb(0x1c7)](Object['entries'](_0x373735)[_0x4d7dbb(0x1eb)](([_0x16c8b0,_0x2fa0ea])=>[_0x16c8b0,{'x':Math[_0x4d7dbb(0x243)](_0x2fa0ea['x']*_0x22ad96),'y':Math['round'](_0x2fa0ea['y']*_0x22ad96)}]));const _0x24cb9f={0x0:{'x':0.55,'y':0.95},0x1:{'x':0.25,'y':0.7},0x2:{'x':0.55,'y':0.7},0x3:{'x':0.85,'y':0.7},0x4:{'x':0.25,'y':0.8},0x5:{'x':0.55,'y':0.8},0x6:{'x':0.85,'y':0.8},0x7:{'x':0.25,'y':0.9},0x8:{'x':0.55,'y':0.9},0x9:{'x':0.85,'y':0.9}},_0x1004cd={'KEYBOARD_SWITCH':{'x':0.05,'y':0.95},'SHIFT_KEY':{'x':0.05,'y':0.88},'RETURN_KEY':{'x':0.95,'y':0.95}},_0x13d700=(0x0,_0x898f7e[_0x4d7dbb(0x29c)])(_0x1004cd),_0x1ba786=(0x0,_0x898f7e['scaleCoordinates'])(_0x24cb9f);_0x898f7e['COMMON_COORDINATES']='PANDA'===_0x465517[_0x4d7dbb(0x30b)][_0x4d7dbb(0x310)]?_0x13d700:_0x1004cd,_0x898f7e['KEYBOARD_LAYOUT']={0x0:{'x':0.95,'y':0.68},0x1:{'x':0.05,'y':0.68},0x2:{'x':0.15,'y':0.68},0x3:{'x':0.25,'y':0.68},0x4:{'x':0.35,'y':0.68},0x5:{'x':0.45,'y':0.68},0x6:{'x':0.55,'y':0.68},0x7:{'x':0.65,'y':0.68},0x8:{'x':0.75,'y':0.68},0x9:{'x':0.85,'y':0.68},'@':{'x':0.85,'y':0.78},'!':{'x':0.65,'y':0.88},'a':{'x':0.1,'y':0.78},'b':{'x':0.6,'y':0.88},'c':{'x':0.4,'y':0.88},'d':{'x':0.3,'y':0.78},'e':{'x':0.25,'y':0.68},'f':{'x':0.4,'y':0.78},'g':{'x':0.5,'y':0.78},'h':{'x':0.6,'y':0.78},'i':{'x':0.75,'y':0.68},'j':{'x':0.7,'y':0.78},'k':{'x':0.8,'y':0.78},'l':{'x':0.9,'y':0.78},'m':{'x':0.8,'y':0.88},'n':{'x':0.7,'y':0.88},'o':{'x':0.85,'y':0.68},'p':{'x':0.95,'y':0.68},'q':{'x':0.05,'y':0.68},'r':{'x':0.35,'y':0.68},'s':{'x':0.2,'y':0.78},'t':{'x':0.45,'y':0.68},'u':{'x':0.65,'y':0.68},'v':{'x':0.5,'y':0.88},'w':{'x':0.15,'y':0.68},'x':{'x':0.3,'y':0.88},'y':{'x':0.55,'y':0.68},'z':{'x':0.2,'y':0.88},'\x20':{'x':0.55,'y':0.95}},_0x898f7e[_0x4d7dbb(0x286)]=_0x4d7dbb(0x171)===_0x465517['config'][_0x4d7dbb(0x310)]?_0x1ba786:_0x24cb9f;},(_0x23d90e,_0x5a42be,_0x320d4b)=>{const _0x598234=a0_0x2633;Object['defineProperty'](_0x5a42be,'__esModule',{'value':!0x0}),_0x5a42be['ACB_UI_COORDINATES']=void 0x0;const _0x477760=_0x320d4b(0xf),_0x568f96={'LOGIN_BUTTON':{'x':0.5,'y':0.8},'LOGIN_BUTTON_API':{'x':0.5,'y':0.62},'PASSWORD_FIELD':{'x':0.5,'y':0.45}},_0x3492c7=(0x0,_0x320d4b(0x25)[_0x598234(0x29c)])(_0x568f96);_0x5a42be[_0x598234(0x25e)]=_0x598234(0x171)===_0x477760['config']['boxType']?_0x3492c7:_0x568f96;},function(_0x3fc4fa,_0x4d0a6a,_0xcb75fd){const _0x20223d=a0_0x2633;var _0x313c58,_0x290b8c,_0x17a1c7,_0x2fe98c=this&&this[_0x20223d(0x32c)]||function(_0x402bc1,_0x12fac3,_0x58e353,_0x29b4cf){const _0x53e6d7=_0x20223d;var _0x5e3eab,_0x24c766=arguments['length'],_0x3e8f3c=_0x24c766<0x3?_0x12fac3:null===_0x29b4cf?_0x29b4cf=Object['getOwnPropertyDescriptor'](_0x12fac3,_0x58e353):_0x29b4cf;if(_0x53e6d7(0x26d)==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x3e8f3c=Reflect['decorate'](_0x402bc1,_0x12fac3,_0x58e353,_0x29b4cf);else{for(var _0x159b53=_0x402bc1['length']-0x1;_0x159b53>=0x0;_0x159b53--)(_0x5e3eab=_0x402bc1[_0x159b53])&&(_0x3e8f3c=(_0x24c766<0x3?_0x5e3eab(_0x3e8f3c):_0x24c766>0x3?_0x5e3eab(_0x12fac3,_0x58e353,_0x3e8f3c):_0x5e3eab(_0x12fac3,_0x58e353))||_0x3e8f3c);}return _0x24c766>0x3&&_0x3e8f3c&&Object['defineProperty'](_0x12fac3,_0x58e353,_0x3e8f3c),_0x3e8f3c;},_0x5bfbc7=this&&this['__metadata']||function(_0x161703,_0xa05837){const _0x54e0e5=_0x20223d;if(_0x54e0e5(0x26d)==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0x161703,_0xa05837);},_0x3a8169=this&&this['__param']||function(_0x5f2f67,_0x16b1f4){return function(_0x31c99b,_0x1c2f2f){_0x16b1f4(_0x31c99b,_0x1c2f2f,_0x5f2f67);};};Object['defineProperty'](_0x4d0a6a,'__esModule',{'value':!0x0}),_0x4d0a6a['PgService']=void 0x0;const _0x319737=_0xcb75fd(0x2),_0x327ec8=_0xcb75fd(0x15),_0x1842a5=_0xcb75fd(0x1a),_0x10079f=_0xcb75fd(0x19),_0xfba17a=_0xcb75fd(0x14),_0x2b1254=_0xcb75fd(0x11),_0xcedfb5=_0xcb75fd(0x28),_0x1fb201=_0xcb75fd(0xf),_0xd844dc=_0xcb75fd(0x29),_0x5db9f2=_0xcb75fd(0x1d),_0x5c1cf2=_0xcb75fd(0x2a),_0x2c42e0=_0xcb75fd(0x24);let _0x3f7ab4=class extends _0x1842a5['BaseBankService']{constructor(_0x4d2eac,_0x4797c9,_0x114c15){const _0x4d1a8f=_0x20223d;super(_0x4d2eac,_0x4797c9,_0x114c15),this['wsService']=_0x4d2eac,this['BANK_CODE']='PGBANK',this[_0x4d1a8f(0x124)]='pgbankApp.pgbank.com.vn';}async['inputPasswordFromConfig'](_0x23c18b){const _0x222ec2=_0x20223d,_0x42b497=await this['deviceService'][_0x222ec2(0x151)](_0x23c18b);if(!_0x42b497||!_0x42b497['password'])throw new Error(_0x222ec2(0x333)+_0x23c18b);await this[_0x222ec2(0x28b)](_0x23c18b,_0xcedfb5['PG_UI_COORDINATES']['PASSWORD_FIELD']['x'],_0xcedfb5['PG_UI_COORDINATES']['PASSWORD_FIELD']['y'],0x5dc),await this['wsService']['inputText'](_0x23c18b,_0x42b497[_0x222ec2(0x154)]),await(0x0,_0x2b1254[_0x222ec2(0x23d)])(0x3e8),await this['wsService'][_0x222ec2(0x23f)](_0x23c18b),await(0x0,_0x2b1254[_0x222ec2(0x23d)])(0x3e8);}async['inputSmartOTPFromConfig'](_0x353b29,_0x40908e=0x3){const _0x22899b=_0x20223d,_0x478263=await this[_0x22899b(0x1af)]['getDeviceConfig'](_0x353b29);if(!_0x478263||!_0x478263['smartOTP'])throw new Error('SmartOTP\x20not\x20configured\x20for\x20device\x20'+_0x353b29);await(0x0,_0x2b1254[_0x22899b(0x23d)])(0x7d0),await this['wsService']['inputText'](_0x353b29,_0x478263['smartOTP']);}async['launchApp'](_0x5eb755){const _0x2002e2=_0x20223d;if(await this[_0x2002e2(0x2e5)][_0x2002e2(0x25d)](_0x5eb755,this['BUNDLE_ID']),!await this['verifyScreenState'](_0x5eb755,{'expectedTexts':[_0x2002e2(0x2b9)],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x2c42e0['PG_ROI_EXPECTED']['LAUNCH_APP'],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new _0x5c1cf2['WithdrawalProcessingError']('Failed\x20to\x20launch\x20PGBank\x20app',_0x5c1cf2[_0x2002e2(0x2f8)]['FORCE_KILL_APP'],_0x5eb755);this['logger']['log']('['+_0x5eb755+']\x20-\x20Get\x20login\x20app\x20screen');}async['login'](_0x536d7d){const _0x3d41a9=_0x20223d;try{if(await this['killApp'](_0x536d7d),await(0x0,_0x2b1254['sleep'])(0x7d0),await this['launchApp'](_0x536d7d),await this[_0x3d41a9(0x2e3)](_0x536d7d),!await this['clickAndWaitForScreen'](_0x536d7d,_0xcedfb5['PG_UI_COORDINATES'][_0x3d41a9(0x32d)]['x'],_0xcedfb5['PG_UI_COORDINATES']['LOGIN_BTN']['y'],{'expectedTexts':['ti\x20khon','chuyn\x20tin','tit\x20kim'],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x2c42e0['PG_ROI_EXPECTED']['HOME_SCREEN']}))throw new _0x5c1cf2['WithdrawalProcessingError']('Failed\x20to\x20login\x20to\x20PGBank',_0x5c1cf2['ErrorType']['FORCE_KILL_APP'],_0x536d7d);this['logger'][_0x3d41a9(0x349)]('['+_0x536d7d+']\x20-\x20Login\x20successfully');}catch(_0x2d4d88){throw this['logger']['error']('Error\x20logging\x20in\x20to\x20PGBank\x20on\x20device\x20'+_0x536d7d+':\x20'+_0x2d4d88[_0x3d41a9(0x26b)]),_0x2d4d88;}}async['executeTransfer'](_0x56ecba,_0x1a8ac5){const _0x394efb=_0x20223d,_0xd2ee56='PGBANK'===_0x56ecba[_0x394efb(0x15a)]?this['executeInternalTransfer'](_0x56ecba,_0x1a8ac5):this['executeExternalTransfer'](_0x56ecba,_0x1a8ac5);return await this['createBillFolder'](_0x56ecba['withdrawalCode']),_0xd2ee56;}async['executeTransferWithQRCode'](_0x4625f5,_0x397bff){const _0x5a38a4=_0x20223d;if(this['logger']['log']('Executing\x20PG\x20transfer\x20for\x20withdrawal\x20'+_0x4625f5[_0x5a38a4(0x207)]+_0x5a38a4(0x100)+_0x397bff['deviceId']),await this['createBillFolder'](_0x4625f5['withdrawalCode']),await this['createQRCodeAndTransferTo'](_0x397bff['deviceId'],_0x4625f5),await this[_0x5a38a4(0x28b)](_0x397bff['deviceId'],_0xcedfb5['PG_UI_COORDINATES'][_0x5a38a4(0x176)]['x'],_0xcedfb5['PG_UI_COORDINATES']['QR_CODE_BTN']['y'],0xbb8),await this['clickWithTransition'](_0x397bff[_0x5a38a4(0x2c1)],_0xcedfb5[_0x5a38a4(0x33a)]['IMAGE_LIBRARY_BTN']['x'],_0xcedfb5[_0x5a38a4(0x33a)]['IMAGE_LIBRARY_BTN']['y'],0x7d0),await this['clickWithTransition'](_0x397bff['deviceId'],_0xcedfb5[_0x5a38a4(0x33a)]['FIRST_IMAGE_BTN']['x'],_0xcedfb5['PG_UI_COORDINATES']['FIRST_IMAGE_BTN']['y'],0x3e8),!await this['clickAndWaitForScreen'](_0x397bff[_0x5a38a4(0x2c1)],_0xcedfb5[_0x5a38a4(0x33a)][_0x5a38a4(0x208)]['x'],_0xcedfb5[_0x5a38a4(0x33a)]['SELECT_IMAGE_QR_CODE_BTN']['y'],{'expectedTexts':[_0x4625f5['beneficiaryName']],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x2c42e0['PG_ROI_EXPECTED'][_0x5a38a4(0x2dd)]}))throw await this['clickWithTransition'](_0x397bff['deviceId'],_0xcedfb5['PG_UI_COORDINATES']['HOME_ICON_HEADER']['x'],_0xcedfb5[_0x5a38a4(0x33a)]['HOME_ICON_HEADER']['y'],0x7d0),new _0x5c1cf2['WithdrawalProcessingError']('Choose\x20wrong\x20image\x20qrcode',_0x5c1cf2['ErrorType']['TEMPORARY'],_0x4625f5[_0x5a38a4(0x207)]);if(this['logger']['log']('['+_0x397bff['accountName']+']\x20-\x20Get\x20Verified\x20account\x20name\x20screen'),!await this[_0x5a38a4(0x121)](_0x397bff['deviceId'],_0xcedfb5['PG_UI_COORDINATES'][_0x5a38a4(0xf8)]['x'],_0xcedfb5[_0x5a38a4(0x33a)]['CONTINUE_TRANSFER_BTN']['y'],{'expectedTexts':[_0x5a38a4(0x2ba)],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x2c42e0['PG_ROI_EXPECTED']['TRANSACTION_CONFIRM']}))throw new _0x5c1cf2['WithdrawalProcessingError']('Transaction\x20confirm\x20screen\x20not\x20found',_0x5c1cf2['ErrorType']['FORCE_LOGIN'],_0x4625f5['withdrawalId']);if(this['logger']['log']('['+_0x397bff['accountName']+']\x20-\x20Get\x20Transaction\x20confirm\x20screen'),!await this['clickAndWaitForScreen'](_0x397bff[_0x5a38a4(0x2c1)],_0xcedfb5['PG_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['x'],_0xcedfb5['PG_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['y'],{'expectedTexts':['Xc\x20thc\x20giao\x20dch'],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x2c42e0['PG_ROI_EXPECTED']['TRANSACTION_VERIFY']}))throw new _0x5c1cf2['WithdrawalProcessingError']('Transaction\x20verification\x20screen\x20not\x20found',_0x5c1cf2['ErrorType'][_0x5a38a4(0x179)],_0x4625f5['withdrawalId']);if(this[_0x5a38a4(0x329)]['log']('['+_0x397bff['accountName']+_0x5a38a4(0x272)),await this['inputSmartOTPFromConfig'](_0x397bff['deviceId']),!await this['verifyScreenState'](_0x397bff[_0x5a38a4(0x2c1)],{'expectedTexts':['Chuyn\x20tin\x20thnh\x20cng'],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x2c42e0['PG_ROI_EXPECTED']['TRANSACTION_SUCCESS'],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new _0x5c1cf2['WithdrawalProcessingError']('Transaction\x20success\x20screen\x20not\x20found',_0x5c1cf2['ErrorType']['FORCE_LOGIN'],_0x4625f5[_0x5a38a4(0x207)]);this['logger'][_0x5a38a4(0x349)]('['+_0x397bff['accountName']+']\x20-\x20Get\x20Transaction\x20success\x20screen'),this[_0x5a38a4(0x220)](_0x397bff['deviceId'],{'folderPath':_0x4625f5['withdrawalCode']})['catch'](()=>{const _0xb1056=_0x5a38a4;this['logger'][_0xb1056(0x25a)]('['+_0x397bff['accountName']+_0xb1056(0x29e)+_0x4625f5['withdrawalId']+'\x20-\x20'+_0x4625f5['withdrawalCode']);}),await this[_0x5a38a4(0x28b)](_0x397bff['deviceId'],_0xcedfb5['PG_UI_COORDINATES'][_0x5a38a4(0x177)]['x'],_0xcedfb5['PG_UI_COORDINATES']['BACK_TO_HOME']['y'],0x1388,'['+_0x397bff[_0x5a38a4(0x206)]+']\x20-\x20Get\x20back\x20to\x20home\x20screen');}async[_0x20223d(0x1e3)](_0x652269,_0x208c21){const _0x3da499=_0x20223d;try{this['logger']['log'](_0x3da499(0x1b4)+_0x652269['withdrawalId']+'\x20on\x20device\x20'+_0x208c21),await this['clickWithTransition'](_0x208c21,_0xcedfb5['PG_UI_COORDINATES']['TRANSFER_BTN']['x'],_0xcedfb5['PG_UI_COORDINATES']['TRANSFER_BTN']['y'],0x1388,'['+_0x208c21+']\x20-\x20Clicking\x20transfer\x20button\x20at\x20coordinates\x20('+_0xcedfb5[_0x3da499(0x33a)][_0x3da499(0x185)]['x']+',\x20'+_0xcedfb5[_0x3da499(0x33a)]['TRANSFER_BTN']['y']+')'),await this['clickWithTransition'](_0x208c21,_0xcedfb5['PG_UI_COORDINATES']['TRANSFER_INTERNAL_BTN']['x'],_0xcedfb5['PG_UI_COORDINATES']['TRANSFER_INTERNAL_BTN']['y'],0xbb8,'['+_0x208c21+_0x3da499(0x259)+_0xcedfb5['PG_UI_COORDINATES']['TRANSFER_INTERNAL_BTN']['x']+',\x20'+_0xcedfb5['PG_UI_COORDINATES'][_0x3da499(0x139)]['y']+')'),await this[_0x3da499(0x28b)](_0x208c21,_0xcedfb5['PG_UI_COORDINATES']['CLOSE_ALLOW_CONTACT_POPUP_BTN']['x'],_0xcedfb5['PG_UI_COORDINATES']['CLOSE_ALLOW_CONTACT_POPUP_BTN']['y'],0xbb8,'['+_0x208c21+']\x20-\x20Clicking\x20close\x20allow\x20contact\x20popup\x20button\x20at\x20coordinates\x20('+_0xcedfb5['PG_UI_COORDINATES']['CLOSE_ALLOW_CONTACT_POPUP_BTN']['x']+',\x20'+_0xcedfb5['PG_UI_COORDINATES']['CLOSE_ALLOW_CONTACT_POPUP_BTN']['y']+')'),await this['clickWithTransition'](_0x208c21,_0xcedfb5[_0x3da499(0x33a)][_0x3da499(0x122)]['x'],_0xcedfb5['PG_UI_COORDINATES']['ACCOUNT_NUMBER_INPUT']['y'],0xbb8,'['+_0x208c21+']\x20-\x20Clicking\x20account\x20number\x20input\x20field\x20at\x20coordinates\x20('+_0xcedfb5[_0x3da499(0x33a)][_0x3da499(0x122)]['x']+',\x20'+_0xcedfb5['PG_UI_COORDINATES'][_0x3da499(0x122)]['y']+')'),'HC'===_0x1fb201['config']['boxType']&&await this['wsService']['switchKeyboardMode'](_0x208c21),await this['wsService']['inputText'](_0x208c21,_0x652269[_0x3da499(0x13b)]),await(0x0,_0x2b1254['sleep'])(0x3e8),await this['wsService']['pressReturnKey'](_0x208c21),await(0x0,_0x2b1254['sleep'])(0x2710),await this[_0x3da499(0x28b)](_0x208c21,_0xcedfb5['PG_UI_COORDINATES']['INTERNAL_AMOUNT_INPUT']['x'],_0xcedfb5['PG_UI_COORDINATES']['INTERNAL_AMOUNT_INPUT']['y'],0x3e8,'['+_0x208c21+']\x20-\x20Clicking\x20amount\x20input\x20field\x20at\x20coordinates\x20('+_0xcedfb5[_0x3da499(0x33a)]['INTERNAL_AMOUNT_INPUT']['x']+',\x20'+_0xcedfb5['PG_UI_COORDINATES']['INTERNAL_AMOUNT_INPUT']['y']+')'),await this['wsService']['inputText'](_0x208c21,_0x652269[_0x3da499(0x1d9)]['toString']()),await this['clickWithTransition'](_0x208c21,_0xcedfb5['PG_UI_COORDINATES']['HIDE_NUMPAD_BTN']['x'],_0xcedfb5['PG_UI_COORDINATES']['HIDE_NUMPAD_BTN']['y'],0x3e8),await this['clickWithTransition'](_0x208c21,_0xcedfb5['PG_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['x'],_0xcedfb5['PG_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['y'],0x3a98,'['+_0x208c21+']\x20-\x20Clicking\x20continue\x20transfer\x20button\x20at\x20coordinates\x20('+_0xcedfb5['PG_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['x']+',\x20'+_0xcedfb5[_0x3da499(0x33a)]['CONTINUE_TRANSFER_BTN']['y']+')'),await this[_0x3da499(0x28b)](_0x208c21,_0xcedfb5['PG_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['x'],_0xcedfb5['PG_UI_COORDINATES'][_0x3da499(0xf8)]['y'],0x7530,'['+_0x208c21+_0x3da499(0x255)+_0xcedfb5[_0x3da499(0x33a)]['CONTINUE_TRANSFER_BTN']['x']+',\x20'+_0xcedfb5['PG_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['y']+')'),this[_0x3da499(0x329)][_0x3da499(0x349)]('['+_0x208c21+_0x3da499(0x129)),await this['inputSmartOTPFromConfig'](_0x208c21),await(0x0,_0x2b1254['sleep'])(0x7530),await this['captureScreen'](_0x208c21,{'quality':0.5,'folderPath':_0x652269['withdrawalCode']}),await this[_0x3da499(0x28b)](_0x208c21,_0xcedfb5[_0x3da499(0x33a)]['BACK_TO_HOME']['x'],_0xcedfb5['PG_UI_COORDINATES']['BACK_TO_HOME']['y'],0x2710,'['+_0x208c21+']\x20-\x20Clicking\x20back\x20to\x20home\x20button\x20at\x20coordinates\x20('+_0xcedfb5['PG_UI_COORDINATES']['BACK_TO_HOME']['x']+',\x20'+_0xcedfb5['PG_UI_COORDINATES']['BACK_TO_HOME']['y']+')');}catch(_0x40050d){throw this[_0x3da499(0x329)]['error']('['+_0x208c21+']\x20-\x20Error\x20executing\x20PG\x20transfer\x20for\x20withdrawal\x20'+_0x652269['withdrawalId']+':\x20'+_0x40050d['message']),_0x40050d;}}async[_0x20223d(0x2da)](_0x59d1eb,_0x3ea634){const _0x25732d=_0x20223d;try{this['logger'][_0x25732d(0x349)](_0x25732d(0x1b4)+_0x59d1eb['withdrawalId']+'\x20on\x20device\x20'+_0x3ea634);const _0x945a01=_0xd844dc['PG_BANK_SEARCH_UI_COORDINATES'][_0x59d1eb['bankCode']];if(!_0x945a01)throw new Error('Bank\x20'+_0x59d1eb[_0x25732d(0x15a)]+'\x20not\x20found!');await this['clickAndWaitForScreen'](_0x3ea634,_0xcedfb5[_0x25732d(0x33a)]['TRANSFER_BTN']['x'],_0xcedfb5['PG_UI_COORDINATES']['TRANSFER_BTN']['y'],{'expectedTexts':['chuyn\x20tin','transfer'],'unexpectedTexts':['trang\x20ch',_0x25732d(0x13e)],'timeout':0x2710,'pollInterval':0x1f4},'['+_0x3ea634+_0x25732d(0x1dd)+_0xcedfb5['PG_UI_COORDINATES']['TRANSFER_BTN']['x']+',\x20'+_0xcedfb5[_0x25732d(0x33a)][_0x25732d(0x185)]['y']+')'),await this['clickAndWaitForScreen'](_0x3ea634,_0xcedfb5['PG_UI_COORDINATES']['TRANSFER_EXTERNAL_BTN']['x'],_0xcedfb5['PG_UI_COORDINATES'][_0x25732d(0x1ca)]['y'],{'expectedTexts':['chuyn\x20tin\x20lin\x20ngn\x20hng','external\x20transfer',_0x25732d(0x14d)],'timeout':0x1f40,'pollInterval':0x1f4},'['+_0x3ea634+_0x25732d(0x21a)+_0xcedfb5[_0x25732d(0x33a)][_0x25732d(0x1ca)]['x']+',\x20'+_0xcedfb5[_0x25732d(0x33a)]['TRANSFER_EXTERNAL_BTN']['y']+')'),await this['clickWithTransition'](_0x3ea634,_0xcedfb5[_0x25732d(0x33a)]['ACCOUNT_NUMBER_INPUT']['x'],_0xcedfb5['PG_UI_COORDINATES']['ACCOUNT_NUMBER_INPUT']['y'],0x5dc,'['+_0x3ea634+']\x20-\x20Clicking\x20account\x20number\x20field\x20at\x20coordinates\x20('+_0xcedfb5[_0x25732d(0x33a)]['ACCOUNT_NUMBER_INPUT']['x']+',\x20'+_0xcedfb5['PG_UI_COORDINATES']['ACCOUNT_NUMBER_INPUT']['y']+')'),'HC'===_0x1fb201['config'][_0x25732d(0x310)]&&await this[_0x25732d(0x2e5)]['switchKeyboardMode'](_0x3ea634),await this['wsService']['inputText'](_0x3ea634,_0x59d1eb['beneficiaryAccountNo']),await(0x0,_0x2b1254['sleep'])(0x3e8),await this[_0x25732d(0x2e5)]['pressReturnKey'](_0x3ea634),await(0x0,_0x2b1254['sleep'])(0x3e8),await this[_0x25732d(0x28b)](_0x3ea634,_0xcedfb5['PG_UI_COORDINATES']['BANK_SEARCH_BTN']['x'],_0xcedfb5['PG_UI_COORDINATES']['BANK_SEARCH_BTN']['y'],0x3e8,'['+_0x3ea634+']\x20-\x20Clicking\x20account\x20number\x20field\x20at\x20coordinates\x20('+_0xcedfb5['PG_UI_COORDINATES'][_0x25732d(0x22a)]['x']+',\x20'+_0xcedfb5[_0x25732d(0x33a)][_0x25732d(0x22a)]['y']+')'),await this['clickWithTransition'](_0x3ea634,_0xcedfb5['PG_UI_COORDINATES']['BANK_SEARCH_INPUT']['x'],_0xcedfb5['PG_UI_COORDINATES']['BANK_SEARCH_INPUT']['y'],0x7d0,'['+_0x3ea634+']\x20-\x20Clicking\x20account\x20number\x20field\x20at\x20coordinates\x20('+_0xcedfb5['PG_UI_COORDINATES'][_0x25732d(0x1db)]['x']+',\x20'+_0xcedfb5[_0x25732d(0x33a)]['BANK_SEARCH_INPUT']['y']+')'),await this[_0x25732d(0x2e5)][_0x25732d(0x24b)](_0x3ea634,_0x945a01['searchValue']),await(0x0,_0x2b1254['sleep'])(0x3e8),await this['wsService']['pressReturnKey'](_0x3ea634),await(0x0,_0x2b1254['sleep'])(0x3e8),await this['clickWithTransition'](_0x3ea634,_0x945a01['coordinates']['x'],_0x945a01['coordinates']['y'],0x2710,'['+_0x3ea634+_0x25732d(0x2cd)+_0x945a01[_0x25732d(0x25f)]['x']+',\x20'+_0x945a01[_0x25732d(0x25f)]['y']+')'),await this['wsService']['swipe'](_0x3ea634,{'type':'6'}),await(0x0,_0x2b1254['sleep'])(0xbb8),await this['clickWithTransition'](_0x3ea634,_0xcedfb5[_0x25732d(0x33a)]['EXTERNAL_AMOUNT_INPUT']['x'],_0xcedfb5[_0x25732d(0x33a)]['EXTERNAL_AMOUNT_INPUT']['y'],0x7d0,'['+_0x3ea634+']\x20-\x20Clicking\x20amount\x20input\x20field\x20at\x20coordinates\x20('+_0xcedfb5['PG_UI_COORDINATES']['EXTERNAL_AMOUNT_INPUT']['x']+',\x20'+_0xcedfb5[_0x25732d(0x33a)][_0x25732d(0x17d)]['y']+')'),await this[_0x25732d(0x2e5)][_0x25732d(0x24b)](_0x3ea634,_0x59d1eb['amount']['toString']()),await this['clickWithTransition'](_0x3ea634,_0xcedfb5['PG_UI_COORDINATES']['HIDE_NUMPAD_BTN']['x'],_0xcedfb5[_0x25732d(0x33a)]['HIDE_NUMPAD_BTN']['y'],0x3e8),await this[_0x25732d(0x121)](_0x3ea634,_0xcedfb5['PG_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['x'],_0xcedfb5[_0x25732d(0x33a)][_0x25732d(0xf8)]['y'],{'expectedTexts':['xc\x20nhn','confirm','otp','m\x20xc\x20thc'],'timeout':0x4e20,'pollInterval':0x1f4},'['+_0x3ea634+']\x20-\x20Clicking\x20continue\x20transfer\x20button\x20at\x20coordinates\x20('+_0xcedfb5['PG_UI_COORDINATES'][_0x25732d(0xf8)]['x']+',\x20'+_0xcedfb5['PG_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['y']+')'),await this['clickWithTransition'](_0x3ea634,_0xcedfb5[_0x25732d(0x33a)][_0x25732d(0xf8)]['x'],_0xcedfb5['PG_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['y'],0x2710,'['+_0x3ea634+']\x20-\x20Clicking\x20continue\x20transfer\x20button\x20at\x20coordinates\x20('+_0xcedfb5['PG_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['x']+',\x20'+_0xcedfb5[_0x25732d(0x33a)][_0x25732d(0xf8)]['y']+')'),await this['clickWithTransition'](_0x3ea634,_0xcedfb5['PG_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['x'],_0xcedfb5['PG_UI_COORDINATES'][_0x25732d(0xf8)]['y'],0x61a8,'['+_0x3ea634+']\x20-\x20Clicking\x20continue\x20transfer\x20button\x20at\x20coordinates\x20('+_0xcedfb5['PG_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['x']+',\x20'+_0xcedfb5['PG_UI_COORDINATES'][_0x25732d(0xf8)]['y']+')'),this['logger']['log']('['+_0x3ea634+_0x25732d(0x129)),await this['inputSmartOTPFromConfig'](_0x3ea634),await(0x0,_0x2b1254['sleep'])(0x4e20),await this['captureScreen'](_0x3ea634,{'quality':0.5,'folderPath':_0x59d1eb['withdrawalCode']}),await(0x0,_0x2b1254[_0x25732d(0x23d)])(0x1388),await this['clickWithTransition'](_0x3ea634,_0xcedfb5['PG_UI_COORDINATES'][_0x25732d(0x177)]['x'],_0xcedfb5['PG_UI_COORDINATES'][_0x25732d(0x177)]['y'],0x1388,'['+_0x3ea634+']\x20-\x20Clicking\x20back\x20to\x20home\x20button\x20at\x20coordinates\x20('+_0xcedfb5['PG_UI_COORDINATES']['BACK_TO_HOME']['x']+',\x20'+_0xcedfb5[_0x25732d(0x33a)][_0x25732d(0x177)]['y']+')');}catch(_0x164b2b){throw this[_0x25732d(0x329)][_0x25732d(0x25a)]('['+_0x3ea634+']\x20-\x20Error\x20executing\x20PG\x20transfer\x20for\x20withdrawal\x20'+_0x59d1eb['withdrawalId']+':\x20'+_0x164b2b['message']),_0x164b2b;}}async[_0x20223d(0x2f0)](_0x1a5126){const _0x349722=_0x20223d;try{const _0x3457e9=await this['ocrService']['recognizeFromFile'](_0x1a5126,{'fieldType':'singleLine','customROI':{'x':0.05,'y':0.75,'width':0.9,'height':0.12},'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}});if(!_0x3457e9)return this['logger']['warn']('Failed\x20to\x20extract\x20transaction\x20amount\x20from\x20ROI'),null;const _0x430fad=_0x3457e9['text'][_0x349722(0x11f)](/[^\d.,]/g,'')['replace'](/,/g,''),_0x4abcab=parseFloat(_0x430fad);return isNaN(_0x4abcab)?(this['logger']['warn']('Could\x20not\x20parse\x20amount\x20from\x20OCR\x20text:\x20'+_0x3457e9['text']),null):(this['logger']['log']('Extracted\x20transaction\x20amount:\x20'+_0x4abcab['toLocaleString']('vi-VN')+'\x20VND\x20(confidence:\x20'+_0x3457e9['confidence']['toFixed'](0x2)+_0x349722(0x1bf)+_0x3457e9[_0x349722(0x1ae)]+_0x349722(0x169)),_0x4abcab);}catch(_0x575085){return this['logger']['error']('Error\x20extracting\x20transaction\x20amount:\x20'+_0x575085[_0x349722(0x26b)],_0x575085['stack']),null;}}async[_0x20223d(0x2ce)](){}['onModuleDestroy'](){}};_0x4d0a6a['PgService']=_0x3f7ab4,_0x4d0a6a['PgService']=_0x3f7ab4=_0x2fe98c([(0x0,_0x319737['Injectable'])(),_0x3a8169(0x0,(0x0,_0x319737['Inject'])(_0xfba17a[_0x20223d(0x2a4)])),_0x5bfbc7('design:paramtypes',['function'==typeof(_0x313c58=void 0x0!==_0x10079f['IWebSocketService']&&_0x10079f['IWebSocketService'])?_0x313c58:Object,'function'==typeof(_0x290b8c=void 0x0!==_0x327ec8['DeviceService']&&_0x327ec8['DeviceService'])?_0x290b8c:Object,_0x20223d(0x269)==typeof(_0x17a1c7=void 0x0!==_0x5db9f2[_0x20223d(0x21e)]&&_0x5db9f2['OCRService'])?_0x17a1c7:Object])],_0x3f7ab4);},(_0x551205,_0x7b141f,_0x269706)=>{const _0x37eaf3=a0_0x2633;Object['defineProperty'](_0x7b141f,'__esModule',{'value':!0x0}),_0x7b141f['PG_UI_COORDINATES']=void 0x0;const _0x33b247=_0x269706(0xf),_0x3e7d58={'LOGIN_BTN':{'x':0.5,'y':0.6},'PASSWORD_FIELD':{'x':0.5,'y':0.4},'TRANSFER_BTN':{'x':0.7,'y':0.7},'TRANSFER_INTERNAL_BTN':{'x':0.2,'y':0.2},'TRANSFER_EXTERNAL_BTN':{'x':0.4,'y':0.2},'CLOSE_ALLOW_CONTACT_POPUP_BTN':{'x':0.3,'y':0.6},'ACCOUNT_NUMBER_INPUT':{'x':0.4,'y':0.43},'SELECT_BANK_BTN':{'x':0.4,'y':0.47},'SEARCH_BANK_BTN':{'x':0.4,'y':0.48},'INTERNAL_AMOUNT_INPUT':{'x':0.5,'y':0.6},'HIDE_NUMPAD_BTN':{'x':0.05,'y':0.4},'CONTINUE_TRANSFER_BTN':{'x':0.5,'y':0.9},'BANK_SEARCH_BTN':{'x':0.4,'y':0.45},'BANK_SEARCH_INPUT':{'x':0.4,'y':0.45},'EXTERNAL_AMOUNT_INPUT':{'x':0.3,'y':0.37},'BACK_TO_HOME':{'x':0.2,'y':0.9},'QR_CODE_BTN':{'x':0.2,'y':0.9},'IMAGE_LIBRARY_BTN':{'x':0.8,'y':0.9},'FIRST_IMAGE_BTN':{'x':0.3,'y':0.3},'SELECT_IMAGE_QR_CODE_BTN':{'x':0.95,'y':0.95},'HOME_ICON_HEADER':{'x':0.95,'y':0.05}},_0xe8e63c=(0x0,_0x269706(0x25)[_0x37eaf3(0x29c)])(_0x3e7d58);_0x7b141f['PG_UI_COORDINATES']=_0x37eaf3(0x171)===_0x33b247['config']['boxType']?_0xe8e63c:_0x3e7d58;},(_0x15923e,_0x14969a,_0x500ab0)=>{const _0x320fed=a0_0x2633;Object['defineProperty'](_0x14969a,_0x320fed(0x209),{'value':!0x0}),_0x14969a['PG_BANK_SEARCH_UI_COORDINATES']=_0x14969a['HC_PG_BANK_SEARCH_UI_COORDINATES']=void 0x0;const _0x1b442e=_0x500ab0(0xf);_0x14969a['HC_PG_BANK_SEARCH_UI_COORDINATES']={'VIETCOMBANK':{'searchValue':'VIETCOMBANK','coordinates':{'x':0.5,'y':0.58}},'AGRIBANK':{'searchValue':'AGRIBANK','coordinates':{'x':0.5,'y':0.58}},'BIDV':{'searchValue':'BIDV','coordinates':{'x':0.5,'y':0.58}},'SACOMBANK':{'searchValue':_0x320fed(0x300),'coordinates':{'x':0.5,'y':0.58}},'TECHCOMBANK':{'searchValue':'TECHCOMBANK','coordinates':{'x':0.5,'y':0.58}},'TPBANK':{'searchValue':'TPBANK','coordinates':{'x':0.5,'y':0.58}},'HDBank':{'searchValue':'HDBank','coordinates':{'x':0.5,'y':0.58}},'VPBANK':{'searchValue':_0x320fed(0x218),'coordinates':{'x':0.5,'y':0.78}},'MBBANK':{'searchValue':_0x320fed(0x2ee),'coordinates':{'x':0.5,'y':0.58}},'MSB':{'searchValue':'MSB','coordinates':{'x':0.5,'y':0.58}},'LPBANK':{'searchValue':'LPBANK','coordinates':{'x':0.5,'y':0.58}},'ACB':{'searchValue':_0x320fed(0x1c6),'coordinates':{'x':0.5,'y':0.58}},'ABBANK':{'searchValue':_0x320fed(0x1ea),'coordinates':{'x':0.5,'y':0.58}},'NCB':{'searchValue':_0x320fed(0x158),'coordinates':{'x':0.5,'y':0.58}},'EXIMBANK':{'searchValue':'EXIMBANK','coordinates':{'x':0.5,'y':0.58}},'SEABANK':{'searchValue':'SEABANK','coordinates':{'x':0.5,'y':0.58}},'SCB':{'searchValue':'SCB','coordinates':{'x':0.5,'y':0.58}},'PVCOMBANK':{'searchValue':'PVCOMBANK','coordinates':{'x':0.5,'y':0.58}},'KIENLONGBANK':{'searchValue':'KIENLONG','coordinates':{'x':0.5,'y':0.58}},'BVBANK':{'searchValue':'BVBANK','coordinates':{'x':0.5,'y':0.58}},'VIETINBANK':{'searchValue':'VIETINBANK','coordinates':{'x':0.5,'y':0.58}},'OCB':{'searchValue':'OCB','coordinates':{'x':0.5,'y':0.58}},'VIETBANK':{'searchValue':_0x320fed(0x136),'coordinates':{'x':0.5,'y':0.58}},'SHB':{'searchValue':'SHB','coordinates':{'x':0.5,'y':0.58}},'NAMABANK':{'searchValue':'NAM\x20A\x20BANK','coordinates':{'x':0.5,'y':0.58}},'SHINHANBANKVIETNAM':{'searchValue':_0x320fed(0x33b),'coordinates':{'x':0.5,'y':0.58}},'CIMB':{'searchValue':_0x320fed(0x167),'coordinates':{'x':0.5,'y':0.58}},'SAIGONBANK':{'searchValue':'SAIGONBANK','coordinates':{'x':0.5,'y':0.58}},'BACABANK':{'searchValue':'BAC','coordinates':{'x':0.5,'y':0.58}},'VIETABANK':{'searchValue':'VIET\x20A\x20BANK','coordinates':{'x':0.5,'y':0.58}},'GPBANK':{'searchValue':_0x320fed(0x326),'coordinates':{'x':0.5,'y':0.58}},'HSBC':{'searchValue':_0x320fed(0x278),'coordinates':{'x':0.5,'y':0.58}},'VRB':{'searchValue':'VRB','coordinates':{'x':0.5,'y':0.58}},'VIB':{'searchValue':'VIB','coordinates':{'x':0.5,'y':0.58}}};const _0x1e8ce3=((_0x2a41e0,_0x4dc562=0x64)=>Object[_0x320fed(0x1c7)](Object[_0x320fed(0x2d2)](_0x2a41e0)['map'](([_0x1ceab3,_0xe26c15])=>[_0x1ceab3,{..._0xe26c15,'coordinates':{'x':Math[_0x320fed(0x243)](_0xe26c15['coordinates']['x']*_0x4dc562),'y':Math[_0x320fed(0x243)](_0xe26c15['coordinates']['y']*_0x4dc562)}}])))(_0x14969a['HC_PG_BANK_SEARCH_UI_COORDINATES'],0x64);_0x14969a['PG_BANK_SEARCH_UI_COORDINATES']=_0x320fed(0x171)===_0x1b442e[_0x320fed(0x30b)][_0x320fed(0x310)]?_0x1e8ce3:_0x14969a['HC_PG_BANK_SEARCH_UI_COORDINATES'];},(_0x307555,_0x4c9878)=>{const _0x5ca66b=a0_0x2633;var _0x3219df;Object[_0x5ca66b(0x1c8)](_0x4c9878,'__esModule',{'value':!0x0}),_0x4c9878['WithdrawalProcessingError']=_0x4c9878['ErrorType']=void 0x0,_0x4c9878[_0x5ca66b(0x172)]=function(_0x4f003f,_0x465d02){const _0x4b3bf5=_0x5ca66b,_0x5d621e=_0x4f003f['toLowerCase']()+'\x20'+(_0x465d02?.[_0x4b3bf5(0x26b)]?.['toLowerCase']()||'');return['insufficient','invalid','not\x20found',_0x4b3bf5(0x28c),_0x4b3bf5(0x1c5),'bad\x20request','required']['some'](_0x14532d=>_0x5d621e[_0x4b3bf5(0x285)](_0x14532d))?_0x3219df['PERMANENT']:['session',_0x4b3bf5(0x2c8),'timeout','device','locked',_0x4b3bf5(0x1ef),_0x4b3bf5(0x131),_0x4b3bf5(0x1e9),'not\x20active','unexpectedly\x20locked'][_0x4b3bf5(0x25b)](_0x19245a=>_0x5d621e['includes'](_0x19245a))?_0x3219df['TEMPORARY']:_0x3219df['UNKNOWN'];},function(_0x55b6ea){const _0x4f2ac2=_0x5ca66b;_0x55b6ea[_0x4f2ac2(0xfd)]=_0x4f2ac2(0xfd),_0x55b6ea['PERMANENT']='PERMANENT',_0x55b6ea[_0x4f2ac2(0x157)]=_0x4f2ac2(0x157),_0x55b6ea[_0x4f2ac2(0x179)]=_0x4f2ac2(0x179),_0x55b6ea['FORCE_KILL_APP']=_0x4f2ac2(0x2fb);}(_0x3219df||(_0x4c9878[_0x5ca66b(0x2f8)]=_0x3219df={}));class _0x3c4e26 extends Error{constructor(_0x859003,_0x101bbd,_0x3a9c6f){const _0x563bb8=_0x5ca66b;super(_0x859003),this['errorType']=_0x101bbd,this[_0x563bb8(0x207)]=_0x3a9c6f,this['name']=_0x563bb8(0x1fa);}}_0x4c9878['WithdrawalProcessingError']=_0x3c4e26;},function(_0x417e28,_0xc2cffc,_0x201872){const _0x40fb0a=a0_0x2633;var _0x4d2b72,_0x5bc801=this&&this['__decorate']||function(_0x1eea31,_0x3975a2,_0x4fef6f,_0x1fdbc8){const _0x38bb5f=a0_0x2633;var _0x5a1e39,_0x59c33d=arguments[_0x38bb5f(0x1e6)],_0x4768d0=_0x59c33d<0x3?_0x3975a2:null===_0x1fdbc8?_0x1fdbc8=Object[_0x38bb5f(0x2c5)](_0x3975a2,_0x4fef6f):_0x1fdbc8;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x4768d0=Reflect['decorate'](_0x1eea31,_0x3975a2,_0x4fef6f,_0x1fdbc8);else{for(var _0x36cf6f=_0x1eea31['length']-0x1;_0x36cf6f>=0x0;_0x36cf6f--)(_0x5a1e39=_0x1eea31[_0x36cf6f])&&(_0x4768d0=(_0x59c33d<0x3?_0x5a1e39(_0x4768d0):_0x59c33d>0x3?_0x5a1e39(_0x3975a2,_0x4fef6f,_0x4768d0):_0x5a1e39(_0x3975a2,_0x4fef6f))||_0x4768d0);}return _0x59c33d>0x3&&_0x4768d0&&Object['defineProperty'](_0x3975a2,_0x4fef6f,_0x4768d0),_0x4768d0;},_0x4debe2=this&&this['__metadata']||function(_0x47236b,_0x46e06f){const _0xfd1e6a=a0_0x2633;if('object'==typeof Reflect&&_0xfd1e6a(0x269)==typeof Reflect['metadata'])return Reflect[_0xfd1e6a(0x331)](_0x47236b,_0x46e06f);};Object['defineProperty'](_0xc2cffc,_0x40fb0a(0x209),{'value':!0x0}),_0xc2cffc[_0x40fb0a(0x213)]=void 0x0;const _0x2d2628=_0x201872(0x2),_0x31c4a9=_0x201872(0x16);let _0x119c7a=class{constructor(_0x4860db){const _0x2cdef2=_0x40fb0a;this['redisService']=_0x4860db,this['logger']=new _0x2d2628[(_0x2cdef2(0x1da))]('SessionManagementService'),this[_0x2cdef2(0x19c)]=_0x2cdef2(0x1f5),this['BANK_SESSION_CONFIGS']=new Map([[_0x2cdef2(0x1c6),{'bankCode':'ACB','sessionTimeoutMs':0xdbba0,'refreshBeforeMs':0xea60}],[_0x2cdef2(0x29a),{'bankCode':_0x2cdef2(0x29a),'sessionTimeoutMs':0x41eb0,'refreshBeforeMs':0x7530}]]);}['getSessionTimeout'](_0x40aec4){const _0x1f82a6=this['BANK_SESSION_CONFIGS']['get'](_0x40aec4['toUpperCase']());return _0x1f82a6?.['sessionTimeoutMs']||0x41eb0;}['getRefreshBeforeTime'](_0x301e38){const _0x18df2b=this['BANK_SESSION_CONFIGS']['get'](_0x301e38['toUpperCase']());return _0x18df2b?.['refreshBeforeMs']||0x7530;}async['recordLogin'](_0x45ab51,_0x4d1555){const _0x2460cf=_0x40fb0a,_0x127f1f=this[_0x2460cf(0x20a)](_0x4d1555),_0x4fcdfd=Date['now']()+_0x127f1f,_0x1f00e2={'deviceId':_0x45ab51,'bankCode':_0x4d1555[_0x2460cf(0x338)](),'loginTime':Date['now'](),'expiresAt':_0x4fcdfd,'status':'logged_in'},_0x4acd5b=''+this['REDIS_SESSION_PREFIX']+_0x45ab51+':'+_0x4d1555['toUpperCase']();await this['redisService'][_0x2460cf(0x1e4)](_0x4acd5b,JSON['stringify'](_0x1f00e2),_0x127f1f),this['logger']['log'](_0x2460cf(0x31c)+_0x45ab51+',\x20bank\x20'+_0x4d1555+_0x2460cf(0x2a8)+new Date(_0x4fcdfd)['toISOString']());}async['markLoggingIn'](_0x228fad,_0x1ebce3){const _0x1f9e84=_0x40fb0a,_0x337e6d=''+this['REDIS_SESSION_PREFIX']+_0x228fad+':'+_0x1ebce3['toUpperCase'](),_0x277ec3=await this['getSession'](_0x228fad,_0x1ebce3),_0x16d1df={'deviceId':_0x228fad,'bankCode':_0x1ebce3['toUpperCase'](),'loginTime':_0x277ec3?.['loginTime']||Date[_0x1f9e84(0x292)](),'expiresAt':_0x277ec3?.['expiresAt']||Date['now']()+this['getSessionTimeout'](_0x1ebce3),'status':_0x1f9e84(0x288)};await this['redisService']['set'](_0x337e6d,JSON['stringify'](_0x16d1df),0x493e0),this['logger']['log']('Marked\x20device\x20'+_0x228fad+_0x1f9e84(0x1f3)+_0x1ebce3+_0x1f9e84(0x153));}async[_0x40fb0a(0x24c)](_0x13ef98,_0x47ed49){const _0x7b9d7f=_0x40fb0a;try{const _0x240151=''+this[_0x7b9d7f(0x19c)]+_0x13ef98+':'+_0x47ed49['toUpperCase'](),_0x5afec5=await this['redisService']['get'](_0x240151);return _0x5afec5?JSON[_0x7b9d7f(0x1ac)](_0x5afec5):null;}catch(_0x39a5d4){return this[_0x7b9d7f(0x329)][_0x7b9d7f(0x25a)]('Error\x20getting\x20session\x20for\x20device\x20'+_0x13ef98+',\x20bank\x20'+_0x47ed49+':\x20'+_0x39a5d4['message']),null;}}async[_0x40fb0a(0x1b3)](_0x3b72af,_0x1ba9e0){const _0x51b0f5=_0x40fb0a,_0x2b09c4=await this['getSession'](_0x3b72af,_0x1ba9e0);return!(!_0x2b09c4||_0x2b09c4['expiresAt']<Date[_0x51b0f5(0x292)]()||'logging_in'===_0x2b09c4['status']||'logged_in'!==_0x2b09c4['status']);}async[_0x40fb0a(0x1fc)](_0x728d44,_0x3a0dae){const _0x2c842f=_0x40fb0a,_0xcfbd23=await this[_0x2c842f(0x24c)](_0x728d44,_0x3a0dae);if(!_0xcfbd23||_0x2c842f(0x25c)!==_0xcfbd23['status'])return!0x1;const _0x4ee84a=this['getRefreshBeforeTime'](_0x3a0dae);return _0xcfbd23[_0x2c842f(0x17c)]-Date['now']()<=_0x4ee84a;}async['clearSession'](_0x4facb0,_0x3a8807){const _0x35ca46=_0x40fb0a,_0x454efe=''+this['REDIS_SESSION_PREFIX']+_0x4facb0+':'+_0x3a8807['toUpperCase']();await this[_0x35ca46(0x240)]['del'](_0x454efe),this[_0x35ca46(0x329)]['log']('Cleared\x20session\x20for\x20device\x20'+_0x4facb0+',\x20bank\x20'+_0x3a8807);}};_0xc2cffc['SessionManagementService']=_0x119c7a,_0xc2cffc[_0x40fb0a(0x213)]=_0x119c7a=_0x5bc801([(0x0,_0x2d2628['Injectable'])(),_0x4debe2('design:paramtypes',['function'==typeof(_0x4d2b72=void 0x0!==_0x31c4a9['RedisService']&&_0x31c4a9[_0x40fb0a(0x18c)])?_0x4d2b72:Object])],_0x119c7a);},function(_0xf625df,_0x125f73,_0x50da4e){const _0x404ff6=a0_0x2633;var _0x41c4c0,_0x2dea35=this&&this['__decorate']||function(_0x3f1b94,_0x2785e5,_0x19c862,_0x525dbf){var _0x21da42,_0x49a51b=arguments['length'],_0x4d430d=_0x49a51b<0x3?_0x2785e5:null===_0x525dbf?_0x525dbf=Object['getOwnPropertyDescriptor'](_0x2785e5,_0x19c862):_0x525dbf;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x4d430d=Reflect['decorate'](_0x3f1b94,_0x2785e5,_0x19c862,_0x525dbf);else{for(var _0x285d1c=_0x3f1b94['length']-0x1;_0x285d1c>=0x0;_0x285d1c--)(_0x21da42=_0x3f1b94[_0x285d1c])&&(_0x4d430d=(_0x49a51b<0x3?_0x21da42(_0x4d430d):_0x49a51b>0x3?_0x21da42(_0x2785e5,_0x19c862,_0x4d430d):_0x21da42(_0x2785e5,_0x19c862))||_0x4d430d);}return _0x49a51b>0x3&&_0x4d430d&&Object['defineProperty'](_0x2785e5,_0x19c862,_0x4d430d),_0x4d430d;},_0x1faba4=this&&this[_0x404ff6(0x233)]||function(_0x361d4f,_0x585168){if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0x361d4f,_0x585168);};Object['defineProperty'](_0x125f73,'__esModule',{'value':!0x0}),_0x125f73[_0x404ff6(0xff)]=void 0x0;const _0x4c2aae=_0x50da4e(0x2),_0x1b2f9a=_0x50da4e(0x16),_0x516efc=_0x50da4e(0x2d);let _0x3fa9bc=class{constructor(_0x405e13){const _0x26c871=_0x404ff6;this['redisService']=_0x405e13,this['logger']=new _0x4c2aae['Logger']('DeviceLockService'),this[_0x26c871(0x203)]=_0x26c871(0x246),this['DEFAULT_LOCK_TTL']=0x927c0;}async['acquireLock'](_0x187f13,_0x53d093,_0x1cf6eb,_0x110f38=this['DEFAULT_LOCK_TTL']){const _0x18c442=_0x404ff6;try{const _0x13da38=''+this[_0x18c442(0x203)]+_0x187f13,_0x2453d7=''+this[_0x18c442(0x203)]+_0x187f13+':meta',_0x4ceddc=(0x0,_0x516efc['randomUUID'])(),_0x2b904a=Math['ceil'](_0x110f38/0x3e8),_0xfe7e04=await this['redisService'][_0x18c442(0x116)]();if('OK'===await _0xfe7e04[_0x18c442(0x1e4)](_0x13da38,_0x4ceddc,'EX',_0x2b904a,'NX')){const _0xfe3ad5={'deviceId':_0x187f13,'lockType':_0x53d093,'lockedAt':Date[_0x18c442(0x292)](),'lockedBy':_0x1cf6eb,'ttl':_0x110f38};return await this[_0x18c442(0x240)][_0x18c442(0x2d6)](_0x2453d7,_0x2b904a,JSON[_0x18c442(0x2be)](_0xfe3ad5)),this['logger']['log'](_0x18c442(0x1ab)+_0x53d093+'\x20lock\x20for\x20device\x20'+_0x187f13+'\x20('+_0x1cf6eb+')\x20with\x20lockId\x20'+_0x4ceddc),!0x0;}return this['logger']['warn'](_0x18c442(0x1dc)+_0x187f13+'\x20is\x20already\x20locked,\x20cannot\x20acquire\x20lock'),!0x1;}catch(_0x19dee5){return this['logger']['error']('Error\x20acquiring\x20lock\x20for\x20device\x20'+_0x187f13+':\x20'+_0x19dee5['message']),!0x1;}}async[_0x404ff6(0x1e5)](_0x2214fc){const _0x56a996=_0x404ff6;try{const _0x471d38=''+this['REDIS_LOCK_PREFIX']+_0x2214fc,_0x233ba6=''+this['REDIS_LOCK_PREFIX']+_0x2214fc+':meta',_0x511553=await this[_0x56a996(0x240)]['getClient'](),_0x254f56=await _0x511553[_0x56a996(0x192)](_0x471d38);if(!_0x254f56)return await this['redisService']['del'](_0x233ba6),void this[_0x56a996(0x329)][_0x56a996(0x2ac)]('Device\x20'+_0x2214fc+_0x56a996(0x143));0x1===await _0x511553[_0x56a996(0x2d3)]('\x0aif\x20redis.call(\x22GET\x22,\x20KEYS[1])\x20==\x20ARGV[1]\x20then\x0a\x20\x20redis.call(\x22DEL\x22,\x20KEYS[2])\x0a\x20\x20return\x20redis.call(\x22DEL\x22,\x20KEYS[1])\x0aelse\x0a\x20\x20return\x200\x0aend\x0a',0x2,_0x471d38,_0x233ba6,_0x254f56)?this['logger']['log'](_0x56a996(0x266)+_0x2214fc+'\x20(lockId:\x20'+_0x254f56+')'):this['logger']['warn'](_0x56a996(0x1c2)+_0x2214fc+'\x20was\x20already\x20released\x20or\x20changed\x20(expected\x20lockId:\x20'+_0x254f56+')');}catch(_0x17aa38){this['logger']['error'](_0x56a996(0x221)+_0x2214fc+':\x20'+_0x17aa38[_0x56a996(0x26b)],_0x17aa38['stack']);}}async[_0x404ff6(0x21b)](_0x12c929){const _0x5b5170=_0x404ff6;try{const _0x4d5413=''+this['REDIS_LOCK_PREFIX']+_0x12c929,_0x4a9c1e=await this['redisService'][_0x5b5170(0x192)](_0x4d5413);if(!_0x4a9c1e)return null;const _0x4c858a=''+this['REDIS_LOCK_PREFIX']+_0x12c929+':meta',_0x489799=await this['redisService']['get'](_0x4c858a);return _0x489799?{...JSON[_0x5b5170(0x1ac)](_0x489799),'lockId':_0x4a9c1e}:{'deviceId':_0x12c929,'lockType':'transfer','lockedAt':Date['now'](),'lockedBy':_0x5b5170(0x2e8),'ttl':this['DEFAULT_LOCK_TTL'],'lockId':_0x4a9c1e};}catch(_0x286135){return this['logger']['error']('Error\x20getting\x20lock\x20for\x20device\x20'+_0x12c929+':\x20'+_0x286135['message']),null;}}async[_0x404ff6(0x14f)](_0x5d93e5,_0x1f4f39){const _0x3b7597=_0x404ff6;try{const _0x17c24a=''+this['REDIS_LOCK_PREFIX']+_0x5d93e5;if(!await this[_0x3b7597(0x240)]['exists'](_0x17c24a))return!0x1;const _0x47400a=await this[_0x3b7597(0x21b)](_0x5d93e5);return!(!_0x47400a||_0x1f4f39&&_0x47400a['lockType']===_0x1f4f39);}catch(_0x16fdbd){return this['logger']['error']('Error\x20checking\x20lock\x20status\x20for\x20device\x20'+_0x5d93e5+':\x20'+_0x16fdbd[_0x3b7597(0x26b)]),!0x1;}}async['extendLock'](_0x12fc39,_0xf17283){const _0x19d35b=_0x404ff6;try{if(!await this['getLock'](_0x12fc39))return!0x1;const _0x2f29fb=''+this['REDIS_LOCK_PREFIX']+_0x12fc39,_0x577463=''+this['REDIS_LOCK_PREFIX']+_0x12fc39+':meta',_0x12e64a=await this['redisService']['getClient'](),_0x387879=await _0x12e64a[_0x19d35b(0x334)](_0x2f29fb);if(_0x387879<=0x0)return!0x1;const _0x1c44f7=Math['ceil']((0x3e8*_0x387879+_0xf17283)/0x3e8);return 0x1===await _0x12e64a[_0x19d35b(0x2e4)](_0x2f29fb,_0x1c44f7)&&(await this['redisService']['expire'](_0x577463,_0x1c44f7),this['logger']['log']('Extended\x20lock\x20for\x20device\x20'+_0x12fc39+'\x20by\x20'+_0xf17283+'ms'),!0x0);}catch(_0x520a0e){return this['logger']['error']('Error\x20extending\x20lock\x20for\x20device\x20'+_0x12fc39+':\x20'+_0x520a0e['message']),!0x1;}}async['releaseLockByType'](_0x2d9323,_0x4fe9ff){const _0x4bd161=_0x404ff6;try{const _0x31f9b0=await this['getLock'](_0x2d9323);if(!_0x31f9b0)return!0x1;if(_0x31f9b0['lockType']!==_0x4fe9ff)return!0x1;const _0x33638a=''+this[_0x4bd161(0x203)]+_0x2d9323,_0x4b8108=''+this['REDIS_LOCK_PREFIX']+_0x2d9323+':meta';return await this['redisService']['del'](_0x33638a),await this['redisService'][_0x4bd161(0x2fd)](_0x4b8108),this['logger'][_0x4bd161(0x349)]('Force\x20released\x20'+_0x4fe9ff+'\x20lock\x20for\x20device\x20'+_0x2d9323),!0x0;}catch(_0x5dc918){return this['logger']['error']('Error\x20releasing\x20'+_0x4fe9ff+_0x4bd161(0x264)+_0x2d9323+':\x20'+_0x5dc918['message']),!0x1;}}};_0x125f73['DeviceLockService']=_0x3fa9bc,_0x125f73['DeviceLockService']=_0x3fa9bc=_0x2dea35([(0x0,_0x4c2aae[_0x404ff6(0x144)])(),_0x1faba4('design:paramtypes',['function'==typeof(_0x41c4c0=void 0x0!==_0x1b2f9a[_0x404ff6(0x18c)]&&_0x1b2f9a[_0x404ff6(0x18c)])?_0x41c4c0:Object])],_0x3fa9bc);},_0x5350f0=>{_0x5350f0['exports']=require('crypto');},function(_0x431e3d,_0x49cc73,_0x5696fc){const _0x2d049d=a0_0x2633;var _0x523c91,_0x5a9afd,_0x457b2b,_0x4236eb,_0x12427d,_0x14d895,_0x26c19e=this&&this['__decorate']||function(_0x275c3c,_0x286908,_0x54c073,_0x2b4a06){const _0x5a7338=a0_0x2633;var _0x4ff63e,_0x16c934=arguments['length'],_0x1e6a2d=_0x16c934<0x3?_0x286908:null===_0x2b4a06?_0x2b4a06=Object[_0x5a7338(0x2c5)](_0x286908,_0x54c073):_0x2b4a06;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x1e6a2d=Reflect['decorate'](_0x275c3c,_0x286908,_0x54c073,_0x2b4a06);else{for(var _0x259d87=_0x275c3c['length']-0x1;_0x259d87>=0x0;_0x259d87--)(_0x4ff63e=_0x275c3c[_0x259d87])&&(_0x1e6a2d=(_0x16c934<0x3?_0x4ff63e(_0x1e6a2d):_0x16c934>0x3?_0x4ff63e(_0x286908,_0x54c073,_0x1e6a2d):_0x4ff63e(_0x286908,_0x54c073))||_0x1e6a2d);}return _0x16c934>0x3&&_0x1e6a2d&&Object['defineProperty'](_0x286908,_0x54c073,_0x1e6a2d),_0x1e6a2d;},_0x5d79df=this&&this['__metadata']||function(_0x35983e,_0x1346ea){const _0x28fec2=a0_0x2633;if(_0x28fec2(0x26d)==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0x35983e,_0x1346ea);},_0x1aa4d7=this&&this[_0x2d049d(0x248)]||function(_0xcc192d,_0x156e4f){return function(_0x313d62,_0xd192fe){_0x156e4f(_0x313d62,_0xd192fe,_0xcc192d);};};Object['defineProperty'](_0x49cc73,'__esModule',{'value':!0x0}),_0x49cc73['WithdrawalJobManagerService']=void 0x0;const _0x3bb7c4=_0x5696fc(0x2),_0x392857=_0x5696fc(0x7),_0x1c23b3=_0x5696fc(0x6),_0x4b8964=_0x5696fc(0x2f),_0x20703f=_0x5696fc(0xa),_0xa01d8f=_0x5696fc(0x15),_0x158cd8=_0x5696fc(0x2c),_0xcc0c61=_0x5696fc(0x14),_0x521415=_0x5696fc(0x19),_0xcd3b5a=_0x5696fc(0x2a),_0x4a9070=_0x5696fc(0x30),_0x15ee62=_0x5696fc(0x31),_0x4a363b=_0x5696fc(0x12);let _0x799cb3=class{constructor(_0x485204,_0x444a3e,_0x28705e,_0x531820,_0xa4a6b1,_0x5c2f14){const _0x289b11=_0x2d049d;this['withdrawalQueue']=_0x485204,this['withdrawalService']=_0x444a3e,this['deviceService']=_0x28705e,this[_0x289b11(0x342)]=_0x531820,this['wsService']=_0xa4a6b1,this['bankService']=_0x5c2f14,this['logger']=new _0x3bb7c4['Logger']('WithdrawalJobManagerService'),this['processingJobs']=new Set(),this['isInitialized']=!0x1;}async['onModuleInit'](){this['logger']['log']('WithdrawalJobManagerService\x20initialized,\x20waiting\x205\x20seconds\x20before\x20starting...'),setTimeout(()=>{this['initializeJobProcessing']();},0x1388);}async[_0x2d049d(0x2ad)](){this['isInitialized']||await this['startProcessing']();}async['startProcessing'](){const _0x35359e=_0x2d049d;try{this['logger'][_0x35359e(0x349)]('Starting\x20withdrawal\x20job\x20processing...'),await this['pickAndProcessJobs'](),this[_0x35359e(0x2b6)]=!0x0;}catch(_0x5af26e){this[_0x35359e(0x329)][_0x35359e(0x25a)]('Error\x20starting\x20job\x20processing:\x20'+_0x5af26e['message'],_0x5af26e['stack']);}}async[_0x2d049d(0x104)](){const _0x5aae2c=_0x2d049d;try{const _0x10a047=await this['wsService']['listDevices'](),_0x57c054=[];for(const _0x52d243 of _0x10a047){const _0x20323c=await this['deviceService']['getDeviceConfig'](_0x52d243[_0x5aae2c(0x268)]);'active'===_0x20323c?.[_0x5aae2c(0x253)]&&(await this['deviceLock']['isLocked'](_0x52d243[_0x5aae2c(0x268)])||_0x57c054['push']({'udid':_0x52d243[_0x5aae2c(0x268)],'config':_0x20323c}));}return _0x57c054;}catch(_0x2a40f5){return this['logger']['error'](_0x5aae2c(0x27b)+_0x2a40f5['message']),[];}}async['pickAndProcessJobs'](_0x44b5a){const _0x44c34b=_0x2d049d;try{const _0x15aad1=await this['deviceService'][_0x44c34b(0x202)]();if(_0x44c34b(0x22e)!==_0x15aad1)return void this[_0x44c34b(0x329)]['debug']('Service\x20is\x20'+_0x15aad1+_0x44c34b(0x148));const _0x51dec7=await this['getAvailableDevices'](),_0x1741c0=_0x51dec7[_0x44c34b(0x1e6)];if(_0x1741c0<=0x0)return;const _0x2a8d5e=_0x44b5a?Math['min'](_0x44b5a,_0x1741c0):_0x1741c0,_0x2d8df1=await this['withdrawalQueue']['getJobs']([_0x44c34b(0x199)],0x0,_0x2a8d5e-0x1);if(0x0===_0x2d8df1['length'])return;this['logger']['log']('Found\x20'+_0x51dec7['length']+'\x20available\x20devices.\x20Picking\x20'+_0x2d8df1[_0x44c34b(0x1e6)]+'\x20jobs\x20('+(_0x2d8df1||[])['length']+'\x20waiting.');for(let _0x3d510c=0x0;_0x3d510c<_0x2d8df1[_0x44c34b(0x1e6)];_0x3d510c++){const _0x5a366d=_0x2d8df1[_0x3d510c],_0x3fb625=_0x51dec7[_0x3d510c];if(this['processingJobs']['has'](_0x5a366d['id']))continue;const _0xfaff23=_0x44c34b(0x1b0)+_0x5a366d['data']['withdrawalId']+':'+_0x3fb625['udid'];await this['deviceLock']['acquireLock'](_0x3fb625['udid'],'transfer',_0xfaff23,0x35e80)?this['processJob'](_0x5a366d,_0x3fb625['udid'])['catch'](_0x526423=>{const _0x31b881=_0x44c34b;this['deviceLock']['releaseLock'](_0x3fb625['udid'])[_0x31b881(0xfb)](()=>{}),this['logger']['error'](_0x31b881(0x178)+_0x5a366d['id']+':\x20'+_0x526423[_0x31b881(0x26b)],_0x526423['stack']);}):this['logger'][_0x44c34b(0x134)]('Device\x20'+_0x3fb625[_0x44c34b(0x268)]+'\x20was\x20locked\x20after\x20assignment,\x20skipping\x20job\x20'+_0x5a366d['id']);}}catch(_0x4d3e03){this['logger']['error'](_0x44c34b(0x1ee)+_0x4d3e03['message'],_0x4d3e03['stack']);}}async['processJob'](_0x51bdc6,_0x32df1e){const _0x5d074c=_0x2d049d,_0x52cf57=(0x0,_0x4a9070['cloneDeep'])(_0x51bdc6['data']),{withdrawalId:_0x1cd6c6}=_0x52cf57,_0x410e30=await this[_0x5d074c(0x1af)]['getDeviceConfig'](_0x32df1e);try{this['logger']['log'](_0x5d074c(0x150)+_0x1cd6c6+'\x20from\x20queue'),await _0x51bdc6['remove']();}catch(_0x25eae9){this['logger']['warn']('Could\x20not\x20remove\x20completed\x20job\x20'+_0x51bdc6['id']+':\x20'+_0x25eae9[_0x5d074c(0x26b)]);}if(_0x52cf57&&_0x52cf57['withdrawalId']||this['logger']['error'](_0x5d074c(0x147)+_0x51bdc6['id']),!_0x52cf57['transferCode'])throw new _0xcd3b5a[(_0x5d074c(0x1fa))]('Transfer\x20code\x20is\x20required\x20for\x20withdrawal\x20'+_0x1cd6c6,_0xcd3b5a[_0x5d074c(0x2f8)]['PERMANENT'],_0x1cd6c6);await this['bankService'][_0x5d074c(0x188)](_0x410e30['bankCode'],_0x32df1e,_0x52cf57),this['processingJobs']['add'](_0x51bdc6['id']);try{await this[_0x5d074c(0x2a0)][_0x5d074c(0x15c)](_0x52cf57,_0x32df1e);}catch(_0x2d626b){let _0x4a1dfa;this['logger'][_0x5d074c(0x25a)]('Error\x20processing\x20withdrawal\x20'+_0x1cd6c6+':\x20'+_0x2d626b['message'],_0x2d626b['stack']),_0x4a1dfa=_0x2d626b instanceof _0xcd3b5a[_0x5d074c(0x1fa)]?_0x2d626b[_0x5d074c(0x321)]:(0x0,_0xcd3b5a[_0x5d074c(0x172)])(_0x2d626b['message'],_0x2d626b),_0x4a1dfa===_0xcd3b5a['ErrorType']['FORCE_LOGIN']&&await this['bankService'][_0x5d074c(0x2fa)](_0x410e30['bankCode'],_0x32df1e,!0x0),await this['handleJobFailure'](_0x52cf57,_0x2d626b[_0x5d074c(0x26b)],_0x4a1dfa);}finally{this['processingJobs']['delete'](_0x51bdc6['id']);}}async['handleJobFailure'](_0x54c71f,_0x4c8e8b,_0x17280e=_0xcd3b5a['ErrorType']['UNKNOWN']){const _0x2ce5b8=_0x2d049d,_0x2874e8=_0x54c71f['manualRetryCount']??0x0;if(this[_0x2ce5b8(0x329)][_0x2ce5b8(0x134)]('Withdrawal\x20'+_0x54c71f['withdrawalId']+'\x20failed.\x20Reason:\x20'+_0x4c8e8b+_0x2ce5b8(0x263)+_0x17280e+_0x2ce5b8(0x200)+_0x2874e8+'/3'),_0x2874e8<0x3){if(_0x17280e===_0xcd3b5a[_0x2ce5b8(0x2f8)][_0x2ce5b8(0x157)]||_0x17280e===_0xcd3b5a['ErrorType']['FORCE_LOGIN']||_0x17280e===_0xcd3b5a['ErrorType'][_0x2ce5b8(0x24a)])return;await this['withdrawalQueue']['add'](_0x2ce5b8(0x28e),{..._0x54c71f,'manualRetryCount':_0x2874e8+0x1,'lastErrorType':_0x17280e,'lastErrorReason':_0x4c8e8b},{'attempts':0x0,'removeOnComplete':!0x1,'removeOnFail':!0x1,'jobId':_0x2ce5b8(0x138)+_0x54c71f['withdrawalId'],'priority':0x0,'delay':0x7530});}else this['logger']['warn']('Max\x20retries\x20(3)\x20exceeded\x20for\x20withdrawal\x20'+_0x54c71f['withdrawalId']+':\x20'+_0x17280e+'\x20error:\x20'+_0x4c8e8b);}async['promoteDelayedJobs'](){return(0x0,_0x15ee62['withCronLock'])('cron:promote_delayed:withdrawal',0x1388,async()=>{const _0x49e363=a0_0x2633,_0x20d8ce=Date[_0x49e363(0x292)](),_0x5947c5=await this[_0x49e363(0x31a)][_0x49e363(0x319)](['delayed'],0x0,0x63);if(!_0x5947c5['length'])return;let _0x52bfd4=0x0;for(const _0x4f5d39 of _0x5947c5){const _0xb0aa4d=_0x49e363(0x14a)==typeof _0x4f5d39['opts']?.[_0x49e363(0x170)]?_0x4f5d39['opts']['delay']:0x0;if(('number'==typeof _0x4f5d39['timestamp']?_0x4f5d39['timestamp']:0x0)+_0xb0aa4d<=_0x20d8ce)try{await _0x4f5d39['promote'](),_0x52bfd4++;}catch(_0x49251e){this[_0x49e363(0x329)]['debug']('Promote\x20skipped\x20for\x20job\x20'+_0x4f5d39['id']+':\x20'+String(_0x49251e));}}_0x52bfd4>0x0&&this['logger'][_0x49e363(0x349)]('Promoted\x20'+_0x52bfd4+'\x20delayed\x20jobs\x20to\x20waiting');});}async['triggerPickJobs'](_0x378415=0x1){await this['pickAndProcessJobs'](_0x378415);}async[_0x2d049d(0x225)](){const _0x1bb0d1=_0x2d049d,[_0x102c79,_0x67ad9d,_0x229896,_0x123808,_0xbe5629,_0x4406fd,_0x2073bf]=await Promise['all']([this[_0x1bb0d1(0x31a)]['getWaitingCount'](),this['withdrawalQueue']['getDelayedCount'](),this['withdrawalQueue']['getActiveCount'](),this[_0x1bb0d1(0x31a)][_0x1bb0d1(0x1ad)](),this['withdrawalQueue']['getFailedCount'](),this[_0x1bb0d1(0x104)](),this[_0x1bb0d1(0x1af)]['getServiceStatus']()]);return{'serviceStatus':_0x2073bf,'activeDevices':_0x4406fd['length'],'processingJobs':this[_0x1bb0d1(0x1c1)]['size'],'isInitialized':this['isInitialized'],'queue':{'waiting':_0x102c79,'delayed':_0x67ad9d,'active':_0x229896,'completed':_0x123808,'failed':_0xbe5629,'total':_0x102c79+_0x67ad9d+_0x229896}};}async['debugQueue'](){const _0x1cb226=_0x2d049d,_0x3249ea=await this['getQueueStats'](),[_0x10e7e0,_0x322c92]=await Promise['all']([this['withdrawalQueue']['getJobs'](['waiting'],0x0,0x9),this[_0x1cb226(0x31a)]['getJobs'](['delayed'],0x0,0x9)]);return{..._0x3249ea,'sampleWaitingJobs':_0x10e7e0['map'](_0x351154=>({'id':_0x351154['id'],'data':_0x351154[_0x1cb226(0x32b)],'opts':_0x351154['opts'],'manualRetryCount':_0x351154['data']['manualRetryCount']})),'sampleDelayedJobs':_0x322c92['map'](_0x7b2abe=>({'id':_0x7b2abe['id'],'data':_0x7b2abe['data'],'opts':_0x7b2abe['opts'],'manualRetryCount':_0x7b2abe[_0x1cb226(0x32b)][_0x1cb226(0x1e0)]}))};}async['periodicJobPicking'](){await this['pickAndProcessJobs']();}async['promoteDelayedJobsPeriodically'](){await this['promoteDelayedJobs']();}};_0x49cc73['WithdrawalJobManagerService']=_0x799cb3,_0x26c19e([(0x0,_0x392857[_0x2d049d(0x215)])(_0x2d049d(0x28f)),_0x5d79df('design:type',Function),_0x5d79df('design:paramtypes',[]),_0x5d79df('design:returntype',Promise)],_0x799cb3['prototype'],_0x2d049d(0x2bb),null),_0x26c19e([(0x0,_0x392857['Cron'])('*/5\x20*\x20*\x20*\x20*\x20*'),_0x5d79df(_0x2d049d(0x2ec),Function),_0x5d79df(_0x2d049d(0x1b9),[]),_0x5d79df('design:returntype',Promise)],_0x799cb3['prototype'],'promoteDelayedJobsPeriodically',null),_0x49cc73[_0x2d049d(0x295)]=_0x799cb3=_0x26c19e([(0x0,_0x3bb7c4['Injectable'])(),_0x1aa4d7(0x0,(0x0,_0x1c23b3['InjectQueue'])('wda-request')),_0x1aa4d7(0x4,(0x0,_0x3bb7c4['Inject'])(_0xcc0c61[_0x2d049d(0x2a4)])),_0x5d79df(_0x2d049d(0x1b9),['function'==typeof(_0x523c91=void 0x0!==_0x4b8964[_0x2d049d(0x242)]&&_0x4b8964[_0x2d049d(0x242)])?_0x523c91:Object,'function'==typeof(_0x5a9afd=void 0x0!==_0x20703f['WithdrawalService']&&_0x20703f['WithdrawalService'])?_0x5a9afd:Object,'function'==typeof(_0x457b2b=void 0x0!==_0xa01d8f[_0x2d049d(0x214)]&&_0xa01d8f['DeviceService'])?_0x457b2b:Object,'function'==typeof(_0x4236eb=void 0x0!==_0x158cd8['DeviceLockService']&&_0x158cd8[_0x2d049d(0xff)])?_0x4236eb:Object,_0x2d049d(0x269)==typeof(_0x12427d=void 0x0!==_0x521415['IWebSocketService']&&_0x521415['IWebSocketService'])?_0x12427d:Object,_0x2d049d(0x269)==typeof(_0x14d895=void 0x0!==_0x4a363b[_0x2d049d(0x111)]&&_0x4a363b['BankService'])?_0x14d895:Object])],_0x799cb3);},_0x22e3dc=>{const _0x7bdd49=a0_0x2633;_0x22e3dc[_0x7bdd49(0x10b)]=require('bull');},_0x5ee7ed=>{const _0x155a29=a0_0x2633;_0x5ee7ed[_0x155a29(0x10b)]=require('lodash');},(_0x3d06be,_0x285cd1,_0xa78aec)=>{const _0x597ea4=a0_0x2633;Object['defineProperty'](_0x285cd1,'__esModule',{'value':!0x0}),_0x285cd1['withCronLock']=void 0x0;const _0x170bb9=_0xa78aec(0x17),_0x240831=_0xa78aec(0xf),_0x5ca8fb=new _0x170bb9['default']({'host':_0x240831[_0x597ea4(0x30b)]['redis']['host'],'port':_0x240831[_0x597ea4(0x30b)]['redis']['port'],'password':_0x240831['config']['redis']['password'],'db':_0x240831[_0x597ea4(0x30b)]['redis']['db']});_0x285cd1['withCronLock']=async(_0xcc3acb,_0x42931f,_0xe06937)=>{const _0x3cfa40=_0x597ea4,_0x950fda=process['pid']+':'+Date['now']();if(await _0x5ca8fb[_0x3cfa40(0x1e4)](_0xcc3acb,_0x950fda,'PX',_0x42931f,'NX'))try{await _0xe06937();}finally{const _0x2b45b1='\x0a\x20\x20\x20\x20\x20\x20if\x20redis.call(\x22GET\x22,\x20KEYS[1])\x20==\x20ARGV[1]\x20then\x0a\x20\x20\x20\x20\x20\x20\x20\x20return\x20redis.call(\x22DEL\x22,\x20KEYS[1])\x0a\x20\x20\x20\x20\x20\x20end\x0a\x20\x20\x20\x20\x20\x20return\x200\x0a\x20\x20\x20\x20';await _0x5ca8fb['eval'](_0x2b45b1,0x1,_0xcc3acb,_0x950fda);}};},function(_0x143b81,_0x1c9faa,_0x4deade){const _0x5967e7=a0_0x2633;var _0x1d3f5a,_0x40704e=this&&this['__decorate']||function(_0x1c6061,_0x2fbda9,_0x33b36e,_0x968b31){var _0x5ae7bd,_0x151307=arguments['length'],_0xf94b6d=_0x151307<0x3?_0x2fbda9:null===_0x968b31?_0x968b31=Object['getOwnPropertyDescriptor'](_0x2fbda9,_0x33b36e):_0x968b31;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0xf94b6d=Reflect['decorate'](_0x1c6061,_0x2fbda9,_0x33b36e,_0x968b31);else{for(var _0x47f683=_0x1c6061['length']-0x1;_0x47f683>=0x0;_0x47f683--)(_0x5ae7bd=_0x1c6061[_0x47f683])&&(_0xf94b6d=(_0x151307<0x3?_0x5ae7bd(_0xf94b6d):_0x151307>0x3?_0x5ae7bd(_0x2fbda9,_0x33b36e,_0xf94b6d):_0x5ae7bd(_0x2fbda9,_0x33b36e))||_0xf94b6d);}return _0x151307>0x3&&_0xf94b6d&&Object['defineProperty'](_0x2fbda9,_0x33b36e,_0xf94b6d),_0xf94b6d;},_0x4016e6=this&&this['__metadata']||function(_0x2dd6f8,_0x4bbb44){const _0x875d44=a0_0x2633;if('object'==typeof Reflect&&_0x875d44(0x269)==typeof Reflect['metadata'])return Reflect[_0x875d44(0x331)](_0x2dd6f8,_0x4bbb44);};Object[_0x5967e7(0x1c8)](_0x1c9faa,_0x5967e7(0x209),{'value':!0x0}),_0x1c9faa['WithdrawalController']=void 0x0;const _0x1f9932=_0x4deade(0x2),_0x27783d=_0x4deade(0x3),_0x26ea60=_0x4deade(0x2e);let _0x523a59=class{constructor(_0x390ab6){this['jobManagerService']=_0x390ab6,this['logger']=new _0x1f9932['Logger']('WithdrawalController');}async[_0x5967e7(0x225)](){return await this['jobManagerService']['getQueueStats']();}async['debugQueue'](){const _0x2a20dc=_0x5967e7;return await this['jobManagerService'][_0x2a20dc(0x22d)]();}async['triggerJobPicking'](){const _0x1b5cdc=_0x5967e7;return this[_0x1b5cdc(0x329)]['log']('Manually\x20triggering\x20job\x20picking...'),await this['jobManagerService'][_0x1b5cdc(0x1f4)](0x1),{'success':!0x0,'message':'Job\x20picking\x20triggered','stats':await this[_0x1b5cdc(0x1b5)]['getQueueStats']()};}async['startProcessing'](){const _0x18b26f=_0x5967e7;return this[_0x18b26f(0x329)]['log']('Manually\x20starting\x20job\x20processing...'),await this[_0x18b26f(0x1b5)]['startProcessing'](),{'success':!0x0,'message':'Job\x20processing\x20started','stats':await this[_0x18b26f(0x1b5)]['getQueueStats']()};}};_0x1c9faa['WithdrawalController']=_0x523a59,_0x40704e([(0x0,_0x1f9932['Get'])(_0x5967e7(0x26a)),(0x0,_0x27783d['ApiOperation'])({'summary':_0x5967e7(0x345)}),(0x0,_0x27783d[_0x5967e7(0x346)])({'status':0xc8,'description':'Queue\x20statistics'}),_0x4016e6('design:type',Function),_0x4016e6(_0x5967e7(0x1b9),[]),_0x4016e6('design:returntype',Promise)],_0x523a59['prototype'],'getQueueStats',null),_0x40704e([(0x0,_0x1f9932['Get'])(_0x5967e7(0x117)),(0x0,_0x27783d['ApiOperation'])({'summary':'Get\x20detailed\x20queue\x20debug\x20information'}),(0x0,_0x27783d[_0x5967e7(0x346)])({'status':0xc8,'description':'Detailed\x20queue\x20debug\x20info'}),_0x4016e6('design:type',Function),_0x4016e6('design:paramtypes',[]),_0x4016e6(_0x5967e7(0x26c),Promise)],_0x523a59[_0x5967e7(0x114)],'debugQueue',null),_0x40704e([(0x0,_0x1f9932[_0x5967e7(0x2b2)])('queue/trigger'),(0x0,_0x27783d[_0x5967e7(0x184)])({'summary':'Manually\x20trigger\x20job\x20picking'}),(0x0,_0x27783d[_0x5967e7(0x346)])({'status':0xc8,'description':'Job\x20picking\x20triggered'}),_0x4016e6('design:type',Function),_0x4016e6('design:paramtypes',[]),_0x4016e6('design:returntype',Promise)],_0x523a59['prototype'],'triggerJobPicking',null),_0x40704e([(0x0,_0x1f9932['Post'])('queue/start'),(0x0,_0x27783d['ApiOperation'])({'summary':'Manually\x20start\x20job\x20processing'}),(0x0,_0x27783d['ApiResponse'])({'status':0xc8,'description':'Job\x20processing\x20started'}),_0x4016e6('design:type',Function),_0x4016e6('design:paramtypes',[]),_0x4016e6('design:returntype',Promise)],_0x523a59[_0x5967e7(0x114)],'startProcessing',null),_0x1c9faa['WithdrawalController']=_0x523a59=_0x40704e([(0x0,_0x27783d['ApiTags'])('withdrawal'),(0x0,_0x1f9932['Controller'])(_0x5967e7(0x189)),_0x4016e6(_0x5967e7(0x1b9),['function'==typeof(_0x1d3f5a=void 0x0!==_0x26ea60['WithdrawalJobManagerService']&&_0x26ea60['WithdrawalJobManagerService'])?_0x1d3f5a:Object])],_0x523a59);},function(_0x7ebda,_0x1f43d1,_0x6c5192){const _0x10280a=a0_0x2633;var _0x1a6787=this&&this['__decorate']||function(_0x42a72a,_0x247138,_0x5c975f,_0x131a4f){const _0x246cd5=a0_0x2633;var _0x207509,_0x5997df=arguments['length'],_0x55061a=_0x5997df<0x3?_0x247138:null===_0x131a4f?_0x131a4f=Object[_0x246cd5(0x2c5)](_0x247138,_0x5c975f):_0x131a4f;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x55061a=Reflect['decorate'](_0x42a72a,_0x247138,_0x5c975f,_0x131a4f);else{for(var _0x35b5df=_0x42a72a[_0x246cd5(0x1e6)]-0x1;_0x35b5df>=0x0;_0x35b5df--)(_0x207509=_0x42a72a[_0x35b5df])&&(_0x55061a=(_0x5997df<0x3?_0x207509(_0x55061a):_0x5997df>0x3?_0x207509(_0x247138,_0x5c975f,_0x55061a):_0x207509(_0x247138,_0x5c975f))||_0x55061a);}return _0x5997df>0x3&&_0x55061a&&Object[_0x246cd5(0x1c8)](_0x247138,_0x5c975f,_0x55061a),_0x55061a;};Object['defineProperty'](_0x1f43d1,_0x10280a(0x209),{'value':!0x0}),_0x1f43d1['HcBoxModule']=void 0x0;const _0x39686c=_0x6c5192(0x2),_0x1eb288=_0x6c5192(0x18);let _0x63c8a1=class{};_0x1f43d1['HcBoxModule']=_0x63c8a1,_0x1f43d1['HcBoxModule']=_0x63c8a1=_0x1a6787([(0x0,_0x39686c['Module'])({'providers':[_0x1eb288['HcBoxService']],'exports':[_0x1eb288[_0x10280a(0x183)]]})],_0x63c8a1);},function(_0x16ea92,_0x2aeb2b,_0x37768f){const _0xd5e3c5=a0_0x2633;var _0x5a38e6=this&&this['__decorate']||function(_0xb0c659,_0x156225,_0x36517d,_0x3e9df0){const _0x355726=a0_0x2633;var _0x3c6b06,_0x29fe1d=arguments['length'],_0xbe994f=_0x29fe1d<0x3?_0x156225:null===_0x3e9df0?_0x3e9df0=Object['getOwnPropertyDescriptor'](_0x156225,_0x36517d):_0x3e9df0;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x355726(0x2a1)])_0xbe994f=Reflect[_0x355726(0x2a1)](_0xb0c659,_0x156225,_0x36517d,_0x3e9df0);else{for(var _0x40b808=_0xb0c659['length']-0x1;_0x40b808>=0x0;_0x40b808--)(_0x3c6b06=_0xb0c659[_0x40b808])&&(_0xbe994f=(_0x29fe1d<0x3?_0x3c6b06(_0xbe994f):_0x29fe1d>0x3?_0x3c6b06(_0x156225,_0x36517d,_0xbe994f):_0x3c6b06(_0x156225,_0x36517d))||_0xbe994f);}return _0x29fe1d>0x3&&_0xbe994f&&Object['defineProperty'](_0x156225,_0x36517d,_0xbe994f),_0xbe994f;};Object['defineProperty'](_0x2aeb2b,'__esModule',{'value':!0x0}),_0x2aeb2b['DeviceModule']=void 0x0;const _0x39d1bc=_0x37768f(0x2),_0x240bce=_0x37768f(0x35),_0xd77e1c=_0x37768f(0x15),_0x1b8e5e=_0x37768f(0x2c),_0x2e9ce0=_0x37768f(0x33),_0x4fa27a=_0x37768f(0x16),_0x4b4d1f=_0x37768f(0x38);let _0x37071f=class{};_0x2aeb2b['DeviceModule']=_0x37071f,_0x2aeb2b['DeviceModule']=_0x37071f=_0x5a38e6([(0x0,_0x39d1bc['Module'])({'imports':[_0x2e9ce0[_0xd5e3c5(0x23c)],(0x0,_0x39d1bc['forwardRef'])(()=>_0x4b4d1f[_0xd5e3c5(0x109)])],'controllers':[_0x240bce[_0xd5e3c5(0x2ca)]],'providers':[_0xd77e1c['DeviceService'],_0x1b8e5e['DeviceLockService'],_0x4fa27a['RedisService']],'exports':[_0xd77e1c[_0xd5e3c5(0x214)],_0x1b8e5e['DeviceLockService']]})],_0x37071f);},function(_0x4ba1d3,_0x13fa85,_0x3f4377){const _0x316b2c=a0_0x2633;var _0x3f8dcb,_0x57d581,_0x369585,_0x1a4a6b=this&&this[_0x316b2c(0x32c)]||function(_0x448204,_0x6cf5e,_0x475fee,_0x17bbcb){const _0x39830c=_0x316b2c;var _0x409fea,_0x232388=arguments['length'],_0x58c88b=_0x232388<0x3?_0x6cf5e:null===_0x17bbcb?_0x17bbcb=Object['getOwnPropertyDescriptor'](_0x6cf5e,_0x475fee):_0x17bbcb;if(_0x39830c(0x26d)==typeof Reflect&&'function'==typeof Reflect[_0x39830c(0x2a1)])_0x58c88b=Reflect['decorate'](_0x448204,_0x6cf5e,_0x475fee,_0x17bbcb);else{for(var _0xac235d=_0x448204['length']-0x1;_0xac235d>=0x0;_0xac235d--)(_0x409fea=_0x448204[_0xac235d])&&(_0x58c88b=(_0x232388<0x3?_0x409fea(_0x58c88b):_0x232388>0x3?_0x409fea(_0x6cf5e,_0x475fee,_0x58c88b):_0x409fea(_0x6cf5e,_0x475fee))||_0x58c88b);}return _0x232388>0x3&&_0x58c88b&&Object[_0x39830c(0x1c8)](_0x6cf5e,_0x475fee,_0x58c88b),_0x58c88b;},_0x113f96=this&&this['__metadata']||function(_0x226a20,_0x1a4bff){if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0x226a20,_0x1a4bff);},_0x5b34f1=this&&this['__param']||function(_0x45a694,_0x2878a8){return function(_0x552675,_0x4ea5c1){_0x2878a8(_0x552675,_0x4ea5c1,_0x45a694);};};Object['defineProperty'](_0x13fa85,'__esModule',{'value':!0x0}),_0x13fa85[_0x316b2c(0x2ca)]=void 0x0;const _0x22e945=_0x3f4377(0x2),_0x487b6c=_0x3f4377(0x15),_0x5200d9=_0x3f4377(0x36),_0x257187=_0x3f4377(0x12),_0x5800b4=_0x3f4377(0xf);let _0x5dda94=class{constructor(_0x463c97,_0x33298c){const _0xf4d566=_0x316b2c;this[_0xf4d566(0x1af)]=_0x463c97,this[_0xf4d566(0x1d2)]=_0x33298c,this['logger']=new _0x22e945[(_0xf4d566(0x1da))]('DeviceController');}async['getDevicesPage'](){const _0x3c444f=_0x316b2c;return{'devices':await this['deviceService']['listDevices'](),'serviceStatus':await this['deviceService']['getServiceStatus'](),'banks':[_0x3c444f(0x163),'TPBANK','TECHCOMBANK','ACB',_0x3c444f(0x29a)],'boxType':_0x5800b4['config']['boxType']};}async['getDevices'](){return{'success':!0x0,'data':await this['deviceService']['listDevices']()};}async['getDeviceConfig'](_0x2607c9){return{'success':!0x0,'data':await this['deviceService']['getDeviceConfig'](_0x2607c9)};}async['retryLogin'](_0x3623f8){const _0x182f73=_0x316b2c;try{this['logger']['log'](_0x182f73(0x26e)+_0x3623f8);const _0x5e2b9d=await this[_0x182f73(0x1af)]['getDeviceConfig'](_0x3623f8);if(!_0x5e2b9d)throw new _0x22e945['HttpException']({'success':!0x1,'error':'Device\x20'+_0x3623f8+_0x182f73(0x280)},_0x22e945['HttpStatus'][_0x182f73(0x2cb)]);if(!_0x5e2b9d['bankCode']||''===_0x5e2b9d['bankCode'][_0x182f73(0x12d)]())throw new _0x22e945[(_0x182f73(0x133))]({'success':!0x1,'error':'Device\x20'+_0x3623f8+'\x20does\x20not\x20have\x20bankCode\x20configured.\x20Please\x20configure\x20bankCode\x20first.'},_0x22e945['HttpStatus'][_0x182f73(0x2cb)]);if('active'!==_0x5e2b9d['status'])throw new _0x22e945['HttpException']({'success':!0x1,'error':'Device\x20'+_0x3623f8+_0x182f73(0x2e9)},_0x22e945['HttpStatus']['BAD_REQUEST']);const _0x855dea=_0x5e2b9d['bankCode']['toUpperCase']();return await this['bankService'][_0x182f73(0x2fa)](_0x855dea,_0x3623f8),{'success':!0x0,'message':'Successfully\x20logged\x20in\x20to\x20'+_0x855dea+'\x20on\x20device\x20'+_0x3623f8};}catch(_0x10dc92){if(_0x10dc92 instanceof _0x22e945['HttpException'])throw _0x10dc92;throw this[_0x182f73(0x329)]['error']('Error\x20retrying\x20login\x20for\x20device\x20'+_0x3623f8+':\x20'+_0x10dc92[_0x182f73(0x26b)],_0x10dc92['stack']),new _0x22e945[(_0x182f73(0x133))]({'success':!0x1,'error':_0x10dc92[_0x182f73(0x26b)]||'Failed\x20to\x20retry\x20login'},_0x22e945[_0x182f73(0x19a)]['INTERNAL_SERVER_ERROR']);}}async[_0x316b2c(0x142)](_0x5b5758,_0x24d626){const _0x1602f0=_0x316b2c;try{this[_0x1602f0(0x329)][_0x1602f0(0x349)]('Updating\x20device\x20config\x20for\x20'+_0x5b5758+':\x20'+JSON[_0x1602f0(0x2be)](_0x24d626));const _0x18b955=await this['deviceService']['getDeviceConfig'](_0x5b5758);if('active'===(void 0x0!==_0x24d626[_0x1602f0(0x253)]?_0x24d626['status']:_0x18b955?.['status']||'deactive')){const _0x573084=[],_0x45d9b5=void 0x0!==_0x24d626['bankCode']?_0x24d626['bankCode']:_0x18b955?.['bankCode'];_0x45d9b5&&''!==_0x45d9b5['trim']()||_0x573084['push']('Bank\x20Code\x20l\x20bt\x20buc\x20khi\x20status\x20l\x20active');const _0x3b716c=void 0x0!==_0x24d626['availableAmount']?_0x24d626['availableAmount']:_0x18b955?.[_0x1602f0(0x1ec)];(null==_0x3b716c||_0x3b716c<0x0)&&_0x573084[_0x1602f0(0x216)](_0x1602f0(0x313));const _0x5791f5=void 0x0!==_0x24d626['password']?_0x24d626[_0x1602f0(0x154)]:_0x18b955?.[_0x1602f0(0x154)];_0x5791f5&&''!==_0x5791f5['trim']()||_0x573084['push']('Password\x20l\x20bt\x20buc\x20khi\x20status\x20l\x20active');const _0x478fa4=void 0x0!==_0x24d626[_0x1602f0(0x238)]?_0x24d626['smartOTP']:_0x18b955?.['smartOTP'];if(_0x478fa4&&''!==_0x478fa4['trim']()||_0x573084['push']('Smart\x20OTP\x20l\x20bt\x20buc\x20khi\x20status\x20l\x20active'),_0x573084['length']>0x0)throw new _0x22e945[(_0x1602f0(0x133))]({'success':!0x1,'error':_0x573084['join'](',\x20')},_0x22e945[_0x1602f0(0x19a)]['BAD_REQUEST']);}return{'success':!0x0,'data':await this['deviceService']['updateDeviceConfig'](_0x5b5758,_0x24d626)};}catch(_0x1e1717){if(_0x1e1717 instanceof _0x22e945['HttpException'])throw _0x1e1717;throw this['logger']['error']('Error\x20updating\x20device\x20config\x20for\x20'+_0x5b5758+':\x20'+_0x1e1717[_0x1602f0(0x26b)],_0x1e1717['stack']),new _0x22e945[(_0x1602f0(0x133))]({'success':!0x1,'error':_0x1e1717['message']||_0x1602f0(0x14b)},_0x22e945[_0x1602f0(0x19a)][_0x1602f0(0x1ff)]);}}async['getServiceStatus'](){const _0x5317d1=_0x316b2c;return{'success':!0x0,'data':{'status':await this['deviceService'][_0x5317d1(0x202)]()}};}async['startService'](){const _0x3e1acc=_0x316b2c;try{if(!await this[_0x3e1acc(0x1af)][_0x3e1acc(0x22c)]())throw new _0x22e945[(_0x3e1acc(0x133))]({'success':!0x1,'error':'Vui\x20lng\x20active\x20bank\x20trc\x20khi\x20start'},_0x22e945['HttpStatus']['BAD_REQUEST']);return this['bankService'][_0x3e1acc(0x224)]()[_0x3e1acc(0xfb)](_0x2a01df=>{this['logger']['error']('Error\x20during\x20background\x20login\x20process:\x20'+_0x2a01df['message']);}),await new Promise(_0x1e9fb9=>setTimeout(_0x1e9fb9,0x7d0)),await this['deviceService']['setServiceStatus']('active'),{'success':!0x0,'message':'Service\x20started\x20successfully.\x20Devices\x20are\x20logging\x20in\x20and\x20will\x20accept\x20jobs\x20when\x20ready.'};}catch(_0x4884ef){if(_0x4884ef instanceof _0x22e945['HttpException'])throw _0x4884ef;throw this['logger'][_0x3e1acc(0x25a)](_0x3e1acc(0x2a6)+_0x4884ef['message'],_0x4884ef[_0x3e1acc(0x267)]),new _0x22e945['HttpException']({'success':!0x1,'error':_0x4884ef[_0x3e1acc(0x26b)]||'Failed\x20to\x20start\x20service'},_0x22e945['HttpStatus'][_0x3e1acc(0x1ff)]);}}async['stopService'](){return await this['deviceService']['setServiceStatus']('inactive'),{'success':!0x0,'message':'Service\x20stopped\x20successfully'};}};_0x13fa85['DeviceController']=_0x5dda94,_0x1a4a6b([(0x0,_0x22e945[_0x316b2c(0x14c)])(),(0x0,_0x22e945['Render'])('devices'),_0x113f96('design:type',Function),_0x113f96('design:paramtypes',[]),_0x113f96(_0x316b2c(0x26c),Promise)],_0x5dda94['prototype'],'getDevicesPage',null),_0x1a4a6b([(0x0,_0x22e945['Get'])('api/devices'),_0x113f96('design:type',Function),_0x113f96(_0x316b2c(0x1b9),[]),_0x113f96(_0x316b2c(0x26c),Promise)],_0x5dda94['prototype'],_0x316b2c(0x1a2),null),_0x1a4a6b([(0x0,_0x22e945[_0x316b2c(0x14c)])('api/devices/:deviceId/config'),_0x5b34f1(0x0,(0x0,_0x22e945[_0x316b2c(0x1f1)])('deviceId')),_0x113f96('design:type',Function),_0x113f96('design:paramtypes',[String]),_0x113f96('design:returntype',Promise)],_0x5dda94['prototype'],'getDeviceConfig',null),_0x1a4a6b([(0x0,_0x22e945['Post'])(_0x316b2c(0x2de)),_0x5b34f1(0x0,(0x0,_0x22e945['Param'])('deviceId')),_0x113f96('design:type',Function),_0x113f96('design:paramtypes',[String]),_0x113f96('design:returntype',Promise)],_0x5dda94['prototype'],'retryLogin',null),_0x1a4a6b([(0x0,_0x22e945['Put'])(_0x316b2c(0x18f)),_0x5b34f1(0x0,(0x0,_0x22e945[_0x316b2c(0x1f1)])(_0x316b2c(0x2c1))),_0x5b34f1(0x1,(0x0,_0x22e945['Body'])()),_0x113f96(_0x316b2c(0x2ec),Function),_0x113f96('design:paramtypes',[String,'function'==typeof(_0x369585=void 0x0!==_0x5200d9['UpdateDeviceConfigDto']&&_0x5200d9['UpdateDeviceConfigDto'])?_0x369585:Object]),_0x113f96('design:returntype',Promise)],_0x5dda94['prototype'],'updateDeviceConfig',null),_0x1a4a6b([(0x0,_0x22e945[_0x316b2c(0x14c)])('api/service/status'),_0x113f96('design:type',Function),_0x113f96(_0x316b2c(0x1b9),[]),_0x113f96('design:returntype',Promise)],_0x5dda94['prototype'],'getServiceStatus',null),_0x1a4a6b([(0x0,_0x22e945['Post'])('api/service/start'),_0x113f96('design:type',Function),_0x113f96('design:paramtypes',[]),_0x113f96('design:returntype',Promise)],_0x5dda94['prototype'],'startService',null),_0x1a4a6b([(0x0,_0x22e945['Post'])(_0x316b2c(0x102)),_0x113f96('design:type',Function),_0x113f96('design:paramtypes',[]),_0x113f96('design:returntype',Promise)],_0x5dda94['prototype'],'stopService',null),_0x13fa85['DeviceController']=_0x5dda94=_0x1a4a6b([(0x0,_0x22e945['Controller'])(),_0x113f96(_0x316b2c(0x1b9),[_0x316b2c(0x269)==typeof(_0x3f8dcb=void 0x0!==_0x487b6c[_0x316b2c(0x214)]&&_0x487b6c['DeviceService'])?_0x3f8dcb:Object,_0x316b2c(0x269)==typeof(_0x57d581=void 0x0!==_0x257187[_0x316b2c(0x111)]&&_0x257187['BankService'])?_0x57d581:Object])],_0x5dda94);},function(_0x208f1f,_0x3194d0,_0x5a975c){const _0x3050c5=a0_0x2633;var _0x503294=this&&this['__decorate']||function(_0x1444e8,_0x247244,_0x50c5b3,_0x8ff42d){const _0x1c5b03=a0_0x2633;var _0x1b2225,_0x1fa1a3=arguments['length'],_0x22bd91=_0x1fa1a3<0x3?_0x247244:null===_0x8ff42d?_0x8ff42d=Object['getOwnPropertyDescriptor'](_0x247244,_0x50c5b3):_0x8ff42d;if('object'==typeof Reflect&&_0x1c5b03(0x269)==typeof Reflect['decorate'])_0x22bd91=Reflect['decorate'](_0x1444e8,_0x247244,_0x50c5b3,_0x8ff42d);else{for(var _0x24b071=_0x1444e8[_0x1c5b03(0x1e6)]-0x1;_0x24b071>=0x0;_0x24b071--)(_0x1b2225=_0x1444e8[_0x24b071])&&(_0x22bd91=(_0x1fa1a3<0x3?_0x1b2225(_0x22bd91):_0x1fa1a3>0x3?_0x1b2225(_0x247244,_0x50c5b3,_0x22bd91):_0x1b2225(_0x247244,_0x50c5b3))||_0x22bd91);}return _0x1fa1a3>0x3&&_0x22bd91&&Object['defineProperty'](_0x247244,_0x50c5b3,_0x22bd91),_0x22bd91;},_0x515b65=this&&this['__metadata']||function(_0xbd3b38,_0x113d57){const _0x4486cf=a0_0x2633;if('object'==typeof Reflect&&_0x4486cf(0x269)==typeof Reflect['metadata'])return Reflect['metadata'](_0xbd3b38,_0x113d57);};Object[_0x3050c5(0x1c8)](_0x3194d0,'__esModule',{'value':!0x0}),_0x3194d0['UpdateDeviceConfigDto']=void 0x0;const _0x10b588=_0x5a975c(0x37);class _0x39a45d{}_0x3194d0[_0x3050c5(0x31b)]=_0x39a45d,_0x503294([(0x0,_0x10b588[_0x3050c5(0x103)])(_0xd99dca=>_0x3050c5(0x22e)===_0xd99dca['status']),(0x0,_0x10b588['IsNotEmpty'])({'message':_0x3050c5(0x198)}),(0x0,_0x10b588['IsString'])(),(0x0,_0x10b588['IsOptional'])(),_0x515b65('design:type',String)],_0x39a45d['prototype'],'bankCode',void 0x0),_0x503294([(0x0,_0x10b588['ValidateIf'])(_0x3d195a=>'active'===_0x3d195a['status']),(0x0,_0x10b588['IsNotEmpty'])({'message':'Available\x20Amount\x20is\x20required\x20when\x20status\x20is\x20active'}),(0x0,_0x10b588['IsNumber'])(),(0x0,_0x10b588['Min'])(0x0,{'message':_0x3050c5(0x307)}),(0x0,_0x10b588[_0x3050c5(0x1b8)])(),_0x515b65('design:type',Number)],_0x39a45d[_0x3050c5(0x114)],'availableAmount',void 0x0),_0x503294([(0x0,_0x10b588['IsOptional'])(),(0x0,_0x10b588['IsString'])(),(0x0,_0x10b588[_0x3050c5(0x247)])(['active',_0x3050c5(0x260)]),_0x515b65('design:type',String)],_0x39a45d['prototype'],'status',void 0x0),_0x503294([(0x0,_0x10b588['ValidateIf'])(_0x5109d6=>'active'===_0x5109d6['status']),(0x0,_0x10b588['IsNotEmpty'])({'message':'Password\x20is\x20required\x20when\x20status\x20is\x20active'}),(0x0,_0x10b588[_0x3050c5(0x2ff)])(),(0x0,_0x10b588['IsOptional'])(),_0x515b65('design:type',String)],_0x39a45d['prototype'],_0x3050c5(0x154),void 0x0),_0x503294([(0x0,_0x10b588['ValidateIf'])(_0x12cbc8=>_0x3050c5(0x22e)===_0x12cbc8['status']),(0x0,_0x10b588['IsNotEmpty'])({'message':'Smart\x20OTP\x20is\x20required\x20when\x20status\x20is\x20active'}),(0x0,_0x10b588['IsString'])(),(0x0,_0x10b588['IsOptional'])(),_0x515b65('design:type',String)],_0x39a45d[_0x3050c5(0x114)],'smartOTP',void 0x0),_0x503294([(0x0,_0x10b588['ValidateIf'])(_0x3053ad=>_0x3050c5(0x22e)===_0x3053ad[_0x3050c5(0x253)]),(0x0,_0x10b588['IsNotEmpty'])({'message':'Account\x20No\x20is\x20required\x20when\x20status\x20is\x20active'}),(0x0,_0x10b588['IsString'])(),(0x0,_0x10b588['IsOptional'])(),_0x515b65('design:type',String)],_0x39a45d['prototype'],'accountNo',void 0x0),_0x503294([(0x0,_0x10b588['ValidateIf'])(_0x4b3984=>'active'===_0x4b3984[_0x3050c5(0x253)]),(0x0,_0x10b588['IsNotEmpty'])({'message':_0x3050c5(0x303)}),(0x0,_0x10b588['IsString'])(),(0x0,_0x10b588['IsOptional'])(),_0x515b65('design:type',String)],_0x39a45d['prototype'],'accountName',void 0x0);},_0x57093d=>{const _0x59900f=a0_0x2633;_0x57093d[_0x59900f(0x10b)]=require('class-validator');},function(_0x1523f1,_0xe8f7c7,_0x417b76){const _0x41a25e=a0_0x2633;var _0x4acd9d=this&&this['__decorate']||function(_0x2bbe30,_0x2be97f,_0x327582,_0x5cc01a){const _0x257f5f=a0_0x2633;var _0x33e21b,_0x5d216c=arguments['length'],_0x4b2869=_0x5d216c<0x3?_0x2be97f:null===_0x5cc01a?_0x5cc01a=Object[_0x257f5f(0x2c5)](_0x2be97f,_0x327582):_0x5cc01a;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x4b2869=Reflect['decorate'](_0x2bbe30,_0x2be97f,_0x327582,_0x5cc01a);else{for(var _0x3931f3=_0x2bbe30['length']-0x1;_0x3931f3>=0x0;_0x3931f3--)(_0x33e21b=_0x2bbe30[_0x3931f3])&&(_0x4b2869=(_0x5d216c<0x3?_0x33e21b(_0x4b2869):_0x5d216c>0x3?_0x33e21b(_0x2be97f,_0x327582,_0x4b2869):_0x33e21b(_0x2be97f,_0x327582))||_0x4b2869);}return _0x5d216c>0x3&&_0x4b2869&&Object['defineProperty'](_0x2be97f,_0x327582,_0x4b2869),_0x4b2869;};Object['defineProperty'](_0xe8f7c7,'__esModule',{'value':!0x0}),_0xe8f7c7[_0x41a25e(0x109)]=void 0x0;const _0x188e2d=_0x417b76(0x2),_0x23ecc7=_0x417b76(0x12),_0x48a490=_0x417b76(0x13),_0x390dde=_0x417b76(0x27),_0x1b8ed2=_0x417b76(0x39),_0xe063c6=_0x417b76(0x33),_0x459bf1=_0x417b76(0x34),_0x1d4e4f=_0x417b76(0x3a),_0x3db46b=_0x417b76(0x2b),_0x39aa33=_0x417b76(0x3e),_0x2d8285=_0x417b76(0x16),_0x46e122=_0x417b76(0x3f);let _0x4e8dc2=class{};_0xe8f7c7['BankModule']=_0x4e8dc2,_0xe8f7c7[_0x41a25e(0x109)]=_0x4e8dc2=_0x4acd9d([(0x0,_0x188e2d['Module'])({'imports':[_0xe063c6[_0x41a25e(0x23c)],(0x0,_0x188e2d['forwardRef'])(()=>_0x459bf1['DeviceModule']),_0x1d4e4f['WebSocketModule'],_0x46e122[_0x41a25e(0x33f)]],'controllers':[_0x1b8ed2['BankController']],'providers':[_0x23ecc7['BankService'],_0x48a490['AcbService'],_0x390dde[_0x41a25e(0x166)],_0x3db46b[_0x41a25e(0x213)],_0x39aa33['SessionRefreshScheduler'],_0x2d8285['RedisService']],'exports':[_0x23ecc7['BankService']]})],_0x4e8dc2);},function(_0x889f31,_0x1e8c07,_0x49e609){const _0x496f37=a0_0x2633;var _0x259a78,_0x3c6481,_0x472294,_0x34fddf=this&&this['__decorate']||function(_0x589860,_0x4c1988,_0x30d1f1,_0x4d7294){const _0x671bef=a0_0x2633;var _0x561fc1,_0x101066=arguments['length'],_0x3beb38=_0x101066<0x3?_0x4c1988:null===_0x4d7294?_0x4d7294=Object['getOwnPropertyDescriptor'](_0x4c1988,_0x30d1f1):_0x4d7294;if('object'==typeof Reflect&&_0x671bef(0x269)==typeof Reflect[_0x671bef(0x2a1)])_0x3beb38=Reflect['decorate'](_0x589860,_0x4c1988,_0x30d1f1,_0x4d7294);else{for(var _0x395675=_0x589860['length']-0x1;_0x395675>=0x0;_0x395675--)(_0x561fc1=_0x589860[_0x395675])&&(_0x3beb38=(_0x101066<0x3?_0x561fc1(_0x3beb38):_0x101066>0x3?_0x561fc1(_0x4c1988,_0x30d1f1,_0x3beb38):_0x561fc1(_0x4c1988,_0x30d1f1))||_0x3beb38);}return _0x101066>0x3&&_0x3beb38&&Object['defineProperty'](_0x4c1988,_0x30d1f1,_0x3beb38),_0x3beb38;},_0x371e19=this&&this['__metadata']||function(_0x6b1d6c,_0x2dfe5c){const _0x3bc4ad=a0_0x2633;if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect[_0x3bc4ad(0x331)](_0x6b1d6c,_0x2dfe5c);},_0xf2e4d6=this&&this[_0x496f37(0x248)]||function(_0x437947,_0xcd42d8){return function(_0x52a274,_0x172ffe){_0xcd42d8(_0x52a274,_0x172ffe,_0x437947);};};Object['defineProperty'](_0x1e8c07,'__esModule',{'value':!0x0}),_0x1e8c07['BankController']=void 0x0;const _0x1e2958=_0x49e609(0x2),_0x3fe4f0=_0x49e609(0x3),_0xc03bf8=_0x49e609(0x12),_0x7b0fba=_0x49e609(0x18),_0xd34087=_0x49e609(0xf),_0x3cc45e=_0x49e609(0x19),_0x299a35=_0x49e609(0x14);let _0x4c543f=class{constructor(_0x2e551f,_0x383f83,_0x3467cd){const _0x18d8e0=_0x496f37;this['bankService']=_0x2e551f,this['hcBoxService']=_0x383f83,this[_0x18d8e0(0x2e5)]=_0x3467cd,this['logger']=new _0x1e2958[(_0x18d8e0(0x1da))](_0x18d8e0(0x28d));}['getBankService'](_0x1a77a0){const _0x214be9=_0x496f37,_0x56ecbf=this['bankService']['getBankService'](_0x1a77a0);if(!_0x56ecbf)throw new _0x1e2958[(_0x214be9(0x133))]({'success':!0x1,'error':'Bank\x20service\x20not\x20found\x20for\x20bank\x20code:\x20'+_0x1a77a0+'.\x20Supported\x20banks:\x20'+this[_0x214be9(0x1d2)]['getSupportedBanks']()[_0x214be9(0x21c)](',\x20')},_0x1e2958['HttpStatus']['BAD_REQUEST']);return _0x56ecbf;}async['getDevices'](_0x21ecdb){const _0x384422=_0x496f37;try{return{'success':!0x0,'data':await this['hcBoxService']['listDevices']()};}catch(_0x54535e){return this[_0x384422(0x329)]['error'](_0x384422(0x13f)+_0x54535e[_0x384422(0x26b)]),{'success':!0x1,'error':_0x54535e[_0x384422(0x26b)]};}}async[_0x496f37(0x250)](_0xff57bd,_0x179b90){const _0x218aa1=_0x496f37;try{const _0x388289=this['getBankService'](_0xff57bd);return this['logger']['log'](_0x218aa1(0x22b)+_0xff57bd+'\x20app\x20launch\x20on\x20device:\x20'+_0x179b90),await _0x388289['launchApp'](_0x179b90),{'success':!0x0,'message':_0xff57bd+'\x20app\x20launched\x20successfully\x20on\x20device\x20'+_0x179b90};}catch(_0x3e5904){return this[_0x218aa1(0x329)]['error']('Error\x20testing\x20'+_0xff57bd+'\x20app\x20launch:\x20'+_0x3e5904['message']),{'success':!0x1,'error':_0x3e5904['message']};}}async[_0x496f37(0x10c)](_0x42713a,_0x361839,_0x55a5d0,_0x1bcbd7){const _0x41073c=_0x496f37;try{this['getBankService'](_0x42713a),this[_0x41073c(0x329)]['log']('Testing\x20screen\x20capture\x20on\x20device:\x20'+_0x361839);const _0x54e4f3=_0x1bcbd7?parseFloat(_0x1bcbd7):0.5,_0x357b98=_0x55a5d0||'test-screen-capture-'+Date['now'](),_0x5dca27=await this['wsService']['captureScreen'](_0x361839,{'quality':_0x54e4f3,'folderPath':'C:/boxscreen/'+_0x357b98+'.png'});return{'success':!0x0,'message':'Screen\x20captured\x20successfully\x20on\x20device\x20'+_0x361839,'data':{'base64Image':_0x5dca27,'imageLength':_0x5dca27?.['length']??0x0}};}catch(_0x2b47bb){return this['logger'][_0x41073c(0x25a)]('Error\x20testing\x20screen\x20capture:\x20'+_0x2b47bb['message']),{'success':!0x1,'error':_0x2b47bb['message']};}}async[_0x496f37(0x2e2)](_0x54f976,_0x4d7819,_0x14b05f,_0x5c1107){const _0x1642ea=_0x496f37;try{const _0x2f689f=parseFloat(_0x14b05f),_0x2b2cc2=parseFloat(_0x5c1107);return isNaN(_0x2f689f)||isNaN(_0x2b2cc2)?{'success':!0x1,'error':'Invalid\x20coordinates.\x20x\x20and\x20y\x20must\x20be\x20numbers\x20between\x200\x20and\x201','example':_0x1642ea(0x279)+_0x54f976+'/test/click/{deviceId}?x=0.5&y=0.55'}:(this['logger']['log'](_0x1642ea(0x299)+_0x2f689f+',\x20'+_0x2b2cc2+_0x1642ea(0x2b7)+_0x4d7819),await this['wsService']['click'](_0x4d7819,_0x2f689f,_0x2b2cc2),{'success':!0x0,'message':_0x1642ea(0x1f8)+_0x2f689f+',\x20'+_0x2b2cc2+_0x1642ea(0x1fd)+_0x4d7819,'coordinates':{'x':_0x2f689f,'y':_0x2b2cc2}});}catch(_0x3d4bf7){return this[_0x1642ea(0x329)]['error']('Error\x20testing\x20click\x20at\x20coordinates:\x20'+_0x3d4bf7['message']),{'success':!0x1,'error':_0x3d4bf7['message']};}}async['testSwipe'](_0x1e6ec0,_0x404f24,_0x2373a9,_0x5e5b28,_0x4d9d8c,_0x18f41d,_0x295181,_0x550499){const _0xac5a=_0x496f37;try{this['getBankService'](_0x1e6ec0);const _0x586176='PANDA'===_0xd34087[_0xac5a(0x30b)][_0xac5a(0x310)],_0xac153d='HC'===_0xd34087['config'][_0xac5a(0x310)];if(_0x586176){if(!_0x4d9d8c)return{'success':!0x1,'error':_0xac5a(0x161),'example':'/api/bank/'+_0x1e6ec0+'/test/swipe/{deviceId}?type=0'};if(!['0','1','2','4','5','6','7','8','9','10']['includes'](_0x4d9d8c))return{'success':!0x1,'error':'Invalid\x20type.\x20Type\x20must\x20be\x20one\x20of:\x200\x20(/press),\x201\x20(/lift),\x202\x20(/move),\x204\x20(/scroll\x20up),\x205\x20(/scroll\x20down),\x206\x20(/swipe\x20up),\x207\x20(/swipe\x20down),\x208\x20(/swipe\x20left),\x209\x20(/swipe\x20right),\x2010\x20(/click)','example':'/api/bank/'+_0x1e6ec0+_0xac5a(0x265)};if(!(['4','5','6','7','8','9']['includes'](_0x4d9d8c)||_0x2373a9&&_0x5e5b28))return{'success':!0x1,'error':'For\x20Panda\x20type\x20'+_0x4d9d8c+':\x20x\x20and\x20y\x20are\x20required','example':_0xac5a(0x279)+_0x1e6ec0+'/test/swipe/{deviceId}?x=50&y=30&type='+_0x4d9d8c};const _0x5b0a77={'type':_0x4d9d8c};if(_0x2373a9&&_0x5e5b28){const _0x12908b=parseFloat(_0x2373a9),_0x1e0add=parseFloat(_0x5e5b28);if(isNaN(_0x12908b)||isNaN(_0x1e0add))return{'success':!0x1,'error':'Invalid\x20coordinates.\x20x\x20and\x20y\x20must\x20be\x20numbers\x20between\x200\x20and\x20100\x20for\x20Panda','example':_0xac5a(0x279)+_0x1e6ec0+'/test/swipe/{deviceId}?x=50&y=30&type='+_0x4d9d8c};if(_0x12908b<0x0||_0x12908b>0x64||_0x1e0add<0x0||_0x1e0add>0x64)return{'success':!0x1,'error':'Invalid\x20coordinates.\x20x\x20and\x20y\x20must\x20be\x20between\x200\x20and\x20100\x20for\x20Panda','example':'/api/bank/'+_0x1e6ec0+'/test/swipe/{deviceId}?x=50&y=30&type='+_0x4d9d8c};_0x5b0a77['x']=_0x12908b['toString'](),_0x5b0a77['y']=_0x1e0add['toString']();}return this['logger'][_0xac5a(0x349)]('Testing\x20Panda\x20swipe\x20on\x20device:\x20'+_0x404f24+'\x20with\x20type='+_0x4d9d8c+(_0x2373a9&&_0x5e5b28?',\x20x='+_0x2373a9+',\x20y='+_0x5e5b28:_0xac5a(0x2f4))),await this[_0xac5a(0x2e5)][_0xac5a(0x2f6)](_0x404f24,_0x5b0a77),{'success':!0x0,'message':_0xac5a(0x20b)+_0x404f24,'coordinates':{'type':_0x4d9d8c,..._0x2373a9&&_0x5e5b28?{'x':_0x2373a9,'y':_0x5e5b28}:{}}};}if(_0xac153d){if(!(_0x2373a9&&_0x5e5b28&&_0x18f41d&&_0x295181))return{'success':!0x1,'error':'For\x20HC\x20format:\x20x,\x20y,\x20endX,\x20and\x20endY\x20are\x20required','example':'/api/bank/'+_0x1e6ec0+'/test/swipe/{deviceId}?x=0.2&y=0.5&endX=0.8&endY=0.5&duration=0.3'};const _0x2ddcb5=parseFloat(_0x2373a9),_0x2e871d=parseFloat(_0x5e5b28),_0x28b615=parseFloat(_0x18f41d),_0x595e58=parseFloat(_0x295181),_0x430eea=_0x550499?parseFloat(_0x550499):0.2;return isNaN(_0x2ddcb5)||isNaN(_0x2e871d)||isNaN(_0x28b615)||isNaN(_0x595e58)?{'success':!0x1,'error':'Invalid\x20coordinates.\x20x,\x20y,\x20endX,\x20and\x20endY\x20must\x20be\x20numbers\x20between\x200\x20and\x201\x20for\x20HC','example':'/api/bank/'+_0x1e6ec0+'/test/swipe/{deviceId}?x=0.2&y=0.5&endX=0.8&endY=0.5&duration=0.3'}:_0x2ddcb5<0x0||_0x2ddcb5>0x1||_0x2e871d<0x0||_0x2e871d>0x1||_0x28b615<0x0||_0x28b615>0x1||_0x595e58<0x0||_0x595e58>0x1?{'success':!0x1,'error':'Invalid\x20coordinates.\x20x,\x20y,\x20endX,\x20and\x20endY\x20must\x20be\x20between\x200\x20and\x201\x20for\x20HC','example':_0xac5a(0x279)+_0x1e6ec0+'/test/swipe/{deviceId}?x=0.2&y=0.5&endX=0.8&endY=0.5&duration=0.3'}:(this[_0xac5a(0x329)]['log'](_0xac5a(0x1d8)+_0x2ddcb5+',\x20'+_0x2e871d+_0xac5a(0x2ab)+_0x28b615+',\x20'+_0x595e58+')\x20on\x20device:\x20'+_0x404f24),await this['wsService'][_0xac5a(0x2f6)](_0x404f24,{'x':_0x2ddcb5,'y':_0x2e871d,'endX':_0x28b615,'endY':_0x595e58,'duration':_0x430eea}),{'success':!0x0,'message':'HC\x20swipe\x20completed\x20successfully\x20from\x20('+_0x2ddcb5+',\x20'+_0x2e871d+')\x20to\x20('+_0x28b615+',\x20'+_0x595e58+_0xac5a(0x1fd)+_0x404f24,'coordinates':{'start':{'x':_0x2ddcb5,'y':_0x2e871d},'end':{'x':_0x28b615,'y':_0x595e58},'duration':_0x430eea}});}return{'success':!0x1,'error':'Invalid\x20box\x20type\x20configuration:\x20'+_0xd34087['config']['boxType']+'.\x20Must\x20be\x20\x27HC\x27\x20or\x20\x27PANDA\x27'};}catch(_0x29ecc5){return this['logger'][_0xac5a(0x25a)]('Error\x20testing\x20swipe:\x20'+_0x29ecc5['message']),{'success':!0x1,'error':_0x29ecc5['message']};}}async['testInputNumpadNumber'](_0x23346c,_0x5f0f53,_0x5e9710){const _0x1413d1=_0x496f37;try{return this['getBankService'](_0x23346c),_0x5e9710&&0x0!==_0x5e9710[_0x1413d1(0x12d)]()['length']?/^\d+$/['test'](_0x5e9710)?(this['logger']['log']('Testing\x20numpad\x20number\x20input\x20\x22'+_0x5e9710+'\x22\x20on\x20device:\x20'+_0x5f0f53),await this['hcBoxService']['inputNumpadNumber'](_0x5f0f53,_0x5e9710),{'success':!0x0,'message':'Numpad\x20number\x20input\x20completed\x20successfully\x20on\x20device\x20'+_0x5f0f53,'data':{'number':_0x5e9710,'digits':_0x5e9710[_0x1413d1(0x15e)]('')['map'](_0x14dac7=>parseInt(_0x14dac7))}}):{'success':!0x1,'error':_0x1413d1(0x1d3),'example':'/api/bank/'+_0x23346c+'/test/input-numpad/{deviceId}?number=123456'}:{'success':!0x1,'error':'Number\x20is\x20required\x20and\x20cannot\x20be\x20empty','example':'/api/bank/'+_0x23346c+'/test/input-numpad/{deviceId}?number=123456'};}catch(_0x1c0198){return this['logger'][_0x1413d1(0x25a)]('Error\x20testing\x20numpad\x20number\x20input:\x20'+_0x1c0198[_0x1413d1(0x26b)]),{'success':!0x1,'error':_0x1c0198[_0x1413d1(0x26b)]};}}async['testInputText'](_0x58bf7d,_0x3286d2,_0x2c4bf5){const _0x5a63f6=_0x496f37;try{return this[_0x5a63f6(0x2f7)](_0x58bf7d),_0x2c4bf5&&0x0!==_0x2c4bf5['trim']()['length']?(this[_0x5a63f6(0x329)]['log']('Testing\x20text\x20input\x20\x22'+_0x2c4bf5+'\x22\x20on\x20device:\x20'+_0x3286d2),await this['hcBoxService'][_0x5a63f6(0x24b)](_0x3286d2,_0x2c4bf5),{'success':!0x0,'message':'Text\x20input\x20completed\x20successfully\x20on\x20device\x20'+_0x3286d2}):{'success':!0x1,'error':_0x5a63f6(0x234),'example':_0x5a63f6(0x279)+_0x58bf7d+'/test/input-text/{deviceId}?text=abc123'};}catch(_0x546637){return this['logger']['error']('Error\x20testing\x20text\x20input:\x20'+_0x546637[_0x5a63f6(0x26b)]),{'success':!0x1,'error':_0x546637[_0x5a63f6(0x26b)]};}}async['testPressReturn'](_0x4b8b55,_0x50fa0f){const _0x34e941=_0x496f37;try{return this['getBankService'](_0x4b8b55),this['logger']['log']('Testing\x20press\x20return\x20key\x20on\x20device:\x20'+_0x50fa0f),await this['wsService']['pressReturnKey'](_0x50fa0f),{'success':!0x0,'message':_0x34e941(0x244)+_0x50fa0f,'note':_0x34e941(0x2e1)};}catch(_0x4d652b){return this['logger']['error']('Error\x20testing\x20press\x20return:\x20'+_0x4d652b[_0x34e941(0x26b)]),{'success':!0x1,'error':_0x4d652b['message']};}}};_0x1e8c07['BankController']=_0x4c543f,_0x34fddf([(0x0,_0x1e2958[_0x496f37(0x14c)])(_0x496f37(0x1c3)),(0x0,_0x3fe4f0['ApiOperation'])({'summary':'Get\x20list\x20of\x20available\x20devices'}),(0x0,_0x3fe4f0[_0x496f37(0x302)])({'name':'bankCode','description':'Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)'}),(0x0,_0x3fe4f0['ApiResponse'])({'status':0xc8,'description':'List\x20of\x20devices\x20retrieved\x20successfully'}),_0xf2e4d6(0x0,(0x0,_0x1e2958['Param'])(_0x496f37(0x15a))),_0x371e19('design:type',Function),_0x371e19(_0x496f37(0x1b9),[String]),_0x371e19('design:returntype',Promise)],_0x4c543f[_0x496f37(0x114)],'getDevices',null),_0x34fddf([(0x0,_0x1e2958['Post'])('test/launch-app/:deviceId'),(0x0,_0x3fe4f0['ApiOperation'])({'summary':_0x496f37(0x291)}),(0x0,_0x3fe4f0['ApiParam'])({'name':'bankCode','description':'Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)'}),(0x0,_0x3fe4f0['ApiParam'])({'name':'deviceId','description':_0x496f37(0x281)}),(0x0,_0x3fe4f0['ApiResponse'])({'status':0xc8,'description':'App\x20launched\x20successfully'}),_0xf2e4d6(0x0,(0x0,_0x1e2958['Param'])('bankCode')),_0xf2e4d6(0x1,(0x0,_0x1e2958[_0x496f37(0x1f1)])('deviceId')),_0x371e19(_0x496f37(0x2ec),Function),_0x371e19('design:paramtypes',[String,String]),_0x371e19('design:returntype',Promise)],_0x4c543f['prototype'],_0x496f37(0x250),null),_0x34fddf([(0x0,_0x1e2958['Post'])('test/capture-screen/:deviceId'),(0x0,_0x3fe4f0['ApiOperation'])({'summary':'Test\x20screen\x20capture\x20on\x20a\x20device'}),(0x0,_0x3fe4f0['ApiParam'])({'name':'bankCode','description':'Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)'}),(0x0,_0x3fe4f0['ApiParam'])({'name':'deviceId','description':_0x496f37(0x281)}),(0x0,_0x3fe4f0['ApiQuery'])({'name':'name','description':_0x496f37(0x137),'required':!0x1}),(0x0,_0x3fe4f0['ApiQuery'])({'name':_0x496f37(0x19b),'description':_0x496f37(0x16e),'required':!0x1}),(0x0,_0x3fe4f0['ApiResponse'])({'status':0xc8,'description':'Screen\x20captured\x20successfully'}),_0xf2e4d6(0x0,(0x0,_0x1e2958['Param'])('bankCode')),_0xf2e4d6(0x1,(0x0,_0x1e2958['Param'])('deviceId')),_0xf2e4d6(0x2,(0x0,_0x1e2958['Query'])('name')),_0xf2e4d6(0x3,(0x0,_0x1e2958['Query'])('quality')),_0x371e19('design:type',Function),_0x371e19('design:paramtypes',[String,String,String,String]),_0x371e19('design:returntype',Promise)],_0x4c543f[_0x496f37(0x114)],'testCaptureScreen',null),_0x34fddf([(0x0,_0x1e2958[_0x496f37(0x2b2)])(_0x496f37(0x301)),(0x0,_0x3fe4f0[_0x496f37(0x184)])({'summary':'Test\x20clicking\x20at\x20specific\x20coordinates\x20on\x20a\x20device'}),(0x0,_0x3fe4f0['ApiParam'])({'name':'bankCode','description':_0x496f37(0x30d)}),(0x0,_0x3fe4f0[_0x496f37(0x302)])({'name':'deviceId','description':'Device\x20ID'}),(0x0,_0x3fe4f0[_0x496f37(0x2fe)])({'name':'x','description':'X\x20coordinate\x20(HC:\x200-1,\x20Panda:\x200-100)','required':!0x0}),(0x0,_0x3fe4f0[_0x496f37(0x2fe)])({'name':'y','description':'Y\x20coordinate\x20(Hc:\x200-1),\x20Panda:\x200-100','required':!0x0}),(0x0,_0x3fe4f0['ApiResponse'])({'status':0xc8,'description':'Click\x20completed\x20successfully'}),_0xf2e4d6(0x0,(0x0,_0x1e2958[_0x496f37(0x1f1)])(_0x496f37(0x15a))),_0xf2e4d6(0x1,(0x0,_0x1e2958['Param'])('deviceId')),_0xf2e4d6(0x2,(0x0,_0x1e2958['Query'])('x')),_0xf2e4d6(0x3,(0x0,_0x1e2958['Query'])('y')),_0x371e19('design:type',Function),_0x371e19('design:paramtypes',[String,String,String,String]),_0x371e19('design:returntype',Promise)],_0x4c543f[_0x496f37(0x114)],'testClickAtCoordinates',null),_0x34fddf([(0x0,_0x1e2958[_0x496f37(0x2b2)])('test/swipe/:deviceId'),(0x0,_0x3fe4f0['ApiOperation'])({'summary':_0x496f37(0x24d)}),(0x0,_0x3fe4f0['ApiParam'])({'name':_0x496f37(0x15a),'description':'Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)'}),(0x0,_0x3fe4f0['ApiParam'])({'name':'deviceId','description':_0x496f37(0x281)}),(0x0,_0x3fe4f0['ApiQuery'])({'name':'x','description':'X\x20coordinate\x20(HC:\x200-1,\x20Panda:\x200-100).\x20Required\x20for\x20HC\x20and\x20Panda\x20types\x200,1,2,10.\x20Optional\x20for\x20Panda\x20types\x204,5,6,7,8,9','required':!0x1}),(0x0,_0x3fe4f0['ApiQuery'])({'name':'y','description':'Y\x20coordinate\x20(HC:\x200-1,\x20Panda:\x200-100).\x20Required\x20for\x20HC\x20and\x20Panda\x20types\x200,1,2,10.\x20Optional\x20for\x20Panda\x20types\x204,5,6,7,8,9','required':!0x1}),(0x0,_0x3fe4f0['ApiQuery'])({'name':_0x496f37(0x13a),'description':'Panda\x20pointer\x20event\x20type:\x200=(press),\x201=(lift),\x202=(move),\x204=(scroll\x20up),\x205=(scroll\x20down),\x206=(swipe\x20up),\x207=(swipe\x20down),\x208=(swipe\x20left),\x209=(swipe\x20right),\x2010=(click).\x20Required\x20for\x20Panda\x20format.','required':!0x1}),(0x0,_0x3fe4f0['ApiQuery'])({'name':'endX','description':'End\x20X\x20coordinate\x20for\x20HC\x20(required\x20for\x20HC:\x200-1)','required':!0x1}),(0x0,_0x3fe4f0['ApiQuery'])({'name':'endY','description':'End\x20Y\x20coordinate\x20for\x20HC\x20(required\x20for\x20HC:\x200-1)','required':!0x1}),(0x0,_0x3fe4f0['ApiQuery'])({'name':'duration','description':'Swipe\x20duration\x20for\x20HC\x20(default:\x200.2)','required':!0x1}),(0x0,_0x3fe4f0['ApiResponse'])({'status':0xc8,'description':'Swipe\x20completed\x20successfully'}),_0xf2e4d6(0x0,(0x0,_0x1e2958['Param'])('bankCode')),_0xf2e4d6(0x1,(0x0,_0x1e2958['Param'])('deviceId')),_0xf2e4d6(0x2,(0x0,_0x1e2958[_0x496f37(0x19e)])('x')),_0xf2e4d6(0x3,(0x0,_0x1e2958['Query'])('y')),_0xf2e4d6(0x4,(0x0,_0x1e2958['Query'])('type')),_0xf2e4d6(0x5,(0x0,_0x1e2958['Query'])(_0x496f37(0x317))),_0xf2e4d6(0x6,(0x0,_0x1e2958['Query'])('endY')),_0xf2e4d6(0x7,(0x0,_0x1e2958['Query'])('duration')),_0x371e19('design:type',Function),_0x371e19(_0x496f37(0x1b9),[String,String,String,String,String,String,String,String]),_0x371e19('design:returntype',Promise)],_0x4c543f['prototype'],'testSwipe',null),_0x34fddf([(0x0,_0x1e2958['Post'])(_0x496f37(0x16a)),(0x0,_0x3fe4f0[_0x496f37(0x184)])({'summary':'Test\x20inputting\x20number\x20using\x20numpad\x20layout\x20on\x20a\x20device'}),(0x0,_0x3fe4f0['ApiParam'])({'name':'bankCode','description':'Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)'}),(0x0,_0x3fe4f0['ApiParam'])({'name':_0x496f37(0x2c1),'description':_0x496f37(0x281)}),(0x0,_0x3fe4f0[_0x496f37(0x2fe)])({'name':'number','description':'Number\x20string\x20to\x20input\x20(e.g.,\x20\x22123\x22,\x20\x22456789\x22)','required':!0x0}),(0x0,_0x3fe4f0['ApiResponse'])({'status':0xc8,'description':'Numpad\x20number\x20input\x20completed\x20successfully'}),_0xf2e4d6(0x0,(0x0,_0x1e2958['Param'])('bankCode')),_0xf2e4d6(0x1,(0x0,_0x1e2958[_0x496f37(0x1f1)])(_0x496f37(0x2c1))),_0xf2e4d6(0x2,(0x0,_0x1e2958['Query'])('number')),_0x371e19('design:type',Function),_0x371e19(_0x496f37(0x1b9),[String,String,String]),_0x371e19(_0x496f37(0x26c),Promise)],_0x4c543f['prototype'],'testInputNumpadNumber',null),_0x34fddf([(0x0,_0x1e2958[_0x496f37(0x2b2)])('test/input-text/:deviceId'),(0x0,_0x3fe4f0[_0x496f37(0x184)])({'summary':'Test\x20inputting\x20text\x20using\x20keyboard\x20layout\x20on\x20a\x20device'}),(0x0,_0x3fe4f0['ApiParam'])({'name':'bankCode','description':_0x496f37(0x30d)}),(0x0,_0x3fe4f0[_0x496f37(0x302)])({'name':'deviceId','description':_0x496f37(0x281)}),(0x0,_0x3fe4f0['ApiQuery'])({'name':_0x496f37(0x191),'description':'Text\x20string\x20to\x20input\x20(e.g.,\x20\x22abc123\x22,\x20\x22test@email.com\x22)','required':!0x0}),(0x0,_0x3fe4f0[_0x496f37(0x346)])({'status':0xc8,'description':'Text\x20input\x20completed\x20successfully'}),_0xf2e4d6(0x0,(0x0,_0x1e2958[_0x496f37(0x1f1)])('bankCode')),_0xf2e4d6(0x1,(0x0,_0x1e2958['Param'])('deviceId')),_0xf2e4d6(0x2,(0x0,_0x1e2958[_0x496f37(0x19e)])(_0x496f37(0x191))),_0x371e19('design:type',Function),_0x371e19('design:paramtypes',[String,String,String]),_0x371e19(_0x496f37(0x26c),Promise)],_0x4c543f['prototype'],'testInputText',null),_0x34fddf([(0x0,_0x1e2958[_0x496f37(0x2b2)])(_0x496f37(0x12e)),(0x0,_0x3fe4f0['ApiOperation'])({'summary':'Test\x20pressing\x20return\x20key\x20on\x20a\x20device'}),(0x0,_0x3fe4f0['ApiParam'])({'name':_0x496f37(0x15a),'description':'Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)'}),(0x0,_0x3fe4f0[_0x496f37(0x302)])({'name':'deviceId','description':'Device\x20ID'}),(0x0,_0x3fe4f0['ApiResponse'])({'status':0xc8,'description':'Return\x20key\x20pressed\x20successfully'}),_0xf2e4d6(0x0,(0x0,_0x1e2958['Param'])('bankCode')),_0xf2e4d6(0x1,(0x0,_0x1e2958[_0x496f37(0x1f1)])('deviceId')),_0x371e19(_0x496f37(0x2ec),Function),_0x371e19(_0x496f37(0x1b9),[String,String]),_0x371e19(_0x496f37(0x26c),Promise)],_0x4c543f['prototype'],'testPressReturn',null),_0x1e8c07[_0x496f37(0x28d)]=_0x4c543f=_0x34fddf([(0x0,_0x3fe4f0['ApiTags'])('bank'),(0x0,_0x1e2958['Controller'])('api/bank/:bankCode'),_0xf2e4d6(0x2,(0x0,_0x1e2958[_0x496f37(0x33e)])(_0x299a35['WEBSOCKET_SERVICE'])),_0x371e19('design:paramtypes',['function'==typeof(_0x259a78=void 0x0!==_0xc03bf8[_0x496f37(0x111)]&&_0xc03bf8['BankService'])?_0x259a78:Object,_0x496f37(0x269)==typeof(_0x3c6481=void 0x0!==_0x7b0fba['HcBoxService']&&_0x7b0fba['HcBoxService'])?_0x3c6481:Object,'function'==typeof(_0x472294=void 0x0!==_0x3cc45e[_0x496f37(0x1f2)]&&_0x3cc45e[_0x496f37(0x1f2)])?_0x472294:Object])],_0x4c543f);},function(_0x37bf8c,_0x4dd60c,_0x228c59){const _0x13dad5=a0_0x2633;var _0x176ffa=this&&this['__decorate']||function(_0x30da15,_0x120c81,_0x1acd57,_0x357c92){const _0x123765=a0_0x2633;var _0x42769c,_0x3db6e2=arguments['length'],_0x4a4c6c=_0x3db6e2<0x3?_0x120c81:null===_0x357c92?_0x357c92=Object[_0x123765(0x2c5)](_0x120c81,_0x1acd57):_0x357c92;if(_0x123765(0x26d)==typeof Reflect&&'function'==typeof Reflect[_0x123765(0x2a1)])_0x4a4c6c=Reflect['decorate'](_0x30da15,_0x120c81,_0x1acd57,_0x357c92);else{for(var _0x30ec41=_0x30da15['length']-0x1;_0x30ec41>=0x0;_0x30ec41--)(_0x42769c=_0x30da15[_0x30ec41])&&(_0x4a4c6c=(_0x3db6e2<0x3?_0x42769c(_0x4a4c6c):_0x3db6e2>0x3?_0x42769c(_0x120c81,_0x1acd57,_0x4a4c6c):_0x42769c(_0x120c81,_0x1acd57))||_0x4a4c6c);}return _0x3db6e2>0x3&&_0x4a4c6c&&Object['defineProperty'](_0x120c81,_0x1acd57,_0x4a4c6c),_0x4a4c6c;};Object['defineProperty'](_0x4dd60c,_0x13dad5(0x209),{'value':!0x0}),_0x4dd60c['WebSocketModule']=void 0x0;const _0x499be5=_0x228c59(0x2),_0x1c5afc=_0x228c59(0x3b),_0x110d63=_0x228c59(0x3d),_0x2ed826=_0x228c59(0x14),_0x5e3f91=_0x228c59(0xf);let _0x27ffa7=class{};_0x4dd60c['WebSocketModule']=_0x27ffa7,_0x4dd60c['WebSocketModule']=_0x27ffa7=_0x176ffa([(0x0,_0x499be5['Global'])(),(0x0,_0x499be5['Module'])({'providers':[{'provide':_0x2ed826['WEBSOCKET_SERVICE'],'useClass':'PANDA'===_0x5e3f91['config'][_0x13dad5(0x310)]?_0x110d63[_0x13dad5(0x168)]:_0x1c5afc['HCWebSocketService']}],'exports':[_0x2ed826['WEBSOCKET_SERVICE']]})],_0x27ffa7);},function(_0xeef213,_0x20a1d0,_0x3da545){const _0x2afd47=a0_0x2633;var _0x2bcbcf=this&&this['__decorate']||function(_0x1e9ff4,_0x17a68c,_0x18285d,_0xd6dfbe){const _0x277bab=a0_0x2633;var _0x1a324f,_0x561ff5=arguments[_0x277bab(0x1e6)],_0x3e1985=_0x561ff5<0x3?_0x17a68c:null===_0xd6dfbe?_0xd6dfbe=Object['getOwnPropertyDescriptor'](_0x17a68c,_0x18285d):_0xd6dfbe;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x3e1985=Reflect['decorate'](_0x1e9ff4,_0x17a68c,_0x18285d,_0xd6dfbe);else{for(var _0x58b67e=_0x1e9ff4[_0x277bab(0x1e6)]-0x1;_0x58b67e>=0x0;_0x58b67e--)(_0x1a324f=_0x1e9ff4[_0x58b67e])&&(_0x3e1985=(_0x561ff5<0x3?_0x1a324f(_0x3e1985):_0x561ff5>0x3?_0x1a324f(_0x17a68c,_0x18285d,_0x3e1985):_0x1a324f(_0x17a68c,_0x18285d))||_0x3e1985);}return _0x561ff5>0x3&&_0x3e1985&&Object['defineProperty'](_0x17a68c,_0x18285d,_0x3e1985),_0x3e1985;},_0x4d024f=this&&this['__metadata']||function(_0x1c982d,_0xbea793){const _0x2cbb75=a0_0x2633;if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect[_0x2cbb75(0x331)](_0x1c982d,_0xbea793);};Object['defineProperty'](_0x20a1d0,_0x2afd47(0x209),{'value':!0x0}),_0x20a1d0['HCWebSocketService']=void 0x0;const _0x153c68=_0x3da545(0x2),_0x24252b=_0x3da545(0x3c),_0x4db8e0=_0x3da545(0x25),_0x41a0f7=_0x3da545(0x11),_0x13e177=_0x3da545(0x30);let _0x3d6139=class{constructor(){const _0x569bb6=_0x2afd47;this['logger']=new _0x153c68[(_0x569bb6(0x1da))]('HCWebSocketService'),this['ws']=null,this['reconnectAttempts']=0x0,this['maxReconnectAttempts']=0xa,this['reconnectDelay']=0x1388,this['requestQueue']=[],this['pendingRequests']=new Map(),this[_0x569bb6(0x19d)]=!0x1,this[_0x569bb6(0x252)]=!0x1,this['wsUrl']='ws://127.0.0.1:26608';}async['onModuleInit'](){await this['connect']();}async['onModuleDestroy'](){const _0x36f733=_0x2afd47;await this[_0x36f733(0x1b1)]();}async['connect'](){return new Promise((_0x120f8a,_0x307c84)=>{const _0x5df3ed=a0_0x2633;try{this[_0x5df3ed(0x329)][_0x5df3ed(0x349)]('Connecting\x20to\x20HC\x20BOX\x20WebSocket:\x20'+this['wsUrl']),this['ws']=new _0x24252b(this['wsUrl']),this['ws']['on']('open',()=>{const _0x540619=_0x5df3ed;this[_0x540619(0x329)]['log']('HC\x20BOX\x20WebSocket\x20connected'),this[_0x540619(0x19d)]=!0x0,this['reconnectAttempts']=0x0,this['processRequestQueue'](),_0x120f8a();}),this['ws']['on'](_0x5df3ed(0x26b),_0x2d486f=>{try{const _0x157fe4=JSON['parse'](_0x2d486f['toString']());this['handleMessage'](_0x157fe4);}catch(_0xcbe8f4){this['logger']['error']('Error\x20parsing\x20WebSocket\x20message:\x20'+_0xcbe8f4['message']);}}),this['ws']['on']('error',_0x4c7646=>{const _0x1afc35=_0x5df3ed;this['logger'][_0x1afc35(0x25a)]('WebSocket\x20error:\x20'+_0x4c7646['message']),this['isConnected']=!0x1,0x0===this['reconnectAttempts']&&_0x307c84(_0x4c7646);}),this['ws']['on']('close',()=>{const _0x3e54ee=_0x5df3ed;this['logger'][_0x3e54ee(0x134)]('HC\x20BOX\x20WebSocket\x20closed'),this['isConnected']=!0x1,this['scheduleReconnect']();});}catch(_0x3f4d48){this['logger']['error']('Error\x20creating\x20WebSocket\x20connection:\x20'+_0x3f4d48[_0x5df3ed(0x26b)]),_0x307c84(_0x3f4d48);}});}['scheduleReconnect'](){const _0x10f1f0=_0x2afd47;if(this['reconnectAttempts']>=this['maxReconnectAttempts'])return void this['logger']['error']('Max\x20reconnection\x20attempts\x20reached');this[_0x10f1f0(0x127)]++;const _0xfd7a09=this['reconnectDelay']*this['reconnectAttempts'];this['logger']['log']('Scheduling\x20reconnect\x20attempt\x20'+this[_0x10f1f0(0x127)]+_0x10f1f0(0x2f1)+_0xfd7a09+'ms'),setTimeout(()=>{this['connect']()['catch'](_0x56eea5=>{this['logger']['error']('Reconnection\x20failed:\x20'+_0x56eea5['message']);});},_0xfd7a09);}async['disconnect'](){const _0x2fc753=_0x2afd47;this['ws']&&(this['ws'][_0x2fc753(0x239)](),this['ws']=null,this[_0x2fc753(0x19d)]=!0x1);}['handleMessage'](_0x3c88b5){const _0x4dcddd=_0x2afd47;if(this['pendingRequests']['size']>0x0){const [_0x55f703,_0x4f4e5d]=this[_0x4dcddd(0x308)]['entries']()[_0x4dcddd(0x1c9)]()['value'];this['pendingRequests']['delete'](_0x55f703),0xc8===_0x3c88b5[_0x4dcddd(0x19f)]?_0x4f4e5d['resolve'](_0x3c88b5['result']):_0x4f4e5d['reject'](new Error('HC\x20BOX\x20error:\x20'+_0x3c88b5['StatusCode']));}else this['logger'][_0x4dcddd(0x134)]('Received\x20response\x20but\x20no\x20pending\x20requests:\x20'+JSON['stringify'](_0x3c88b5));}async['processRequestQueue'](){const _0x18c770=_0x2afd47;if(this[_0x18c770(0x252)]||0x0===this['requestQueue']['length'])return;if(!this['isConnected']||!this['ws'])return;this['isProcessingRequest']=!0x0;const {request:_0x12ae01,resolve:_0x32b94e,reject:_0x2b0058,timeout:_0x4a489e}=this['requestQueue'][_0x18c770(0x1bd)]();try{_0x32b94e(await this['_sendRequestOnce'](_0x12ae01,_0x4a489e));}catch(_0x22b90b){_0x2b0058(_0x22b90b);}finally{this['isProcessingRequest']=!0x1,this['requestQueue'][_0x18c770(0x1e6)]>0x0&&setImmediate(()=>this['processRequestQueue']());}}async['_sendRequestOnce'](_0x407634,_0x196ad6=0x7530){return new Promise((_0x3ea171,_0x52bd9d)=>{const _0x1e966e=a0_0x2633,_0x2ba0dc=Date['now']()['toString']()+Math[_0x1e966e(0x16c)]()[_0x1e966e(0x1cd)](0x24)['substr'](0x2,0x9);this[_0x1e966e(0x308)][_0x1e966e(0x1e4)](_0x2ba0dc,{'resolve':_0x3ea171,'reject':_0x52bd9d});const _0x1be804=setTimeout(()=>{const _0x81fcb3=_0x1e966e;this['pendingRequests'][_0x81fcb3(0x26f)](_0x2ba0dc),_0x52bd9d(new Error('WebSocket\x20request\x20timeout'));},_0x196ad6),_0x129497=_0x3ea171,_0x10965a=_0x52bd9d;_0x3ea171=_0x399b53=>{clearTimeout(_0x1be804),_0x129497(_0x399b53);},_0x52bd9d=_0x386d71=>{clearTimeout(_0x1be804),_0x10965a(_0x386d71);},this['pendingRequests'][_0x1e966e(0x1e4)](_0x2ba0dc,{'resolve':_0x3ea171,'reject':_0x52bd9d});try{this['ws']['send'](JSON['stringify'](_0x407634));}catch(_0x23ce0d){this['pendingRequests']['delete'](_0x2ba0dc),clearTimeout(_0x1be804),_0x52bd9d(_0x23ce0d);}});}async['sendRequest'](_0xb23ab3,_0x2ec09c=0x7530){return new Promise((_0x3e2eb5,_0x4b5ec6)=>{this['requestQueue']['push']({'request':_0xb23ab3,'resolve':_0x3e2eb5,'reject':_0x4b5ec6,'timeout':_0x2ec09c}),this['processRequestQueue']();});}async['listDevices'](){const _0x3339e0=_0x2afd47,_0x3390af=await this[_0x3339e0(0x1b2)]({'action':'list'});return Array['isArray'](_0x3390af)?_0x3390af:[];}async[_0x2afd47(0x237)](_0x31bccd,_0x3829a1,_0x20a6a5,_0x11ae0c=0.2){const _0x39ef13=_0x2afd47,_0xc28547=Array['isArray'](_0x31bccd)?_0x31bccd[_0x39ef13(0x21c)](','):_0x31bccd;return this['sendRequest']({'action':'click','comm':{'deviceIds':_0xc28547,'x':_0x3829a1,'y':_0x20a6a5,'duration':_0x11ae0c}});}async['swipe'](_0x36ec4f,_0x546563){const _0xd3182b=_0x2afd47,_0x7c81e3=Array['isArray'](_0x36ec4f)?_0x36ec4f['join'](','):_0x36ec4f;return this[_0xd3182b(0x1b2)]({'action':_0xd3182b(0x2f6),'comm':{'deviceIds':_0x7c81e3,..._0x546563}});}async['captureScreen'](_0x5d28a8,_0x44920a){const _0x218ab9=_0x2afd47;return this['sendRequest']({'action':'screen','comm':{'deviceIds':_0x5d28a8,...(0x0,_0x13e177[_0x218ab9(0x227)])(_0x44920a,'folderPath'),'filePath':_0x44920a[_0x218ab9(0x251)]}});}async['home'](_0x530806){const _0x49ac63=Array['isArray'](_0x530806)?_0x530806['join'](','):_0x530806;return this['sendRequest']({'action':'home','comm':{'deviceIds':_0x49ac63}});}async['launchApp'](_0x5d317d,_0x33ce53){const _0xb8f2e9=_0x2afd47,_0x363b9d=Array['isArray'](_0x5d317d)?_0x5d317d['join'](','):_0x5d317d;return this['sendRequest']({'action':_0xb8f2e9(0x25d),'comm':{'deviceIds':_0x363b9d,'content':_0x33ce53}});}async['killApp'](_0x391c64,_0xeef43f){const _0x1cb21a=Array['isArray'](_0x391c64)?_0x391c64['join'](','):_0x391c64;return this['sendRequest']({'action':'killApp','comm':{'deviceIds':_0x1cb21a,'content':_0xeef43f}});}['isNumber'](_0x1059df){const _0xda90f5=_0x2afd47;return/^[0-9]$/[_0xda90f5(0x24f)](_0x1059df);}[_0x2afd47(0x212)](_0x151524){return/^[a-zA-Z]$/['test'](_0x151524);}['isSpecialCharInNumberMode'](_0x2966cb){return['@','!']['includes'](_0x2966cb);}async[_0x2afd47(0x284)](_0x28f7c5){const _0x39394f=_0x2afd47,{x:_0x20d6c6,y:_0x2d8eb0}=_0x4db8e0['COMMON_COORDINATES']['KEYBOARD_SWITCH'];this[_0x39394f(0x329)]['log']('Switching\x20keyboard\x20mode\x20on\x20device\x20'+_0x28f7c5+_0x39394f(0x2c3)+_0x20d6c6+',\x20'+_0x2d8eb0+')'),await this[_0x39394f(0x237)](_0x28f7c5,_0x20d6c6,_0x2d8eb0,0.2),await(0x0,_0x41a0f7['sleep'])(0x1f4),this['logger']['log']('Keyboard\x20mode\x20switched\x20successfully\x20on\x20device\x20'+_0x28f7c5);}async['pressShiftKey'](_0x4c6559){const _0x4cfb6e=_0x2afd47,{x:_0x36a6af,y:_0xd385b7}=_0x4db8e0['COMMON_COORDINATES'][_0x4cfb6e(0x205)];this['logger'][_0x4cfb6e(0x2ac)]('Pressing\x20shift\x20key\x20on\x20device\x20'+_0x4c6559+'\x20at\x20coordinates\x20('+_0x36a6af+',\x20'+_0xd385b7+')'),await this[_0x4cfb6e(0x237)](_0x4c6559,_0x36a6af,_0xd385b7,0.2),await(0x0,_0x41a0f7['sleep'])(0xc8),this[_0x4cfb6e(0x329)]['debug']('Shift\x20key\x20pressed\x20successfully\x20on\x20device\x20'+_0x4c6559);}async['pressReturnKey'](_0x4ae442){const _0x471578=_0x2afd47,{x:_0xb9f971,y:_0x24fde8}=_0x4db8e0['COMMON_COORDINATES']['RETURN_KEY'];this['logger']['log']('Pressing\x20return\x20key\x20on\x20device\x20'+_0x4ae442+'\x20at\x20coordinates\x20('+_0xb9f971+',\x20'+_0x24fde8+')'),await this[_0x471578(0x237)](_0x4ae442,_0xb9f971,_0x24fde8,0.2),await(0x0,_0x41a0f7['sleep'])(0x1f4),this[_0x471578(0x329)]['log']('Return\x20key\x20pressed\x20successfully\x20on\x20device\x20'+_0x4ae442);}async['inputText'](_0x4357b7,_0x776f10){const _0x424281=_0x2afd47;if(!_0x776f10||0x0===_0x776f10[_0x424281(0x1e6)])throw new Error('Password\x20cannot\x20be\x20empty');let _0x1ba6e7='letter';for(let _0x42f9f4=0x0;_0x42f9f4<_0x776f10['length'];_0x42f9f4++){const _0x251562=_0x776f10[_0x42f9f4],_0x27f664=_0x251562['toLowerCase'](),_0x34ad6a=_0x251562!==_0x27f664&&this[_0x424281(0x212)](_0x251562),_0x440455=this[_0x424281(0x222)](_0x251562)?_0x251562:_0x27f664,_0x38e828=_0x4db8e0['KEYBOARD_LAYOUT'][_0x440455];if(!_0x38e828){this['logger']['warn']('Character\x20\x27'+_0x251562+'\x27\x20not\x20found\x20in\x20keyboard\x20layout.\x20Skipping...');continue;}let _0x14213a=null;this['isNumber'](_0x27f664)?_0x14213a=_0x424281(0x14a):this[_0x424281(0x212)](_0x27f664)?_0x14213a='letter':this['isSpecialCharInNumberMode'](_0x251562)&&(_0x14213a='number'),_0x14213a&&_0x1ba6e7!==_0x14213a&&(this[_0x424281(0x329)]['debug']('Switching\x20keyboard\x20to\x20'+_0x14213a+_0x424281(0x1b6)+_0x251562+'\x27'),await this['switchKeyboardMode'](_0x4357b7),_0x1ba6e7=_0x14213a),_0x34ad6a&&'letter'===_0x1ba6e7&&(this['logger'][_0x424281(0x2ac)](_0x424281(0x325)+_0x251562+'\x27'),await this[_0x424281(0x335)](_0x4357b7)),this['logger']['debug']('Clicking\x20key\x20\x27'+_0x440455+'\x27'+(_0x34ad6a?'\x20(uppercase)':'')+'\x20at\x20('+_0x38e828['x']+',\x20'+_0x38e828['y']+')'),await this['click'](_0x4357b7,_0x38e828['x'],_0x38e828['y'],0.15),await(0x0,_0x41a0f7[_0x424281(0x23d)])(0xc8);}this[_0x424281(0x329)]['log']('Text\x20input\x20completed\x20on\x20device\x20'+_0x4357b7);}async['inputNumpadNumber'](_0x29cc7a,_0xde0465){if(!_0xde0465||0x0===_0xde0465['length'])throw new Error('value\x20cannot\x20be\x20empty');for(let _0x2b01c7=0x0;_0x2b01c7<_0xde0465['length'];_0x2b01c7++){const _0x36f55e=_0xde0465[_0x2b01c7],_0x1497f8=_0x4db8e0['NUMPAD_LAYOUT'][_0x36f55e];await this['click'](_0x29cc7a,_0x1497f8['x'],_0x1497f8['y'],0.15),this['logger']['debug']('Clicking\x20key\x20\x27'+_0x36f55e+'\x27\x20at\x20('+_0x1497f8['x']+',\x20'+_0x1497f8['y']+')'),await(0x0,_0x41a0f7['sleep'])(0xc8);}}async['transferFile'](_0xea10ce,_0x4ea5a9,_0xf4f56b=0x1){return Promise['resolve'](null);}};_0x20a1d0['HCWebSocketService']=_0x3d6139,_0x20a1d0['HCWebSocketService']=_0x3d6139=_0x2bcbcf([(0x0,_0x153c68['Injectable'])(),_0x4d024f('design:paramtypes',[])],_0x3d6139);},_0x2414c0=>{_0x2414c0['exports']=require('ws');},function(_0x4f0c7a,_0x55c5d3,_0x219422){const _0x476840=a0_0x2633;var _0x3b5cdb=this&&this[_0x476840(0x32c)]||function(_0x2ec5ef,_0x1a9f5b,_0x127181,_0x3e1b1f){const _0x77324=_0x476840;var _0x30cc9d,_0x349c14=arguments['length'],_0x13f70d=_0x349c14<0x3?_0x1a9f5b:null===_0x3e1b1f?_0x3e1b1f=Object['getOwnPropertyDescriptor'](_0x1a9f5b,_0x127181):_0x3e1b1f;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x77324(0x2a1)])_0x13f70d=Reflect[_0x77324(0x2a1)](_0x2ec5ef,_0x1a9f5b,_0x127181,_0x3e1b1f);else{for(var _0x3b0e02=_0x2ec5ef['length']-0x1;_0x3b0e02>=0x0;_0x3b0e02--)(_0x30cc9d=_0x2ec5ef[_0x3b0e02])&&(_0x13f70d=(_0x349c14<0x3?_0x30cc9d(_0x13f70d):_0x349c14>0x3?_0x30cc9d(_0x1a9f5b,_0x127181,_0x13f70d):_0x30cc9d(_0x1a9f5b,_0x127181))||_0x13f70d);}return _0x349c14>0x3&&_0x13f70d&&Object['defineProperty'](_0x1a9f5b,_0x127181,_0x13f70d),_0x13f70d;},_0x52917d=this&&this[_0x476840(0x233)]||function(_0x4e12ab,_0x6e30a5){const _0x2466d7=_0x476840;if('object'==typeof Reflect&&_0x2466d7(0x269)==typeof Reflect['metadata'])return Reflect['metadata'](_0x4e12ab,_0x6e30a5);};Object['defineProperty'](_0x55c5d3,'__esModule',{'value':!0x0}),_0x55c5d3[_0x476840(0x168)]=void 0x0;const _0x48160f=_0x219422(0x2),_0x1e0811=_0x219422(0x3c),_0x17581b=_0x219422(0x30),_0x4cf8b3=_0x219422(0x11),_0x4a4b92=_0x219422(0x25);let _0x1046a5=class{constructor(){const _0x326800=_0x476840;this['logger']=new _0x48160f['Logger'](_0x326800(0x168)),this['ws']=null,this['reconnectAttempts']=0x0,this[_0x326800(0x162)]=0xa,this['reconnectDelay']=0x1388,this['requestQueue']=[],this[_0x326800(0x308)]=new Map(),this[_0x326800(0x19d)]=!0x1,this[_0x326800(0x252)]=!0x1,this['wsUrl']='ws://127.0.0.1:33333';}async[_0x476840(0x2ce)](){await this['connect']();}async['onModuleDestroy'](){await this['disconnect']();}async[_0x476840(0x1bb)](){return new Promise((_0x4d89fe,_0x38ca6a)=>{const _0x2c04fb=a0_0x2633;try{this['logger'][_0x2c04fb(0x349)]('Connecting\x20to\x20Panda\x20BOX\x20WebSocket:\x20'+this['wsUrl']),this['ws']=new _0x1e0811(this['wsUrl']),this['ws']['on']('open',()=>{const _0x146ef8=_0x2c04fb;this['logger'][_0x146ef8(0x349)]('Panda\x20BOX\x20WebSocket\x20connected'),this[_0x146ef8(0x19d)]=!0x0,this['reconnectAttempts']=0x0,this['processRequestQueue'](),_0x4d89fe();}),this['ws']['on']('message',_0x1532c4=>{const _0x1acb21=_0x2c04fb;try{const _0x236fb1=_0x1532c4['toString'](),_0x543c17=JSON[_0x1acb21(0x1ac)](_0x236fb1);this['handleMessage'](_0x543c17);}catch(_0x46117d){this['logger']['error']('Error\x20parsing\x20WebSocket\x20message:\x20'+_0x46117d['message'],_0x46117d[_0x1acb21(0x267)]),this['logger']['error'](_0x1acb21(0x229)+_0x1532c4['toString']());}}),this['ws']['on']('error',_0x3cef78=>{const _0x529b25=_0x2c04fb;this[_0x529b25(0x329)][_0x529b25(0x25a)]('WebSocket\x20error:\x20'+_0x3cef78['message']),this['isConnected']=!0x1,0x0===this['reconnectAttempts']&&_0x38ca6a(_0x3cef78);}),this['ws']['on'](_0x2c04fb(0x239),()=>{const _0x5dc766=_0x2c04fb;this['logger']['warn']('Panda\x20BOX\x20WebSocket\x20closed'),this[_0x5dc766(0x19d)]=!0x1,this['scheduleReconnect']();});}catch(_0x358793){this[_0x2c04fb(0x329)]['error'](_0x2c04fb(0x270)+_0x358793['message']),_0x38ca6a(_0x358793);}});}['scheduleReconnect'](){const _0x19820d=_0x476840;if(this['reconnectAttempts']>=this['maxReconnectAttempts'])return void this['logger']['error']('Max\x20reconnection\x20attempts\x20reached');this['reconnectAttempts']++;const _0x8e11cb=this['reconnectDelay']*this[_0x19820d(0x127)];this['logger']['log']('Scheduling\x20reconnect\x20attempt\x20'+this[_0x19820d(0x127)]+'\x20in\x20'+_0x8e11cb+'ms'),setTimeout(()=>{this['connect']()['catch'](_0x44866b=>{const _0x1e9bba=a0_0x2633;this[_0x1e9bba(0x329)]['error']('Reconnection\x20failed:\x20'+_0x44866b['message']);});},_0x8e11cb);}async[_0x476840(0x1b1)](){const _0x2fd9e4=_0x476840;this['ws']&&(this['ws'][_0x2fd9e4(0x239)](),this['ws']=null,this['isConnected']=!0x1);}[_0x476840(0x27d)](_0x348142){const _0x4fbff2=_0x476840;if(this[_0x4fbff2(0x308)][_0x4fbff2(0x316)]>0x0){const [_0x312b72,_0x5e6d7e]=this['pendingRequests']['entries']()['next']()['value'];if(this['pendingRequests'][_0x4fbff2(0x26f)](_0x312b72),0x2710===_0x348142['code'])_0x5e6d7e['resolve'](_0x348142['data']);else{const _0x4056d0=_0x348142[_0x4fbff2(0x26b)]||'Panda\x20BOX\x20error:\x20'+_0x348142['code'];_0x5e6d7e['reject'](new Error(_0x4056d0));}}else{if(Array['isArray'](_0x348142[_0x4fbff2(0x32b)])&&_0x348142[_0x4fbff2(0x32b)]['length']>0x0&&void 0x0!==_0x348142['data'][0x0]?.[_0x4fbff2(0x112)]&&0x2710===_0x348142['code']){const _0x18508a=_0x348142['data'];this['logger']['debug'](_0x4fbff2(0x219)+_0x18508a['length']+'\x20device(s)');}else this[_0x4fbff2(0x329)]['warn']('Received\x20response\x20but\x20no\x20pending\x20requests:\x20'+JSON[_0x4fbff2(0x2be)](_0x348142));}}async['processRequestQueue'](){const _0x4042d7=_0x476840;if(this['isProcessingRequest']||0x0===this['requestQueue']['length'])return;if(!this[_0x4042d7(0x19d)]||!this['ws'])return;this[_0x4042d7(0x252)]=!0x0;const {request:_0x116219,resolve:_0x93d655,reject:_0x4c1422,timeout:_0x443f1d}=this['requestQueue']['shift']();try{_0x93d655(await this['_sendRequestOnce'](_0x116219,_0x443f1d));}catch(_0xcf10a5){_0x4c1422(_0xcf10a5);}finally{this[_0x4042d7(0x252)]=!0x1,this['requestQueue'][_0x4042d7(0x1e6)]>0x0&&setImmediate(()=>this[_0x4042d7(0x23b)]());}}async[_0x476840(0x113)](_0x14163b,_0x3060c6=0x7530){return new Promise((_0x417903,_0x2db4cf)=>{const _0x284214=a0_0x2633,_0x51ecb8=Date['now']()['toString']()+Math[_0x284214(0x16c)]()[_0x284214(0x1cd)](0x24)['substr'](0x2,0x9);this[_0x284214(0x308)]['set'](_0x51ecb8,{'resolve':_0x417903,'reject':_0x2db4cf});const _0x1b01d2=setTimeout(()=>{const _0x2ee79b=_0x284214;this['pendingRequests'][_0x2ee79b(0x26f)](_0x51ecb8),_0x2db4cf(new Error('WebSocket\x20request\x20timeout'));},_0x3060c6),_0x2ccba8=_0x417903,_0x167133=_0x2db4cf;_0x417903=_0x4adc0b=>{clearTimeout(_0x1b01d2),_0x2ccba8(_0x4adc0b);},_0x2db4cf=_0x7fd88a=>{clearTimeout(_0x1b01d2),_0x167133(_0x7fd88a);},this['pendingRequests']['set'](_0x51ecb8,{'resolve':_0x417903,'reject':_0x2db4cf});try{const _0x843935=JSON['stringify'](_0x14163b);this['ws']['send'](_0x843935);}catch(_0x5095cf){this['logger'][_0x284214(0x25a)]('Error\x20sending\x20WebSocket\x20request:\x20'+_0x5095cf[_0x284214(0x26b)],_0x5095cf['stack']),this['pendingRequests'][_0x284214(0x26f)](_0x51ecb8),clearTimeout(_0x1b01d2),_0x2db4cf(_0x5095cf);}});}async['sendRequest'](_0x2af956,_0x997a60=0x7530){return new Promise((_0x1aab99,_0x1d8dc4)=>{this['requestQueue']['push']({'request':_0x2af956,'resolve':_0x1aab99,'reject':_0x1d8dc4,'timeout':_0x997a60}),this['processRequestQueue']();});}async[_0x476840(0x254)](){const _0x5b2ec4=_0x476840,_0x2554ed=(await this['sendRequest']({'action':'list'}))[_0x5b2ec4(0x1eb)](_0x457f0d=>({..._0x457f0d,'udid':_0x457f0d['serial']}));return _0x2554ed[_0x5b2ec4(0x1e6)]<=0x0&&this['logger'][_0x5b2ec4(0x25a)]('No\x20devices\x20found!'),_0x2554ed;}async['click'](_0x1b4e68,_0x50b0b6,_0x5c90c6,_0x3a36b5=0.2){const _0x22ec9c=_0x476840;return this['sendRequest']({'action':'pointerEvent','devices':Array['isArray'](_0x1b4e68)?_0x1b4e68['join'](','):_0x1b4e68,'data':{'type':'10','x':(0x0,_0x17581b['toString'])(_0x50b0b6),'y':(0x0,_0x17581b[_0x22ec9c(0x1cd)])(_0x5c90c6)}});}async[_0x476840(0x2f6)](_0x2a2297,_0x26f418){const _0x66293d=_0x476840,_0x28df4a=Array[_0x66293d(0x2a9)](_0x2a2297)?_0x2a2297['join'](','):_0x2a2297;return this['sendRequest']({'action':_0x66293d(0x2ef),'devices':_0x28df4a,'data':_0x26f418});}async['captureScreen'](_0x5aff9c,_0xe02af6){return this['sendRequest']({'action':'screenFile','devices':_0x5aff9c,'data':{'savePath':_0xe02af6['folderPath']}});}async['home'](_0x387788){const _0x2dc9be=_0x476840;return this[_0x2dc9be(0x1b2)]({'action':'pushEvent','devices':_0x387788,'data':{'type':'2'}});}async['launchApp'](_0x5b8801,_0x17b9bc){const _0x4164d8=Array['isArray'](_0x5b8801)?_0x5b8801['join'](','):_0x5b8801;return this['sendRequest']({'action':'startApp','devices':_0x4164d8,'data':{'app':_0x17b9bc}});}async[_0x476840(0x1a3)](_0x292ae8,_0x102a15){const _0x5cb445=Array['isArray'](_0x292ae8)?_0x292ae8['join'](','):_0x292ae8;return this['sendRequest']({'action':'stopApp','devices':_0x5cb445,'data':{'app':_0x102a15}});}async[_0x476840(0x284)](_0x4b6f0c){const _0x5a1f88=_0x476840,{x:_0x414a7a,y:_0x3eea15}=_0x4a4b92['COMMON_COORDINATES']['KEYBOARD_SWITCH'];this['logger']['log']('Switching\x20keyboard\x20mode\x20on\x20device\x20'+_0x4b6f0c+'\x20at\x20coordinates\x20('+_0x414a7a+',\x20'+_0x3eea15+')'),await this[_0x5a1f88(0x237)](_0x4b6f0c,0x64*_0x414a7a,0x64*_0x3eea15,0.2),await(0x0,_0x4cf8b3['sleep'])(0x1f4),this['logger']['log'](_0x5a1f88(0x1ce)+_0x4b6f0c);}async['pressShiftKey'](_0x37b7ef){const _0x260bb0=_0x476840,{x:_0x27ae8c,y:_0x264fd4}=_0x4a4b92['COMMON_COORDINATES']['SHIFT_KEY'];this['logger'][_0x260bb0(0x2ac)](_0x260bb0(0x304)+_0x37b7ef+'\x20at\x20coordinates\x20('+_0x27ae8c+',\x20'+_0x264fd4+')'),await this[_0x260bb0(0x237)](_0x37b7ef,0x64*_0x27ae8c,0x64*_0x264fd4,0.2),await(0x0,_0x4cf8b3['sleep'])(0xc8),this['logger']['debug'](_0x260bb0(0x1cb)+_0x37b7ef);}async['pressReturnKey'](_0x5f07b9){const _0x3ad242=_0x476840,{x:_0x1bf8a9,y:_0x1d0a70}=_0x4a4b92['COMMON_COORDINATES']['RETURN_KEY'];this['logger']['log']('Pressing\x20return\x20key\x20on\x20device\x20'+_0x5f07b9+'\x20at\x20coordinates\x20('+_0x1bf8a9+',\x20'+_0x1d0a70+')'),await this[_0x3ad242(0x237)](_0x5f07b9,0x64*_0x1bf8a9,0x64*_0x1d0a70,0.2),await(0x0,_0x4cf8b3['sleep'])(0x1f4),this[_0x3ad242(0x329)]['log']('Return\x20key\x20pressed\x20successfully\x20on\x20device\x20'+_0x5f07b9);}async['inputText'](_0x508c28,_0x48cbbc){const _0x24dbff=_0x476840,_0x55523c=Array['isArray'](_0x508c28)?_0x508c28['join'](','):_0x508c28;return this[_0x24dbff(0x1b2)]({'action':'inputText','devices':_0x55523c,'data':{'content':_0x48cbbc}});}async['inputNumpadNumber'](_0x5c0410,_0x5f2464){const _0x496c1d=_0x476840;if(!_0x5f2464||0x0===_0x5f2464[_0x496c1d(0x1e6)])throw new Error(_0x496c1d(0x31d));for(let _0x3fc678=0x0;_0x3fc678<_0x5f2464[_0x496c1d(0x1e6)];_0x3fc678++){const _0x565be3=_0x5f2464[_0x3fc678],_0x862502=_0x4a4b92['NUMPAD_LAYOUT'][_0x565be3];await this[_0x496c1d(0x237)](_0x5c0410,_0x862502['x'],_0x862502['y']),this['logger']['debug']('Clicking\x20key\x20\x27'+_0x565be3+_0x496c1d(0x17e)+_0x862502['x']+',\x20'+_0x862502['y']+')'),await(0x0,_0x4cf8b3['sleep'])(0xc8);}}async[_0x476840(0x274)](_0x1f98ec,_0x5733a8,_0x4fe67a=0x1){const _0x22ce94=_0x476840,_0x1183b2=Array['isArray'](_0x1f98ec)?_0x1f98ec[_0x22ce94(0x21c)](','):_0x1f98ec;return this['logger']['log']('Transferring\x20file\x20'+_0x5733a8+_0x22ce94(0x289)+_0x1183b2+'\x20with\x20fileType\x20'+_0x4fe67a),this['sendRequest']({'action':_0x22ce94(0x1f7),'devices':_0x1183b2,'data':{'filePath':_0x5733a8,'fileType':_0x4fe67a}});}};_0x55c5d3['PandaWebSocketService']=_0x1046a5,_0x55c5d3['PandaWebSocketService']=_0x1046a5=_0x3b5cdb([(0x0,_0x48160f['Injectable'])(),_0x52917d('design:paramtypes',[])],_0x1046a5);},function(_0x1d73c6,_0x838c87,_0x2137c4){const _0x4e8cac=a0_0x2633;var _0x5ebac1,_0x2a4b02,_0x299eb3,_0x40286a=this&&this[_0x4e8cac(0x32c)]||function(_0x5a4c1c,_0x28a6f4,_0x27dcb8,_0xc3e402){const _0x1fd59d=_0x4e8cac;var _0x34f1b8,_0x5999a2=arguments['length'],_0x56c9b5=_0x5999a2<0x3?_0x28a6f4:null===_0xc3e402?_0xc3e402=Object[_0x1fd59d(0x2c5)](_0x28a6f4,_0x27dcb8):_0xc3e402;if(_0x1fd59d(0x26d)==typeof Reflect&&'function'==typeof Reflect[_0x1fd59d(0x2a1)])_0x56c9b5=Reflect['decorate'](_0x5a4c1c,_0x28a6f4,_0x27dcb8,_0xc3e402);else{for(var _0x3581c5=_0x5a4c1c['length']-0x1;_0x3581c5>=0x0;_0x3581c5--)(_0x34f1b8=_0x5a4c1c[_0x3581c5])&&(_0x56c9b5=(_0x5999a2<0x3?_0x34f1b8(_0x56c9b5):_0x5999a2>0x3?_0x34f1b8(_0x28a6f4,_0x27dcb8,_0x56c9b5):_0x34f1b8(_0x28a6f4,_0x27dcb8))||_0x56c9b5);}return _0x5999a2>0x3&&_0x56c9b5&&Object[_0x1fd59d(0x1c8)](_0x28a6f4,_0x27dcb8,_0x56c9b5),_0x56c9b5;},_0x176bfd=this&&this['__metadata']||function(_0xc9b506,_0x329edf){const _0x42269a=_0x4e8cac;if(_0x42269a(0x26d)==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0xc9b506,_0x329edf);};Object['defineProperty'](_0x838c87,'__esModule',{'value':!0x0}),_0x838c87['SessionRefreshScheduler']=void 0x0;const _0x4303c6=_0x2137c4(0x2),_0xb4d82c=_0x2137c4(0x7),_0x1a33b5=_0x2137c4(0x12),_0x3980dd=_0x2137c4(0x15),_0x48c453=_0x2137c4(0x2b);let _0x593dc7=class{constructor(_0xe07998,_0x565533,_0x3a56f8){const _0x41deb2=_0x4e8cac;this['bankService']=_0xe07998,this['deviceService']=_0x565533,this[_0x41deb2(0x2af)]=_0x3a56f8,this['logger']=new _0x4303c6['Logger']('SessionRefreshScheduler');}async['refreshSessions'](){const _0x39ffaf=_0x4e8cac;try{if('active'!==await this['deviceService']['getServiceStatus']())return;const _0x33817a=(await this['deviceService'][_0x39ffaf(0x254)]())[_0x39ffaf(0x20e)](_0x47c9e3=>'active'===_0x47c9e3['status']&&_0x47c9e3['bankCode']);for(const _0x1daf7f of _0x33817a){const _0x8a24cc=_0x1daf7f['bankCode']['toUpperCase']();try{await this['bankService']['refreshSessionIfNeeded'](_0x1daf7f[_0x39ffaf(0x268)],_0x8a24cc);}catch(_0x1e6d3d){this[_0x39ffaf(0x329)][_0x39ffaf(0x25a)]('Error\x20refreshing\x20session\x20for\x20device\x20'+_0x1daf7f['udid']+',\x20bank\x20'+_0x8a24cc+':\x20'+_0x1e6d3d[_0x39ffaf(0x26b)]);}}}catch(_0x4fbc78){this['logger']['error']('Error\x20in\x20session\x20refresh\x20scheduler:\x20'+_0x4fbc78[_0x39ffaf(0x26b)]);}}};_0x838c87[_0x4e8cac(0x2c2)]=_0x593dc7,_0x40286a([(0x0,_0xb4d82c[_0x4e8cac(0x215)])(_0xb4d82c['CronExpression']['EVERY_30_SECONDS']),_0x176bfd('design:type',Function),_0x176bfd(_0x4e8cac(0x1b9),[]),_0x176bfd('design:returntype',Promise)],_0x593dc7[_0x4e8cac(0x114)],_0x4e8cac(0x1d1),null),_0x838c87['SessionRefreshScheduler']=_0x593dc7=_0x40286a([(0x0,_0x4303c6['Injectable'])(),_0x176bfd(_0x4e8cac(0x1b9),['function'==typeof(_0x5ebac1=void 0x0!==_0x1a33b5['BankService']&&_0x1a33b5['BankService'])?_0x5ebac1:Object,'function'==typeof(_0x2a4b02=void 0x0!==_0x3980dd['DeviceService']&&_0x3980dd[_0x4e8cac(0x214)])?_0x2a4b02:Object,_0x4e8cac(0x269)==typeof(_0x299eb3=void 0x0!==_0x48c453[_0x4e8cac(0x213)]&&_0x48c453['SessionManagementService'])?_0x299eb3:Object])],_0x593dc7);},function(_0x5746cf,_0x353ce1,_0x36a661){const _0x49accb=a0_0x2633;var _0x385ac1=this&&this['__decorate']||function(_0x324c1e,_0x213e8c,_0x293781,_0x4dde21){const _0xe805d=a0_0x2633;var _0x148d57,_0x42920c=arguments['length'],_0x544b71=_0x42920c<0x3?_0x213e8c:null===_0x4dde21?_0x4dde21=Object['getOwnPropertyDescriptor'](_0x213e8c,_0x293781):_0x4dde21;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x544b71=Reflect['decorate'](_0x324c1e,_0x213e8c,_0x293781,_0x4dde21);else{for(var _0x43e4f1=_0x324c1e[_0xe805d(0x1e6)]-0x1;_0x43e4f1>=0x0;_0x43e4f1--)(_0x148d57=_0x324c1e[_0x43e4f1])&&(_0x544b71=(_0x42920c<0x3?_0x148d57(_0x544b71):_0x42920c>0x3?_0x148d57(_0x213e8c,_0x293781,_0x544b71):_0x148d57(_0x213e8c,_0x293781))||_0x544b71);}return _0x42920c>0x3&&_0x544b71&&Object['defineProperty'](_0x213e8c,_0x293781,_0x544b71),_0x544b71;};Object['defineProperty'](_0x353ce1,'__esModule',{'value':!0x0}),_0x353ce1['OCRModule']=void 0x0;const _0x473419=_0x36a661(0x2),_0x31603a=_0x36a661(0x1e),_0x55bb43=_0x36a661(0x20),_0x199871=_0x36a661(0x1d);let _0x4df5d6=class{};_0x353ce1[_0x49accb(0x33f)]=_0x4df5d6,_0x353ce1['OCRModule']=_0x4df5d6=_0x385ac1([(0x0,_0x473419[_0x49accb(0x181)])({'providers':[_0x31603a['OCRWorkerPoolService'],_0x55bb43['ImagePreprocessingService'],_0x199871['OCRService']],'exports':[_0x199871['OCRService'],_0x31603a[_0x49accb(0x13d)],_0x55bb43['ImagePreprocessingService']]})],_0x4df5d6);}],_0x414384={};function _0x536956(_0x2ea070){const _0x3ad4f0=a0_0x2633;var _0x19b54f=_0x414384[_0x2ea070];if(void 0x0!==_0x19b54f)return _0x19b54f[_0x3ad4f0(0x10b)];var _0x51176a=_0x414384[_0x2ea070]={'exports':{}};return _0x5c484f[_0x2ea070]['call'](_0x51176a[_0x3ad4f0(0x10b)],_0x51176a,_0x51176a['exports'],_0x536956),_0x51176a['exports'];}var _0x295944={};((()=>{const _0x453613=a0_0x2633;var _0x1b3fd7=_0x295944;Object['defineProperty'](_0x1b3fd7,_0x453613(0x209),{'value':!0x0});const _0x307a74=_0x536956(0x1),_0xc0b9=_0x536956(0x2),_0x4ae6fd=_0x536956(0x3),_0x4a1d45=_0x536956(0x4),_0x194e7c=_0x536956(0x5),_0x6c76dc=_0x536956(0xf);!(async function(){const _0x58abc4=_0x453613,_0x2feaee=await _0x307a74[_0x58abc4(0x2cf)]['create'](_0x194e7c['AppModule']),_0x15aad4=new _0xc0b9['Logger'](_0x58abc4(0x294)),_0x5481e2='production'===process['env']['NODE_ENV']?(0x0,_0x4a1d45[_0x58abc4(0x21c)])(__dirname,'views'):(0x0,_0x4a1d45[_0x58abc4(0x21c)])(process[_0x58abc4(0x101)](),'src',_0x58abc4(0x258));_0x2feaee['setBaseViewsDir'](_0x5481e2),_0x2feaee['setViewEngine']('ejs'),_0x15aad4['log']('Views\x20directory:\x20'+_0x5481e2),_0x2feaee['useGlobalPipes'](new _0xc0b9[(_0x58abc4(0x195))]({'transform':!0x0,'whitelist':!0x0,'forbidNonWhitelisted':!0x0}));const _0x5d44a5=new _0x4ae6fd['DocumentBuilder']()['setTitle']('EzPay\x20Auto\x20API')[_0x58abc4(0x10a)]('Automated\x20withdrawal\x20processing\x20service\x20with\x20HC\x20BOX\x20integration')['setVersion']('1.0')['addTag']('bank',_0x58abc4(0x1c4))[_0x58abc4(0x2b5)](_0x58abc4(0x21d),'Withdrawal\x20processing')['addTag']('device','Device\x20management')['addTag']('hcbox','HC\x20Box\x20integration')['build'](),_0x1dff48=_0x4ae6fd['SwaggerModule']['createDocument'](_0x2feaee,_0x5d44a5);_0x4ae6fd['SwaggerModule'][_0x58abc4(0x16b)]('docs',_0x2feaee,_0x1dff48);const _0x4242e7=process[_0x58abc4(0x126)]['PORT']||0xbba;_0x15aad4[_0x58abc4(0x349)]('\x20Swagger\x20documentation\x20available\x20at:\x20http://localhost:'+_0x4242e7+_0x58abc4(0x12b)),await _0x2feaee['listen'](_0x4242e7),_0x15aad4['log']('\x20EzPay\x20Auto\x20is\x20running\x20on:\x20http://localhost:'+_0x4242e7),_0x15aad4[_0x58abc4(0x349)]('\x20Withdrawal\x20processing\x20started\x20by\x20'+_0x6c76dc['config']['boxType']+_0x58abc4(0x2dc)),_0x15aad4['log'](_0x58abc4(0x156)+_0x4242e7);}());})());})()));function a0_0x49ff(){const _0x248fc2=['message','design:returntype','object','Retry\x20login\x20requested\x20for\x20device\x20','delete','Error\x20creating\x20WebSocket\x20connection:\x20','all',']\x20-\x20Get\x20Transaction\x20verification\x20screen','14xpmnGT','transferFile','preprocess','ms,\x20Poll:\x20','Bank\x20','HSBC','/api/bank/','\x20after\x20','Error\x20getting\x20available\x20devices:\x20','setParameters','handleMessage','resolve','max','\x20not\x20found\x20or\x20not\x20configured','Device\x20ID','httpService','folderCreated','switchKeyboardMode','includes','NUMPAD_LAYOUT','EzpayBeClientService','logging_in','\x20to\x20device(s)\x20','baseTransactionFolderPath','clickWithTransition','unauthorized','BankController','process-withdrawal-request','*/5\x20*\x20*\x20*\x20*\x20*','reject','Test\x20launching\x20bank\x20app\x20on\x20a\x20device','now','hcBoxService','Bootstrap','WithdrawalJobManagerService','waitingQueue','wda-request','getMimeType','Testing\x20click\x20at\x20coordinates\x20(','PGBANK','OCR_ROI_SINGLE_Y','scaleCoordinates','toLocaleUpperCase',']\x20-\x20Error\x20capturing\x20screen\x20for\x20withdrawal\x20','ImagePreprocessingService','withdrawalService','decorate','withdrawalCode','getROIConfig','WEBSOCKET_SERVICE','\x20after\x204\x20attempts.\x20Payload:\x20','Error\x20starting\x20service:\x20','\x20error:\x20',',\x20expires\x20at\x20','isArray','\x20as\x20completed',')\x20to\x20(','debug','initializeJobProcessing','psm','sessionManagement','pgService','createWorker','Post','poolSize','ocrRecognize','addTag','isInitialized',')\x20on\x20device:\x20','singleLine','ng\x20nhp','Xc\x20nhn\x20giao\x20dch','periodicJobPicking','found','MIN_DIMENSION','stringify','crop','image/png','deviceId','SessionRefreshScheduler','\x20at\x20coordinates\x20(','Failed\x20to\x20acquire\x20lock\x20for\x20device\x20','getOwnPropertyDescriptor',']\x20QR\x20code\x20is\x20transferred\x20for\x20withdrawal\x20','\x20after\x204\x20attempts.\x20Response:\x20','network','ocr=','DeviceController','BAD_REQUEST','https://api-hn.botpro.world/payment',']\x20-\x20Clicking\x20bank\x20at\x20coordinates\x20(','onModuleInit','NestFactory','folderCreationInProgress','Dcsvnqvmn1','entries','eval','markAsCompleted','\x20status\x20to\x20','setex','Full\x20screen','PG_ROI_EXPECTED','ROI:\x20x=','executeExternalTransfer','_id','\x20box','VERIFY_ACCOUNT_NAME','api/devices/:deviceId/retryLogin','releaseWorker','charWhitelist','This\x20key\x20can\x20dismiss\x20keyboard\x20or\x20submit/enter\x20depending\x20on\x20context','testClickAtCoordinates','inputPasswordFromConfig','expire','wsService','registerBankService',':config','unknown','\x20is\x20not\x20active.\x20Please\x20activate\x20the\x20device\x20first.','.\x20Available:\x20','REDIS_SERVICE_STATUS_KEY','design:type','getBillImagePath','QUAN\x20DOI','pointerEvent','extractTransactionAmount','\x20in\x20','name','Failed\x20to\x20reset\x20worker\x20parameters:\x20','\x20(swipe\x20direction,\x20no\x20coordinates)','mtimeMs','swipe','getBankService','ErrorType','customROI','login','FORCE_KILL_APP','width','del','ApiQuery','IsString','SACOMBANK','test/click/:deviceId','ApiParam','Account\x20Name\x20is\x20required\x20when\x20status\x20is\x20active','Pressing\x20shift\x20key\x20on\x20device\x20','maxWaitTime','createTemporaryWorker','Available\x20Amount\x20must\x20be\x20greater\x20than\x20or\x20equal\x20to\x200','pendingRequests','\x20(attempt\x20','PreprocessOptions','config','Error\x20processing\x20withdrawal\x20','Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)','offset','ScheduleModule','boxType','lastIndexOf','ezpayBe','Available\x20Amount\x20l\x20bt\x20buc\x20v\x20phi\x20>=\x200\x20khi\x20status\x20l\x20active','verifyScreenState','confidence','size','endX','lang','getJobs','withdrawalQueue','UpdateDeviceConfigDto','Recorded\x20login\x20session\x20for\x20device\x20','value\x20cannot\x20be\x20empty','acquireWorker','inUse','Successfully\x20uploaded\x20bill\x20for\x20withdrawal\x20','errorType','validateROI','worker','7979OblMVY','Pressing\x20shift\x20key\x20for\x20uppercase\x20letter\x20\x27','GPBANK','withdrawal:processed:','OCR_MAX_WIDTH_SINGLE','logger','isDestroyed','data','__decorate','LOGIN_BTN','\x20attempts).\x20Expected:\x20[','recognizeFromBuffer','default','metadata','rawPath','Password\x20not\x20configured\x20for\x20device\x20','ttl','pressShiftKey','redis','K82766678488957','toUpperCase','280CgYOTE','PG_UI_COORDINATES','SHINHAN\x20BANK',',\x20Retrying\x20in\x20','grayscale','Inject','OCRModule','maxWidth','14.225.44.234','deviceLock','uHqE5X9H0QEBsqlZpdTHG0fOyvmMtHjCGgsG4ouls3Gz9WvaWg4w9HV3sqETGWfE','3692280wedtEO','Get\x20withdrawal\x20queue\x20statistics','ApiResponse','https://apipro2.ocr.space/parse/image','ms\x20>\x201000ms\x20(p95\x20target)','log','CONTINUE_TRANSFER_BTN','initializationPromise','Service\x20status\x20initialized\x20to:\x20inactive','catch','Failed\x20to\x20create\x20base\x20folder\x20','TEMPORARY','apiUrl','DeviceLockService','\x20on\x20device\x20','cwd','api/service/stop','ValidateIf','getAvailableDevices','inputNumpadNumber','1280AWblef','Method\x20not\x20implemented.','Invalid\x20ROI\x20y:\x20','BankModule','setDescription','exports','testCaptureScreen','substring','BaseBankService','terminateAll','buffer','BankService','serial','_sendRequestOnce','prototype','timeout','getClient','queue/debug','ocr','4717088fOjepd','Redis\x20Client\x20Error','scan_','endsWith','then','processing','replace','unlink','clickAndWaitForScreen','ACCOUNT_NUMBER_INPUT','patch','BUNDLE_ID','RETURN_KEY','env','reconnectAttempts','isAcquiring',']\x20-\x20Entering\x20OTP','OCR\x20service\x20is\x20destroyed','/docs','.png','trim','test/press-return/:deviceId','qr_','\x20is\x20being\x20processed\x20by\x20another\x20instance','connection','releaseLockByType','HttpException','warn',']\x20-\x20Error\x20uploading\x20receipt\x20for\x20','VIETBANK','Screen\x20capture\x20name\x20(optional)','withdrawal-request-','TRANSFER_INTERNAL_BTN','type','beneficiaryAccountNo','ACB\x20executeExternalTransfer','OCRWorkerPoolService','home','Error\x20getting\x20devices:\x20','No\x20bill\x20image\x20path\x20','lastUsed','updateDeviceConfig','\x20is\x20not\x20locked,\x20nothing\x20to\x20release','Injectable','EZZPAY_KEY','mkdir','Invalid\x20withdrawal\x20data\x20in\x20job\x20',',\x20cannot\x20pick\x20jobs','getBillImage','number','Failed\x20to\x20update\x20device\x20config','Get','s\x20ti\x20khon','Folder\x20path\x20is\x20null\x20or\x20empty','isLocked','Successfully\x20processed\x20and\x20removed\x20withdrawal\x20','getDeviceConfig','height','\x20as\x20logging\x20in','password','full','\x20Device\x20management:\x20http://localhost:','UNKNOWN','NCB','\x20not\x20supported,\x20cannot\x20analyze\x20transfer\x20bill','bankCode','OCR_ROI_SINGLE_X','processWithdrawal','refreshSessionIfNeeded','split','\x20(must\x20be\x200-1)','port','For\x20Panda\x20format:\x20type\x20is\x20required','maxReconnectAttempts','VIETCOMBANK','Error\x20getting\x20device\x20config\x20for\x20','matchedTexts','PgService','CIMB','PandaWebSocketService','ms)','test/input-numpad/:deviceId','setup','random','host','Image\x20quality\x20(0-1,\x20default:\x200.5)','Updated\x20device\x20config\x20for\x20','delay','PANDA','classifyError','Unexpected\x20status\x20code\x20','\x20|\x20','4181484Ylrwdp','QR_CODE_BTN','BACK_TO_HOME','Error\x20processing\x20job\x20','FORCE_LOGIN',']\x20-\x20Error\x20updating\x20withdrawal\x20status\x20for\x20','BILL_IMAGE_EXTENSIONS','expiresAt','EXTERNAL_AMOUNT_INPUT','\x27\x20at\x20(','No\x20OCR\x20result\x20found\x20for\x20','Processing\x20withdrawal:\x20','Module','\x20(min:\x20','HcBoxService','ApiOperation','TRANSFER_BTN','Failed\x20to\x20terminate\x20temporary\x20worker:\x20','Completed\x20login\x20process\x20for\x20all\x20active\x20banks','createQRCodeAndTransferTo','api/withdrawal','allSettled','):\x20','RedisService','\x20as\x20failed:\x20','/4):\x20','api/devices/:deviceId/config','\x20for\x20bank:\x20','text','get','EEXIST','min','ValidationPipe','pool','hget','Bank\x20Code\x20is\x20required\x20when\x20status\x20is\x20active','waiting','HttpStatus','quality','REDIS_SESSION_PREFIX','isConnected','Query','StatusCode','ezpayBeClient','Error\x20getting\x20service\x20status:\x20','getDevices','killApp','analyzeTransferBill','ocrConfig','Insufficient\x20amount\x20for\x20device\x20','Bank\x20service\x20not\x20found\x20for\x20bank\x20code:\x20','getBankBundleId','Killing\x20','response','Acquired\x20','parse','getCompletedCount','processingTime','deviceService','withdraw:','disconnect','sendRequest','isSessionValid','Executing\x20PG\x20transfer\x20for\x20withdrawal\x20','jobManagerService','\x20mode\x20for\x20character\x20\x27','mtime','IsOptional','design:paramtypes','Failed\x20to\x20login\x20','connect','baseTransactionExecutionFolder','shift','chuyn\x20tin\x20thnh\x20cng','%,\x20time:\x20','Warming\x20up\x20OCR\x20worker\x20pool\x20(size:\x20','processingJobs','Lock\x20for\x20device\x20','devices','Bank\x20operations','forbidden','ACB','fromEntries','defineProperty','next','TRANSFER_EXTERNAL_BTN','Shift\x20key\x20pressed\x20successfully\x20on\x20device\x20','ceil','toString','Keyboard\x20mode\x20switched\x20successfully\x20on\x20device\x20','Clicking\x20password\x20field\x20on\x20device\x20','AcbService','refreshSessions','bankService','Number\x20must\x20contain\x20only\x20digits\x20(0-9)','ready','1022250QxIUJr','postprocessText','not\x20set','Testing\x20HC\x20swipe\x20from\x20(','amount','Logger','BANK_SEARCH_INPUT','Device\x20',']\x20-\x20Clicking\x20transfer\x20button\x20at\x20coordinates\x20(','.\x20Response:\x20','redisClient','manualRetryCount','271368IJZoSX','analyzedStatus','executeInternalTransfer','set','releaseLock','length','recognizeFromFile','Error\x20inputting\x20password\x20from\x20config\x20for\x20device\x20','temporary','ABANK','map','availableAmount','Worker\x20','Error\x20picking\x20jobs:\x20','busy','OCR_POOL_SIZE\x20(','Param','IWebSocketService',',\x20bank\x20','triggerPickJobs','bank:session:','BANK_CODE','uploadFile','Click\x20completed\x20successfully\x20at\x20coordinates\x20(','acbService','WithdrawalProcessingError','com.vietcombank.mobilebanking','needsRefresh',')\x20on\x20device\x20','Updating\x20withdrawal\x20','INTERNAL_SERVER_ERROR','.\x20Retry\x20attempt:\x20','application/json','getServiceStatus','REDIS_LOCK_PREFIX','COMPLETED_TTL','SHIFT_KEY','accountName','withdrawalId','SELECT_IMAGE_QR_CODE_BTN','__esModule','getSessionTimeout','Panda\x20swipe\x20completed\x20successfully\x20on\x20device\x20','\x20as\x20processing','workerPoolService','filter','removeVietnameseTones','7689500DIsgUS','recognize','isLetter','SessionManagementService','DeviceService','Cron','push','REDIS_DEVICE_CONFIG_SUFFIX','VPBANK','Received\x20unsolicited\x20device\x20list\x20update\x20(no\x20pending\x20requests):\x20',']\x20-\x20Clicking\x20transfer\x20external\x20button\x20at\x20coordinates\x20(','getLock','join','withdrawal','OCRService','Failed\x20to\x20upload\x20bill\x20for\x20withdrawal\x20','captureScreen','Error\x20releasing\x20lock\x20for\x20device\x20','isSpecialCharInNumberMode','REDIS_PROCESSED_PREFIX','loginAllActiveBanks','getQueueStats','Failed\x20to\x20warm\x20up\x20worker\x20pool:\x20','omit','existsSync','Raw\x20message\x20was:\x20','BANK_SEARCH_BTN','Testing\x20','hasActiveDevice','debugQueue','active','WithdrawalModule','Error\x20deducting\x20amount\x20for\x20device\x20','terminate','toLowerCase','__metadata','Text\x20is\x20required\x20and\x20cannot\x20be\x20empty','keys','maxPoolSize','click','smartOTP','close','floor','processRequestQueue','HcBoxModule','sleep','HttpService','pressReturnKey','redisService','service:status','Queue','round','Return\x20key\x20pressed\x20successfully\x20on\x20device\x20','updateWithdrawalStatus','device:lock:','IsIn','__param','forRoot','PERMANENT','inputText','getSession','Test\x20swiping\x20on\x20a\x20device.\x20Format\x20is\x20determined\x20by\x20config.boxType\x20(HC\x20or\x20PANDA)',',\x20retrying...','test','testLaunchApp','folderPath','isProcessingRequest','status','listDevices',']\x20-\x20Clicking\x20continue\x20transfer\x20button\x20at\x20coordinates\x20(','isInitializing','1200','views',']\x20-\x20Clicking\x20transfer\x20internal\x20button\x20at\x20coordinates\x20(','error','some','logged_in','launchApp','ACB_UI_COORDINATES','coordinates','deactive','\x20attempts)','Error\x20clicking\x20login\x20button\x20on\x20device\x20','.\x20Error\x20Type:\x20','\x20lock\x20for\x20device\x20','/test/swipe/{deviceId}?type=0','Released\x20lock\x20for\x20device\x20','stack','udid','function','queue/stats'];a0_0x49ff=function(){return _0x248fc2;};return a0_0x49ff();}
//# sourceMappingURL=main.js.map
//# sourceMappingURL=main.js.map