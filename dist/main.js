function a0_0x23a4(_0x414f8,_0x1a72d8){_0x414f8=_0x414f8-0x15b;const _0x15ef95=a0_0x15ef();let _0x23a4d5=_0x15ef95[_0x414f8];return _0x23a4d5;}function a0_0x15ef(){const _0x78aa19=['xiaowei_iphone.exe','hasAnyLockKeys','Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)','BaseBankService','floor','Error\x20extracting\x20transaction\x20amount:\x20','stopApp','full','Inject','refreshSessionIfNeeded','apiUrl','Error\x20processing\x20','Unexpected\x20status\x20code\x20','decorate','text','deviceLock','VCB_UI_COORDINATES','Marked\x20withdrawal\x20','uHqE5X9H0QEBsqlZpdTHG0fOyvmMtHjCGgsG4ouls3Gz9WvaWg4w9HV3sqETGWfE','inactive','roi','escapePs','photo','disable_notification','queue/debug','TPBANK','BankController','\x20-\x20device\x20is\x20locked','NotificationModule','Asia/Ho_Chi_Minh','pool',',\x20Required:\x20','TelegramService','isInitialized','REDIS_PWD','PORT','duration','com.techcombank.mobilebanking','VERIFY_ACCOUNT_NUMBER','processingJobs','setTitle','httpService','Telegram\x20request\x20failed:\x20','shift','REDIS_DEVICE_CONFIG_SUFFIX','ocrConfig','onModuleDestroy','access\x20is\x20denied','set','ACB_UI_COORDINATES','needsRefresh','ready','testLaunchApp','processingTime','map',']\x20Failed\x20to\x20detect\x20screen\x20after\x203\x20swipe\x20attempts','handleMessage','normalize','ms,\x20pollInterval:\x20','\x0a<b>To:</b>\x20','C:/EasyTrx','hgetall','Text\x20input\x20completed\x20successfully','sourceAccountNo','WithdrawalStatus','number','\x20is\x20already\x20being\x20processed\x20by\x20another\x20instance','quality','SHIFT_KEY','getClient','includes','HSBC','createTransactionFolder','zadd','opts',',\x20amount:\x20','logging_in',',\x20lang:\x20','ms:\x20','ErrorType','description','Found\x20latest\x20bill\x20image:\x20',']\x20Error\x20verifying\x20screen\x20(attempt\x20','errorType','EVERY_5_SECONDS','COMPLETED_TTL','_sendRequestOnce','verifyScreenState','EXIMBANK','acquireLock','ocrRecognize','PgService','322vBplzS','safeErr','K·∫øt\x20qu·∫£\x20giao\x20d·ªãch',',\x20Timeout:\x20','testRoi','forceKillWithPowerShell','terminate','entries','onModuleInit','hint','Text\x20is\x20required\x20and\x20cannot\x20be\x20empty','tryAcquireFromPool','\x20for\x20bank:\x20','KEYBOARD_SWITCH','ƒê√£\x20x√≥a\x20folder\x20','firstValueFrom','mkdir','processWithdrawal','clickAndWaitForScreen','processing','getBillImagePath','Error\x20checking\x20processed\x20status\x20for\x20','fieldType','\x20not\x20found\x20or\x20not\x20configured','object','Logger','Screen\x20captured\x20successfully\x20on\x20device\x20','jobId','Successfully\x20updated\x20withdrawal\x20','redisLockService','bankServices','no\x20tasks\x20are\x20running','Module','\x20attempts','lockType','stopService','disableNotification','poolSize','requestQueue','Get-Process\x20-Name\x20\x22','data','worker','code','design:type','reject','Full\x20screen','round','/test/input-numpad/{deviceId}?number=123456','WithdrawalJobManagerService','QR_CODE_BTN','processRequestQueue','api/devices','setex','mtimeMs','IsNumber','VIB','REDIS_SESSION_PREFIX','377518TYIvms','MIN_DIMENSION','stat','vietcombankService','getBankBundleId','OCR_WHITELIST_SINGLE','SWIPE_UP_SCREEN','backoffMs','27Zhfuzx','smartOTP','ImagePreprocessingService','grayscale','AcbService','from','scaleCoordinates','clickWithTransition','\x27\x20at\x20(','SessionManagementService','BAD_REQUEST','Giao\x20d·ªãch\x20th√†nh\x20c√¥ng','sleep','transferCode','manualRetryCount','error','Testing\x20numpad\x20number\x20input\x20\x22','stack','bankCode',',\x20h=',')\x20exceeds\x20maximum\x20(','login','letter',']\x20-\x20Get\x20image\x20library\x20screen','hdBankService','parseMode',').\x20Matched\x20texts:\x20[',']\x20Assigned\x20device\x20has\x20insufficient\x20amount.\x20Available:\x20','cannot\x20find\x20a\x20process','FORCE_LOGIN_AND_REQUEUE','exports','ms\x20(','\x20or\x20','test/click/:deviceId',']\x20-\x20Get\x20Transaction\x20confirm\x20screen','InjectQueue','captureStackTrace','accountName','\x20|\x20','forwardRef','SHB','token','189681CeVsqp','size','lockedBy','\x20as\x20completed:\x20','endX','swipe','getDevicesPage','\x20OCR\x20workers...','DeviceLockService','isRetryable','HC\x20BOX\x20WebSocket\x20connected',']\x20-\x20Error\x20updating\x20withdrawal\x20status\x20for\x20','timestamp','listDevices','SYSTEM_LOCK_BOXPHONE','WithdrawalController','EzPay\x20Auto\x20API','HD_SCREEN_HINT_NAME','SmartOTP\x20not\x20configured\x20for\x20device\x20','HDBANK','For\x20Panda\x20format:\x20type\x20is\x20required','Transaction\x20verification\x20screen\x20not\x20found','Panda\x20BOX\x20WebSocket\x20connected','\x20-\x20','psm','Received\x20unsolicited\x20device\x20list\x20update\x20(no\x20pending\x20requests):\x20','X\x20coordinate\x20(HC:\x200-1,\x20Panda:\x200-100).\x20Required\x20for\x20HC\x20and\x20Panda\x20types\x200,1,2,10.\x20Optional\x20for\x20Panda\x20types\x204,5,6,7,8,9','has','\x20in\x20','WindowsAppGitBashService','isSessionValid','WithdrawalService','setBaseViewsDir','_id','withdrawalId','Views\x20directory:\x20','WebSocketModule','resolve','type',')\x20on\x20device:\x20','\x20status\x20to\x20','detectScreenByHint','Invalid\x20coordinates.\x20x\x20and\x20y\x20must\x20be\x20numbers\x20between\x200\x20and\x201','FAILED','deactive','\x20(attempt\x20','deviceId','debug','PG_ROI_EXPECTED','replyToMessageId','replace','startService','recognizeFromFile','api/devices/:deviceId/config','patch','warn','SCROLL_UP','Testing\x20HC\x20swipe\x20from\x20(','getWithdrawalDetails','readdir','.\x20Error\x20Type:\x20','folderCreationInProgress','updateDeviceConfig','ROI\x20extends\x20beyond\x20image:\x20x(','stripBase64Prefix',',\x20retrying...','PERMANENT','toUpperCase','HCWebSocketService','OCR_POOL_SIZE','amount','ocrService','ECONNRESET','pressReturnKey','mkdirSync','closeMainWindow','ƒêƒÉng\x20nh·∫≠p','Injectable','Retry\x20login\x20requested\x20for\x20device\x20','home','createQRCodeAndTransferTo','unknown','scheduleReconnect','.png','__esModule','devices','udid','redis','test','vi-VN','sendRequest','Failed\x20to\x20refresh\x20session\x20for\x20device\x20','access\x20denied','hcbox','com.vietcombank.mobilebanking','BVBANK','\x20(swipe\x20direction,\x20no\x20coordinates)','ANALYZE_BILL_ROI','close',',\x20timeout:\x20','Invalid\x20ROI\x20height:\x20','ALBUM_SCREEN','REDIS_LOCK_PREFIX','isNil','ScheduleModule','ceil','deviceLockService','isInitializing','TRANSACTION_SUCCESS','add','wda-request','inputPasswordFromConfig','inputText','t√†i\x20kho·∫£n',']\x20Failed\x20to\x20debug\x20OCR:\x20','NODE_ENV','expire','Transfer\x20is\x20paused\x20by\x20admin\x20temporarily!','C:/Users/Public/Desktop/ÊïàÂç´ËãπÊûúÊäïÂ±è.lnk','pendingRequests','HttpModule','isProcessingRequest','preprocess','CONTINUE_TRANSFER_BTN','getCompletedCount','ApiQuery','com.vcb.VCB',']\x20-\x20Login\x20successfully','eval','End\x20Y\x20coordinate\x20for\x20HC\x20(required\x20for\x20HC:\x200-1)','BankCodeWithdrawal','the\x20system\x20cannot\x20find','\x0a\x0a<b>Kh·ªüi\x20ƒë·ªông\x20l·∫°i:</b>\x20','sendMessage','width','Query','Error\x20setting\x20service\x20status:\x20','EzpayBeClientService','DeviceService','HC\x20BOX\x20WebSocket\x20closed','WEBSOCKET_SERVICE','Added\x20','ValidateIf','inputSmartOTPFromConfig','pickAndProcessJobs','Invalid\x20box\x20type\x20configuration:\x20','decodeImage','delay','postprocess=','markAsCompleted','Failed\x20to\x20update\x20withdrawal\x20','__metadata','AGRIBANK','stderr','Post','OCB','/api/bank/','testPressReturn','\x27,\x27/T\x27\x20-Verb\x20RunAs\x20-Wait\x20-WindowStyle\x20Hidden','Error\x20refreshing\x20session\x20for\x20device\x20','Body','cloneDeep','OCR_ROI_SINGLE_Y','jobManagerService','restartPandaBoxPeriodically','now','customROI','\x20(must\x20be\x200-1)','toLocaleString','Promote\x20skipped\x20for\x20job\x20','.\x20Must\x20be\x20\x27HC\x27\x20or\x20\x27PANDA\x27','registerBankService','mobileapp.acb.com.vn',']\x20-\x20Get\x20Transaction\x20verify\x20screen','launchApp','pickFromZSet','OCR_PSM_SINGLE','TEMPORARY','fromEntries','trim','promoteDelayedJobsPeriodically','Error\x20listing\x20devices:\x20','availableAmount','PANDA','status','],\x20Expected:\x20[','test/input-numpad/:deviceId','getJobs','\x20after\x204\x20attempts.\x20Response:\x20','triggerPickJobs','build','ocr','name','Redis\x20Client\x20Connection\x20Closed','PreprocessOptions','__param','catch','maxWaitTime','HcBoxService','maxReconnectAttempts','Y\x20coordinate\x20(HC:\x200-1,\x20Panda:\x200-100).\x20Required\x20for\x20HC\x20and\x20Panda\x20types\x200,1,2,10.\x20Optional\x20for\x20Panda\x20types\x204,5,6,7,8,9','VCB_ROI_EXPECTED','ECONNABORTED','Unknown\x20Telegram\x20error','Connecting\x20to\x20Panda\x20BOX\x20WebSocket:\x20','logTimingBreakdown','WithdrawalJobManagerService\x20initialized,\x20waiting\x205\x20seconds\x20before\x20starting...','Password\x20not\x20configured\x20for\x20device\x20','Test\x20clicking\x20at\x20specific\x20coordinates\x20on\x20a\x20device','deductDeviceAmount','createWorker','postprocessText','146488BQlEDu',':meta','baseTransactionExecutionFolder','ezpayBe','\x20attempts).\x20Expected:\x20[','COMPLETED',']\x20Error\x20checking\x20lock\x20status:\x20','Testing\x20press\x20return\x20key\x20on\x20device:\x20','restartBoxphone','deviceService','ws://127.0.0.1:26608','create','SELECT_IMAGE_QR_CODE_BTN','matchedTexts','NAMABANK','Error\x20testing\x20swipe:\x20','No\x20devices\x20found!','getDeviceConfig','HD_UI_COORDINATES','HTML','prototype','filter','splice','Transaction\x20verify\x20screen\x20not\x20found','üöÄ\x20EzPay\x20Auto\x20is\x20running\x20on:\x20http://localhost:','Invalid\x20ROI\x20width:\x20','screen','Pressing\x20shift\x20key\x20on\x20device\x20','/3\x20-\x20OCR\x20detected\x20text:\x20\x22','Get','design:returntype','HttpService','WithdrawalProcessingError','IsOptional','mtime','getLock','swipeAndWaitForScreen','lastUsed','Error\x20starting\x20service:\x20','Clicking\x20password\x20field\x20on\x20device\x20','debugQueue','PowerShell\x20kill\x20with\x20admin\x20failed,\x20trying\x20taskkill:\x20','Transfer\x20execution\x20completed\x20for\x20withdrawal\x20','ACB\x20executeTransferWithQRCode','EZZPAY_BE','windowsAppGitBashService','\x20attempts).\x20Expected:\x20Find\x20[','restartApp','withCronLock','pgbankApp.pgbank.com.vn','Device\x20ID','uploadReceipt','isNumber','SEABANK','executeTransferWithQRCode','CONTINUE_OTP_VERIFY_BTN','existsSync','unlink','port','22gEeCKL','findIndex','isArray','caption','OCRWorkerPoolService','rois','disconnect','Job\x20picking\x20triggered','OCRService','waitForWorker','defaultChatId','OCR_ROI_BLOCK_WIDTH','Error\x20getting\x20device\x20config\x20for\x20','\x20at\x20coordinates\x20(','Service\x20status\x20initialized\x20to:\x20inactive','hget','test/swipe/:deviceId','Created\x20base\x20folder:\x20','getBankService','IsNotEmpty','Start-Process\x20powershell\x20-ArgumentList\x20\x27-NoProfile\x27,\x27-ExecutionPolicy\x27,\x27Bypass\x27,\x27-Command\x27,\x22','PENDING','OCR\x20worker\x20pool\x20warmed\x20up\x20successfully\x20in\x20','message','triggerJobPicking','Invalid\x20coordinates.\x20x\x20and\x20y\x20must\x20be\x20between\x200\x20and\x20100\x20for\x20Panda','application/json','Return\x20key\x20pressed\x20successfully','Device\x20config\x20deleted\x20successfully','COMMON_COORDINATES','test/roi','terminateAll','loginAllActiveBanks','validateROI','createdAt','1961284tuYWsh','DEFAULT_LOCK_TTL','accountNo','boxType','K82766678488957','base64,','Image\x20quality\x20(0-1,\x20default:\x200.5)','active','Kh√¥ng\x20th·ªÉ\x20x√≥a\x20folder:\x20','device:lock:','Scanning\x20folder\x20for\x20bill\x20image:\x20','hset','Controller','\x20on\x20device\x20','keys','cleanupFolder','env','SACOMBANK','Invalid\x20image\x20dimensions:\x20width\x20or\x20height\x20is\x200','KIENLONGBANK','\x20when\x20updating\x20withdrawal\x20','reconnectDelay','hasActiveDevice','OCR_ROI_SINGLE_X','isConnected','inputNumpadNumber','\x22\x20/FO\x20CSV\x20/NH','üöÄüöÄüöÄ\x20<b>Boxphone\x20software(local\x20dev)...</b>','toLowerCase','redisService','RedisLockModule','BANK_SESSION_CONFIGS','Error\x20marking\x20withdrawal\x20',']\x20Starting\x20screen\x20verification.\x20Expected:\x20[','scan',']\x20-\x20Get\x20back\x20to\x20home\x20screen','del','__decorate','length','buffer','VIETINBANK','getHeaders','Error\x20sending\x20telegram\x20message','maxPoolSize','getROIConfig','HD_ROI_EXPECTED','\x0aif\x20redis.call(\x22GET\x22,\x20KEYS[1])\x20==\x20ARGV[1]\x20then\x0a\x20\x20redis.call(\x22DEL\x22,\x20KEYS[2])\x0a\x20\x20return\x20redis.call(\x22DEL\x22,\x20KEYS[1])\x0aelse\x0a\x20\x20return\x200\x0aend\x0a','.\x20Retrying\x20login...','UpdateDeviceConfigDto','Error\x20getting\x20service\x20status:\x20','\x20was\x20locked\x20after\x20assignment,\x20skipping\x20job\x20','isRestartingBoxphone','rawPath','ENTER_OTP','Registered\x20bank\x20service:\x20','BankModule','createBillFolder','http','notificationService','G888CWKP2Y06X','withdrawalQueue','REDIS_HOST','SYSTEM_LOCK_PAUSE_PROCESSING','defineProperty','\x20available\x20devices.\x20Picking\x20','\x20VND\x20(confidence:\x20','metadata','REDIS_PROCESSED_PREFIX','beneficiaryName','config','startTarget','tasklist\x20/FI\x20\x22IMAGENAME\x20eq\x20','value\x20cannot\x20be\x20empty','ti·∫øt\x20ki·ªám','telegramService','OCR_MAX_WIDTH_BLOCK','com.tpbank.mobilebanking','OCR_ROI_SINGLE_WIDTH','isLocked','acquireWorker','getRefreshBeforeTime','Found\x20','\x20error:\x20','max','stringify','NO_BILL_AFTER_OTP','For\x20HC\x20format:\x20x,\x20y,\x20endX,\x20and\x20endY\x20are\x20required','endsWith','markAsFailed','DeviceController','sessionTimeoutMs','\x20when\x20uploading\x20bill\x20for\x20withdrawal\x20','log','Error\x20sending\x20telegram\x20photo','Automated\x20withdrawal\x20processing\x20service\x20with\x20HC\x20BOX\x20integration','Error\x20logging\x20in\x20on\x20device\x20','Service\x20status\x20set\x20to:\x20','NUMPAD_LAYOUT','5774388RKTXnt','validateObjectResult','click','Process\x20not\x20found\x20(expected):\x20','apiKey','deleteDeviceConfig','chat_id','Failed\x20to\x20extract\x20transaction\x20amount\x20from\x20ROI','\x20device(s)','Cron','getServiceStatus','connect','LAUNCH_APP','testInputNumpadNumber','VIETABANK','UNKNOWN','\x20with\x20type=','password','OCRModule','2241630ftVKtB',']\x20Failed\x20to\x20cleanup\x20folder:\x20','\x20at\x20(','acbService',',\x20bank\x20','PROCESSING','function','WebSocket\x20error:\x20','StatusCode','parse','RedisService',']\x20Device\x20is\x20already\x20locked,\x20cannot\x20acquire\x20lock','Start-Process\x20-FilePath\x20\x27','Error\x20checking\x20active\x20devices:\x20','1600650WAusdO','WindowAppModule','sessionManagement','join','removeVietnameseTones','):\x20','logger','cwd','PG_UI_COORDINATES','ApiParam','Extracted\x20transaction\x20amount:\x20','OCR_ROI_BLOCK_X','VIETBANK','HttpException','üÜò\x20<b>Devices\x20disconnected:\x20','HOME_ICON','Worker\x20','Queue','next','IWebSocketService','HcBoxModule','Panda\x20BOX\x20error:\x20','FIRST_IMAGE_BTN','getOwnPropertyDescriptor','test/input-text/:deviceId','reconnectAttempts','Executing\x20HDBank\x20transfer\x20for\x20withdrawal\x20','OCR_POOL_SIZE\x20(','SessionRefreshScheduler','redisClient','crop','ms)','analyzedStatus','PandaWebSocketService','device','Panda\x20pointer\x20event\x20type:\x200=Êåâ‰∏ã(press),\x201=Êä¨Ëµ∑(lift),\x202=ÁßªÂä®(move),\x204=ÊªöËΩÆÂêë‰∏ä(scroll\x20up),\x205=ÊªöËΩÆÂêë‰∏ã(scroll\x20down),\x206=‰∏äÊªë(swipe\x20up),\x207=‰∏ãÊªë(swipe\x20down),\x208=Â∑¶Êªë(swipe\x20left),\x209=Âè≥Êªë(swipe\x20right),\x2010=ÁÇπÂáª(click).\x20Required\x20for\x20Panda\x20format.','ACB','HttpStatus','SCROLL_DOWN','updateWithdrawalStatus','get','üÜòüÜòüÜò\x20Connection\x20Error\x0a\x0a<b>K·∫øt\x20n·ªëi\x20v√†o\x20boxphone\x20software\x20th·∫•t\x20b·∫°i.</b>\x0a<b>Max\x20retry:</b>\x20','push','PGBANK','LOGIN_BTN','fullPath',']\x20Error\x20deleting\x20device\x20config:\x20','Failed\x20to\x20release\x20transfer\x20lock\x20for\x20device\x20','ki·ªÉm\x20tra\x20v√†\x20x√°c\x20nh·∫≠n','normalizeBankAccountName','info:','WebSocket\x20is\x20not\x20connected,\x20cannot\x20pick\x20jobs','withdrawal-request-','indexOf','/test/swipe/{deviceId}?type=0','height','confidence','\x20(ROI:\x20','executeTransfer','wsService','Process\x20still\x20running\x20after\x20','getWaitingCount','min','ApiOperation','isConnectedStatus','initializationPromise','Width','RETRY','/test/swipe/{deviceId}?x=50&y=30&type=','powershell\x20-NoProfile\x20-ExecutionPolicy\x20Bypass\x20-Command\x20\x22','VPBANK','RedisLockService','handleJobFailure','Switching\x20keyboard\x20mode\x20on\x20device\x20','getSessionTimeout','IMAGE_LIBRARY_BTN','WDA\x20','killApp','OTP_ENTER','Error\x20testing\x20','\x20after\x20','msg=','VIETCOMBANK','X\x20coordinate\x20(HC:\x200-1,\x20Panda:\x200-100)','lang','NotificationService','Max\x20reconnection\x20attempts\x20reached','ApiTags','sort','append','design:paramtypes','isDestroyed','BankService','isAcquiring','\x20|\x20Expected:\x20[','FORCE_LOGIN_NO_REQUEUE',']\x20Start\x20detecting\x20screen.\x20Screen:\x20[','open','exists',')\x20>\x201','getSupportedBanks','captureScreen','CronExpression','Telegram\x20form\x20request\x20failed,\x20retrying\x20in\x20','Param','HdBankService','taskkill\x20/F\x20/IM\x20\x22','ApiResponse','Invalid\x20withdrawal:\x20missing\x20','value',']\x20-\x20Get\x20Verified\x20account\x20name\x20screen','AppModule','tessedit_pageseg_mode','INTERNAL_SERVER_ERROR','recordLogin','toString','PASSWORD_FIELD','bankService','withdrawalCode','testClickAtCoordinates',']\x20Deleted\x20device\x20config','Redis\x20Client\x20Disconnected','waitingQueue','Failed\x20to\x20upload\x20bill\x20for\x20withdrawal\x20','pressShiftKey','ValidationPipe','HD_SCREEN_OTP_HINT'];a0_0x15ef=function(){return _0x78aa19;};return a0_0x15ef();}(function(_0x1792dc,_0x404383){const _0x2042d5=a0_0x23a4,_0x3066ef=_0x1792dc();while(!![]){try{const _0x5275a0=-parseInt(_0x2042d5(0x36b))/0x1+parseInt(_0x2042d5(0x1b1))/0x2*(parseInt(_0x2042d5(0x39d))/0x3)+parseInt(_0x2042d5(0x1d4))/0x4+parseInt(_0x2042d5(0x257))/0x5+parseInt(_0x2042d5(0x236))/0x6+parseInt(_0x2042d5(0x332))/0x7*(-parseInt(_0x2042d5(0x176))/0x8)+parseInt(_0x2042d5(0x373))/0x9*(-parseInt(_0x2042d5(0x249))/0xa);if(_0x5275a0===_0x404383)break;else _0x3066ef['push'](_0x3066ef['shift']());}catch(_0x3f75cf){_0x3066ef['push'](_0x3066ef['shift']());}}}(a0_0x15ef,0x8ca21),((()=>{'use strict';var _0x4fccc8=[,_0x4faf52=>{_0x4faf52['exports']=require('@nestjs/core');},_0x2606cf=>{const _0x3cfebb=a0_0x23a4;_0x2606cf[_0x3cfebb(0x391)]=require('@nestjs/common');},_0x271a55=>{const _0x1f0338=a0_0x23a4;_0x271a55[_0x1f0338(0x391)]=require('@nestjs/swagger');},_0x5e1ade=>{_0x5e1ade['exports']=require('path');},function(_0x2f8338,_0x459ba5,_0x530777){const _0x480923=a0_0x23a4;var _0x4ba192=this&&this['__decorate']||function(_0x16a94f,_0x38e872,_0x32b8e7,_0x2becd8){const _0x24065d=a0_0x23a4;var _0x5aa448,_0x49301b=arguments[_0x24065d(0x1fa)],_0x2237b0=_0x49301b<0x3?_0x38e872:null===_0x2becd8?_0x2becd8=Object[_0x24065d(0x26e)](_0x38e872,_0x32b8e7):_0x2becd8;if('object'==typeof Reflect&&_0x24065d(0x24f)==typeof Reflect['decorate'])_0x2237b0=Reflect['decorate'](_0x16a94f,_0x38e872,_0x32b8e7,_0x2becd8);else{for(var _0x13a9ba=_0x16a94f[_0x24065d(0x1fa)]-0x1;_0x13a9ba>=0x0;_0x13a9ba--)(_0x5aa448=_0x16a94f[_0x13a9ba])&&(_0x2237b0=(_0x49301b<0x3?_0x5aa448(_0x2237b0):_0x49301b>0x3?_0x5aa448(_0x38e872,_0x32b8e7,_0x2237b0):_0x5aa448(_0x38e872,_0x32b8e7))||_0x2237b0);}return _0x49301b>0x3&&_0x2237b0&&Object[_0x24065d(0x213)](_0x38e872,_0x32b8e7,_0x2237b0),_0x2237b0;};Object[_0x480923(0x213)](_0x459ba5,'__esModule',{'value':!0x0}),_0x459ba5[_0x480923(0x2c6)]=void 0x0;const _0x45a6c1=_0x530777(0x2),_0x3d6a72=_0x530777(0x6),_0xf769fb=_0x530777(0x7),_0x25c004=_0x530777(0x8),_0x4a46ba=_0x530777(0x9),_0x391171=_0x530777(0x47),_0x2c7290=_0x530777(0x49),_0x10faf2=_0x530777(0xf),_0x1eb78f=_0x530777(0x4e),_0x8484bb=_0x530777(0x11),_0x580f3c=_0x530777(0x4c),_0x3c23fe=_0x530777(0x53),_0x3b39b7=_0x530777(0x54),_0x3fed1d=_0x530777(0x56);let _0x339961=class{};_0x459ba5['AppModule']=_0x339961,_0x459ba5['AppModule']=_0x339961=_0x4ba192([(0x0,_0x45a6c1['Module'])({'imports':[_0x3d6a72['BullModule']['forRoot']({'redis':{'host':_0x8484bb['config'][_0x480923(0x3f4)]['host'],'port':_0x8484bb[_0x480923(0x219)]['redis'][_0x480923(0x1b0)],'db':_0x8484bb['config']['redis']['db'],'password':_0x8484bb[_0x480923(0x219)]['redis']['password']},'defaultJobOptions':{'removeOnComplete':0xa,'removeOnFail':0x32,'attempts':0x3,'backoff':{'type':'exponential','delay':0x7d0}}}),_0xf769fb['ScheduleModule']['forRoot'](),_0x25c004[_0x480923(0x415)],_0x4a46ba['WithdrawalModule'],_0x391171['HcBoxModule'],_0x2c7290['DeviceModule'],_0x1eb78f['WebSocketModule'],_0x580f3c[_0x480923(0x20b)],_0x3c23fe[_0x480923(0x248)],_0x3b39b7['NotificationModule'],_0x3fed1d['RedisLockModule']],'providers':[_0x10faf2['RedisService']],'exports':[_0x10faf2[_0x480923(0x253)]]})],_0x339961);},_0x407576=>{_0x407576['exports']=require('@nestjs/bull');},_0x6f967b=>{_0x6f967b['exports']=require('@nestjs/schedule');},_0x1102d2=>{_0x1102d2['exports']=require('@nestjs/axios');},function(_0x371872,_0x41e888,_0x1892f8){const _0x14bbab=a0_0x23a4;var _0x115f96=this&&this['__decorate']||function(_0x3744b1,_0x4efec7,_0x5941e1,_0x34d746){const _0x5e92aa=a0_0x23a4;var _0x3e0d99,_0x44c913=arguments[_0x5e92aa(0x1fa)],_0x5e0531=_0x44c913<0x3?_0x4efec7:null===_0x34d746?_0x34d746=Object[_0x5e92aa(0x26e)](_0x4efec7,_0x5941e1):_0x34d746;if('object'==typeof Reflect&&_0x5e92aa(0x24f)==typeof Reflect['decorate'])_0x5e0531=Reflect['decorate'](_0x3744b1,_0x4efec7,_0x5941e1,_0x34d746);else{for(var _0x20636b=_0x3744b1['length']-0x1;_0x20636b>=0x0;_0x20636b--)(_0x3e0d99=_0x3744b1[_0x20636b])&&(_0x5e0531=(_0x44c913<0x3?_0x3e0d99(_0x5e0531):_0x44c913>0x3?_0x3e0d99(_0x4efec7,_0x5941e1,_0x5e0531):_0x3e0d99(_0x4efec7,_0x5941e1))||_0x5e0531);}return _0x44c913>0x3&&_0x5e0531&&Object['defineProperty'](_0x4efec7,_0x5941e1,_0x5e0531),_0x5e0531;};Object['defineProperty'](_0x41e888,'__esModule',{'value':!0x0}),_0x41e888['WithdrawalModule']=void 0x0;const _0x456617=_0x1892f8(0x2),_0x111367=_0x1892f8(0x6),_0xc3dabc=_0x1892f8(0x7),_0x937290=_0x1892f8(0xa),_0x85cbc1=_0x1892f8(0x38),_0x4f6a1c=_0x1892f8(0x46),_0x63a8e5=_0x1892f8(0x36),_0x59efe9=_0x1892f8(0xf),_0x4fcbf5=_0x1892f8(0x47),_0xf0948d=_0x1892f8(0x49),_0x2be9b7=_0x1892f8(0x4c),_0x332d7a=_0x1892f8(0x8),_0x2461dd=_0x1892f8(0x55);let _0x470003=class{};_0x41e888['WithdrawalModule']=_0x470003,_0x41e888['WithdrawalModule']=_0x470003=_0x115f96([(0x0,_0x456617[_0x14bbab(0x352)])({'imports':[_0x111367['BullModule']['registerQueue']({'name':'wda-request'}),_0xc3dabc[_0x14bbab(0x405)],_0x4fcbf5['HcBoxModule'],(0x0,_0x456617['forwardRef'])(()=>_0xf0948d['DeviceModule']),_0x2be9b7['BankModule'],_0x332d7a['HttpModule'],_0x2461dd[_0x14bbab(0x258)]],'controllers':[_0x4f6a1c[_0x14bbab(0x3ac)]],'providers':[_0x937290[_0x14bbab(0x3bc)],_0x85cbc1[_0x14bbab(0x362)],_0x63a8e5['EzpayBeClientService'],_0x59efe9['RedisService']],'exports':[_0x937290['WithdrawalService']]})],_0x470003);},function(_0x19fa58,_0x16e9c6,_0x5af7a2){const _0x1d5081=a0_0x23a4;var _0x48ecae,_0x2f46b5,_0x4e10db,_0x55dc2f,_0x1f60e2,_0xc8756a,_0x16eecc=this&&this['__decorate']||function(_0x487873,_0x4981ca,_0x453409,_0x246dad){const _0x346439=a0_0x23a4;var _0x3aaeeb,_0x272223=arguments[_0x346439(0x1fa)],_0x2f1e4c=_0x272223<0x3?_0x4981ca:null===_0x246dad?_0x246dad=Object['getOwnPropertyDescriptor'](_0x4981ca,_0x453409):_0x246dad;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x2f1e4c=Reflect['decorate'](_0x487873,_0x4981ca,_0x453409,_0x246dad);else{for(var _0x1cde22=_0x487873['length']-0x1;_0x1cde22>=0x0;_0x1cde22--)(_0x3aaeeb=_0x487873[_0x1cde22])&&(_0x2f1e4c=(_0x272223<0x3?_0x3aaeeb(_0x2f1e4c):_0x272223>0x3?_0x3aaeeb(_0x4981ca,_0x453409,_0x2f1e4c):_0x3aaeeb(_0x4981ca,_0x453409))||_0x2f1e4c);}return _0x272223>0x3&&_0x2f1e4c&&Object['defineProperty'](_0x4981ca,_0x453409,_0x2f1e4c),_0x2f1e4c;},_0x1d84e7=this&&this['__metadata']||function(_0xd3e327,_0x366630){const _0x391e50=a0_0x23a4;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x391e50(0x216)])return Reflect['metadata'](_0xd3e327,_0x366630);},_0x136f4d=this&&this['__param']||function(_0x6f5db6,_0x2b9712){return function(_0x2c6cc7,_0x45cea2){_0x2b9712(_0x2c6cc7,_0x45cea2,_0x6f5db6);};};Object[_0x1d5081(0x213)](_0x16e9c6,_0x1d5081(0x3f1),{'value':!0x0}),_0x16e9c6['WithdrawalService']=void 0x0;const _0xbb5017=_0x5af7a2(0x2),_0x4306b3=_0x5af7a2(0xb),_0x408cf4=_0x5af7a2(0xe),_0x36ce8f=_0x5af7a2(0xf),_0x43c0ed=_0x5af7a2(0xd),_0x3a9175=_0x5af7a2(0x13),_0x58d3c1=_0x5af7a2(0x2a),_0x1f1efc=_0x5af7a2(0x35),_0x3653b0=_0x5af7a2(0x37),_0x463706=_0x5af7a2(0x11),_0x46cc58=_0x5af7a2(0x8);let _0x57f680=class{constructor(_0x1d396c,_0x768baa,_0x205fae,_0x25ee77,_0x420f87,_0x397406){const _0x3ce7e1=_0x1d5081;this[_0x3ce7e1(0x292)]=_0x1d396c,this['bankService']=_0x768baa,this[_0x3ce7e1(0x17f)]=_0x205fae,this[_0x3ce7e1(0x1f1)]=_0x25ee77,this['notificationService']=_0x420f87,this['httpService']=_0x397406,this['logger']=new _0xbb5017['Logger']('WithdrawalService'),this[_0x3ce7e1(0x217)]='withdrawal:processed:',this['PROCESSING_TTL']=0xf731400,this[_0x3ce7e1(0x32b)]=0xf731400;}async['checkIfProcessed'](_0x65651f){const _0x925ff7=_0x1d5081;try{const _0x44745b=''+this['REDIS_PROCESSED_PREFIX']+_0x65651f,_0x428792=await this['redisService']['get'](_0x44745b);return'completed'===_0x428792?(this['logger'][_0x925ff7(0x3d4)]('Withdrawal\x20'+_0x65651f+'\x20already\x20completed'),!0x0):'processing'===_0x428792&&(this['logger']['warn']('Withdrawal\x20'+_0x65651f+'\x20is\x20being\x20processed\x20by\x20another\x20instance'),!0x0);}catch(_0x466da4){return this['logger'][_0x925ff7(0x382)](_0x925ff7(0x347)+_0x65651f+':\x20'+_0x466da4['message']),!0x1;}}async['markAsProcessing'](_0xf4d0d){const _0x1f2b18=_0x1d5081;try{const _0x2eb357=''+this[_0x1f2b18(0x217)]+_0xf4d0d;return'OK'===await this['redisService']['setnx'](_0x2eb357,_0x1f2b18(0x345),this['PROCESSING_TTL'])?(this['logger']['debug']('Marked\x20withdrawal\x20'+_0xf4d0d+'\x20as\x20processing'),!0x0):(this[_0x1f2b18(0x25d)]['warn']('Withdrawal\x20'+_0xf4d0d+_0x1f2b18(0x318)),!0x1);}catch(_0x589c4c){return this['logger'][_0x1f2b18(0x382)](_0x1f2b18(0x1f4)+_0xf4d0d+'\x20as\x20processing:\x20'+_0x589c4c[_0x1f2b18(0x1c8)]),!0x0;}}async[_0x1d5081(0x432)](_0x13d258){const _0xd3b00c=_0x1d5081;try{const _0x40fea9=''+this['REDIS_PROCESSED_PREFIX']+_0x13d258;await this['redisService'][_0xd3b00c(0x306)](_0x40fea9,'completed',this['COMPLETED_TTL']),this['logger']['log'](_0xd3b00c(0x2e7)+_0x13d258+'\x20as\x20completed');}catch(_0x553bd1){this[_0xd3b00c(0x25d)]['error'](_0xd3b00c(0x1f4)+_0x13d258+_0xd3b00c(0x3a0)+_0x553bd1['message']);}}async['markAsFailed'](_0x59c778){const _0x1bcec6=_0x1d5081;try{const _0x5d370f=''+this['REDIS_PROCESSED_PREFIX']+_0x59c778;await this[_0x1bcec6(0x1f1)]['del'](_0x5d370f),this['logger']['log']('Marked\x20withdrawal\x20'+_0x59c778+'\x20as\x20failed\x20(removed\x20from\x20processed\x20list)');}catch(_0x133f08){this['logger']['error'](_0x1bcec6(0x1f4)+_0x59c778+'\x20as\x20failed:\x20'+_0x133f08['message']);}}async[_0x1d5081(0x343)](_0x406cfc,_0xbac8a5){const _0x19ebc6=_0x1d5081,{withdrawalId:_0x18917d,bankCode:_0x9a39df,amount:_0x3435e2}=_0x406cfc;if(await this['checkIfProcessed'](_0x18917d))this[_0x19ebc6(0x25d)][_0x19ebc6(0x3d4)]('Withdrawal\x20'+_0x18917d+'\x20already\x20processed\x20or\x20being\x20processed,\x20skipping');else{if(!await this['markAsProcessing'](_0x18917d)){const _0x34324b='Withdrawal\x20'+_0x18917d+'\x20is\x20being\x20processed\x20by\x20another\x20instance';throw this['logger']['warn'](_0x34324b),new _0x58d3c1['WithdrawalProcessingError'](_0x34324b,_0x58d3c1['ErrorType'][_0x19ebc6(0x44e)]);}try{this[_0x19ebc6(0x25d)]['log']('['+_0xbac8a5+']\x20Processing\x20withdrawal:\x20'+_0x18917d+_0x19ebc6(0x33e)+_0x9a39df+_0x19ebc6(0x321)+_0x3435e2);const _0x6ba231=await this['deviceService']['getDeviceConfig'](_0xbac8a5);if(_0x6ba231['availableAmount']<_0x3435e2){const _0x2f45c7='['+_0xbac8a5+_0x19ebc6(0x38e)+_0x6ba231['availableAmount']+_0x19ebc6(0x2f5)+_0x3435e2;throw this['logger']['error'](_0x2f45c7),await this[_0x19ebc6(0x22c)](_0x18917d),await this['deviceService']['updateDeviceConfig'](_0xbac8a5,{'status':'deactive'}),new _0x58d3c1['WithdrawalProcessingError'](_0x2f45c7,_0x58d3c1['ErrorType']['TEMPORARY']);}await this[_0x19ebc6(0x2cc)]['executeTransferWithQRCode'](_0x406cfc,_0x6ba231,_0x6ba231[_0x19ebc6(0x385)]),this['deviceService']['deductDeviceAmount'](_0xbac8a5,_0x3435e2)[_0x19ebc6(0x166)](()=>{});const _0x802d40=await this[_0x19ebc6(0x2cc)]['analyzeTransferBill'](_0x6ba231['bankCode'],_0x406cfc);this[_0x19ebc6(0x20e)]['completeWithdrawal'](_0x406cfc,_0x802d40,_0x6ba231)['catch'](()=>{}),'unknown'===_0x802d40['analyzedStatus']&&await this[_0x19ebc6(0x2cc)]['login'](_0x6ba231['bankCode'],_0xbac8a5,!0x0),await this['markAsCompleted'](_0x18917d),this[_0x19ebc6(0x25d)][_0x19ebc6(0x230)]('Successfully\x20processed\x20withdrawal:\x20'+_0x18917d);}catch(_0x4348c5){if(await this[_0x19ebc6(0x22c)](_0x18917d),_0x4348c5 instanceof _0x58d3c1['WithdrawalProcessingError'])throw _0x4348c5;throw new _0x58d3c1['WithdrawalProcessingError'](_0x4348c5['message']||'Unknown\x20error',_0x58d3c1[_0x19ebc6(0x325)]['PERMANENT']);}}}async[_0x1d5081(0x3d7)](_0x1c8571){const _0x24caf2=_0x1d5081,_0x4f4d18=_0x463706['config']['ezpayBe'][_0x24caf2(0x2e0)]+'/api/internal/withdrawals/'+_0x1c8571;return(await(0x0,_0x3653b0['firstValueFrom'])(this['httpService']['get'](_0x4f4d18,{'headers':{'Content-Type':_0x24caf2(0x1cb),'X-API-Key':_0x463706[_0x24caf2(0x219)]['ezpayBe']['apiKey'],'x-internal-secret-key':_0x463706['config']['ezpayBe']['apiKey']},'timeout':0x4e20})))[_0x24caf2(0x35a)]['data'];}};_0x16e9c6['WithdrawalService']=_0x57f680,_0x16e9c6[_0x1d5081(0x3bc)]=_0x57f680=_0x16eecc([(0x0,_0xbb5017[_0x1d5081(0x3ea)])(),_0x136f4d(0x0,(0x0,_0xbb5017['Inject'])(_0x43c0ed[_0x1d5081(0x429)])),_0x136f4d(0x2,(0x0,_0xbb5017['Inject'])((0x0,_0xbb5017['forwardRef'])(()=>_0x408cf4[_0x1d5081(0x427)]))),_0x1d84e7(_0x1d5081(0x2b1),[_0x1d5081(0x24f)==typeof(_0x48ecae=void 0x0!==_0x3a9175['IWebSocketService']&&_0x3a9175[_0x1d5081(0x26a)])?_0x48ecae:Object,'function'==typeof(_0x2f46b5=void 0x0!==_0x4306b3['BankService']&&_0x4306b3['BankService'])?_0x2f46b5:Object,'function'==typeof(_0x4e10db=void 0x0!==_0x408cf4[_0x1d5081(0x427)]&&_0x408cf4['DeviceService'])?_0x4e10db:Object,'function'==typeof(_0x55dc2f=void 0x0!==_0x36ce8f['RedisService']&&_0x36ce8f[_0x1d5081(0x253)])?_0x55dc2f:Object,'function'==typeof(_0x1f60e2=void 0x0!==_0x1f1efc['NotificationService']&&_0x1f1efc['NotificationService'])?_0x1f60e2:Object,'function'==typeof(_0xc8756a=void 0x0!==_0x46cc58['HttpService']&&_0x46cc58[_0x1d5081(0x195)])?_0xc8756a:Object])],_0x57f680);},function(_0x496557,_0x41b965,_0x36365b){const _0x5b519d=a0_0x23a4;var _0x1f07ed,_0x1fc16b,_0x4a893b,_0x243522,_0x5edb82,_0x3be56e,_0x32dcc2,_0x96ec65,_0x17b3e3=this&&this['__decorate']||function(_0x440cd6,_0x1f399d,_0x53c1b1,_0x354551){const _0x3f3c37=a0_0x23a4;var _0x5401a6,_0x104ca6=arguments['length'],_0x5da6b8=_0x104ca6<0x3?_0x1f399d:null===_0x354551?_0x354551=Object['getOwnPropertyDescriptor'](_0x1f399d,_0x53c1b1):_0x354551;if('object'==typeof Reflect&&_0x3f3c37(0x24f)==typeof Reflect['decorate'])_0x5da6b8=Reflect[_0x3f3c37(0x2e3)](_0x440cd6,_0x1f399d,_0x53c1b1,_0x354551);else{for(var _0x14eb8b=_0x440cd6[_0x3f3c37(0x1fa)]-0x1;_0x14eb8b>=0x0;_0x14eb8b--)(_0x5401a6=_0x440cd6[_0x14eb8b])&&(_0x5da6b8=(_0x104ca6<0x3?_0x5401a6(_0x5da6b8):_0x104ca6>0x3?_0x5401a6(_0x1f399d,_0x53c1b1,_0x5da6b8):_0x5401a6(_0x1f399d,_0x53c1b1))||_0x5da6b8);}return _0x104ca6>0x3&&_0x5da6b8&&Object['defineProperty'](_0x1f399d,_0x53c1b1,_0x5da6b8),_0x5da6b8;},_0x543141=this&&this[_0x5b519d(0x434)]||function(_0x5e4944,_0x49d11d){const _0x15ab99=_0x5b519d;if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect[_0x15ab99(0x216)](_0x5e4944,_0x49d11d);};Object[_0x5b519d(0x213)](_0x41b965,_0x5b519d(0x3f1),{'value':!0x0}),_0x41b965['BankService']=void 0x0;const _0x55ece7=_0x36365b(0x2),_0x4f22da=_0x36365b(0xc),_0x51e4fd=_0x36365b(0x28),_0x48c88f=_0x36365b(0x2f),_0x412e5d=_0x36365b(0x32),_0xb0fd4c=_0x36365b(0xe),_0x2c4820=_0x36365b(0x34),_0x27a0c3=_0x36365b(0x14),_0x41b9cf=_0x36365b(0x2a),_0x1095fb=_0x36365b(0x2c),_0x47f607=_0x36365b(0x18),_0x3a5285=_0x36365b(0x4),_0x262bd6=_0x36365b(0x1a),_0x23df97=_0x36365b(0x19);let _0x28c510=class{constructor(_0x2b245b,_0x55971d,_0x351d8f,_0x1ee255,_0x8e0b35,_0x5c8d8d,_0x4b45d8,_0x537528){const _0x4ac88c=_0x5b519d;this['acbService']=_0x2b245b,this['pgService']=_0x55971d,this['hdBankService']=_0x351d8f,this[_0x4ac88c(0x36e)]=_0x1ee255,this['deviceService']=_0x8e0b35,this[_0x4ac88c(0x259)]=_0x5c8d8d,this['deviceLock']=_0x4b45d8,this['telegramService']=_0x537528,this[_0x4ac88c(0x25d)]=new _0x55ece7['Logger']('BankService'),this['bankServices']=new Map(),this['registerBankService'](this[_0x4ac88c(0x24c)]),this[_0x4ac88c(0x448)](this['pgService']),this['registerBankService'](this[_0x4ac88c(0x38b)]),this['registerBankService'](this['vietcombankService']);}[_0x5b519d(0x448)](_0x3599b3){const _0x2918cd=_0x5b519d,_0x8c71cb=_0x3599b3['getBankCode']()['toUpperCase']();this['bankServices']['set'](_0x8c71cb,_0x3599b3),this['logger'][_0x2918cd(0x230)](_0x2918cd(0x20a)+_0x8c71cb);}[_0x5b519d(0x1c3)](_0x49114d){const _0x40538e=_0x5b519d,_0x31a8a0=this[_0x40538e(0x350)]['get'](_0x49114d['toUpperCase']());if(!_0x31a8a0)throw new _0x41b9cf['WithdrawalProcessingError']('Bank\x20'+_0x49114d+'\x20not\x20supported!\x20Cannot\x20find\x20bank\x20service\x20out!',_0x41b9cf[_0x40538e(0x325)]['PERMANENT']);return _0x31a8a0;}[_0x5b519d(0x2bb)](){const _0x240d94=_0x5b519d;return Array[_0x240d94(0x378)](this['bankServices']['keys']());}async['login'](_0x4b9b6c,_0x2f7c01,_0x16d7b1=!0x1){const _0x36293f=_0x5b519d;if(_0x16d7b1&&await this['deviceLock']['releaseLock'](_0x2f7c01),await this['deviceLock'][_0x36293f(0x222)](_0x2f7c01)){const _0x411552=await this[_0x36293f(0x2e5)]['getLock'](_0x2f7c01);throw new Error('Device\x20'+_0x2f7c01+'\x20is\x20currently\x20locked\x20by\x20'+_0x411552?.[_0x36293f(0x354)]+'\x20('+_0x411552?.[_0x36293f(0x39f)]+').\x20Cannot\x20login.');}const _0x1fe58d='login:'+_0x4b9b6c+':'+_0x2f7c01+':'+Date['now']();if(!await this[_0x36293f(0x2e5)]['acquireLock'](_0x2f7c01,'login',_0x1fe58d,0x41eb0))throw new Error('Failed\x20to\x20acquire\x20lock\x20for\x20device\x20'+_0x2f7c01);try{await this['sessionManagement']['markLoggingIn'](_0x2f7c01,_0x4b9b6c);const _0x20827f=this[_0x36293f(0x1c3)](_0x4b9b6c);if(!_0x20827f)throw new Error('Bank\x20service\x20not\x20found\x20for\x20bank\x20code:\x20'+_0x4b9b6c);this['logger']['log']('['+_0x2f7c01+']\x20Logging\x20in\x20to\x20'+_0x4b9b6c),await _0x20827f['login'](_0x2f7c01),await this['sessionManagement']['recordLogin'](_0x2f7c01,_0x4b9b6c),this['logger']['log']('['+_0x2f7c01+']\x20Successfully\x20logged\x20in\x20to\x20'+_0x4b9b6c);}catch(_0x57c1a5){throw await this['sessionManagement']['clearSession'](_0x2f7c01,_0x4b9b6c),_0x57c1a5;}finally{await this[_0x36293f(0x2e5)]['releaseLock'](_0x2f7c01);}}async[_0x5b519d(0x1d1)](){const _0xab4e16=_0x5b519d;try{const _0x472e23=0x6,_0x1d27c7=0x2710;let _0x1cbc31=[];for(let _0x502bac=0x0;_0x502bac<_0x472e23&&(this['logger']['log']('['+(_0x502bac+0x1)+'/'+_0x472e23+']\x20Retrying\x20to\x20list\x20devices\x20on\x20login...'),_0x1cbc31=await this[_0xab4e16(0x17f)]['listDevices'](),!(_0x1cbc31['length']>0x0));_0x502bac++)await(0x0,_0x47f607[_0xab4e16(0x37f)])(_0x1d27c7);const _0x56c1ac=await this[_0xab4e16(0x17f)]['listDeviceConfigs'](),_0x3e0a3f=_0x1cbc31['filter'](_0xd5494b=>'active'===_0xd5494b['status']&&_0xd5494b['bankCode']),_0x1fdac2=_0x56c1ac['filter'](_0x11d615=>'active'===_0x11d615['status']&&_0x11d615['bankCode']);if(_0x3e0a3f[_0xab4e16(0x1fa)]<_0x1fdac2['length']){const _0x347448=_0x1fdac2['filter'](_0xb52e19=>!_0x3e0a3f['some'](_0x315fd2=>_0x315fd2['udid']===_0xb52e19[_0xab4e16(0x3cb)])),_0x4da14b=_0x347448[_0xab4e16(0x30c)](_0x1e1e31=>'<b>Bank:</b>\x20'+_0x1e1e31[_0xab4e16(0x385)]+'\x0a<b>Account:</b>\x20'+_0x1e1e31['accountName'])['join']('\x0a\x0a');this[_0xab4e16(0x21e)][_0xab4e16(0x422)]({'text':_0xab4e16(0x265)+_0x347448['length']+'</b>\x0a\x0a'+_0x4da14b,'options':{'parseMode':_0xab4e16(0x189)}});}if(0x0===_0x3e0a3f['length'])return void this['logger']['warn']('No\x20active\x20devices\x20found\x20to\x20login');for(const _0x2c5a68 of _0x3e0a3f){const _0x33a2a3=_0x2c5a68['udid'];try{await this[_0xab4e16(0x2e5)]['releaseLockByType'](_0x33a2a3,'transfer');}catch(_0x540460){this[_0xab4e16(0x25d)]['warn'](_0xab4e16(0x286)+_0x33a2a3+':\x20'+_0x540460['message']);}}const _0xc6b8a2=[];for(const _0x287397 of _0x3e0a3f){const _0x2d17cc=_0x287397[_0xab4e16(0x385)]['toUpperCase'](),_0x4b0d1b=_0x287397[_0xab4e16(0x3f3)];_0xc6b8a2['push'](this['login'](_0x2d17cc,_0x4b0d1b,!0x0)[_0xab4e16(0x166)](_0x18edd1=>{const _0x2ea537=_0xab4e16;this['logger']['error']('Failed\x20to\x20login\x20'+_0x2d17cc+_0x2ea537(0x1e1)+_0x4b0d1b+':\x20'+_0x18edd1[_0x2ea537(0x1c8)]);}));}await Promise['allSettled'](_0xc6b8a2),this['logger']['log']('Completed\x20login\x20process\x20for\x20all\x20active\x20banks');}catch(_0x522434){throw this['logger'][_0xab4e16(0x382)]('Error\x20logging\x20in\x20all\x20active\x20banks:\x20'+_0x522434['message']),_0x522434;}}['executeTransferWithQRCode'](_0x24c94c,_0x22bf15,_0x5639bd){const _0x19597e=_0x5b519d;return this['getBankService'](_0x5639bd)[_0x19597e(0x1ac)](_0x24c94c,_0x22bf15);}async['isSessionValid'](_0x5da9b6,_0x553d15){const _0x3ffe3b=_0x5b519d;return await this[_0x3ffe3b(0x259)]['isSessionValid'](_0x5da9b6,_0x553d15);}['analyzeTransferBill'](_0x4f6cc0,_0x3d0e78){return this['getBankService'](_0x4f6cc0)['analyzeTransferBill'](_0x4f6cc0,_0x3d0e78);}async[_0x5b519d(0x2df)](_0x386f55,_0x5e9226){const _0x3eb17a=_0x5b519d,_0x1b9ee6=await this[_0x3eb17a(0x259)]['getSession'](_0x386f55,_0x5e9226);if('logging_in'===_0x1b9ee6?.['status'])return!0x1;const _0x1942a5=await this['sessionManagement'][_0x3eb17a(0x308)](_0x386f55,_0x5e9226),_0x579f18=await this['sessionManagement']['isSessionValid'](_0x386f55,_0x5e9226);if(!_0x1942a5&&_0x579f18)return!0x1;if(await this['deviceLock'][_0x3eb17a(0x222)](_0x386f55))return this['logger']['warn']('Cannot\x20refresh\x20session\x20for\x20device\x20'+_0x386f55+_0x3eb17a(0x2f1)),!0x1;try{return _0x579f18?this['logger'][_0x3eb17a(0x230)]('Refreshing\x20session\x20for\x20device\x20'+_0x386f55+',\x20bank\x20'+_0x5e9226):this['logger']['log']('Session\x20expired\x20or\x20missing\x20for\x20device\x20'+_0x386f55+',\x20bank\x20'+_0x5e9226+_0x3eb17a(0x203)),await this['login'](_0x5e9226,_0x386f55),!0x0;}catch(_0x13bb1b){return this['logger']['error'](_0x3eb17a(0x3f8)+_0x386f55+':\x20'+_0x13bb1b['message']),!0x1;}}['createQRCodeAndTransferTo'](_0x1a75cb,_0x1625fd,_0x49401c){const _0x314fe2=_0x5b519d;return this[_0x314fe2(0x1c3)](_0x1a75cb)['createQRCodeAndTransferTo'](_0x1625fd,_0x49401c);}['captureScreen'](_0x11abc6,_0x2479f7,_0x3e1340){const _0x235d6b=_0x5b519d;return this[_0x235d6b(0x1c3)](_0x11abc6)[_0x235d6b(0x2bc)](_0x2479f7,{'folderPath':_0x3e1340});}[_0x5b519d(0x346)](_0x653d19,_0x156f3b){const _0x4d856e=_0x5b519d;return this[_0x4d856e(0x1c3)](_0x653d19)['getBillImagePath'](_0x156f3b);}[_0x5b519d(0x20c)](_0x3ff80d,_0x303a60){const _0x501c33=_0x5b519d;return this[_0x501c33(0x1c3)](_0x3ff80d)['createBillFolder'](_0x303a60);}async['getLatestImagePath'](_0x1ce111,_0x1d6e6e=0x2710,_0x2124b0=0x1f4){const _0x5371cc=_0x5b519d;if(!_0x1ce111)return this['logger'][_0x5371cc(0x3d4)]('Folder\x20path\x20is\x20null\x20or\x20empty'),null;const _0x307b81=Date['now']();let _0x52a7c8=0x0;for(this[_0x5371cc(0x25d)]['debug'](_0x5371cc(0x1de)+_0x1ce111+',\x20timeout:\x20'+_0x1d6e6e+_0x5371cc(0x310)+_0x2124b0+'ms');Date['now']()-_0x307b81<_0x1d6e6e;){_0x52a7c8++;try{if(!(0x0,_0x23df97['existsSync'])(_0x1ce111)){await(0x0,_0x47f607[_0x5371cc(0x37f)])(_0x2124b0);continue;}const _0x251b6c=await(0x0,_0x262bd6[_0x5371cc(0x3d8)])(_0x1ce111);if(0x0===_0x251b6c['length']){await(0x0,_0x47f607[_0x5371cc(0x37f)])(_0x2124b0);continue;}const _0x2d6374=(await Promise['all'](_0x251b6c['map'](async _0x2c39cf=>{const _0x477864=_0x5371cc;try{const _0x39c42b=(0x0,_0x3a5285[_0x477864(0x25a)])(_0x1ce111,_0x2c39cf),_0x2a939f=await(0x0,_0x262bd6['stat'])(_0x39c42b);return{'fullPath':_0x39c42b,'mtime':_0x2a939f['mtimeMs'],'size':_0x2a939f['size']};}catch(_0x1ddd7c){return null;}})))['filter'](_0x4cde68=>null!==_0x4cde68&&_0x4cde68['size']>0x0);if(0x0===_0x2d6374['length']){await(0x0,_0x47f607[_0x5371cc(0x37f)])(_0x2124b0);continue;}_0x2d6374['sort']((_0x15ff71,_0x2468cf)=>_0x2468cf['mtime']-_0x15ff71['mtime']);const _0x3c520a=_0x2d6374[0x0]['fullPath'],_0x300979=Date['now']()-_0x307b81;return this['logger']['log']('Found\x20latest\x20bill\x20image:\x20'+_0x3c520a+'\x20after\x20'+_0x300979+_0x5371cc(0x392)+_0x52a7c8+'\x20attempts)'),_0x3c520a;}catch(_0x5dde53){this['logger']['debug']('Error\x20scanning\x20folder\x20'+_0x1ce111+_0x5371cc(0x3ca)+_0x52a7c8+'):\x20'+_0x5dde53['message']+',\x20retrying...'),await(0x0,_0x47f607[_0x5371cc(0x37f)])(_0x2124b0);}}const _0x4d9f35=Date['now']()-_0x307b81;return this[_0x5371cc(0x25d)][_0x5371cc(0x3d4)]('Timeout\x20scanning\x20folder\x20for\x20bill\x20image:\x20'+_0x1ce111+_0x5371cc(0x2a7)+_0x4d9f35+'ms\x20('+_0x52a7c8+'\x20attempts)'),null;}};_0x41b965[_0x5b519d(0x2b3)]=_0x28c510,_0x41b965['BankService']=_0x28c510=_0x17b3e3([(0x0,_0x55ece7['Injectable'])(),_0x543141(_0x5b519d(0x2b1),['function'==typeof(_0x1f07ed=void 0x0!==_0x4f22da['AcbService']&&_0x4f22da['AcbService'])?_0x1f07ed:Object,_0x5b519d(0x24f)==typeof(_0x1fc16b=void 0x0!==_0x51e4fd['PgService']&&_0x51e4fd[_0x5b519d(0x331)])?_0x1fc16b:Object,'function'==typeof(_0x4a893b=void 0x0!==_0x48c88f['HdBankService']&&_0x48c88f[_0x5b519d(0x2c0)])?_0x4a893b:Object,'function'==typeof(_0x243522=void 0x0!==_0x412e5d['VietcombankService']&&_0x412e5d['VietcombankService'])?_0x243522:Object,_0x5b519d(0x24f)==typeof(_0x5edb82=void 0x0!==_0xb0fd4c['DeviceService']&&_0xb0fd4c[_0x5b519d(0x427)])?_0x5edb82:Object,'function'==typeof(_0x3be56e=void 0x0!==_0x2c4820['SessionManagementService']&&_0x2c4820['SessionManagementService'])?_0x3be56e:Object,_0x5b519d(0x24f)==typeof(_0x32dcc2=void 0x0!==_0x27a0c3[_0x5b519d(0x3a5)]&&_0x27a0c3[_0x5b519d(0x3a5)])?_0x32dcc2:Object,_0x5b519d(0x24f)==typeof(_0x96ec65=void 0x0!==_0x1095fb[_0x5b519d(0x2f6)]&&_0x1095fb[_0x5b519d(0x2f6)])?_0x96ec65:Object])],_0x28c510);},function(_0x1116b5,_0x11cbda,_0x1bd0d9){const _0x43fbcc=a0_0x23a4;var _0x456eff,_0x34bd29,_0x26d5d7,_0x15df65,_0x18cb1a=this&&this[_0x43fbcc(0x1f9)]||function(_0x30979b,_0x4a2c89,_0x1c4c9e,_0x25b9f8){const _0x51ddb0=_0x43fbcc;var _0x24b56a,_0x5410ca=arguments['length'],_0x549c3d=_0x5410ca<0x3?_0x4a2c89:null===_0x25b9f8?_0x25b9f8=Object[_0x51ddb0(0x26e)](_0x4a2c89,_0x1c4c9e):_0x25b9f8;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x549c3d=Reflect[_0x51ddb0(0x2e3)](_0x30979b,_0x4a2c89,_0x1c4c9e,_0x25b9f8);else{for(var _0x51d56a=_0x30979b['length']-0x1;_0x51d56a>=0x0;_0x51d56a--)(_0x24b56a=_0x30979b[_0x51d56a])&&(_0x549c3d=(_0x5410ca<0x3?_0x24b56a(_0x549c3d):_0x5410ca>0x3?_0x24b56a(_0x4a2c89,_0x1c4c9e,_0x549c3d):_0x24b56a(_0x4a2c89,_0x1c4c9e))||_0x549c3d);}return _0x5410ca>0x3&&_0x549c3d&&Object['defineProperty'](_0x4a2c89,_0x1c4c9e,_0x549c3d),_0x549c3d;},_0x5c1ef6=this&&this['__metadata']||function(_0x21609f,_0xe34d52){if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0x21609f,_0xe34d52);},_0x467001=this&&this[_0x43fbcc(0x165)]||function(_0x2eba14,_0x39f4c3){return function(_0x1fe4ee,_0x9cdc){_0x39f4c3(_0x1fe4ee,_0x9cdc,_0x2eba14);};};Object[_0x43fbcc(0x213)](_0x11cbda,'__esModule',{'value':!0x0}),_0x11cbda[_0x43fbcc(0x377)]=void 0x0;const _0x48ede9=_0x1bd0d9(0x2),_0x4ffb7f=_0x1bd0d9(0xd),_0x1b8afb=_0x1bd0d9(0xe),_0x2fd6a7=_0x1bd0d9(0x17),_0x28ebc6=_0x1bd0d9(0x13),_0x1ef5c3=_0x1bd0d9(0x18),_0x3d9c28=_0x1bd0d9(0x26),_0x40c8e2=_0x1bd0d9(0x27),_0x15fd6e=_0x1bd0d9(0x1b),_0x4a9dfd=_0x1bd0d9(0x1e);let _0x4d1065=class extends _0x2fd6a7['BaseBankService']{constructor(_0xaf6afb,_0x421c04,_0x6cdc72,_0x2920e6){const _0x46dc9e=_0x43fbcc;super(_0xaf6afb,_0x421c04,_0x6cdc72,_0x2920e6),this['wsService']=_0xaf6afb,this['BANK_CODE']='ACB',this['BUNDLE_ID']=_0x46dc9e(0x449);}['launchApp'](_0x319022){throw new Error('Method\x20not\x20implemented.');}async['captureScreen'](_0x2e0f53,_0xccfc71){}async['clickPasswordField'](_0x366106){const _0x26c23e=_0x43fbcc;try{const {x:_0x4e0bc9,y:_0x2647be}=_0x40c8e2['ACB_UI_COORDINATES'][_0x26c23e(0x2cb)];this['logger']['log'](_0x26c23e(0x19d)+_0x366106+'\x20at\x20coordinates\x20('+_0x4e0bc9+',\x20'+_0x2647be+')'),await this['clickWithTransition'](_0x366106,_0x4e0bc9,_0x2647be,0.2),await(0x0,_0x1ef5c3['sleep'])(0x3e8),this['logger']['log']('Password\x20field\x20clicked\x20successfully\x20on\x20device\x20'+_0x366106);}catch(_0x31b50a){throw this['logger']['error']('Error\x20clicking\x20password\x20field\x20on\x20device\x20'+_0x366106+':\x20'+_0x31b50a['message']),_0x31b50a;}}async[_0x43fbcc(0x40c)](_0x5a4216){const _0x57a2f9=_0x43fbcc;try{const _0x1f840d=await this['deviceService'][_0x57a2f9(0x187)](_0x5a4216);if(!_0x1f840d||!_0x1f840d[_0x57a2f9(0x247)])throw new Error('Password\x20not\x20configured\x20for\x20device\x20'+_0x5a4216);await this['wsService']['inputText'](_0x5a4216,_0x1f840d['password']);}catch(_0x547734){throw this['logger']['error']('Error\x20inputting\x20password\x20from\x20config\x20for\x20device\x20'+_0x5a4216+':\x20'+_0x547734['message']),_0x547734;}}async['clickLoginButton'](_0x4cf4bd){const _0x4c82f9=_0x43fbcc;try{const {x:_0x3d738b,y:_0x479fd1}=_0x40c8e2['ACB_UI_COORDINATES']['LOGIN_BUTTON'];this['logger']['log']('Clicking\x20login\x20button\x20on\x20device\x20'+_0x4cf4bd+'\x20at\x20coordinates\x20('+_0x3d738b+',\x20'+_0x479fd1+')'),await this[_0x4c82f9(0x292)]['click'](_0x4cf4bd,_0x3d738b,_0x479fd1,0.2),await(0x0,_0x1ef5c3[_0x4c82f9(0x37f)])(0x1388),this[_0x4c82f9(0x25d)][_0x4c82f9(0x230)]('Login\x20button\x20clicked\x20successfully\x20on\x20device\x20'+_0x4cf4bd);}catch(_0x28fe8f){throw this['logger'][_0x4c82f9(0x382)]('Error\x20clicking\x20login\x20button\x20on\x20device\x20'+_0x4cf4bd+':\x20'+_0x28fe8f['message']),_0x28fe8f;}}async['login'](_0x181f40){const _0x86f94a=_0x43fbcc;try{await this['killApp'](_0x181f40),await this['launchApp'](_0x181f40);const {x:_0x3de491,y:_0x2aaa20}=_0x40c8e2['ACB_UI_COORDINATES']['LOGIN_BUTTON'];this[_0x86f94a(0x25d)]['log']('Clicking\x20login\x20button\x20on\x20device\x20'+_0x181f40+'\x20at\x20coordinates\x20('+_0x3de491+',\x20'+_0x2aaa20+')'),await this['wsService']['click'](_0x181f40,_0x3de491,_0x2aaa20,0.2),await(0x0,_0x1ef5c3[_0x86f94a(0x37f)])(0x7d0),await this['inputPasswordFromConfig'](_0x181f40),await(0x0,_0x1ef5c3['sleep'])(0x7d0);const {x:_0x3c2a08,y:_0x24cd38}=_0x3d9c28[_0x86f94a(0x1ce)]['RETURN_KEY'];this[_0x86f94a(0x25d)][_0x86f94a(0x230)]('Clicking\x20return\x20key\x20on\x20device\x20'+_0x181f40+_0x86f94a(0x1be)+_0x3c2a08+',\x20'+_0x24cd38+')'),await this[_0x86f94a(0x292)][_0x86f94a(0x238)](_0x181f40,_0x3c2a08,_0x24cd38,0.2),await(0x0,_0x1ef5c3[_0x86f94a(0x37f)])(0x7d0),await this[_0x86f94a(0x292)]['click'](_0x181f40,0.5,0.62,0.2),await(0x0,_0x1ef5c3[_0x86f94a(0x37f)])(0x1388),await this['wsService']['click'](_0x181f40,0.3,0.55,0.2),await this['wsService']['click'](_0x181f40,0.5,0.65,0.2);}catch(_0xf40cb0){throw this['logger']['error'](_0x86f94a(0x233)+_0x181f40+':\x20'+_0xf40cb0['message']),_0xf40cb0;}}async[_0x43fbcc(0x291)](_0x44f666,_0x42077c){}async['executeTransferWithQRCode'](_0x562f82,_0x4935aa){const _0xcee729=_0x43fbcc;console['warn'](_0xcee729(0x1a1));}async['executeInternalTransfer'](_0x240280,_0x56b148){return this['executeExternalTransfer'](_0x240280,_0x56b148);}async['executeExternalTransfer'](_0x3d1c38,_0x54df89){console['warn']('ACB\x20executeExternalTransfer');}};_0x11cbda['AcbService']=_0x4d1065,_0x11cbda[_0x43fbcc(0x377)]=_0x4d1065=_0x18cb1a([(0x0,_0x48ede9[_0x43fbcc(0x3ea)])(),_0x467001(0x0,(0x0,_0x48ede9['Inject'])(_0x4ffb7f['WEBSOCKET_SERVICE'])),_0x5c1ef6(_0x43fbcc(0x2b1),[_0x43fbcc(0x24f)==typeof(_0x456eff=void 0x0!==_0x28ebc6['IWebSocketService']&&_0x28ebc6[_0x43fbcc(0x26a)])?_0x456eff:Object,'function'==typeof(_0x34bd29=void 0x0!==_0x1b8afb[_0x43fbcc(0x427)]&&_0x1b8afb['DeviceService'])?_0x34bd29:Object,'function'==typeof(_0x26d5d7=void 0x0!==_0x15fd6e[_0x43fbcc(0x1b9)]&&_0x15fd6e[_0x43fbcc(0x1b9)])?_0x26d5d7:Object,'function'==typeof(_0x15df65=void 0x0!==_0x4a9dfd['ImagePreprocessingService']&&_0x4a9dfd['ImagePreprocessingService'])?_0x15df65:Object])],_0x4d1065);},(_0x56b9cb,_0x9ff3e5)=>{const _0x1f0bf9=a0_0x23a4;Object['defineProperty'](_0x9ff3e5,_0x1f0bf9(0x3f1),{'value':!0x0}),_0x9ff3e5['WEBSOCKET_SERVICE']=void 0x0,_0x9ff3e5[_0x1f0bf9(0x429)]=Symbol('WEBSOCKET_SERVICE');},function(_0x5aba2c,_0x43288f,_0x2e46cf){const _0x399fb0=a0_0x23a4;var _0x27b68a,_0x19746e,_0x1d6084,_0x38abff,_0x2a16e9=this&&this[_0x399fb0(0x1f9)]||function(_0x3893c2,_0x2ab745,_0x3198f0,_0x30ec5e){const _0x1530cf=_0x399fb0;var _0x3d2117,_0x3e6153=arguments[_0x1530cf(0x1fa)],_0x2922f2=_0x3e6153<0x3?_0x2ab745:null===_0x30ec5e?_0x30ec5e=Object['getOwnPropertyDescriptor'](_0x2ab745,_0x3198f0):_0x30ec5e;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x2922f2=Reflect[_0x1530cf(0x2e3)](_0x3893c2,_0x2ab745,_0x3198f0,_0x30ec5e);else{for(var _0x7a4dfa=_0x3893c2['length']-0x1;_0x7a4dfa>=0x0;_0x7a4dfa--)(_0x3d2117=_0x3893c2[_0x7a4dfa])&&(_0x2922f2=(_0x3e6153<0x3?_0x3d2117(_0x2922f2):_0x3e6153>0x3?_0x3d2117(_0x2ab745,_0x3198f0,_0x2922f2):_0x3d2117(_0x2ab745,_0x3198f0))||_0x2922f2);}return _0x3e6153>0x3&&_0x2922f2&&Object['defineProperty'](_0x2ab745,_0x3198f0,_0x2922f2),_0x2922f2;},_0x1e29ec=this&&this['__metadata']||function(_0x41bdc8,_0x4ab46c){if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0x41bdc8,_0x4ab46c);},_0x2223a8=this&&this['__param']||function(_0x2fab3d,_0x1de97d){return function(_0x4f9294,_0x388d85){_0x1de97d(_0x4f9294,_0x388d85,_0x2fab3d);};};Object['defineProperty'](_0x43288f,'__esModule',{'value':!0x0}),_0x43288f['DeviceService']=void 0x0;const _0x2592b5=_0x2e46cf(0x2),_0x1fd666=_0x2e46cf(0xf),_0x430d3a=_0x2e46cf(0x13),_0xe552af=_0x2e46cf(0xd),_0x256498=_0x2e46cf(0x14),_0x29b720=_0x2e46cf(0xb),_0x54c0a3=_0x2e46cf(0x16);let _0x242f79=class{constructor(_0x2b2656,_0x4b9ffb,_0xe47ac7,_0x2cf63b){const _0x13beda=_0x399fb0;this[_0x13beda(0x1f1)]=_0x2b2656,this[_0x13beda(0x292)]=_0x4b9ffb,this['deviceLockService']=_0xe47ac7,this[_0x13beda(0x2cc)]=_0x2cf63b,this['logger']=new _0x2592b5['Logger']('DeviceService'),this['REDIS_DEVICE_CONFIG_PREFIX']='device:',this[_0x13beda(0x302)]=':config',this['REDIS_SERVICE_STATUS_KEY']='service:status';}async[_0x399fb0(0x33a)](){const _0xf3e191=_0x399fb0;try{await this['setServiceStatus']('inactive'),this[_0xf3e191(0x25d)]['log'](_0xf3e191(0x1bf));}catch(_0x2fe4a5){this[_0xf3e191(0x25d)]['error']('Failed\x20to\x20initialize\x20service\x20status:\x20'+_0x2fe4a5['message']);}}async['listDeviceConfigs'](){const _0x5859a9=_0x399fb0;try{const _0x5618a6=this['REDIS_DEVICE_CONFIG_PREFIX']+'*'+this['REDIS_DEVICE_CONFIG_SUFFIX'],_0x2992ff=await this['redisService'][_0x5859a9(0x1e2)](_0x5618a6);return 0x0===_0x2992ff[_0x5859a9(0x1fa)]?[]:(await Promise['all'](_0x2992ff['map'](async _0x4d7005=>{const _0xc4be5f=_0x5859a9;try{const _0x3afd25=await this[_0xc4be5f(0x1f1)][_0xc4be5f(0x27f)](_0x4d7005);return _0x3afd25?JSON['parse'](_0x3afd25):null;}catch(_0x51eb17){return this[_0xc4be5f(0x25d)][_0xc4be5f(0x382)]('Error\x20parsing\x20config\x20for\x20key\x20'+_0x4d7005+':\x20'+_0x51eb17[_0xc4be5f(0x1c8)]),null;}})))['filter'](_0x26bfcb=>!(0x0,_0x54c0a3[_0x5859a9(0x404)])(_0x26bfcb));}catch(_0x6a2cd){return this[_0x5859a9(0x25d)][_0x5859a9(0x382)]('Error\x20listing\x20device\x20configs:\x20'+_0x6a2cd[_0x5859a9(0x1c8)]),[];}}async['listDevices'](){const _0x38757d=_0x399fb0;try{const _0x1cdeaf=await this[_0x38757d(0x292)]['listDevices']();return await Promise['all'](_0x1cdeaf[_0x38757d(0x30c)](async _0x42e647=>{const _0x3e5b98=_0x38757d,_0x438f57=await this[_0x3e5b98(0x187)](_0x42e647['udid']);return{..._0x42e647,'bankCode':_0x438f57?.['bankCode']||'','availableAmount':_0x438f57?.['availableAmount']||0x0,'status':_0x438f57?.['status']||'deactive','password':_0x438f57?.['password']||'','smartOTP':_0x438f57?.['smartOTP']||'','accountNo':_0x438f57?.['accountNo']||'','accountName':_0x438f57?.[_0x3e5b98(0x398)]||''};}));}catch(_0x5590a8){return this['logger'][_0x38757d(0x382)]('Error\x20listing\x20devices:\x20'+_0x5590a8['message']),[];}}async['getDeviceConfig'](_0x43d228){const _0x105e4a=_0x399fb0;try{const _0xbe5dfa=''+this['REDIS_DEVICE_CONFIG_PREFIX']+_0x43d228+this['REDIS_DEVICE_CONFIG_SUFFIX'],_0x21a90c=await this['redisService']['get'](_0xbe5dfa);return _0x21a90c?JSON['parse'](_0x21a90c):null;}catch(_0x4dd53a){return this['logger']['error'](_0x105e4a(0x1bd)+_0x43d228+':\x20'+_0x4dd53a[_0x105e4a(0x1c8)]),null;}}async['getDeviceConfigSafe'](_0x3c10df){const _0x5a102b=_0x399fb0;try{const _0xe420bb=await this[_0x5a102b(0x187)](_0x3c10df);return _0xe420bb?{..._0xe420bb,'password':_0xe420bb[_0x5a102b(0x247)]?'':void 0x0,'smartOTP':_0xe420bb['smartOTP']?'':void 0x0}:null;}catch(_0x22e6a1){return this['logger']['error']('Error\x20getting\x20safe\x20device\x20config\x20for\x20'+_0x3c10df+':\x20'+_0x22e6a1['message']),null;}}async[_0x399fb0(0x3db)](_0x5f3632,_0x2838d0){const _0x4a6de6=_0x399fb0;try{const _0x47bf32=''+this['REDIS_DEVICE_CONFIG_PREFIX']+_0x5f3632+this['REDIS_DEVICE_CONFIG_SUFFIX'],_0x471afd=await this[_0x4a6de6(0x187)](_0x5f3632),_0x4b77a9=_0x471afd?.['password']||_0x471afd?.['smartOTP'],_0x5a9796=_0x4b77a9?_0x471afd?.['password']||'':void 0x0!==_0x2838d0['password']?_0x2838d0[_0x4a6de6(0x247)]:'',_0x265d9e=_0x4b77a9?_0x471afd?.[_0x4a6de6(0x374)]||'':void 0x0!==_0x2838d0['smartOTP']?_0x2838d0['smartOTP']:'',_0x29d36c={'deviceId':_0x5f3632,'bankCode':void 0x0!==_0x2838d0[_0x4a6de6(0x385)]?_0x2838d0[_0x4a6de6(0x385)]:_0x471afd?.['bankCode']||'','availableAmount':void 0x0!==_0x2838d0['availableAmount']?_0x2838d0[_0x4a6de6(0x453)]:_0x471afd?.['availableAmount']||0x0,'status':void 0x0!==_0x2838d0['status']?_0x2838d0['status']:_0x471afd?.['status']||_0x4a6de6(0x3c9),'password':_0x5a9796,'smartOTP':_0x265d9e,'accountNo':void 0x0!==_0x2838d0[_0x4a6de6(0x1d6)]?_0x2838d0['accountNo']:_0x471afd?.['accountNo']||'','accountName':void 0x0!==_0x2838d0[_0x4a6de6(0x398)]?_0x2838d0['accountName']:_0x471afd?.['accountName']||''};return await this['redisService'][_0x4a6de6(0x306)](_0x47bf32,JSON['stringify'](_0x29d36c)),this[_0x4a6de6(0x25d)]['log']('['+_0x5f3632+']\x20Updated\x20device\x20config\x20(bankCode:\x20'+(_0x29d36c['bankCode']||'not\x20set')+_0x4a6de6(0x25c)+JSON['stringify']((0x0,_0x54c0a3['omit'])(_0x29d36c,['password',_0x4a6de6(0x374)]))),_0x29d36c;}catch(_0x1199c2){throw this['logger'][_0x4a6de6(0x382)]('['+_0x5f3632+']\x20Error\x20updating\x20device\x20config:\x20'+_0x1199c2[_0x4a6de6(0x1c8)]),_0x1199c2;}}async['deleteDeviceConfig'](_0x3e2cfa){const _0x5665e5=_0x399fb0;try{const _0x50c9fe=''+this['REDIS_DEVICE_CONFIG_PREFIX']+_0x3e2cfa+this['REDIS_DEVICE_CONFIG_SUFFIX'];await this['redisService']['del'](_0x50c9fe),this['logger'][_0x5665e5(0x230)]('['+_0x3e2cfa+_0x5665e5(0x2cf));}catch(_0x7f74fb){throw this['logger']['error']('['+_0x3e2cfa+_0x5665e5(0x285)+_0x7f74fb['message']),_0x7f74fb;}}async['getServiceStatus'](){const _0x23b22a=_0x399fb0;try{return await this['redisService']['get'](this['REDIS_SERVICE_STATUS_KEY'])||'inactive';}catch(_0xcbbd88){return this['logger']['error'](_0x23b22a(0x205)+_0xcbbd88['message']),_0x23b22a(0x2e9);}}async['setServiceStatus'](_0x208c64){const _0x2cb29b=_0x399fb0;try{await this[_0x2cb29b(0x1f1)][_0x2cb29b(0x306)](this['REDIS_SERVICE_STATUS_KEY'],_0x208c64),this['logger'][_0x2cb29b(0x230)](_0x2cb29b(0x234)+_0x208c64);}catch(_0x48a24a){throw this['logger']['error'](_0x2cb29b(0x425)+_0x48a24a['message']),_0x48a24a;}}async['startService'](){const _0x266ad2=_0x399fb0;try{if(!await this[_0x266ad2(0x1ea)]())throw new _0x2592b5['HttpException']({'success':!0x1,'error':'Vui\x20l√≤ng\x20active\x20bank\x20tr∆∞·ªõc\x20khi\x20start'},_0x2592b5['HttpStatus'][_0x266ad2(0x37d)]);return this[_0x266ad2(0x2cc)]['loginAllActiveBanks']()['catch'](_0x5f43ee=>{const _0x196a44=_0x266ad2;this[_0x196a44(0x25d)][_0x196a44(0x382)]('Error\x20during\x20background\x20login\x20process:\x20'+_0x5f43ee['message']);}),await new Promise(_0x2de26f=>setTimeout(_0x2de26f,0x7d0)),await this['setServiceStatus']('active'),{'success':!0x0,'message':'Service\x20started\x20successfully.\x20Devices\x20are\x20logging\x20in\x20and\x20will\x20accept\x20jobs\x20when\x20ready.'};}catch(_0x363744){if(_0x363744 instanceof _0x2592b5['HttpException'])throw _0x363744;throw this[_0x266ad2(0x25d)]['error'](_0x266ad2(0x19c)+_0x363744[_0x266ad2(0x1c8)],_0x363744[_0x266ad2(0x384)]),new _0x2592b5['HttpException']({'success':!0x1,'error':_0x363744['message']||'Failed\x20to\x20start\x20service'},_0x2592b5[_0x266ad2(0x27c)][_0x266ad2(0x2c8)]);}}async[_0x399fb0(0x173)](_0x4a2197,_0x213cf4){const _0x517b4=_0x399fb0;try{const _0x1b8840=await this['getDeviceConfig'](_0x4a2197);if(!_0x1b8840)return!0x1;const _0x3dcf60=_0x1b8840['availableAmount']-_0x213cf4;return _0x3dcf60<0x0?(this['logger'][_0x517b4(0x3d4)]('Insufficient\x20amount\x20for\x20device\x20'+_0x4a2197+'.\x20Available:\x20'+_0x1b8840['availableAmount']+',\x20Requested:\x20'+_0x213cf4),!0x1):(await this['updateDeviceConfig'](_0x4a2197,{'availableAmount':_0x3dcf60}),!0x0);}catch(_0x2290b3){return this['logger']['error']('Error\x20deducting\x20amount\x20for\x20device\x20'+_0x4a2197+':\x20'+_0x2290b3['message']),!0x1;}}async['hasActiveDevice'](){const _0x3da05d=_0x399fb0;try{return(await this['listDevices']())['some'](_0x459e15=>'active'===_0x459e15[_0x3da05d(0x455)]);}catch(_0x55febd){return this[_0x3da05d(0x25d)]['error'](_0x3da05d(0x256)+_0x55febd['message']),!0x1;}}async['getAvailableDevices'](){const _0x5b0ecc=_0x399fb0;try{const _0x4a4960=await this['wsService'][_0x5b0ecc(0x3aa)](),_0x26f69f=[];for(const _0x506497 of _0x4a4960){const _0x355062=await this['getDeviceConfig'](_0x506497['udid']);'active'===_0x355062?.['status']&&(await this['deviceLockService']['isLocked'](_0x506497['udid'])||(await this['bankService'][_0x5b0ecc(0x3bb)](_0x506497['udid'],_0x355062['bankCode'])?_0x26f69f['push'](_0x355062):this['logger']['error']('['+_0x506497[_0x5b0ecc(0x3f3)]+']\x20Device\x20does\x20not\x20have\x20valid\x20session\x20for\x20bank\x20'+_0x355062[_0x5b0ecc(0x385)])));}return _0x26f69f;}catch(_0x523602){return this['logger']['error']('Error\x20getting\x20available\x20devices:\x20'+_0x523602['message']),[];}}};_0x43288f['DeviceService']=_0x242f79,_0x43288f['DeviceService']=_0x242f79=_0x2a16e9([(0x0,_0x2592b5['Injectable'])(),_0x2223a8(0x1,(0x0,_0x2592b5[_0x399fb0(0x2de)])(_0xe552af[_0x399fb0(0x429)])),_0x2223a8(0x3,(0x0,_0x2592b5['Inject'])((0x0,_0x2592b5[_0x399fb0(0x39a)])(()=>_0x29b720['BankService']))),_0x1e29ec('design:paramtypes',['function'==typeof(_0x27b68a=void 0x0!==_0x1fd666['RedisService']&&_0x1fd666['RedisService'])?_0x27b68a:Object,'function'==typeof(_0x19746e=void 0x0!==_0x430d3a[_0x399fb0(0x26a)]&&_0x430d3a['IWebSocketService'])?_0x19746e:Object,'function'==typeof(_0x1d6084=void 0x0!==_0x256498['DeviceLockService']&&_0x256498['DeviceLockService'])?_0x1d6084:Object,'function'==typeof(_0x38abff=void 0x0!==_0x29b720['BankService']&&_0x29b720['BankService'])?_0x38abff:Object])],_0x242f79);},function(_0x44b134,_0x35c4fb,_0x5cd396){const _0x14cf07=a0_0x23a4;var _0x2e2297=this&&this['__decorate']||function(_0x36fbed,_0x33e65e,_0x28ecc7,_0x4a139c){const _0x38002d=a0_0x23a4;var _0xcafd7f,_0xb26682=arguments[_0x38002d(0x1fa)],_0x3ca690=_0xb26682<0x3?_0x33e65e:null===_0x4a139c?_0x4a139c=Object['getOwnPropertyDescriptor'](_0x33e65e,_0x28ecc7):_0x4a139c;if('object'==typeof Reflect&&_0x38002d(0x24f)==typeof Reflect[_0x38002d(0x2e3)])_0x3ca690=Reflect['decorate'](_0x36fbed,_0x33e65e,_0x28ecc7,_0x4a139c);else{for(var _0x27f795=_0x36fbed[_0x38002d(0x1fa)]-0x1;_0x27f795>=0x0;_0x27f795--)(_0xcafd7f=_0x36fbed[_0x27f795])&&(_0x3ca690=(_0xb26682<0x3?_0xcafd7f(_0x3ca690):_0xb26682>0x3?_0xcafd7f(_0x33e65e,_0x28ecc7,_0x3ca690):_0xcafd7f(_0x33e65e,_0x28ecc7))||_0x3ca690);}return _0xb26682>0x3&&_0x3ca690&&Object['defineProperty'](_0x33e65e,_0x28ecc7,_0x3ca690),_0x3ca690;},_0x2cddd3=this&&this['__metadata']||function(_0x5a9e9c,_0x2fb7fe){if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0x5a9e9c,_0x2fb7fe);};Object['defineProperty'](_0x35c4fb,'__esModule',{'value':!0x0}),_0x35c4fb[_0x14cf07(0x253)]=void 0x0;const _0x424698=_0x5cd396(0x2),_0x28a979=_0x5cd396(0x10),_0x2fa674=_0x5cd396(0x11);let _0x5c220a=class{constructor(){const _0x1bc5d2=_0x14cf07;this['logger']=new _0x424698['Logger']('RedisService'),this[_0x1bc5d2(0x274)]=null;}async[_0x14cf07(0x31b)](){const _0xf6eb0f=_0x14cf07;if(this['redisClient'])return this[_0xf6eb0f(0x274)];const _0x49352e=_0x2fa674['config']['redis']['host']??'localhost',_0x33f43d=_0x2fa674['config']['redis'][_0xf6eb0f(0x1b0)]??0x18eb,_0x1db97c=_0x2fa674['config']['redis'][_0xf6eb0f(0x247)]??void 0x0,_0x31d3c1=_0x2fa674['config']['redis']['db']??0x3;return this['redisClient']=new _0x28a979['default']({'host':_0x49352e,'port':_0x33f43d,'password':_0x1db97c,'db':_0x31d3c1,'enableReadyCheck':!0x1,'maxRetriesPerRequest':null,'lazyConnect':!0x0}),this['redisClient']['on'](_0xf6eb0f(0x382),_0x217718=>{const _0x493f59=_0xf6eb0f;this[_0x493f59(0x25d)][_0x493f59(0x382)]('Redis\x20Client\x20Error',_0x217718[_0x493f59(0x384)]||_0x217718['message']);}),this['redisClient']['on']('connect',()=>{const _0x193bf3=_0xf6eb0f;this[_0x193bf3(0x25d)][_0x193bf3(0x230)]('Redis\x20Client\x20Connected');}),this['redisClient']['on'](_0xf6eb0f(0x309),()=>{this['logger']['log']('Redis\x20Client\x20Ready');}),this['redisClient']['on'](_0xf6eb0f(0x3ff),()=>{const _0x48cf17=_0xf6eb0f;this['logger'][_0x48cf17(0x3d4)](_0x48cf17(0x163));}),this['redisClient']['on']('reconnecting',()=>{const _0x10f149=_0xf6eb0f;this[_0x10f149(0x25d)]['log']('Redis\x20Client\x20Reconnecting...');}),await this['redisClient'][_0xf6eb0f(0x241)](),this['redisClient'];}async['disconnect'](){const _0x3b097e=_0x14cf07;this['redisClient']&&(await this[_0x3b097e(0x274)][_0x3b097e(0x1b7)](),this['redisClient']=null,this[_0x3b097e(0x25d)][_0x3b097e(0x230)](_0x3b097e(0x2d0)));}async['onModuleDestroy'](){await this['disconnect']();}async[_0x14cf07(0x27f)](_0x1feccb){const _0x77ccf5=_0x14cf07;return(await this[_0x77ccf5(0x31b)]())[_0x77ccf5(0x27f)](_0x1feccb);}async['set'](_0x2ab800,_0x3a262c,_0x57059c){const _0xe767eb=await this['getClient']();if(_0x57059c){const _0x2d347d=Math['ceil'](_0x57059c/0x3e8);return _0xe767eb['setex'](_0x2ab800,_0x2d347d,_0x3a262c);}return _0xe767eb['set'](_0x2ab800,_0x3a262c);}async[_0x14cf07(0x366)](_0x12ffcb,_0x41b1fd,_0x4c1a00){const _0x5b88b4=_0x14cf07,_0x5cf54e=await this[_0x5b88b4(0x31b)](),_0x20606a=Math[_0x5b88b4(0x406)](_0x41b1fd/0x3e8);return _0x5cf54e[_0x5b88b4(0x366)](_0x12ffcb,_0x20606a,_0x4c1a00);}async['del'](_0x3869fe){return(await this['getClient']())['del'](_0x3869fe);}async[_0x14cf07(0x2b9)](_0xdd60d7){return(await this['getClient']())['exists'](_0xdd60d7);}async['zadd'](_0x2a0483,_0x2aef81,_0x4d54ae){const _0x2e9d61=_0x14cf07;return(await this[_0x2e9d61(0x31b)]())[_0x2e9d61(0x31f)](_0x2a0483,_0x2aef81,_0x4d54ae);}async['zrange'](_0x4c5432,_0x53cd44,_0x1424e0){return(await this['getClient']())['zrange'](_0x4c5432,_0x53cd44,_0x1424e0);}async['zrangebyscore'](_0x4918f0,_0xb89af8,_0x391a9b,_0x412ea7){const _0x773e62=await this['getClient']();return _0x412ea7?_0x773e62['zrangebyscore'](_0x4918f0,_0xb89af8,_0x391a9b,'LIMIT',_0x412ea7['offset'],_0x412ea7['count']):_0x773e62['zrangebyscore'](_0x4918f0,_0xb89af8,_0x391a9b);}async['zrem'](_0x2da078,..._0x2f81a4){return(await this['getClient']())['zrem'](_0x2da078,..._0x2f81a4);}async['sadd'](_0x12a059,..._0x2118d3){const _0x257ab1=_0x14cf07;return(await this[_0x257ab1(0x31b)]())['sadd'](_0x12a059,..._0x2118d3);}async['sismember'](_0x32015f,_0x3f7b32){return(await this['getClient']())['sismember'](_0x32015f,_0x3f7b32);}async[_0x14cf07(0x1df)](_0x433d06,_0x338a36,_0x5c052e){return(await this['getClient']())['hset'](_0x433d06,_0x338a36,_0x5c052e);}async['hget'](_0x5d3b77,_0x20824a){const _0x32fe7a=_0x14cf07;return(await this[_0x32fe7a(0x31b)]())[_0x32fe7a(0x1c0)](_0x5d3b77,_0x20824a);}async[_0x14cf07(0x313)](_0x1da465){const _0x27d0b7=_0x14cf07;return(await this[_0x27d0b7(0x31b)]())['hgetall'](_0x1da465);}async[_0x14cf07(0x411)](_0x25a8c4,_0x2c3863){return(await this['getClient']())['expire'](_0x25a8c4,_0x2c3863);}async['keys'](_0x53d4a1){const _0xdc8976=_0x14cf07,_0x20325c=await this[_0xdc8976(0x31b)](),_0xedec90=[];let _0x13996e='0';do{const _0x82b8db=await _0x20325c[_0xdc8976(0x1f6)](_0x13996e,'MATCH',_0x53d4a1,'COUNT',0x64);_0x13996e=_0x82b8db[0x0],_0xedec90[_0xdc8976(0x281)](..._0x82b8db[0x1]);}while('0'!==_0x13996e);return _0xedec90;}async['setnx'](_0xcc902b,_0xc67f08,_0x1abf53){const _0x592b5c=_0x14cf07,_0x308dfc=await this['getClient']();if(_0x1abf53){const _0x194afc=Math['ceil'](_0x1abf53/0x3e8);return await _0x308dfc['set'](_0xcc902b,_0xc67f08,'EX',_0x194afc,'NX');}return await _0x308dfc[_0x592b5c(0x306)](_0xcc902b,_0xc67f08,'NX');}async[_0x14cf07(0x44c)](_0x5bf352,_0x3013e8=0x1){const _0x3b2cf4=_0x14cf07,_0x1e81e8=await this['getClient'](),_0x5305f5=await _0x1e81e8['zrange'](_0x5bf352,0x0,_0x3013e8-0x1,'WITHSCORES');if(!_0x5305f5||0x0===_0x5305f5['length'])return[];const _0x54e490=[];for(let _0x49b924=0x0;_0x49b924<_0x5305f5[_0x3b2cf4(0x1fa)];_0x49b924+=0x2)_0x54e490['push']({'jobId':_0x5305f5[_0x49b924],'score':_0x5305f5[_0x49b924+0x1]});return _0x54e490;}};_0x35c4fb['RedisService']=_0x5c220a,_0x35c4fb[_0x14cf07(0x253)]=_0x5c220a=_0x2e2297([(0x0,_0x424698['Injectable'])(),_0x2cddd3('design:paramtypes',[])],_0x5c220a);},_0x33da25=>{_0x33da25['exports']=require('ioredis');},(_0x17f53a,_0x555497,_0x365ac6)=>{const _0x5d1677=a0_0x23a4;Object['defineProperty'](_0x555497,'__esModule',{'value':!0x0}),_0x555497[_0x5d1677(0x219)]=void 0x0;const _0x4b8b4e=_0x365ac6(0x12),_0x1bdd43=_0x365ac6(0x4);(0x0,_0x4b8b4e['config'])({'path':(0x0,_0x1bdd43['join'])(process['cwd'](),'.env')}),_0x555497['config']={'NODE_ENV':process['env']['NODE_ENV']||'production','boxType':'PANDA','redis':{'host':process[_0x5d1677(0x1e4)][_0x5d1677(0x211)]??'14.225.44.234','port':parseInt(process['env']['REDIS_PORT']??'6888'),'db':0x3,'password':process['env'][_0x5d1677(0x2f8)]??'Dcsvnqvmn1'},'ezpayBe':{'apiUrl':process[_0x5d1677(0x1e4)][_0x5d1677(0x1a2)]??'https://api-hn.botpro.world/payment','apiKey':process['env']['EZZPAY_KEY']??_0x5d1677(0x2e8)},'ocr':{'poolSize':parseInt(process['env'][_0x5d1677(0x3e2)]||'4',0xa),'lang':process['env']['OCR_LANG']||'vie','rois':{'singleLine':{'crop':{'x':parseFloat(process['env'][_0x5d1677(0x1eb)]||'0'),'y':parseFloat(process['env'][_0x5d1677(0x43f)]||'0'),'width':parseFloat(process['env'][_0x5d1677(0x221)]||'1'),'height':parseFloat(process['env']['OCR_ROI_SINGLE_HEIGHT']||'1')},'psm':parseInt(process[_0x5d1677(0x1e4)][_0x5d1677(0x44d)]||'7',0xa),'charWhitelist':process['env'][_0x5d1677(0x370)]||'0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\x20.-','maxWidth':parseInt(process['env']['OCR_MAX_WIDTH_SINGLE']||'800',0xa)},'block':{'crop':{'x':parseFloat(process['env'][_0x5d1677(0x262)]||'0'),'y':parseFloat(process[_0x5d1677(0x1e4)]['OCR_ROI_BLOCK_Y']||'0'),'width':parseFloat(process['env'][_0x5d1677(0x1bc)]||'1'),'height':parseFloat(process['env']['OCR_ROI_BLOCK_HEIGHT']||'1')},'psm':parseInt(process[_0x5d1677(0x1e4)]['OCR_PSM_BLOCK']||'6',0xa),'charWhitelist':process['env']['OCR_WHITELIST_BLOCK']||void 0x0,'maxWidth':parseInt(process['env'][_0x5d1677(0x21f)]||'1200',0xa)},'full':{'crop':{'x':0x0,'y':0x0,'width':0x1,'height':0x1},'psm':parseInt(process[_0x5d1677(0x1e4)]['OCR_PSM_FULL']||'6',0xa),'charWhitelist':void 0x0,'maxWidth':parseInt(process[_0x5d1677(0x1e4)]['OCR_MAX_WIDTH_FULL']||'1200',0xa)}}},'spaceocr':{'datacenterPrimary':'https://apipro1.ocr.space/parse/image','datacenterSecond':'https://apipro2.ocr.space/parse/image','key':_0x5d1677(0x20f),'keyFree':_0x5d1677(0x1d8)}};},_0x24a77f=>{const _0x51c1f4=a0_0x23a4;_0x24a77f[_0x51c1f4(0x391)]=require('dotenv');},(_0x511ed4,_0x1cabbf)=>{const _0x8b574=a0_0x23a4;Object['defineProperty'](_0x1cabbf,_0x8b574(0x3f1),{'value':!0x0});},function(_0x5aa340,_0x1487b3,_0xc03ef7){const _0x456764=a0_0x23a4;var _0x2d232c,_0x46e209=this&&this['__decorate']||function(_0xa2bc61,_0x5224b5,_0x5b320a,_0x58fe71){const _0x8aa6e1=a0_0x23a4;var _0x286eae,_0x4b2342=arguments['length'],_0x1f68b4=_0x4b2342<0x3?_0x5224b5:null===_0x58fe71?_0x58fe71=Object['getOwnPropertyDescriptor'](_0x5224b5,_0x5b320a):_0x58fe71;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x8aa6e1(0x2e3)])_0x1f68b4=Reflect[_0x8aa6e1(0x2e3)](_0xa2bc61,_0x5224b5,_0x5b320a,_0x58fe71);else{for(var _0x4497e3=_0xa2bc61['length']-0x1;_0x4497e3>=0x0;_0x4497e3--)(_0x286eae=_0xa2bc61[_0x4497e3])&&(_0x1f68b4=(_0x4b2342<0x3?_0x286eae(_0x1f68b4):_0x4b2342>0x3?_0x286eae(_0x5224b5,_0x5b320a,_0x1f68b4):_0x286eae(_0x5224b5,_0x5b320a))||_0x1f68b4);}return _0x4b2342>0x3&&_0x1f68b4&&Object[_0x8aa6e1(0x213)](_0x5224b5,_0x5b320a,_0x1f68b4),_0x1f68b4;},_0x1952ae=this&&this['__metadata']||function(_0x29d7a0,_0x2d83e4){const _0x3f0125=a0_0x23a4;if(_0x3f0125(0x34a)==typeof Reflect&&'function'==typeof Reflect[_0x3f0125(0x216)])return Reflect[_0x3f0125(0x216)](_0x29d7a0,_0x2d83e4);};Object['defineProperty'](_0x1487b3,'__esModule',{'value':!0x0}),_0x1487b3['DeviceLockService']=void 0x0;const _0x338cce=_0xc03ef7(0x2),_0x3a306e=_0xc03ef7(0xf),_0x5076cc=_0xc03ef7(0x15);let _0x4e6255=class{constructor(_0x287ff3){const _0x49924d=a0_0x23a4;this['redisService']=_0x287ff3,this['logger']=new _0x338cce['Logger']('DeviceLockService'),this['REDIS_LOCK_PREFIX']=_0x49924d(0x1dd),this['DEFAULT_LOCK_TTL']=0x927c0;}async['acquireLock'](_0x34753d,_0xe845ca,_0x32392d,_0x3345c9=this['DEFAULT_LOCK_TTL']){const _0x798073=a0_0x23a4;try{const _0x5beab3=''+this['REDIS_LOCK_PREFIX']+_0x34753d,_0x5e9d8e=''+this['REDIS_LOCK_PREFIX']+_0x34753d+_0x798073(0x177),_0x43757e=(0x0,_0x5076cc['randomUUID'])(),_0x5aef8c=Math[_0x798073(0x406)](_0x3345c9/0x3e8),_0x1e6109=await this[_0x798073(0x1f1)]['getClient']();if('OK'===await _0x1e6109['set'](_0x5beab3,_0x43757e,'EX',_0x5aef8c,'NX')){const _0x1600ce={'deviceId':_0x34753d,'lockType':_0xe845ca,'lockedAt':Date['now'](),'lockedBy':_0x32392d,'ttl':_0x3345c9};return await this['redisService']['setex'](_0x5e9d8e,_0x5aef8c,JSON['stringify'](_0x1600ce)),this['logger']['log']('['+_0x34753d+']\x20Acquired\x20'+_0xe845ca+'\x20lock\x20('+_0x32392d+')\x20with\x20lockId\x20'+_0x43757e),!0x0;}return this[_0x798073(0x25d)][_0x798073(0x3d4)]('['+_0x34753d+_0x798073(0x254)),!0x1;}catch(_0x387b9a){return this['logger']['error']('['+_0x34753d+']\x20Error\x20acquiring\x20lock:\x20'+_0x387b9a['message']),!0x1;}}async['releaseLock'](_0x5bb6e1){const _0x3a48fd=a0_0x23a4;try{const _0x42ada9=''+this['REDIS_LOCK_PREFIX']+_0x5bb6e1,_0x5e8d78=''+this['REDIS_LOCK_PREFIX']+_0x5bb6e1+':meta',_0x56a1f5=await this['redisService']['getClient'](),_0x3f8800=await _0x56a1f5['get'](_0x42ada9);if(!_0x3f8800)return await this['redisService']['del'](_0x5e8d78),void this['logger']['debug']('['+_0x5bb6e1+']\x20Device\x20is\x20not\x20locked,\x20nothing\x20to\x20release');0x1===await _0x56a1f5[_0x3a48fd(0x41d)](_0x3a48fd(0x202),0x2,_0x42ada9,_0x5e8d78,_0x3f8800)?this['logger']['log']('['+_0x5bb6e1+']\x20Released\x20lock\x20(lockId:\x20'+_0x3f8800+')'):this['logger']['warn']('['+_0x5bb6e1+']\x20Lock\x20was\x20already\x20released\x20or\x20changed\x20(expected\x20lockId:\x20'+_0x3f8800+')');}catch(_0x10baa6){this[_0x3a48fd(0x25d)][_0x3a48fd(0x382)]('['+_0x5bb6e1+']\x20Error\x20releasing\x20lock:\x20'+_0x10baa6[_0x3a48fd(0x1c8)],_0x10baa6['stack']);}}async['getLock'](_0x3aae68){const _0x9c0c0f=a0_0x23a4;try{const _0x289e6c=''+this[_0x9c0c0f(0x403)]+_0x3aae68,_0x538fcd=await this['redisService']['get'](_0x289e6c);if(!_0x538fcd)return null;const _0x153a3c=''+this[_0x9c0c0f(0x403)]+_0x3aae68+':meta',_0x546eb7=await this['redisService']['get'](_0x153a3c);return _0x546eb7?{...JSON['parse'](_0x546eb7),'lockId':_0x538fcd}:{'deviceId':_0x3aae68,'lockType':'transfer','lockedAt':Date['now'](),'lockedBy':_0x9c0c0f(0x3ee),'ttl':this['DEFAULT_LOCK_TTL'],'lockId':_0x538fcd};}catch(_0x4fab15){return this[_0x9c0c0f(0x25d)]['error']('['+_0x3aae68+']\x20Error\x20getting\x20lock:\x20'+_0x4fab15['message']),null;}}async['isLocked'](_0x289f67,_0x3cff89){const _0xd4ea61=a0_0x23a4;try{const _0x7ec540=''+this['REDIS_LOCK_PREFIX']+_0x289f67;if(!await this['redisService'][_0xd4ea61(0x2b9)](_0x7ec540))return!0x1;const _0x9e1a84=await this['getLock'](_0x289f67);return!(!_0x9e1a84||_0x3cff89&&_0x9e1a84['lockType']===_0x3cff89);}catch(_0x47a728){return this[_0xd4ea61(0x25d)][_0xd4ea61(0x382)]('['+_0x289f67+']\x20Error\x20checking\x20lock\x20status:\x20'+_0x47a728['message']),!0x1;}}async['extendLock'](_0xc68e7b,_0xf77a10){const _0x131444=a0_0x23a4;try{if(!await this['getLock'](_0xc68e7b))return!0x1;const _0x1e4d4d=''+this['REDIS_LOCK_PREFIX']+_0xc68e7b,_0x24b752=''+this[_0x131444(0x403)]+_0xc68e7b+':meta',_0x2385d3=await this['redisService'][_0x131444(0x31b)](),_0x466b65=await _0x2385d3['ttl'](_0x1e4d4d);if(_0x466b65<=0x0)return!0x1;const _0x5724c8=Math['ceil']((0x3e8*_0x466b65+_0xf77a10)/0x3e8);return 0x1===await _0x2385d3['expire'](_0x1e4d4d,_0x5724c8)&&(await this['redisService']['expire'](_0x24b752,_0x5724c8),this['logger']['log']('['+_0xc68e7b+']\x20Extended\x20lock\x20by\x20'+_0xf77a10+'ms'),!0x0);}catch(_0x3e2171){return this['logger']['error']('['+_0xc68e7b+']\x20Error\x20extending\x20lock:\x20'+_0x3e2171[_0x131444(0x1c8)]),!0x1;}}async['releaseLockByType'](_0x5b0671,_0x136864){const _0x266e49=a0_0x23a4;try{const _0x292dec=await this['getLock'](_0x5b0671);if(!_0x292dec)return!0x1;if(_0x292dec['lockType']!==_0x136864)return!0x1;const _0x44856c=''+this['REDIS_LOCK_PREFIX']+_0x5b0671,_0x4b9d33=''+this['REDIS_LOCK_PREFIX']+_0x5b0671+':meta';return await this['redisService']['del'](_0x44856c),await this['redisService']['del'](_0x4b9d33),this[_0x266e49(0x25d)][_0x266e49(0x230)]('['+_0x5b0671+']\x20Force\x20released\x20'+_0x136864+'\x20lock'),!0x0;}catch(_0x26663c){return this[_0x266e49(0x25d)]['error']('['+_0x5b0671+']\x20Error\x20releasing\x20'+_0x136864+'\x20lock:\x20'+_0x26663c['message']),!0x1;}}async[_0x456764(0x2d7)](){const _0x4f22c9=_0x456764;try{const _0x88a7e=this['REDIS_LOCK_PREFIX']+'*';return(await this['redisService']['keys'](_0x88a7e))['filter'](_0x10524f=>!_0x10524f[_0x4f22c9(0x22b)](':meta'))[_0x4f22c9(0x1fa)];}catch(_0x5a5672){return this[_0x4f22c9(0x25d)][_0x4f22c9(0x382)]('Error\x20getting\x20all\x20lock\x20keys:\x20'+_0x5a5672['message']),0x0;}}};_0x1487b3[_0x456764(0x3a5)]=_0x4e6255,_0x1487b3[_0x456764(0x3a5)]=_0x4e6255=_0x46e209([(0x0,_0x338cce['Injectable'])(),_0x1952ae(_0x456764(0x2b1),[_0x456764(0x24f)==typeof(_0x2d232c=void 0x0!==_0x3a306e['RedisService']&&_0x3a306e['RedisService'])?_0x2d232c:Object])],_0x4e6255);},_0x5c7ae4=>{_0x5c7ae4['exports']=require('crypto');},_0x441cc4=>{const _0x578558=a0_0x23a4;_0x441cc4[_0x578558(0x391)]=require('lodash');},function(_0x6cca41,_0x3c0fef,_0x2cc3b9){const _0xbf8644=a0_0x23a4;var _0x19c79d,_0x4be887,_0x4d3cee,_0x3115fb,_0x139f54,_0x1cc0ee=this&&this['__decorate']||function(_0x180c66,_0x570973,_0x583d88,_0x471f87){const _0x4b93e5=a0_0x23a4;var _0x324064,_0x2ad4d7=arguments[_0x4b93e5(0x1fa)],_0x2d7fb1=_0x2ad4d7<0x3?_0x570973:null===_0x471f87?_0x471f87=Object[_0x4b93e5(0x26e)](_0x570973,_0x583d88):_0x471f87;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x2d7fb1=Reflect['decorate'](_0x180c66,_0x570973,_0x583d88,_0x471f87);else{for(var _0x524882=_0x180c66['length']-0x1;_0x524882>=0x0;_0x524882--)(_0x324064=_0x180c66[_0x524882])&&(_0x2d7fb1=(_0x2ad4d7<0x3?_0x324064(_0x2d7fb1):_0x2ad4d7>0x3?_0x324064(_0x570973,_0x583d88,_0x2d7fb1):_0x324064(_0x570973,_0x583d88))||_0x2d7fb1);}return _0x2ad4d7>0x3&&_0x2d7fb1&&Object[_0x4b93e5(0x213)](_0x570973,_0x583d88,_0x2d7fb1),_0x2d7fb1;},_0x25be92=this&&this['__metadata']||function(_0x4629b6,_0x1423fb){const _0x32c569=a0_0x23a4;if('object'==typeof Reflect&&_0x32c569(0x24f)==typeof Reflect['metadata'])return Reflect['metadata'](_0x4629b6,_0x1423fb);},_0xfb771a=this&&this['__param']||function(_0x3352f,_0xe475f){return function(_0x53afde,_0x36a0d8){_0xe475f(_0x53afde,_0x36a0d8,_0x3352f);};};Object[_0xbf8644(0x213)](_0x3c0fef,'__esModule',{'value':!0x0}),_0x3c0fef[_0xbf8644(0x2d9)]=void 0x0;const _0x16da79=_0x2cc3b9(0x2),_0x432602=_0x2cc3b9(0xe),_0x25e82c=_0x2cc3b9(0x13),_0x2117c0=_0x2cc3b9(0xd),_0x1d7272=_0x2cc3b9(0x18),_0x2666c3=_0x2cc3b9(0x19),_0x2af8fe=_0x2cc3b9(0x1a),_0x497426=_0x2cc3b9(0x4),_0x5deb57=_0x2cc3b9(0x1b),_0x8ad8e3=_0x2cc3b9(0x1e),_0x5ebdf0=_0x2cc3b9(0x21),_0xe910c0=_0x2cc3b9(0x22),_0x3cced2=_0x2cc3b9(0x20);let _0x2a3c09=_0x19c79d=class{constructor(_0x480a10,_0x4e1158,_0x16affd,_0x2c01ee){const _0x42408d=_0xbf8644;this['wsService']=_0x480a10,this['deviceService']=_0x4e1158,this[_0x42408d(0x3e4)]=_0x16affd,this['imagePreprocessingService']=_0x2c01ee,this['baseTransactionFolderPath']='C:/EasyData',this['baseTransactionExecutionFolder']=_0x42408d(0x312),this['cleanupFolder']=async(_0x8f714a,_0x1ce8a2)=>{const _0x53fe7d=_0x42408d;if((0x0,_0x2666c3['existsSync'])(_0x8f714a))try{await(0x0,_0x2af8fe['rm'])(_0x8f714a,{'recursive':!0x0,'force':!0x0});}catch(_0x365410){this[_0x53fe7d(0x25d)]['debug']('['+_0x1ce8a2+_0x53fe7d(0x24a)+_0x365410[_0x53fe7d(0x1c8)]);}},this['logger']=new _0x16da79['Logger']('BaseBankService'),_0x19c79d[_0x42408d(0x31e)](this['baseTransactionFolderPath'],this['logger']),_0x19c79d['createTransactionFolder'](this[_0x42408d(0x178)],this['logger']);}static[_0xbf8644(0x31e)](_0x1fe160,_0x17375d){const _0x591251=_0xbf8644;if(!_0x19c79d['folderCreated']){if(_0x19c79d['folderCreationInProgress']){let _0x20ac2d=0x0;const _0x24345a=0xa;for(;_0x19c79d['folderCreationInProgress']&&_0x20ac2d<_0x24345a;){_0x20ac2d++;const _0x337c5b=Date['now']();for(;Date[_0x591251(0x442)]()-_0x337c5b<0xa;);}if(_0x19c79d['folderCreated']||(0x0,_0x2666c3['existsSync'])(_0x1fe160))return void(_0x19c79d['folderCreated']=!0x0);}try{_0x19c79d[_0x591251(0x3da)]=!0x0,(0x0,_0x2666c3[_0x591251(0x1ae)])(_0x1fe160)?_0x17375d[_0x591251(0x3cc)]('Base\x20folder\x20already\x20exists:\x20'+_0x1fe160):((0x0,_0x2666c3[_0x591251(0x3e7)])(_0x1fe160,{'recursive':!0x0}),_0x17375d['log'](_0x591251(0x1c2)+_0x1fe160)),_0x19c79d['folderCreated']=!0x0;}catch(_0x5a87da){'EEXIST'!==_0x5a87da['code']?_0x17375d['error']('Failed\x20to\x20create\x20base\x20folder\x20'+_0x1fe160+':\x20'+_0x5a87da[_0x591251(0x1c8)]):(_0x19c79d['folderCreated']=!0x0,_0x17375d[_0x591251(0x3cc)]('Base\x20folder\x20already\x20exists\x20(created\x20by\x20another\x20process):\x20'+_0x1fe160));}finally{_0x19c79d['folderCreationInProgress']=!0x1;}}}['getBankCode'](){return this['BANK_CODE'];}async[_0xbf8644(0x2a4)](_0x37faa8){const _0x7ad8ea=_0xbf8644;this[_0x7ad8ea(0x25d)][_0x7ad8ea(0x230)]('['+_0x37faa8+']\x20Killing\x20'+this['BANK_CODE']+'\x20app'),await this['wsService']['killApp'](_0x37faa8,this['BUNDLE_ID']);}async[_0xbf8644(0x37a)](_0x3a811d,_0x1cd659,_0x3a8880,_0x3c55de,_0xce728b=''){const _0x35e4b3=_0xbf8644;await this['wsService']['click'](_0x3a811d,_0x1cd659,_0x3a8880,0.2),_0xce728b&&this['logger'][_0x35e4b3(0x230)](_0xce728b),await(0x0,_0x1d7272['sleep'])(_0x3c55de);}async['verifyScreenState'](_0x4cf9bc,_0x5814d4){const _0x50bcf1=_0xbf8644,{expectedTexts:_0xa4885f=[],unexpectedTexts:_0x5ae802=[],timeout:_0x1f6908=0x7530,pollInterval:_0x34a37a=0x1f4,roi:_0xb84ca,fieldType:_0x25329b='full',preprocess:_0x8c3f89}=_0x5814d4,_0x3278a9=Date['now']();let _0x1d79a9=0x0;const _0x2a3edd=(0x0,_0x497426[_0x50bcf1(0x25a)])(this['baseTransactionExecutionFolder'],'scan_'+_0x4cf9bc),_0x585e09=_0xb84ca?'ROI:\x20x='+_0xb84ca['x']+',\x20y='+_0xb84ca['y']+',\x20w='+_0xb84ca['width']+',\x20h='+_0xb84ca['height']:_0x50bcf1(0x35f);this[_0x50bcf1(0x25d)]['debug']('['+_0x4cf9bc+_0x50bcf1(0x1f5)+_0xa4885f['join'](',\x20')+'],\x20Unexpected:\x20['+_0x5ae802[_0x50bcf1(0x25a)](',\x20')+'],\x20'+_0x585e09+_0x50bcf1(0x335)+_0x1f6908+'ms,\x20Poll:\x20'+_0x34a37a+'ms');try{for(await this[_0x50bcf1(0x1e3)](_0x2a3edd,_0x4cf9bc),await(0x0,_0x2af8fe['mkdir'])(_0x2a3edd,{'recursive':!0x0});Date['now']()-_0x3278a9<_0x1f6908;){_0x1d79a9++;let _0x396818=null;try{const _0x293fbc=Date['now']();await this['wsService'][_0x50bcf1(0x2bc)](_0x4cf9bc,{'folderPath':_0x2a3edd});let _0x5630da=null;const _0x2f727c=0x5;let _0x9bd779=0x0;for(;_0x9bd779<_0x2f727c&&!_0x5630da;){_0x9bd779++,await(0x0,_0x1d7272['sleep'])(0x1f4);try{if(!(0x0,_0x2666c3['existsSync'])(_0x2a3edd))continue;const _0xb23fa2=(await(0x0,_0x2af8fe['readdir'])(_0x2a3edd))['filter'](_0x568041=>_0x568041['endsWith'](_0x50bcf1(0x3f0)));if(0x0===_0xb23fa2[_0x50bcf1(0x1fa)])continue;let _0x6386db=0x0;Date['now']();for(const _0x3f286a of _0xb23fa2){const _0x381564=(0x0,_0x497426['join'])(_0x2a3edd,_0x3f286a);try{const _0x3e2159=await(0x0,_0x2af8fe['stat'])(_0x381564);if(0x0===_0x3e2159['size'])continue;_0x3e2159['mtimeMs']>=_0x293fbc-0x7d0&&_0x3e2159['mtimeMs']>_0x6386db&&(_0x6386db=_0x3e2159['mtimeMs'],_0x5630da=_0x381564);}catch(_0x16a019){continue;}}}catch(_0x54e94c){continue;}}if(!_0x5630da){await(0x0,_0x1d7272['sleep'])(_0x34a37a);continue;}_0x396818=_0x5630da;const _0x19f887=[..._0xa4885f,..._0x5ae802],_0x217b71=await this['ocrService']['fastScreenOCR'](_0x396818,_0x19f887,{'fieldType':_0xb84ca?'singleLine':_0x25329b,'customROI':_0xb84ca,'preprocess':_0x8c3f89});if(!_0x217b71||!_0x217b71['found']){await(0x0,_0x1d7272[_0x50bcf1(0x37f)])(_0x34a37a);continue;}const _0x1367a7=0x0===_0xa4885f['length']||_0xa4885f['some'](_0x5480f9=>_0x217b71[_0x50bcf1(0x183)]['includes'](_0x5480f9)),_0x327709=_0x5ae802['some'](_0x585c5c=>_0x217b71['matchedTexts']['includes'](_0x585c5c));if(_0x1367a7&&!_0x327709){await this['cleanupFolder'](_0x2a3edd,_0x4cf9bc);const _0x1ce68a=Date[_0x50bcf1(0x442)]()-_0x3278a9,_0x9921c9=_0x217b71['result']?.['processingTime']||0x0,_0x2cfe31=_0xb84ca?_0x50bcf1(0x290)+_0xb84ca['x']+','+_0xb84ca['y']+'\x20'+_0xb84ca[_0x50bcf1(0x423)]+'x'+_0xb84ca['height']+')':'';return this[_0x50bcf1(0x25d)][_0x50bcf1(0x230)]('['+_0x4cf9bc+']\x20Screen\x20verified\x20successfully\x20after\x20'+_0x1ce68a+_0x50bcf1(0x392)+_0x1d79a9+'\x20attempts,\x20OCR:\x20'+_0x9921c9+_0x50bcf1(0x276)+_0x2cfe31+'.\x20Matched:\x20['+_0x217b71['matchedTexts']['join'](',\x20')+']'),!0x0;}if(_0x1d79a9%0x5==0x0&&this[_0x50bcf1(0x25d)]['debug']('['+_0x4cf9bc+']\x20Screen\x20not\x20matched\x20yet\x20(attempt\x20'+_0x1d79a9+_0x50bcf1(0x38d)+_0x217b71['matchedTexts']['join'](',\x20')+_0x50bcf1(0x15b)+_0xa4885f['join'](',\x20')+']'),_0x396818)try{await(0x0,_0x2af8fe['unlink'])(_0x396818);}catch{}await(0x0,_0x1d7272['sleep'])(_0x34a37a);}catch(_0x598da7){this[_0x50bcf1(0x25d)]['debug']('['+_0x4cf9bc+']\x20Error\x20verifying\x20screen\x20(attempt\x20'+_0x1d79a9+'):\x20'+_0x598da7[_0x50bcf1(0x1c8)]+',\x20retrying...'),await(0x0,_0x1d7272[_0x50bcf1(0x37f)])(_0x34a37a);}}await this[_0x50bcf1(0x1e3)](_0x2a3edd,_0x4cf9bc);const _0x114c81=Date[_0x50bcf1(0x442)]()-_0x3278a9;return this['logger']['warn']('['+_0x4cf9bc+']\x20Screen\x20verification\x20timeout\x20after\x20'+_0x114c81+_0x50bcf1(0x392)+_0x1d79a9+_0x50bcf1(0x17a)+_0xa4885f['join'](',\x20')+']'),!0x1;}catch(_0xcfa087){throw await this['cleanupFolder'](_0x2a3edd,_0x4cf9bc),_0xcfa087;}}async['getLatestImagePath'](_0x3c995d,_0x26c422=0x2710,_0xdea0ec=0x1f4){const _0xbc4cd7=_0xbf8644;if(!_0x3c995d)return this['logger']['warn']('Folder\x20path\x20is\x20null\x20or\x20empty'),null;const _0x3ce641=Date[_0xbc4cd7(0x442)]();let _0x128ecf=0x0;for(this['logger']['debug']('Scanning\x20folder\x20for\x20bill\x20image:\x20'+_0x3c995d+',\x20timeout:\x20'+_0x26c422+'ms,\x20pollInterval:\x20'+_0xdea0ec+'ms');Date['now']()-_0x3ce641<_0x26c422;){_0x128ecf++;try{if(!(0x0,_0x2666c3[_0xbc4cd7(0x1ae)])(_0x3c995d)){await(0x0,_0x1d7272[_0xbc4cd7(0x37f)])(_0xdea0ec);continue;}const _0x21e5c6=await(0x0,_0x2af8fe[_0xbc4cd7(0x3d8)])(_0x3c995d);if(0x0===_0x21e5c6[_0xbc4cd7(0x1fa)]){await(0x0,_0x1d7272['sleep'])(_0xdea0ec);continue;}const _0x17d88c=(await Promise['all'](_0x21e5c6['map'](async _0x3e9081=>{const _0x17def7=_0xbc4cd7;try{const _0x390006=(0x0,_0x497426['join'])(_0x3c995d,_0x3e9081),_0x4fc2df=await(0x0,_0x2af8fe[_0x17def7(0x36d)])(_0x390006);return{'fullPath':_0x390006,'mtime':_0x4fc2df[_0x17def7(0x367)],'size':_0x4fc2df['size']};}catch(_0x3520c2){return null;}})))['filter'](_0x3c30de=>null!==_0x3c30de&&_0x3c30de['size']>0x0);if(0x0===_0x17d88c[_0xbc4cd7(0x1fa)]){await(0x0,_0x1d7272[_0xbc4cd7(0x37f)])(_0xdea0ec);continue;}_0x17d88c[_0xbc4cd7(0x2af)]((_0x1f5ac,_0x40d84f)=>_0x40d84f['mtime']-_0x1f5ac['mtime']);const _0x435e43=_0x17d88c[0x0]['fullPath'],_0x13c4aa=Date[_0xbc4cd7(0x442)]()-_0x3ce641;return this['logger']['log']('Found\x20latest\x20bill\x20image:\x20'+_0x435e43+'\x20after\x20'+_0x13c4aa+'ms\x20('+_0x128ecf+'\x20attempts)'),_0x435e43;}catch(_0x2e33d4){this['logger']['debug']('Error\x20scanning\x20folder\x20'+_0x3c995d+_0xbc4cd7(0x3ca)+_0x128ecf+'):\x20'+_0x2e33d4[_0xbc4cd7(0x1c8)]+',\x20retrying...'),await(0x0,_0x1d7272['sleep'])(_0xdea0ec);}}const _0x8d83e5=Date['now']()-_0x3ce641;return this['logger']['warn']('Timeout\x20scanning\x20folder\x20for\x20bill\x20image:\x20'+_0x3c995d+'\x20after\x20'+_0x8d83e5+'ms\x20('+_0x128ecf+'\x20attempts)'),null;}async[_0xbf8644(0x3c6)](_0x1cadcf,_0x55f638,_0xea9af2){const _0xffa69c=_0xbf8644,_0x666064=(0x0,_0x497426['join'])(this['baseTransactionExecutionFolder'],'scan_'+_0x1cadcf),_0x1e868d=_0x55f638[_0xffa69c(0x30c)](_0x41f366=>({'name':_0x41f366[_0xffa69c(0x162)],'hint':(0x0,_0x3cced2[_0xffa69c(0x25b)])(_0x41f366[_0xffa69c(0x33b)])})),_0x15adcd=Date['now']();let _0x56ca3b=0x0;const {roi:_0x3c4915,timeout:_0x4dd2fa,pollInterval:_0x3dbc80}=_0xea9af2,_0x7f2f72=_0x3c4915?'ROI:\x20x='+_0x3c4915['x']+',\x20y='+_0x3c4915['y']+',\x20w='+_0x3c4915['width']+_0xffa69c(0x386)+_0x3c4915['height']:'Full\x20screen';this['logger']['debug']('['+_0x1cadcf+_0xffa69c(0x2b7)+_0x55f638['map'](_0x1f220e=>_0x1f220e['name'])['join'](_0xffa69c(0x393))+'],\x20'+_0x7f2f72+',\x20Timeout:\x20'+_0x4dd2fa+'ms,\x20Poll:\x20'+_0x3dbc80+'ms');try{for(await this['cleanupFolder'](_0x666064,_0x1cadcf),await(0x0,_0x2af8fe[_0xffa69c(0x342)])(_0x666064,{'recursive':!0x0});Date['now']()-_0x15adcd<_0x4dd2fa;){_0x56ca3b++;let _0x135929=null;try{const _0x197881=Date['now']();await this['wsService']['captureScreen'](_0x1cadcf,{'folderPath':_0x666064});let _0x4ea274=null;const _0x739cb5=0x5;let _0x300197=0x0;for(;_0x300197<_0x739cb5&&!_0x4ea274;){_0x300197++,await(0x0,_0x1d7272[_0xffa69c(0x37f)])(0x1f4);try{if(!(0x0,_0x2666c3[_0xffa69c(0x1ae)])(_0x666064))continue;const _0x234074=(await(0x0,_0x2af8fe[_0xffa69c(0x3d8)])(_0x666064))['filter'](_0x4fd788=>_0x4fd788[_0xffa69c(0x22b)](_0xffa69c(0x3f0)));if(0x0===_0x234074['length'])continue;let _0x538342=0x0;for(const _0x6a3dc1 of _0x234074){const _0x4bd91b=(0x0,_0x497426['join'])(_0x666064,_0x6a3dc1);try{const _0x51cb9d=await(0x0,_0x2af8fe['stat'])(_0x4bd91b);if(0x0===_0x51cb9d['size'])continue;_0x51cb9d['mtimeMs']>=_0x197881-0x7d0&&_0x51cb9d['mtimeMs']>_0x538342&&(_0x538342=_0x51cb9d['mtimeMs'],_0x4ea274=_0x4bd91b);}catch(_0x2e86e1){continue;}}}catch(_0x431b7d){continue;}}if(!_0x4ea274){await(0x0,_0x1d7272['sleep'])(_0x3dbc80);continue;}const _0x24d248=await(0x0,_0x2af8fe['readFile'])(_0x4ea274),_0x47adcf=await this['imagePreprocessingService'][_0xffa69c(0x417)](_0x24d248,_0xea9af2[_0xffa69c(0x2ea)]?_0xea9af2['roi']:{'x':0x0,'y':0x0,'width':0x1,'height':0x1},void 0x0,_0xea9af2['preprocess']),_0x3a2a05=await this['ocrService']['recognizeFromBuffer'](_0x47adcf['buffer']);if(!_0x3a2a05[_0xffa69c(0x2e4)]){await(0x0,_0x1d7272['sleep'])(_0x3dbc80);continue;}const _0x419c4c=(0x0,_0x3cced2['removeVietnameseTones'])(_0x3a2a05['text']),_0x325a7e=_0x1e868d['find'](_0x4a04fb=>_0x419c4c['includes'](_0x4a04fb['hint']));if(!_0x325a7e){await(0x0,_0x1d7272['sleep'])(_0x3dbc80);continue;}if(_0x135929)try{await(0x0,_0x2af8fe[_0xffa69c(0x1af)])(_0x135929);}catch{}return _0x325a7e;}catch(_0x2eb999){this[_0xffa69c(0x25d)][_0xffa69c(0x3cc)]('['+_0x1cadcf+_0xffa69c(0x328)+_0x56ca3b+_0xffa69c(0x25c)+_0x2eb999[_0xffa69c(0x1c8)]+_0xffa69c(0x3de)),await(0x0,_0x1d7272[_0xffa69c(0x37f)])(_0x3dbc80);}}await this[_0xffa69c(0x1e3)](_0x666064,_0x1cadcf);const _0x2f07f6=Date['now']()-_0x15adcd;return this[_0xffa69c(0x25d)]['warn']('['+_0x1cadcf+']\x20Screen\x20verification\x20timeout\x20after\x20'+_0x2f07f6+'ms\x20('+_0x56ca3b+_0xffa69c(0x1a4)+_0x55f638['join']('\x20or\x20')+'],'),null;}catch(_0x8f6b0a){throw await this['cleanupFolder'](_0x666064,_0x1cadcf),_0x8f6b0a;}}async[_0xbf8644(0x344)](_0x26ce05,_0x3fca99,_0x1eec7e,_0x1e714e,_0x26113a){const _0x15d1dd=_0xbf8644;return await this[_0x15d1dd(0x292)]['click'](_0x26ce05,_0x3fca99,_0x1eec7e,0.2),_0x26113a&&this[_0x15d1dd(0x25d)]['log'](_0x26113a),await this['verifyScreenState'](_0x26ce05,_0x1e714e);}async[_0xbf8644(0x19a)](_0x37a685,_0x332bc8,_0xbf9c95,_0x46d4e5){const _0x3f8e86=_0xbf8644;for(let _0x2fcebb=0x1;_0x2fcebb<=0x3;_0x2fcebb++){if(await this[_0x3f8e86(0x292)]['swipe'](_0x37a685,_0x332bc8),await(0x0,_0x1d7272[_0x3f8e86(0x37f)])(0x320),_0x46d4e5&&0x1===_0x2fcebb&&this['logger'][_0x3f8e86(0x230)](_0x46d4e5),await this['verifyScreenState'](_0x37a685,{..._0xbf9c95,'timeout':0xbb8}))return _0x2fcebb>0x1&&this['logger']['log']('['+_0x37a685+']\x20Screen\x20verified\x20after\x20'+_0x2fcebb+'\x20swipe\x20attempts'),!0x0;try{const _0x2d05ac=(0x0,_0x497426[_0x3f8e86(0x25a)])(this[_0x3f8e86(0x178)],'scan_'+_0x37a685+'_debug');if((0x0,_0x2666c3['existsSync'])(_0x2d05ac))try{await(0x0,_0x2af8fe['rm'])(_0x2d05ac,{'recursive':!0x0,'force':!0x0});}catch{}await(0x0,_0x2af8fe[_0x3f8e86(0x342)])(_0x2d05ac,{'recursive':!0x0});const _0x12e9da=Date['now']();await this['wsService']['captureScreen'](_0x37a685,{'folderPath':_0x2d05ac});let _0x58ab31=null;const _0x3c3697=0x5;let _0x1a9acc=0x0;for(;_0x1a9acc<_0x3c3697&&!_0x58ab31;){_0x1a9acc++,await(0x0,_0x1d7272[_0x3f8e86(0x37f)])(0x1f4);try{if(!(0x0,_0x2666c3['existsSync'])(_0x2d05ac))continue;const _0x58fea1=(await(0x0,_0x2af8fe['readdir'])(_0x2d05ac))[_0x3f8e86(0x18b)](_0x3ba430=>_0x3ba430[_0x3f8e86(0x22b)]('.png'));if(0x0===_0x58fea1['length'])continue;let _0x474c3a=0x0;for(const _0x603e2 of _0x58fea1){const _0x10d0a5=(0x0,_0x497426['join'])(_0x2d05ac,_0x603e2);try{const _0x1202f1=await(0x0,_0x2af8fe['stat'])(_0x10d0a5);_0x1202f1[_0x3f8e86(0x39e)]>0x0&&_0x1202f1['mtimeMs']>=_0x12e9da-0x7d0&&_0x1202f1[_0x3f8e86(0x367)]>_0x474c3a&&(_0x474c3a=_0x1202f1['mtimeMs'],_0x58ab31=_0x10d0a5);}catch{}}}catch{}}if(_0x58ab31){const {expectedTexts:_0x5c1f4c=[],unexpectedTexts:_0x484855=[],roi:_0x60bcb5,fieldType:_0x46e6f6=_0x3f8e86(0x2dd),preprocess:_0x2e933b}=_0xbf9c95,_0x2fa800=[..._0x5c1f4c,..._0x484855];let _0x146b7a='',_0x501f49=[];if(_0x2fa800['length']>0x0){const _0x381616=await this['ocrService']['fastScreenOCR'](_0x58ab31,_0x2fa800,{'fieldType':_0x60bcb5?'singleLine':_0x46e6f6,'customROI':_0x60bcb5,'preprocess':_0x2e933b});_0x146b7a=_0x381616?.['result']?.['text']||'',_0x501f49=_0x381616?.[_0x3f8e86(0x183)]||[];}else{const _0x3e9dff=await this['ocrService']['recognizeFromFile'](_0x58ab31,{'fieldType':_0x60bcb5?'singleLine':_0x46e6f6,'customROI':_0x60bcb5,'preprocess':_0x2e933b});_0x146b7a=_0x3e9dff?.['text']||'';}const _0x316055=_0x60bcb5?'\x20ROI:\x20('+_0x60bcb5['x']+','+_0x60bcb5['y']+'\x20'+_0x60bcb5['width']+'x'+_0x60bcb5['height']+')':'';_0x146b7a?this['logger'][_0x3f8e86(0x3d4)]('['+_0x37a685+']\x20Swipe\x20attempt\x20'+_0x2fcebb+_0x3f8e86(0x192)+_0x146b7a+'\x22'+(_0x501f49[_0x3f8e86(0x1fa)]>0x0?'\x20|\x20Matched\x20texts:\x20['+_0x501f49['join'](',\x20')+']':'')+(_0x3f8e86(0x2b5)+(_0x5c1f4c[_0x3f8e86(0x25a)](',\x20')||'none')+']'+_0x316055)):this[_0x3f8e86(0x25d)][_0x3f8e86(0x3d4)]('['+_0x37a685+']\x20Swipe\x20attempt\x20'+_0x2fcebb+'/3\x20-\x20OCR\x20found\x20no\x20text'+_0x316055);}else this['logger'][_0x3f8e86(0x3d4)]('['+_0x37a685+']\x20Swipe\x20attempt\x20'+_0x2fcebb+'/3\x20-\x20Could\x20not\x20find\x20screenshot\x20file\x20after\x20'+_0x1a9acc+_0x3f8e86(0x353));try{await(0x0,_0x2af8fe['rm'])(_0x2d05ac,{'recursive':!0x0,'force':!0x0});}catch{}}catch(_0x132f8a){this[_0x3f8e86(0x25d)][_0x3f8e86(0x3cc)]('['+_0x37a685+_0x3f8e86(0x40f)+_0x132f8a['message']);}_0x2fcebb<0x3&&this['logger'][_0x3f8e86(0x3cc)]('['+_0x37a685+']\x20Screen\x20not\x20detected\x20after\x20swipe\x20(attempt\x20'+_0x2fcebb+'/3),\x20retrying...');}return this['logger']['warn']('['+_0x37a685+_0x3f8e86(0x30d)),!0x1;}async['createBillFolder'](_0x10b321){const _0x22dec2=(0x0,_0x497426['resolve'])(this['baseTransactionFolderPath'],_0x10b321);await(0x0,_0x2af8fe['mkdir'])(_0x22dec2,{'recursive':!0x0});}async['captureScreen'](_0x14e3ca,_0x2e673c){const _0x1626bc=_0xbf8644;this['logger']['log']('Capturing\x20screen\x20on\x20device\x20'+_0x14e3ca+'\x20with\x20folderPath:\x20'+_0x2e673c['folderPath']);const _0x93fb5a=(0x0,_0x497426['resolve'])(this['baseTransactionFolderPath'],_0x2e673c['folderPath']);await this['wsService'][_0x1626bc(0x2bc)](_0x14e3ca,{..._0x2e673c,'folderPath':_0x93fb5a}),await(0x0,_0x1d7272[_0x1626bc(0x37f)])(0x1f4);}async['getBillImagePath'](_0x544c9c,_0xd83bf6=0x2710,_0xfb881c=0x1f4){const _0x505512=_0xbf8644;if(!_0x544c9c)return this['logger']['warn']('Folder\x20path\x20is\x20null\x20or\x20empty'),null;const _0x36a7d0=(0x0,_0x497426[_0x505512(0x25a)])(this['baseTransactionFolderPath'],_0x544c9c),_0x3ed14b=Date[_0x505512(0x442)]();let _0x2a4955=0x0;for(this[_0x505512(0x25d)]['debug'](_0x505512(0x1de)+_0x544c9c+_0x505512(0x400)+_0xd83bf6+'ms,\x20pollInterval:\x20'+_0xfb881c+'ms');Date[_0x505512(0x442)]()-_0x3ed14b<_0xd83bf6;){_0x2a4955++;try{if(!(0x0,_0x2666c3[_0x505512(0x1ae)])(_0x36a7d0)){await(0x0,_0x1d7272[_0x505512(0x37f)])(_0xfb881c);continue;}const _0x425cf7=await(0x0,_0x2af8fe['readdir'])(_0x36a7d0);if(0x0===_0x425cf7['length']){await(0x0,_0x1d7272['sleep'])(_0xfb881c);continue;}const _0x28ba5a=(await Promise['all'](_0x425cf7[_0x505512(0x30c)](async _0x76ae8f=>{try{const _0x55fbd9=(0x0,_0x497426['join'])(_0x36a7d0,_0x76ae8f),_0x3e885d=await(0x0,_0x2af8fe['stat'])(_0x55fbd9);return{'fullPath':_0x55fbd9,'mtime':_0x3e885d['mtimeMs'],'size':_0x3e885d['size']};}catch(_0x6134bc){return null;}})))['filter'](_0x59e754=>null!==_0x59e754&&_0x59e754['size']>0x0);if(0x0===_0x28ba5a['length']){await(0x0,_0x1d7272[_0x505512(0x37f)])(_0xfb881c);continue;}_0x28ba5a['sort']((_0xb4e26c,_0x5c16fe)=>_0x5c16fe[_0x505512(0x198)]-_0xb4e26c['mtime']);const _0x3347ab=_0x28ba5a[0x0][_0x505512(0x284)],_0x1f4d69=Date[_0x505512(0x442)]()-_0x3ed14b;return this['logger']['log'](_0x505512(0x327)+_0x3347ab+'\x20after\x20'+_0x1f4d69+_0x505512(0x392)+_0x2a4955+'\x20attempts)'),_0x3347ab;}catch(_0x1a21d8){this['logger'][_0x505512(0x3cc)]('Error\x20scanning\x20folder\x20'+_0x544c9c+_0x505512(0x3ca)+_0x2a4955+'):\x20'+_0x1a21d8['message']+',\x20retrying...'),await(0x0,_0x1d7272['sleep'])(_0xfb881c);}}const _0xf35c8=Date['now']()-_0x3ed14b;return this['logger']['warn']('Timeout\x20scanning\x20folder\x20for\x20bill\x20image:\x20'+_0x544c9c+'\x20after\x20'+_0xf35c8+'ms\x20('+_0x2a4955+'\x20attempts)'),null;}async['analyzeTransferBill'](_0x42a055,_0x279bff){const _0x108993=_0xbf8644,{ROI:_0x57a6f8,expectedTexts:_0x4a1115}=_0xe910c0['ANALYZE_BILL_ROI'][_0x42a055],_0x1a29c3=await this['getBillImagePath'](_0x279bff[_0x108993(0x2cd)]);try{if(!_0x1a29c3)return this['logger']['warn']('No\x20bill\x20image\x20path\x20'+_0x279bff[_0x108993(0x2cd)]),{'rawPath':null,'analyzedStatus':'na'};const _0xde0762=await this[_0x108993(0x3e4)]['fastScreenOCR'](_0x1a29c3,_0x4a1115,{'fieldType':'singleLine','customROI':_0x57a6f8,'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}});return _0xde0762['found']?{'rawPath':_0x1a29c3,'analyzedStatus':_0xde0762['found']?'success':'unknown'}:(this[_0x108993(0x25d)][_0x108993(0x3d4)]('No\x20OCR\x20result\x20found\x20for\x20'+_0x279bff['withdrawalCode']),{'rawPath':_0x1a29c3,'analyzedStatus':'na'});}catch(_0x16450b){return this['logger']['error']('Error\x20analyzing\x20transfer\x20bill:\x20'+_0x16450b[_0x108993(0x1c8)]),{'rawPath':_0x1a29c3,'analyzedStatus':'na'};}}async[_0xbf8644(0x3ed)](_0xa17cd5,_0x42ff99){const _0x36f8d0=_0xbf8644,_0x1e89f4=(0x0,_0x497426['join'])(this[_0x36f8d0(0x178)],'qrcode');await(0x0,_0x2af8fe[_0x36f8d0(0x342)])(_0x1e89f4,{'recursive':!0x0});const _0x347571='qr_'+_0x42ff99['withdrawalCode']+'.png',_0x568a63=(0x0,_0x497426['join'])(_0x1e89f4,_0x347571);await(0x0,_0x5ebdf0['toFile'])(_0x568a63,_0x42ff99[_0x36f8d0(0x380)],{'type':'png','width':0xe4,'margin':0x2}),await(0x0,_0x1d7272['sleep'])(0x1f4),await this['wsService']['transferFile'](_0xa17cd5,_0x568a63,0x1),await(0x0,_0x1d7272[_0x36f8d0(0x37f)])(0x1f4),this['logger']['log']('['+_0xa17cd5+']\x20QR\x20code\x20is\x20created\x20and\x20transferred\x20for\x20withdrawal\x20'+_0x42ff99['withdrawalId']);}};_0x3c0fef['BaseBankService']=_0x2a3c09,_0x2a3c09[_0xbf8644(0x3da)]=!0x1,_0x2a3c09['folderCreated']=!0x1,_0x3c0fef[_0xbf8644(0x2d9)]=_0x2a3c09=_0x19c79d=_0x1cc0ee([(0x0,_0x16da79['Injectable'])(),_0xfb771a(0x0,(0x0,_0x16da79['Inject'])(_0x2117c0['WEBSOCKET_SERVICE'])),_0x25be92('design:paramtypes',['function'==typeof(_0x4be887=void 0x0!==_0x25e82c['IWebSocketService']&&_0x25e82c[_0xbf8644(0x26a)])?_0x4be887:Object,'function'==typeof(_0x4d3cee=void 0x0!==_0x432602['DeviceService']&&_0x432602[_0xbf8644(0x427)])?_0x4d3cee:Object,'function'==typeof(_0x3115fb=void 0x0!==_0x5deb57['OCRService']&&_0x5deb57['OCRService'])?_0x3115fb:Object,'function'==typeof(_0x139f54=void 0x0!==_0x8ad8e3[_0xbf8644(0x375)]&&_0x8ad8e3['ImagePreprocessingService'])?_0x139f54:Object])],_0x2a3c09);},(_0x3062de,_0x46100a)=>{Object['defineProperty'](_0x46100a,'__esModule',{'value':!0x0}),_0x46100a['sleep']=void 0x0,_0x46100a['sleep']=_0x3c1508=>new Promise(_0x3cdab5=>setTimeout(_0x3cdab5,_0x3c1508));},_0x54c9fb=>{_0x54c9fb['exports']=require('fs');},_0xb08c81=>{_0xb08c81['exports']=require('fs/promises');},function(_0xb89e9a,_0x3d7048,_0x1f3a0a){const _0x2d17a1=a0_0x23a4;var _0x1665d8,_0x1936bc,_0x153030,_0x39a515=this&&this['__decorate']||function(_0x10149a,_0x16c734,_0x38e8b6,_0x1402b4){const _0x9d79db=a0_0x23a4;var _0x1d129b,_0x21f577=arguments['length'],_0x5115c1=_0x21f577<0x3?_0x16c734:null===_0x1402b4?_0x1402b4=Object['getOwnPropertyDescriptor'](_0x16c734,_0x38e8b6):_0x1402b4;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x9d79db(0x2e3)])_0x5115c1=Reflect[_0x9d79db(0x2e3)](_0x10149a,_0x16c734,_0x38e8b6,_0x1402b4);else{for(var _0x407883=_0x10149a['length']-0x1;_0x407883>=0x0;_0x407883--)(_0x1d129b=_0x10149a[_0x407883])&&(_0x5115c1=(_0x21f577<0x3?_0x1d129b(_0x5115c1):_0x21f577>0x3?_0x1d129b(_0x16c734,_0x38e8b6,_0x5115c1):_0x1d129b(_0x16c734,_0x38e8b6))||_0x5115c1);}return _0x21f577>0x3&&_0x5115c1&&Object['defineProperty'](_0x16c734,_0x38e8b6,_0x5115c1),_0x5115c1;},_0x3adbb7=this&&this[_0x2d17a1(0x434)]||function(_0x3c06e8,_0x1feedd){const _0x413a44=_0x2d17a1;if(_0x413a44(0x34a)==typeof Reflect&&_0x413a44(0x24f)==typeof Reflect['metadata'])return Reflect['metadata'](_0x3c06e8,_0x1feedd);};Object['defineProperty'](_0x3d7048,_0x2d17a1(0x3f1),{'value':!0x0}),_0x3d7048[_0x2d17a1(0x1b9)]=_0x3d7048['PreprocessOptions']=_0x3d7048['ROI']=void 0x0;const _0x1366ea=_0x1f3a0a(0x2),_0x425877=_0x1f3a0a(0x1a),_0x4db219=_0x1f3a0a(0x1c),_0x5aed21=_0x1f3a0a(0x1e),_0x406f93=_0x1f3a0a(0x20),_0x73a154=_0x1f3a0a(0x11);var _0x44a568=_0x1f3a0a(0x1e);Object['defineProperty'](_0x3d7048,'ROI',{'enumerable':!0x0,'get':function(){return _0x44a568['ROI'];}}),Object[_0x2d17a1(0x213)](_0x3d7048,'PreprocessOptions',{'enumerable':!0x0,'get':function(){const _0x1cad21=_0x2d17a1;return _0x44a568[_0x1cad21(0x164)];}});const _0x4a14bb={'crop':{'x':0x0,'y':0x0,'width':0x1,'height':0x1},'psm':0x6,'charWhitelist':void 0x0,'maxWidth':0x4b0};let _0x55cb5d=_0x1665d8=class{constructor(_0x3545dc,_0x5e48d2){const _0x299744=_0x2d17a1;this['workerPoolService']=_0x3545dc,this['imagePreprocessingService']=_0x5e48d2,this['logger']=new _0x1366ea[(_0x299744(0x34b))](_0x1665d8['name']),this['ocrConfig']={'poolSize':_0x73a154['config']['ocr']['poolSize'],'lang':_0x73a154['config']['ocr']['lang'],'rois':{'full':_0x4a14bb,'singleLine':{..._0x4a14bb,'psm':0x7},'block':{..._0x4a14bb,'psm':0x6}}};}['validateROI'](_0x1609ec){const _0x15ecd2=_0x2d17a1;return{'x':Math['max'](0x0,Math['min'](0x1,_0x1609ec['x']||0x0)),'y':Math[_0x15ecd2(0x227)](0x0,Math['min'](0x1,_0x1609ec['y']||0x0)),'width':Math[_0x15ecd2(0x227)](0.01,Math[_0x15ecd2(0x295)](0x1,_0x1609ec['width']||0x1)),'height':Math['max'](0.01,Math['min'](0x1,_0x1609ec['height']||0x1))};}[_0x2d17a1(0x200)](_0x142feb){const _0x3dda68=_0x2d17a1,_0x1b1a72=this[_0x3dda68(0x303)]['rois']?.[_0x142feb]||this['ocrConfig'][_0x3dda68(0x1b6)]?.['full']||_0x4a14bb;return{'crop':_0x1b1a72['crop']||_0x4a14bb[_0x3dda68(0x275)],'psm':_0x1b1a72['psm']??_0x4a14bb['psm'],'charWhitelist':_0x1b1a72['charWhitelist'],'maxWidth':_0x1b1a72['maxWidth']??_0x4a14bb['maxWidth']};}async['recognizeFromFile'](_0x200211,_0x25b490={}){const _0x18630c=_0x2d17a1,_0x2a9d26=Date[_0x18630c(0x442)](),_0x5dee4b={'decodeImage':0x0,'preprocess':0x0,'ocrRecognize':0x0,'postprocess':0x0};try{const _0x29dadd=Date[_0x18630c(0x442)](),_0x4e5235=await(0x0,_0x425877['readFile'])(_0x200211);_0x5dee4b[_0x18630c(0x42f)]=Date['now']()-_0x29dadd;const _0x4071e6=_0x25b490['fieldType']||'full',_0x45f64c=this['getROIConfig'](_0x4071e6),_0x5da4ef=this['validateROI'](_0x25b490[_0x18630c(0x443)]||_0x45f64c['crop']),_0x2db048=Date[_0x18630c(0x442)](),_0x2531a4=await this['imagePreprocessingService']['preprocess'](_0x4e5235,_0x5da4ef,_0x45f64c['maxWidth'],_0x25b490['preprocess']);_0x5dee4b[_0x18630c(0x417)]=Date['now']()-_0x2db048;const _0x39901a=Date['now'](),_0x427f0c=await this['workerPoolService']['recognize'](_0x2531a4['buffer'],{'psm':_0x45f64c[_0x18630c(0x3b5)],'charWhitelist':_0x45f64c['charWhitelist']});_0x5dee4b[_0x18630c(0x330)]=Date['now']()-_0x39901a;const _0x42b08f=Date['now'](),_0x5a6a44=this['postprocessText'](_0x427f0c[_0x18630c(0x2e4)]);_0x5dee4b['postprocess']=Date['now']()-_0x42b08f;const _0x3dced8=Date['now']()-_0x2a9d26;return this['logTimingBreakdown'](_0x200211,_0x4071e6,_0x3dced8,_0x5dee4b,_0x427f0c['confidence']),{'text':_0x5a6a44,'confidence':_0x427f0c[_0x18630c(0x28f)],'processingTime':_0x3dced8,'timingBreakdown':_0x5dee4b};}catch(_0x3ceba9){return this['logger']['error']('OCR\x20error\x20for\x20'+_0x200211+':\x20'+_0x3ceba9['message'],_0x3ceba9['stack']),null;}}async['recognizeFromBuffer'](_0x408370,_0x514f1d={}){const _0x39cfd5=_0x2d17a1,_0x51b505=Date['now'](),_0x3d2c3e={'decodeImage':0x0,'preprocess':0x0,'ocrRecognize':0x0,'postprocess':0x0};try{_0x3d2c3e['decodeImage']=0x0;const _0x5461b1=_0x514f1d[_0x39cfd5(0x348)]||'full',_0x3f1cbb=this[_0x39cfd5(0x200)](_0x5461b1),_0x20d011=this[_0x39cfd5(0x1d2)](_0x514f1d[_0x39cfd5(0x443)]||_0x3f1cbb[_0x39cfd5(0x275)]),_0x177a8f=Date['now'](),_0x11f8f5=await this['imagePreprocessingService']['preprocess'](_0x408370,_0x20d011,_0x3f1cbb['maxWidth'],_0x514f1d[_0x39cfd5(0x417)]);_0x3d2c3e['preprocess']=Date['now']()-_0x177a8f;const _0x5d3bb4=Date['now'](),_0x5a6c54=await this['workerPoolService']['recognize'](_0x11f8f5[_0x39cfd5(0x1fb)],{'psm':_0x3f1cbb['psm'],'charWhitelist':_0x3f1cbb['charWhitelist']});_0x3d2c3e[_0x39cfd5(0x330)]=Date['now']()-_0x5d3bb4;const _0x4b642c=Date['now'](),_0x3112e7=this[_0x39cfd5(0x175)](_0x5a6c54[_0x39cfd5(0x2e4)]);_0x3d2c3e['postprocess']=Date['now']()-_0x4b642c;const _0x41c750=Date['now']()-_0x51b505;return this['logTimingBreakdown'](_0x39cfd5(0x1fb),_0x5461b1,_0x41c750,_0x3d2c3e,_0x5a6c54['confidence']),{'text':_0x3112e7,'confidence':_0x5a6c54[_0x39cfd5(0x28f)],'processingTime':_0x41c750,'timingBreakdown':_0x3d2c3e};}catch(_0x40c674){return this['logger'][_0x39cfd5(0x382)]('OCR\x20error\x20from\x20buffer:\x20'+_0x40c674['message'],_0x40c674['stack']),null;}}async['fastScreenOCR'](_0x4c9cf3,_0x3b6b8b,_0x14cf11={}){const _0x1e3325=await this['recognizeFromFile'](_0x4c9cf3,{'fieldType':_0x14cf11['fieldType']||'full','customROI':_0x14cf11['customROI'],'preprocess':_0x14cf11['preprocess']});if(!_0x1e3325||!_0x1e3325['text'])return{'found':!0x1,'matchedTexts':[],'result':_0x1e3325};const _0x1b8bd0=(0x0,_0x406f93['normalizeBankAccountName'])(_0x1e3325['text']),_0x891fe6=_0x3b6b8b['filter'](_0x4f649c=>_0x1b8bd0['includes']((0x0,_0x406f93['normalizeBankAccountName'])(_0x4f649c)));return{'found':_0x891fe6['length']>0x0,'matchedTexts':_0x891fe6,'result':_0x1e3325};}['postprocessText'](_0x9c03f2){const _0x5a6631=_0x2d17a1;return _0x9c03f2[_0x5a6631(0x450)]()['replace'](/\s+/g,'\x20')['replace'](/\n{3,}/g,'\x0a\x0a');}[_0x2d17a1(0x16f)](_0x1924f6,_0x307270,_0x218c0c,_0x4ad8a8,_0x1e8de8){const _0x414d2c=_0x2d17a1;['decode='+_0x4ad8a8[_0x414d2c(0x42f)]+'ms','preprocess='+_0x4ad8a8[_0x414d2c(0x417)]+'ms','ocr='+_0x4ad8a8['ocrRecognize']+'ms',_0x414d2c(0x431)+_0x4ad8a8['postprocess']+'ms']['join']('\x20|\x20'),_0x218c0c>0x3e8&&this[_0x414d2c(0x25d)][_0x414d2c(0x3d4)]('‚ö†Ô∏è\x20OCR\x20latency\x20exceeded\x20target:\x20'+_0x218c0c+'ms\x20>\x201000ms\x20(p95\x20target)');}};_0x3d7048[_0x2d17a1(0x1b9)]=_0x55cb5d,_0x3d7048['OCRService']=_0x55cb5d=_0x1665d8=_0x39a515([(0x0,_0x1366ea['Injectable'])(),_0x3adbb7('design:paramtypes',['function'==typeof(_0x1936bc=void 0x0!==_0x4db219[_0x2d17a1(0x1b5)]&&_0x4db219['OCRWorkerPoolService'])?_0x1936bc:Object,_0x2d17a1(0x24f)==typeof(_0x153030=void 0x0!==_0x5aed21['ImagePreprocessingService']&&_0x5aed21[_0x2d17a1(0x375)])?_0x153030:Object])],_0x55cb5d);},function(_0x16c976,_0x441e18,_0x53e4e3){const _0x73429d=a0_0x23a4;var _0xb2f872=this&&this['__decorate']||function(_0x3f2ce7,_0x17b623,_0x2fd749,_0x1d6372){const _0x5d92eb=a0_0x23a4;var _0x34b861,_0x469bd9=arguments['length'],_0x380c8c=_0x469bd9<0x3?_0x17b623:null===_0x1d6372?_0x1d6372=Object['getOwnPropertyDescriptor'](_0x17b623,_0x2fd749):_0x1d6372;if('object'==typeof Reflect&&_0x5d92eb(0x24f)==typeof Reflect['decorate'])_0x380c8c=Reflect['decorate'](_0x3f2ce7,_0x17b623,_0x2fd749,_0x1d6372);else{for(var _0x1fb506=_0x3f2ce7['length']-0x1;_0x1fb506>=0x0;_0x1fb506--)(_0x34b861=_0x3f2ce7[_0x1fb506])&&(_0x380c8c=(_0x469bd9<0x3?_0x34b861(_0x380c8c):_0x469bd9>0x3?_0x34b861(_0x17b623,_0x2fd749,_0x380c8c):_0x34b861(_0x17b623,_0x2fd749))||_0x380c8c);}return _0x469bd9>0x3&&_0x380c8c&&Object[_0x5d92eb(0x213)](_0x17b623,_0x2fd749,_0x380c8c),_0x380c8c;},_0x2aa8a2=this&&this['__metadata']||function(_0x3d9c54,_0x590618){const _0x1f0fad=a0_0x23a4;if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect[_0x1f0fad(0x216)](_0x3d9c54,_0x590618);};Object['defineProperty'](_0x441e18,'__esModule',{'value':!0x0}),_0x441e18['OCRWorkerPoolService']=void 0x0;const _0x2a4b90=_0x53e4e3(0x2),_0x440b3f=_0x53e4e3(0x1d),_0x2bc73f=_0x53e4e3(0x11);let _0x206987=class{constructor(){const _0x472ae8=a0_0x23a4;this[_0x472ae8(0x25d)]=new _0x2a4b90[(_0x472ae8(0x34b))](_0x472ae8(0x1b5)),this['pool']=[],this['waitingQueue']=[],this[_0x472ae8(0x167)]=0x1388,this[_0x472ae8(0x1ff)]=0xa,this[_0x472ae8(0x408)]=!0x1,this[_0x472ae8(0x2b2)]=!0x1,this[_0x472ae8(0x2b4)]=!0x1,this['initializationPromise']=null,this[_0x472ae8(0x357)]=Math['max'](0x1,Math[_0x472ae8(0x295)](_0x2bc73f['config']['ocr']['poolSize'],this[_0x472ae8(0x1ff)])),this['lang']=_0x2bc73f['config']['ocr']['lang'],_0x2bc73f['config']['ocr']['poolSize']>this['maxPoolSize']&&this[_0x472ae8(0x25d)]['warn'](_0x472ae8(0x272)+_0x2bc73f[_0x472ae8(0x219)][_0x472ae8(0x161)]['poolSize']+_0x472ae8(0x387)+this[_0x472ae8(0x1ff)]+').\x20Using\x20'+this['maxPoolSize']+'.');}async[_0x73429d(0x33a)](){await this['warmPool']();}async['onModuleDestroy'](){this['isDestroyed']=!0x0,this['rejectAllPending'](new Error('OCR\x20service\x20is\x20shutting\x20down')),await this['terminateAll']();}async['warmPool'](){const _0x3488ba=_0x73429d;if(this[_0x3488ba(0x408)])return this[_0x3488ba(0x298)]||Promise['resolve']();this['isInitializing']=!0x0,this['initializationPromise']=this['doWarmPool']();try{await this[_0x3488ba(0x298)];}finally{this[_0x3488ba(0x408)]=!0x1;}}async['doWarmPool'](){const _0x36bc6b=_0x73429d,_0x1c0f7d=Date[_0x36bc6b(0x442)]();this['logger']['log']('Warming\x20up\x20OCR\x20worker\x20pool\x20(size:\x20'+this[_0x36bc6b(0x357)]+_0x36bc6b(0x323)+this['lang']+')...');const _0x59f048=Array['from']({'length':this['poolSize']},(_0x1dba43,_0x10cd67)=>this['createWorker'](_0x10cd67));try{await Promise['all'](_0x59f048);const _0x13cd60=Date['now']()-_0x1c0f7d;this['logger']['log'](_0x36bc6b(0x1c7)+_0x13cd60+'ms.\x20Pool\x20size:\x20'+this['pool']['length']);}catch(_0x47031b){throw this['logger'][_0x36bc6b(0x382)]('Failed\x20to\x20warm\x20up\x20worker\x20pool:\x20'+_0x47031b['message'],_0x47031b['stack']),await this[_0x36bc6b(0x1d0)](),_0x47031b;}}async['createWorker'](_0x4f4624){const _0x452165=_0x73429d;try{const _0x58f737=await _0x440b3f[_0x452165(0x174)](this[_0x452165(0x2ab)],0x1,{'logger':_0x224c4c=>{const _0x1a1afc=_0x452165;_0x1a1afc(0x382)===_0x224c4c[_0x1a1afc(0x455)]&&this['logger'][_0x1a1afc(0x382)]('Tesseract\x20worker\x20'+_0x4f4624+_0x1a1afc(0x226)+_0x224c4c[_0x1a1afc(0x1c8)]);}});this['pool'][_0x452165(0x281)]({'id':_0x4f4624,'worker':_0x58f737,'inUse':!0x1,'lastUsed':Date['now']()}),this['logger']['debug'](_0x452165(0x267)+_0x4f4624+'\x20created\x20successfully');}catch(_0x1aba97){throw this[_0x452165(0x25d)]['error']('Failed\x20to\x20create\x20worker\x20'+_0x4f4624+':\x20'+_0x1aba97['message']),_0x1aba97;}}async['acquireWorker'](){const _0x17f4fc=_0x73429d;if(this['isDestroyed'])throw new Error('OCR\x20service\x20is\x20destroyed');return this['isInitializing']&&this['initializationPromise']&&await this['initializationPromise'],this[_0x17f4fc(0x33d)]()||this[_0x17f4fc(0x1ba)]();}['tryAcquireFromPool'](){if(this['isAcquiring'])return null;this['isAcquiring']=!0x0;try{for(const _0x657d29 of this['pool'])if(!_0x657d29['inUse'])return _0x657d29['inUse']=!0x0,_0x657d29['lastUsed']=Date['now'](),_0x657d29;return null;}finally{this['isAcquiring']=!0x1;}}[_0x73429d(0x1ba)](){return new Promise((_0x2b4262,_0x2638cb)=>{const _0x1c301a=a0_0x23a4,_0x4f53f4=setTimeout(()=>{const _0x14457e=a0_0x23a4,_0x367a03=this[_0x14457e(0x2d1)][_0x14457e(0x1b2)](_0x454c5c=>_0x454c5c[_0x14457e(0x3c2)]===_0x2b4262);-0x1!==_0x367a03&&this['waitingQueue'][_0x14457e(0x18c)](_0x367a03,0x1),this[_0x14457e(0x25d)]['warn']('Timeout\x20waiting\x20for\x20worker,\x20creating\x20temporary\x20worker'),this['createTemporaryWorker']()['then'](_0x2b4262)['catch'](_0x2638cb);},this['maxWaitTime']);this[_0x1c301a(0x2d1)]['push']({'resolve':_0x2b4262,'reject':_0x2638cb,'timeout':_0x4f53f4});});}async['createTemporaryWorker'](){const _0x1f53e8=_0x73429d;return{'id':-0x1,'worker':await _0x440b3f['createWorker'](this[_0x1f53e8(0x2ab)],0x1,{'logger':()=>{}}),'inUse':!0x0,'lastUsed':Date[_0x1f53e8(0x442)]()};}['releaseWorker'](_0xdb22b1){const _0x54540e=_0x73429d;if(this[_0x54540e(0x2d1)]['length']>0x0){const _0x4da798=this[_0x54540e(0x2d1)]['shift']();clearTimeout(_0x4da798['timeout']),_0xdb22b1[_0x54540e(0x19b)]=Date['now'](),_0x4da798['resolve'](_0xdb22b1);}else _0xdb22b1['inUse']=!0x1,_0xdb22b1['lastUsed']=Date['now']();}['rejectAllPending'](_0x525b3b){const _0x3398ab=_0x73429d;for(;this['waitingQueue']['length']>0x0;){const _0x4255f3=this['waitingQueue'][_0x3398ab(0x301)]();clearTimeout(_0x4255f3['timeout']),_0x4255f3[_0x3398ab(0x35e)](_0x525b3b);}}async['recognize'](_0x329307,_0xd19ea3={}){const _0xe64a69=_0x73429d,_0x1d3ae9=await this[_0xe64a69(0x223)](),_0x3aafe3=_0x1d3ae9['id']<0x0,{psm:_0x31dcc3,charWhitelist:_0x1da96f}=_0xd19ea3,_0x1bd8d8=void 0x0!==_0x31dcc3||!!_0x1da96f;try{const _0x3ac05c={};void 0x0!==_0x31dcc3&&(_0x3ac05c[_0xe64a69(0x2c7)]=_0x31dcc3),_0x1da96f&&(_0x3ac05c['tessedit_char_whitelist']=_0x1da96f),Object['keys'](_0x3ac05c)['length']>0x0&&await _0x1d3ae9[_0xe64a69(0x35b)]['setParameters'](_0x3ac05c);const {data:_0x1c0a7b}=await _0x1d3ae9['worker']['recognize'](_0x329307);return{'text':_0x1c0a7b['text'],'confidence':_0x1c0a7b['confidence']};}finally{if(_0x3aafe3)try{await _0x1d3ae9['worker']['terminate']();}catch(_0x287313){this[_0xe64a69(0x25d)]['warn']('Failed\x20to\x20terminate\x20temporary\x20worker:\x20'+_0x287313[_0xe64a69(0x1c8)]);}else{if(_0x1bd8d8)try{await _0x1d3ae9['worker']['setParameters']({'tessedit_pageseg_mode':0x6,'tessedit_char_whitelist':''});}catch(_0x4f275d){this['logger']['warn']('Failed\x20to\x20reset\x20worker\x20parameters:\x20'+_0x4f275d['message']);}this['releaseWorker'](_0x1d3ae9);}}}['getPoolStats'](){const _0xdabdcc=_0x73429d;return{'total':this['pool']['length'],'inUse':this[_0xdabdcc(0x2f4)]['filter'](_0xecd20d=>_0xecd20d['inUse'])['length'],'waiting':this[_0xdabdcc(0x2d1)]['length']};}async['terminateAll'](){const _0x3470e4=_0x73429d;if(0x0===this['pool']['length'])return;this['logger']['log']('Terminating\x20'+this['pool']['length']+_0x3470e4(0x3a4));const _0x3ea1d4=this[_0x3470e4(0x2f4)][_0x3470e4(0x30c)](_0x3a4690=>_0x3a4690['worker'][_0x3470e4(0x338)]()['then'](()=>{this['logger']['debug']('Worker\x20'+_0x3a4690['id']+'\x20terminated');})[_0x3470e4(0x166)](_0x48f699=>{this['logger']['error']('Error\x20terminating\x20worker\x20'+_0x3a4690['id']+':\x20'+_0x48f699['message']);}));await Promise['all'](_0x3ea1d4),this[_0x3470e4(0x2f4)]['length']=0x0,this['logger']['log']('All\x20OCR\x20workers\x20terminated');}};_0x441e18['OCRWorkerPoolService']=_0x206987,_0x441e18['OCRWorkerPoolService']=_0x206987=_0xb2f872([(0x0,_0x2a4b90[_0x73429d(0x3ea)])(),_0x2aa8a2('design:paramtypes',[])],_0x206987);},_0x121611=>{const _0x41605b=a0_0x23a4;_0x121611[_0x41605b(0x391)]=require('tesseract.js');},function(_0x19d8a9,_0x14b7d7,_0x4b1b32){const _0x210292=a0_0x23a4;var _0x4382a1=this&&this[_0x210292(0x1f9)]||function(_0xcc2d41,_0xd726bf,_0x57fa15,_0x4eacb0){const _0x23fab8=_0x210292;var _0x2f94c4,_0x2d85cd=arguments['length'],_0x214953=_0x2d85cd<0x3?_0xd726bf:null===_0x4eacb0?_0x4eacb0=Object[_0x23fab8(0x26e)](_0xd726bf,_0x57fa15):_0x4eacb0;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x214953=Reflect['decorate'](_0xcc2d41,_0xd726bf,_0x57fa15,_0x4eacb0);else{for(var _0x87b99f=_0xcc2d41['length']-0x1;_0x87b99f>=0x0;_0x87b99f--)(_0x2f94c4=_0xcc2d41[_0x87b99f])&&(_0x214953=(_0x2d85cd<0x3?_0x2f94c4(_0x214953):_0x2d85cd>0x3?_0x2f94c4(_0xd726bf,_0x57fa15,_0x214953):_0x2f94c4(_0xd726bf,_0x57fa15))||_0x214953);}return _0x2d85cd>0x3&&_0x214953&&Object[_0x23fab8(0x213)](_0xd726bf,_0x57fa15,_0x214953),_0x214953;};Object[_0x210292(0x213)](_0x14b7d7,_0x210292(0x3f1),{'value':!0x0}),_0x14b7d7['ImagePreprocessingService']=void 0x0;const _0x42bdf1=_0x4b1b32(0x2),_0xc021cd=_0x4b1b32(0x1f);let _0x11c41b=class{constructor(){const _0x757ae3=_0x210292;this['logger']=new _0x42bdf1[(_0x757ae3(0x34b))]('ImagePreprocessingService'),this['MIN_DIMENSION']=0xa;}['validateROI'](_0x291a97){const _0x28bcaa=_0x210292;if(_0x291a97['x']<0x0||_0x291a97['x']>0x1)throw new Error('Invalid\x20ROI\x20x:\x20'+_0x291a97['x']+_0x28bcaa(0x444));if(_0x291a97['y']<0x0||_0x291a97['y']>0x1)throw new Error('Invalid\x20ROI\x20y:\x20'+_0x291a97['y']+'\x20(must\x20be\x200-1)');if(_0x291a97['width']<=0x0||_0x291a97['width']>0x1)throw new Error(_0x28bcaa(0x18f)+_0x291a97[_0x28bcaa(0x423)]+'\x20(must\x20be\x200-1)');if(_0x291a97['height']<=0x0||_0x291a97['height']>0x1)throw new Error(_0x28bcaa(0x401)+_0x291a97['height']+'\x20(must\x20be\x200-1)');if(_0x291a97['x']+_0x291a97['width']>1.001)throw new Error(_0x28bcaa(0x3dc)+_0x291a97['x']+')\x20+\x20width('+_0x291a97['width']+')\x20>\x201');if(_0x291a97['y']+_0x291a97['height']>1.001)throw new Error('ROI\x20extends\x20beyond\x20image:\x20y('+_0x291a97['y']+')\x20+\x20height('+_0x291a97[_0x28bcaa(0x28e)]+_0x28bcaa(0x2ba));}async[_0x210292(0x417)](_0x51b9c6,_0x20547b,_0x4b01e3,_0x459656={}){const _0x2b9698=_0x210292;try{this['validateROI'](_0x20547b);const _0x366351=_0xc021cd(_0x51b9c6),_0x577edb=await _0x366351['metadata'](),_0x208417=_0x577edb['width']||0x0,_0x5372b8=_0x577edb['height']||0x0;if(0x0===_0x208417||0x0===_0x5372b8)throw new Error(_0x2b9698(0x1e6));if(_0x208417<this['MIN_DIMENSION']||_0x5372b8<this[_0x2b9698(0x36c)])throw new Error('Image\x20too\x20small:\x20'+_0x208417+'x'+_0x5372b8+'\x20(min:\x20'+this['MIN_DIMENSION']+'x'+this['MIN_DIMENSION']+')');const _0x440cce=Math[_0x2b9698(0x2da)](_0x20547b['x']*_0x208417),_0x1da6ef=Math[_0x2b9698(0x2da)](_0x20547b['y']*_0x5372b8),_0x4e09dd=Math['floor'](_0x20547b['width']*_0x208417),_0x372e8e=Math[_0x2b9698(0x2da)](_0x20547b['height']*_0x5372b8),_0x54b723=Math[_0x2b9698(0x227)](0x0,Math[_0x2b9698(0x295)](_0x440cce,_0x208417-0x1)),_0x194d0a=Math['max'](0x0,Math['min'](_0x1da6ef,_0x5372b8-0x1)),_0x4b2608=Math['max'](this[_0x2b9698(0x36c)],Math['min'](_0x4e09dd,_0x208417-_0x54b723)),_0x45552d=Math['max'](this['MIN_DIMENSION'],Math['min'](_0x372e8e,_0x5372b8-_0x194d0a));let _0x372b4f=_0x366351['clone']()['extract']({'left':_0x54b723,'top':_0x194d0a,'width':_0x4b2608,'height':_0x45552d}),_0x296870=_0x4b2608,_0x4c5be2=_0x45552d,_0x3343f5=0x1;return _0x4b01e3&&_0x4b2608>_0x4b01e3&&(_0x3343f5=_0x4b01e3/_0x4b2608,_0x296870=_0x4b01e3,_0x4c5be2=Math['max'](this[_0x2b9698(0x36c)],Math['floor'](_0x45552d*_0x3343f5)),_0x372b4f=_0x372b4f['resize'](_0x296870,_0x4c5be2,{'kernel':_0xc021cd['kernel']['lanczos3'],'withoutEnlargement':!0x0})),_0x459656[_0x2b9698(0x376)]&&(_0x372b4f=_0x372b4f['grayscale']()),_0x459656['enhanceContrast']&&(_0x372b4f=_0x372b4f[_0x2b9698(0x30f)]()),{'buffer':await _0x372b4f['png']()['toBuffer'](),'metadata':{'originalWidth':_0x208417,'originalHeight':_0x5372b8,'processedWidth':_0x296870,'processedHeight':_0x4c5be2,'scaleFactor':_0x3343f5}};}catch(_0x56e45d){throw this['logger'][_0x2b9698(0x382)]('Image\x20preprocessing\x20error:\x20'+_0x56e45d['message'],_0x56e45d['stack']),_0x56e45d;}}};_0x14b7d7[_0x210292(0x375)]=_0x11c41b,_0x14b7d7['ImagePreprocessingService']=_0x11c41b=_0x4382a1([(0x0,_0x42bdf1[_0x210292(0x3ea)])()],_0x11c41b);},_0x154349=>{_0x154349['exports']=require('sharp');},(_0x33c789,_0x1397a0)=>{const _0x525ab9=a0_0x23a4;Object['defineProperty'](_0x1397a0,'__esModule',{'value':!0x0}),_0x1397a0['normalizeBankAccountName']=_0x1397a0['removeVietnameseTones']=void 0x0,_0x1397a0['removeVietnameseTones']=_0x435652=>_0x435652?_0x435652['normalize']('NFD')[_0x525ab9(0x3cf)](/[\u0300-\u036f]/g,'')[_0x525ab9(0x3cf)](/ƒë/g,'d')[_0x525ab9(0x3cf)](/ƒê/g,'D'):'',_0x1397a0[_0x525ab9(0x288)]=_0x410196=>_0x410196?(0x0,_0x1397a0[_0x525ab9(0x25b)])(_0x410196)['trim']()['replace'](/ /g,'')['toLocaleUpperCase']():'';},_0x291160=>{const _0x129337=a0_0x23a4;_0x291160[_0x129337(0x391)]=require('qrcode');},(_0x44114e,_0x56a8be,_0x562b93)=>{const _0x1d54dd=a0_0x23a4;Object['defineProperty'](_0x56a8be,_0x1d54dd(0x3f1),{'value':!0x0}),_0x56a8be['ANALYZE_BILL_ROI']=void 0x0;const _0xa369fa=_0x562b93(0x23),_0x144d9a=_0x562b93(0x24),_0x14152f=_0x562b93(0x25);_0x56a8be[_0x1d54dd(0x3fe)]={'PGBANK':{'ROI':_0x144d9a['PG_ROI_EXPECTED']['TRANSACTION_SUCCESS'],'expectedTexts':['chuy·ªÉn\x20ti·ªÅn\x20th√†nh\x20c√¥ng']},'HDBANK':{'ROI':_0xa369fa['HD_ROI_EXPECTED']['BILL_AREA'],'expectedTexts':[_0x1d54dd(0x334)]},'VIETCOMBANK':{'ROI':_0x14152f[_0x1d54dd(0x16b)][_0x1d54dd(0x409)],'expectedTexts':[_0x1d54dd(0x37e)]}};},(_0x3b5cb9,_0x5ee586)=>{const _0x3bc3ce=a0_0x23a4;Object['defineProperty'](_0x5ee586,'__esModule',{'value':!0x0}),_0x5ee586['HD_ROI_EXPECTED']=void 0x0,_0x5ee586[_0x3bc3ce(0x201)]={'LAUNCH_APP':{'x':0.1,'y':0.54,'width':0.7,'height':0.1},'VERIFY_ACCOUNT_NUMBER':{'x':0.05,'y':0.4,'width':0.9,'height':0.2},'VERIFY_ACCOUNT_NAME':{'x':0.05,'y':0.6,'width':0.8,'height':0.2},'OTP_ENTER':{'x':0.1,'y':0.25,'width':0.8,'height':0.1},'TRANSACTION_VERIFY':{'x':0.1,'y':0.5,'width':0.4,'height':0.1},'TRANSACTION_SUCCESS':{'x':0.2,'y':0.3,'width':0.6,'height':0.1},'BILL_AREA':{'x':0.085,'y':0.025,'width':0.6,'height':0.075},'HOME_SCREEN':{'x':0.02,'y':0.7,'width':0.98,'height':0.3},'ALBUM_SCREEN':{'x':0.18,'y':0.02,'width':0.8,'height':0.085},'SWIPE_UP_SCREEN':{'x':0.01,'y':0.5,'width':0.5,'height':0.1},'WARNING_TRANSACTION':{'x':0.14,'y':0.39,'width':0.72,'height':0.2},'OTP_ENTER_OR_CONTINUE_TRANSFER':{'x':0.03,'y':0.1,'width':0.95,'height':0.5},'CONFIRM_AFTER_OTP':{'x':0.03,'y':0.5,'width':0.95,'height':0.2},'BOTTOM_BILL':{'x':0.03,'y':0.8,'width':0.9,'height':0.1}};},(_0xc5e05a,_0x1ef64e)=>{const _0x223572=a0_0x23a4;Object['defineProperty'](_0x1ef64e,'__esModule',{'value':!0x0}),_0x1ef64e['PG_ROI_EXPECTED']=void 0x0,_0x1ef64e[_0x223572(0x3cd)]={'LAUNCH_APP':{'x':0.04,'y':0.53,'width':0.73,'height':0.078},'VERIFY_ACCOUNT_NAME':{'x':0.04,'y':0.45,'width':0.81,'height':0.18},'TRANSACTION_CONFIRM':{'x':0.085,'y':0.023,'width':0.8,'height':0.08},'TRANSACTION_VERIFY':{'x':0.085,'y':0.023,'width':0.8,'height':0.08},'TRANSACTION_SUCCESS':{'x':0.06,'y':0.212,'width':0.88,'height':0.1},'HOME_SCREEN':{'x':0.02,'y':0.7,'width':0.98,'height':0.3},'ALBUM_SCREEN':{'x':0.18,'y':0.02,'width':0.8,'height':0.085}};},(_0xf9aad7,_0x5a4d0a)=>{Object['defineProperty'](_0x5a4d0a,'__esModule',{'value':!0x0}),_0x5a4d0a['VCB_ROI_EXPECTED']=void 0x0,_0x5a4d0a['VCB_ROI_EXPECTED']={'LAUNCH_APP':{'x':0.3,'y':0.5,'width':0.4,'height':0.1},'VERIFY_ACCOUNT_NUMBER':{'x':0.05,'y':0.45,'width':0.9,'height':0.2},'VERIFY_ACCOUNT_NAME':{'x':0.05,'y':0.55,'width':0.8,'height':0.1},'OTP_ENTER':{'x':0.1,'y':0.5,'width':0.4,'height':0.1},'OTP_VERIFY':{'x':0.1,'y':0.4,'width':0.5,'height':0.1},'TRANSACTION_VERIFY':{'x':0.5,'y':0.1,'width':0.4,'height':0.1},'TRANSACTION_SUCCESS':{'x':0.2,'y':0.2,'width':0.6,'height':0.1},'HOME_SCREEN':{'x':0.02,'y':0.55,'width':0.5,'height':0.1},'ALBUM_SCREEN':{'x':0.02,'y':0.02,'width':0.98,'height':0.2}};},(_0x4b2c8f,_0x5a8496,_0x55a226)=>{const _0x35e978=a0_0x23a4;Object['defineProperty'](_0x5a8496,'__esModule',{'value':!0x0}),_0x5a8496[_0x35e978(0x235)]=_0x5a8496['KEYBOARD_LAYOUT']=_0x5a8496['COMMON_COORDINATES']=_0x5a8496[_0x35e978(0x379)]=void 0x0;const _0x21cb23=_0x55a226(0x11);_0x5a8496['scaleCoordinates']=(_0x15a14e,_0xaa4afa=0x64)=>Object[_0x35e978(0x44f)](Object['entries'](_0x15a14e)[_0x35e978(0x30c)](([_0x58eb8a,_0x13ea32])=>[_0x58eb8a,{'x':Math[_0x35e978(0x360)](_0x13ea32['x']*_0xaa4afa),'y':Math['round'](_0x13ea32['y']*_0xaa4afa)}]));const _0x15b6fa={0x0:{'x':0.55,'y':0.95},0x1:{'x':0.25,'y':0.7},0x2:{'x':0.55,'y':0.7},0x3:{'x':0.85,'y':0.7},0x4:{'x':0.25,'y':0.8},0x5:{'x':0.55,'y':0.8},0x6:{'x':0.85,'y':0.8},0x7:{'x':0.25,'y':0.9},0x8:{'x':0.55,'y':0.9},0x9:{'x':0.85,'y':0.9}},_0x9526e5={'KEYBOARD_SWITCH':{'x':0.05,'y':0.95},'SHIFT_KEY':{'x':0.05,'y':0.88},'RETURN_KEY':{'x':0.95,'y':0.95}},_0x1a8fa4=(0x0,_0x5a8496[_0x35e978(0x379)])(_0x9526e5),_0x1e1169=(0x0,_0x5a8496['scaleCoordinates'])(_0x15b6fa);_0x5a8496['COMMON_COORDINATES']='PANDA'===_0x21cb23[_0x35e978(0x219)]['boxType']?_0x1a8fa4:_0x9526e5,_0x5a8496['KEYBOARD_LAYOUT']={0x0:{'x':0.95,'y':0.68},0x1:{'x':0.05,'y':0.68},0x2:{'x':0.15,'y':0.68},0x3:{'x':0.25,'y':0.68},0x4:{'x':0.35,'y':0.68},0x5:{'x':0.45,'y':0.68},0x6:{'x':0.55,'y':0.68},0x7:{'x':0.65,'y':0.68},0x8:{'x':0.75,'y':0.68},0x9:{'x':0.85,'y':0.68},'@':{'x':0.85,'y':0.78},'!':{'x':0.65,'y':0.88},'a':{'x':0.1,'y':0.78},'b':{'x':0.6,'y':0.88},'c':{'x':0.4,'y':0.88},'d':{'x':0.3,'y':0.78},'e':{'x':0.25,'y':0.68},'f':{'x':0.4,'y':0.78},'g':{'x':0.5,'y':0.78},'h':{'x':0.6,'y':0.78},'i':{'x':0.75,'y':0.68},'j':{'x':0.7,'y':0.78},'k':{'x':0.8,'y':0.78},'l':{'x':0.9,'y':0.78},'m':{'x':0.8,'y':0.88},'n':{'x':0.7,'y':0.88},'o':{'x':0.85,'y':0.68},'p':{'x':0.95,'y':0.68},'q':{'x':0.05,'y':0.68},'r':{'x':0.35,'y':0.68},'s':{'x':0.2,'y':0.78},'t':{'x':0.45,'y':0.68},'u':{'x':0.65,'y':0.68},'v':{'x':0.5,'y':0.88},'w':{'x':0.15,'y':0.68},'x':{'x':0.3,'y':0.88},'y':{'x':0.55,'y':0.68},'z':{'x':0.2,'y':0.88},'\x20':{'x':0.55,'y':0.95}},_0x5a8496[_0x35e978(0x235)]=_0x35e978(0x454)===_0x21cb23[_0x35e978(0x219)]['boxType']?_0x1e1169:_0x15b6fa;},(_0x522592,_0x59fb8b,_0x4a1607)=>{const _0x19234e=a0_0x23a4;Object['defineProperty'](_0x59fb8b,_0x19234e(0x3f1),{'value':!0x0}),_0x59fb8b[_0x19234e(0x307)]=void 0x0;const _0x5caf25=_0x4a1607(0x11),_0x45fb29={'LOGIN_BUTTON':{'x':0.5,'y':0.8},'LOGIN_BUTTON_API':{'x':0.5,'y':0.62},'PASSWORD_FIELD':{'x':0.5,'y':0.45}},_0x53eb5f=(0x0,_0x4a1607(0x26)['scaleCoordinates'])(_0x45fb29);_0x59fb8b['ACB_UI_COORDINATES']='PANDA'===_0x5caf25['config']['boxType']?_0x53eb5f:_0x45fb29;},function(_0x21f059,_0x213f95,_0xa384e5){const _0xc2d3fa=a0_0x23a4;var _0x5e8ee9,_0x46e48a,_0x1bb35f,_0x5618e8,_0x370b33,_0x545142=this&&this[_0xc2d3fa(0x1f9)]||function(_0x3b4671,_0x13dd17,_0x1e5f8b,_0x183ca8){const _0x47f64a=_0xc2d3fa;var _0x2f8c1f,_0x12002f=arguments[_0x47f64a(0x1fa)],_0x8fea2f=_0x12002f<0x3?_0x13dd17:null===_0x183ca8?_0x183ca8=Object['getOwnPropertyDescriptor'](_0x13dd17,_0x1e5f8b):_0x183ca8;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x47f64a(0x2e3)])_0x8fea2f=Reflect['decorate'](_0x3b4671,_0x13dd17,_0x1e5f8b,_0x183ca8);else{for(var _0x8a37e6=_0x3b4671['length']-0x1;_0x8a37e6>=0x0;_0x8a37e6--)(_0x2f8c1f=_0x3b4671[_0x8a37e6])&&(_0x8fea2f=(_0x12002f<0x3?_0x2f8c1f(_0x8fea2f):_0x12002f>0x3?_0x2f8c1f(_0x13dd17,_0x1e5f8b,_0x8fea2f):_0x2f8c1f(_0x13dd17,_0x1e5f8b))||_0x8fea2f);}return _0x12002f>0x3&&_0x8fea2f&&Object['defineProperty'](_0x13dd17,_0x1e5f8b,_0x8fea2f),_0x8fea2f;},_0x385aa3=this&&this['__metadata']||function(_0xd2813f,_0x44ba6e){const _0x10b566=_0xc2d3fa;if(_0x10b566(0x34a)==typeof Reflect&&'function'==typeof Reflect[_0x10b566(0x216)])return Reflect['metadata'](_0xd2813f,_0x44ba6e);},_0x334339=this&&this['__param']||function(_0x364125,_0x4f657b){return function(_0x55e6f0,_0x438b49){_0x4f657b(_0x55e6f0,_0x438b49,_0x364125);};};Object['defineProperty'](_0x213f95,_0xc2d3fa(0x3f1),{'value':!0x0}),_0x213f95[_0xc2d3fa(0x331)]=void 0x0;const _0x42b416=_0xa384e5(0x2),_0x445ff4=_0xa384e5(0xe),_0xb49050=_0xa384e5(0x17),_0x44ba65=_0xa384e5(0x13),_0x36640c=_0xa384e5(0xd),_0x17d14e=_0xa384e5(0x18),_0x3c9e3b=_0xa384e5(0x29),_0x3586bd=_0xa384e5(0x1b),_0x1ad4ab=_0xa384e5(0x2a),_0x4f0ddf=_0xa384e5(0x24),_0x5584f6=_0xa384e5(0x2b),_0x4b6c58=_0xa384e5(0x2c),_0xc0ec11=_0xa384e5(0x1e);let _0x10a4da=class extends _0xb49050[_0xc2d3fa(0x2d9)]{constructor(_0x323e03,_0x3d4ea6,_0x5dc666,_0x1d0bfe,_0x2194a7){const _0x249dd6=_0xc2d3fa;super(_0x323e03,_0x3d4ea6,_0x5dc666,_0x1d0bfe),this[_0x249dd6(0x292)]=_0x323e03,this['telegramService']=_0x2194a7,this['BANK_CODE']=_0x249dd6(0x282),this['BUNDLE_ID']=_0x249dd6(0x1a7);}async['inputPasswordFromConfig'](_0x447e1f){const _0x1265a9=_0xc2d3fa,_0x11a3e3=await this['deviceService']['getDeviceConfig'](_0x447e1f);if(!_0x11a3e3||!_0x11a3e3['password'])throw new Error('Password\x20not\x20configured\x20for\x20device\x20'+_0x447e1f);await this['clickWithTransition'](_0x447e1f,_0x3c9e3b['PG_UI_COORDINATES'][_0x1265a9(0x2cb)]['x'],_0x3c9e3b[_0x1265a9(0x25f)][_0x1265a9(0x2cb)]['y'],0x5dc),await this[_0x1265a9(0x292)]['inputText'](_0x447e1f,_0x11a3e3['password']),await(0x0,_0x17d14e['sleep'])(0x3e8),await this['wsService'][_0x1265a9(0x3e6)](_0x447e1f);}async['inputSmartOTPFromConfig'](_0x3863a4,_0x2f800e=0x3){const _0x5a4ea9=_0xc2d3fa,_0x286982=await this[_0x5a4ea9(0x17f)]['getDeviceConfig'](_0x3863a4);if(!_0x286982||!_0x286982[_0x5a4ea9(0x374)])throw new Error('SmartOTP\x20not\x20configured\x20for\x20device\x20'+_0x3863a4);await(0x0,_0x17d14e['sleep'])(0x7d0),await this['wsService'][_0x5a4ea9(0x40d)](_0x3863a4,_0x286982[_0x5a4ea9(0x374)]);}async['launchApp'](_0x3afb4a){const _0x533582=_0xc2d3fa;if(await this['wsService']['launchApp'](_0x3afb4a,this['BUNDLE_ID']),!await this[_0x533582(0x32d)](_0x3afb4a,{'expectedTexts':[_0x533582(0x3e9)],'timeout':0x2710,'pollInterval':0x1f4,'roi':_0x4f0ddf['PG_ROI_EXPECTED'][_0x533582(0x242)],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new Error('Failed\x20to\x20launch\x20PGBank\x20app\x20and\x20go\x20to\x20login\x20screen');this['logger']['log']('['+_0x3afb4a+']\x20-\x20Get\x20login\x20app\x20screen');}async['login'](_0x5dff40){const _0x505cc1=_0xc2d3fa;if(await this['killApp'](_0x5dff40),await(0x0,_0x17d14e['sleep'])(0x3e8),await this['launchApp'](_0x5dff40),await(0x0,_0x17d14e['sleep'])(0x3e8),await this[_0x505cc1(0x40c)](_0x5dff40),!await this['clickAndWaitForScreen'](_0x5dff40,_0x3c9e3b['PG_UI_COORDINATES']['LOGIN_BTN']['x'],_0x3c9e3b['PG_UI_COORDINATES'][_0x505cc1(0x283)]['y'],{'expectedTexts':['t√†i\x20kho·∫£n','chuy·ªÉn\x20ti·ªÅn',_0x505cc1(0x21d)],'timeout':0x4e20,'pollInterval':0x1f4,'roi':_0x4f0ddf['PG_ROI_EXPECTED']['HOME_SCREEN']}))throw this[_0x505cc1(0x21e)]['sendMessage']({'text':'‚ùå\x20Login\x20Error\x0a\x0a<b>Device:</b>\x20'+_0x5dff40+'\x0a<b>Error:</b>\x20Kh√¥ng\x20th·ªÉ\x20ƒëƒÉng\x20nh·∫≠p\x20v√†o\x20app\x20PGBank.','options':{'parseMode':'HTML'}}),new Error('Failed\x20to\x20login\x20to\x20PGBank');this['logger']['log']('['+_0x5dff40+']\x20-\x20Login\x20successfully');}async['executeTransferWithQRCode'](_0x17bd01,_0x359bd7){const _0x53321e=_0xc2d3fa;if(this['logger']['log']('Executing\x20PG\x20transfer\x20for\x20withdrawal\x20'+_0x17bd01[_0x53321e(0x3bf)]+_0x53321e(0x1e1)+_0x359bd7['deviceId']),await this[_0x53321e(0x37a)](_0x359bd7['deviceId'],_0x3c9e3b[_0x53321e(0x25f)]['QR_CODE_BTN']['x'],_0x3c9e3b['PG_UI_COORDINATES']['QR_CODE_BTN']['y'],0x1388),!await this[_0x53321e(0x344)](_0x359bd7['deviceId'],_0x3c9e3b['PG_UI_COORDINATES'][_0x53321e(0x2a2)]['x'],_0x3c9e3b['PG_UI_COORDINATES'][_0x53321e(0x2a2)]['y'],{'expectedTexts':['·∫¢nh'],'timeout':0x2710,'pollInterval':0x1f4,'roi':_0x4f0ddf['PG_ROI_EXPECTED']['ALBUM_SCREEN']}))throw new _0x1ad4ab[(_0x53321e(0x196))]('['+_0x359bd7['accountName']+']\x20Failed\x20to\x20get\x20image\x20library\x20screen',_0x1ad4ab['ErrorType']['FORCE_LOGIN_AND_REQUEUE']);this['logger']['log']('['+_0x359bd7['accountName']+_0x53321e(0x38a)),await this['clickWithTransition'](_0x359bd7['deviceId'],_0x3c9e3b['PG_UI_COORDINATES']['FIRST_IMAGE_BTN']['x'],_0x3c9e3b['PG_UI_COORDINATES'][_0x53321e(0x26d)]['y'],0x7d0);let _0xb57fbe=!0x1;if(_0xb57fbe=_0x17bd01[_0x53321e(0x385)]===_0x5584f6[_0x53321e(0x41f)]['PGBANK']?await this[_0x53321e(0x344)](_0x359bd7['deviceId'],_0x3c9e3b['PG_UI_COORDINATES'][_0x53321e(0x182)]['x'],_0x3c9e3b[_0x53321e(0x25f)]['SELECT_IMAGE_QR_CODE_BTN']['y'],{'expectedTexts':[_0x17bd01[_0x53321e(0x218)]],'timeout':0x4e20,'pollInterval':0x1f4,'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}):await this['clickAndWaitForScreen'](_0x359bd7[_0x53321e(0x3cb)],_0x3c9e3b['PG_UI_COORDINATES'][_0x53321e(0x182)]['x'],_0x3c9e3b['PG_UI_COORDINATES']['SELECT_IMAGE_QR_CODE_BTN']['y'],{'expectedTexts':[_0x17bd01[_0x53321e(0x218)]],'timeout':0x4e20,'pollInterval':0x1f4,'roi':_0x4f0ddf[_0x53321e(0x3cd)]['VERIFY_ACCOUNT_NAME'],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}),!_0xb57fbe)throw new _0x1ad4ab[(_0x53321e(0x196))]('Choose\x20wrong\x20image\x20qrcode',_0x1ad4ab[_0x53321e(0x325)]['FORCE_LOGIN_AND_REQUEUE']);if(this['logger'][_0x53321e(0x230)]('['+_0x359bd7['accountName']+']\x20-\x20Get\x20Verified\x20account\x20name\x20screen'),!await this['clickAndWaitForScreen'](_0x359bd7['deviceId'],_0x3c9e3b['PG_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['x'],_0x3c9e3b['PG_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['y'],{'expectedTexts':['X√°c\x20nh·∫≠n\x20giao\x20d·ªãch'],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x4f0ddf['PG_ROI_EXPECTED']['TRANSACTION_CONFIRM'],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new _0x1ad4ab['WithdrawalProcessingError']('Transaction\x20confirm\x20screen\x20not\x20found',_0x1ad4ab['ErrorType'][_0x53321e(0x390)]);if(this['logger'][_0x53321e(0x230)]('['+_0x359bd7['accountName']+_0x53321e(0x395)),!await this['clickAndWaitForScreen'](_0x359bd7[_0x53321e(0x3cb)],_0x3c9e3b[_0x53321e(0x25f)][_0x53321e(0x418)]['x'],_0x3c9e3b['PG_UI_COORDINATES'][_0x53321e(0x418)]['y'],{'expectedTexts':['X√°c\x20th·ª±c\x20giao\x20d·ªãch'],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x4f0ddf[_0x53321e(0x3cd)]['TRANSACTION_VERIFY'],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new _0x1ad4ab['WithdrawalProcessingError']('Transaction\x20verification\x20screen\x20not\x20found',_0x1ad4ab['ErrorType'][_0x53321e(0x390)]);if(this[_0x53321e(0x25d)]['log']('['+_0x359bd7[_0x53321e(0x398)]+']\x20-\x20Get\x20Transaction\x20verification\x20screen'),await this['inputSmartOTPFromConfig'](_0x359bd7['deviceId']),!await this[_0x53321e(0x32d)](_0x359bd7['deviceId'],{'expectedTexts':['Chuy·ªÉn\x20ti·ªÅn\x20th√†nh\x20c√¥ng'],'timeout':0xea60,'pollInterval':0x1f4,'roi':_0x4f0ddf[_0x53321e(0x3cd)]['TRANSACTION_SUCCESS'],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new _0x1ad4ab['WithdrawalProcessingError']('Transaction\x20success\x20screen\x20not\x20found',_0x1ad4ab['ErrorType'][_0x53321e(0x229)]);if(this['logger'][_0x53321e(0x230)]('['+_0x359bd7['accountName']+']\x20-\x20Get\x20Transaction\x20success\x20screen'),await(0x0,_0x17d14e['sleep'])(0x1f4),await this['captureScreen'](_0x359bd7['deviceId'],{'folderPath':_0x17bd01['withdrawalCode']}),!await this['clickAndWaitForScreen'](_0x359bd7['deviceId'],_0x3c9e3b['PG_UI_COORDINATES']['BACK_TO_HOME']['x'],_0x3c9e3b['PG_UI_COORDINATES']['BACK_TO_HOME']['y'],{'expectedTexts':[_0x53321e(0x40e),'chuy·ªÉn\x20ti·ªÅn',_0x53321e(0x21d)],'timeout':0x2710,'pollInterval':0x1f4,'roi':_0x4f0ddf['PG_ROI_EXPECTED']['HOME_SCREEN']}))throw new _0x1ad4ab['WithdrawalProcessingError']('Failed\x20to\x20login\x20to\x20PGBank',_0x1ad4ab['ErrorType']['FORCE_LOGIN_NO_REQUEUE']);this[_0x53321e(0x25d)]['log']('['+_0x359bd7['deviceId']+']\x20-\x20Get\x20to\x20home\x20screen');}async['extractTransactionAmount'](_0x14f8be){const _0x508764=_0xc2d3fa;try{const _0x1f5d9f=await this['ocrService']['recognizeFromFile'](_0x14f8be,{'fieldType':'singleLine','customROI':{'x':0.05,'y':0.75,'width':0.9,'height':0.12},'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}});if(!_0x1f5d9f)return this[_0x508764(0x25d)][_0x508764(0x3d4)]('Failed\x20to\x20extract\x20transaction\x20amount\x20from\x20ROI'),null;const _0xdceb31=_0x1f5d9f['text']['replace'](/[^\d.,]/g,'')['replace'](/,/g,''),_0x2d5f0a=parseFloat(_0xdceb31);return isNaN(_0x2d5f0a)?(this['logger']['warn']('Could\x20not\x20parse\x20amount\x20from\x20OCR\x20text:\x20'+_0x1f5d9f['text']),null):(this[_0x508764(0x25d)]['log']('Extracted\x20transaction\x20amount:\x20'+_0x2d5f0a['toLocaleString']('vi-VN')+_0x508764(0x215)+_0x1f5d9f['confidence']['toFixed'](0x2)+'%,\x20time:\x20'+_0x1f5d9f['processingTime']+'ms)'),_0x2d5f0a);}catch(_0x1bb726){return this['logger']['error'](_0x508764(0x2db)+_0x1bb726['message'],_0x1bb726[_0x508764(0x384)]),null;}}async['onModuleInit'](){}['onModuleDestroy'](){}};_0x213f95[_0xc2d3fa(0x331)]=_0x10a4da,_0x213f95['PgService']=_0x10a4da=_0x545142([(0x0,_0x42b416[_0xc2d3fa(0x3ea)])(),_0x334339(0x0,(0x0,_0x42b416['Inject'])(_0x36640c[_0xc2d3fa(0x429)])),_0x385aa3(_0xc2d3fa(0x2b1),['function'==typeof(_0x5e8ee9=void 0x0!==_0x44ba65['IWebSocketService']&&_0x44ba65['IWebSocketService'])?_0x5e8ee9:Object,'function'==typeof(_0x46e48a=void 0x0!==_0x445ff4['DeviceService']&&_0x445ff4['DeviceService'])?_0x46e48a:Object,'function'==typeof(_0x1bb35f=void 0x0!==_0x3586bd['OCRService']&&_0x3586bd[_0xc2d3fa(0x1b9)])?_0x1bb35f:Object,_0xc2d3fa(0x24f)==typeof(_0x5618e8=void 0x0!==_0xc0ec11['ImagePreprocessingService']&&_0xc0ec11['ImagePreprocessingService'])?_0x5618e8:Object,_0xc2d3fa(0x24f)==typeof(_0x370b33=void 0x0!==_0x4b6c58['TelegramService']&&_0x4b6c58['TelegramService'])?_0x370b33:Object])],_0x10a4da);},(_0x11bb3a,_0x1c5d60,_0x11b6d3)=>{const _0xa96d2c=a0_0x23a4;Object[_0xa96d2c(0x213)](_0x1c5d60,'__esModule',{'value':!0x0}),_0x1c5d60[_0xa96d2c(0x25f)]=void 0x0;const _0x29df12=_0x11b6d3(0x11),_0x299747={'LOGIN_BTN':{'x':0.5,'y':0.6},'PASSWORD_FIELD':{'x':0.5,'y':0.435},'TRANSFER_BTN':{'x':0.7,'y':0.7},'TRANSFER_INTERNAL_BTN':{'x':0.2,'y':0.2},'TRANSFER_EXTERNAL_BTN':{'x':0.4,'y':0.2},'CLOSE_ALLOW_CONTACT_POPUP_BTN':{'x':0.3,'y':0.6},'ACCOUNT_NUMBER_INPUT':{'x':0.4,'y':0.43},'SELECT_BANK_BTN':{'x':0.4,'y':0.47},'SEARCH_BANK_BTN':{'x':0.4,'y':0.48},'INTERNAL_AMOUNT_INPUT':{'x':0.5,'y':0.6},'HIDE_NUMPAD_BTN':{'x':0.05,'y':0.4},'CONTINUE_TRANSFER_BTN':{'x':0.5,'y':0.9},'BANK_SEARCH_BTN':{'x':0.4,'y':0.45},'BANK_SEARCH_INPUT':{'x':0.4,'y':0.45},'EXTERNAL_AMOUNT_INPUT':{'x':0.3,'y':0.37},'BACK_TO_HOME':{'x':0.2,'y':0.9},'QR_CODE_BTN':{'x':0.2,'y':0.9},'IMAGE_LIBRARY_BTN':{'x':0.8,'y':0.9},'FIRST_IMAGE_BTN':{'x':0.3,'y':0.3},'SELECT_IMAGE_QR_CODE_BTN':{'x':0.95,'y':0.95},'HOME_ICON_HEADER':{'x':0.95,'y':0.05}},_0x24157b=(0x0,_0x11b6d3(0x26)[_0xa96d2c(0x379)])(_0x299747);_0x1c5d60['PG_UI_COORDINATES']=_0xa96d2c(0x454)===_0x29df12['config']['boxType']?_0x24157b:_0x299747;},(_0x56c41f,_0x39b64b)=>{const _0x169748=a0_0x23a4;var _0x1dcbfd;Object[_0x169748(0x213)](_0x39b64b,'__esModule',{'value':!0x0}),_0x39b64b[_0x169748(0x196)]=_0x39b64b[_0x169748(0x325)]=void 0x0,function(_0x73c26b){const _0x1d546b=_0x169748;_0x73c26b['TEMPORARY']=_0x1d546b(0x44e),_0x73c26b[_0x1d546b(0x3df)]='PERMANENT',_0x73c26b['FORCE_LOGIN_AND_REQUEUE']='FORCE_LOGIN_AND_REQUEUE',_0x73c26b['FORCE_LOGIN_NO_REQUEUE']=_0x1d546b(0x2b6),_0x73c26b['NO_BILL_AFTER_OTP']=_0x1d546b(0x229);}(_0x1dcbfd||(_0x39b64b[_0x169748(0x325)]=_0x1dcbfd={}));class _0x1b0b26 extends Error{constructor(_0x2f01ac,_0x3ea4d4){const _0x562978=_0x169748;super(_0x2f01ac),this['errorType']=_0x3ea4d4,this[_0x562978(0x162)]='WithdrawalProcessingError',Error[_0x562978(0x397)](this,this['constructor']);}}_0x39b64b[_0x169748(0x196)]=_0x1b0b26;},(_0x25ed39,_0x727bad)=>{const _0x1dcea4=a0_0x23a4;var _0x3b9d14;Object['defineProperty'](_0x727bad,'__esModule',{'value':!0x0}),_0x727bad[_0x1dcea4(0x41f)]=void 0x0,function(_0x270f32){const _0x80a621=_0x1dcea4;_0x270f32['VIETCOMBANK']='VIETCOMBANK',_0x270f32['AGRIBANK']=_0x80a621(0x435),_0x270f32['BIDV']='BIDV',_0x270f32['SACOMBANK']=_0x80a621(0x1e5),_0x270f32['TECHCOMBANK']='TECHCOMBANK',_0x270f32[_0x80a621(0x2ef)]=_0x80a621(0x2ef),_0x270f32['HDBank']='HDBank',_0x270f32['VPBANK']=_0x80a621(0x29d),_0x270f32['MBBANK']='MBBANK',_0x270f32['MSB']='MSB',_0x270f32['LPBANK']='LPBANK',_0x270f32['ACB']='ACB',_0x270f32['ABBANK']='ABBANK',_0x270f32['NCB']='NCB',_0x270f32[_0x80a621(0x32e)]='EXIMBANK',_0x270f32[_0x80a621(0x1ab)]=_0x80a621(0x1ab),_0x270f32['SCB']='SCB',_0x270f32['PVCOMBANK']='PVCOMBANK',_0x270f32['KIENLONGBANK']=_0x80a621(0x1e7),_0x270f32[_0x80a621(0x3fc)]=_0x80a621(0x3fc),_0x270f32['VIETINBANK']=_0x80a621(0x1fc),_0x270f32[_0x80a621(0x438)]='OCB',_0x270f32[_0x80a621(0x263)]=_0x80a621(0x263),_0x270f32[_0x80a621(0x39b)]='SHB',_0x270f32[_0x80a621(0x184)]='NAMABANK',_0x270f32['SHINHANBANKVIETNAM']='SHINHANBANKVIETNAM',_0x270f32['CIMB']='CIMB',_0x270f32['SAIGONBANK']='SAIGONBANK',_0x270f32['BACABANK']='BACABANK',_0x270f32[_0x80a621(0x244)]=_0x80a621(0x244),_0x270f32['GPBANK']='GPBANK',_0x270f32['HSBC']=_0x80a621(0x31d),_0x270f32['VRB']='VRB',_0x270f32['VIB']=_0x80a621(0x369),_0x270f32['PGBANK']='PGBANK';}(_0x3b9d14||(_0x727bad['BankCodeWithdrawal']=_0x3b9d14={}));},function(_0x150343,_0x3975ef,_0x55b0b8){const _0xda39fa=a0_0x23a4;var _0x16e7bc,_0x44c1d7=this&&this['__decorate']||function(_0x992725,_0x5b269c,_0x3ac275,_0x575908){const _0x3fd1d5=a0_0x23a4;var _0x51f72e,_0x4753be=arguments[_0x3fd1d5(0x1fa)],_0x28b914=_0x4753be<0x3?_0x5b269c:null===_0x575908?_0x575908=Object['getOwnPropertyDescriptor'](_0x5b269c,_0x3ac275):_0x575908;if(_0x3fd1d5(0x34a)==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x28b914=Reflect['decorate'](_0x992725,_0x5b269c,_0x3ac275,_0x575908);else{for(var _0x167fb0=_0x992725[_0x3fd1d5(0x1fa)]-0x1;_0x167fb0>=0x0;_0x167fb0--)(_0x51f72e=_0x992725[_0x167fb0])&&(_0x28b914=(_0x4753be<0x3?_0x51f72e(_0x28b914):_0x4753be>0x3?_0x51f72e(_0x5b269c,_0x3ac275,_0x28b914):_0x51f72e(_0x5b269c,_0x3ac275))||_0x28b914);}return _0x4753be>0x3&&_0x28b914&&Object['defineProperty'](_0x5b269c,_0x3ac275,_0x28b914),_0x28b914;},_0x2612a9=this&&this['__metadata']||function(_0x46e71c,_0x14dff8){const _0x2049a9=a0_0x23a4;if(_0x2049a9(0x34a)==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect[_0x2049a9(0x216)](_0x46e71c,_0x14dff8);};Object[_0xda39fa(0x213)](_0x3975ef,_0xda39fa(0x3f1),{'value':!0x0}),_0x3975ef['TelegramService']=void 0x0;const _0x477453=_0x55b0b8(0x18),_0x49b338=_0x55b0b8(0x2),_0x25cd59=_0x55b0b8(0x2d),_0x596f35=_0x55b0b8(0x2e),_0x191c47=_0x55b0b8(0x19);let _0x97bff0=_0x16e7bc=class{constructor(){const _0x3540ce=_0xda39fa;this[_0x3540ce(0x25d)]=new _0x49b338[(_0x3540ce(0x34b))](_0x16e7bc['name']),this[_0x3540ce(0x39c)]='8514906447:AAGFB2Fsl21IeF1tJvt8y6UsuoyNCIVcwCE',this['defaultChatId']='-5288197652',this['baseUrl']='https://api.telegram.org',this[_0x3540ce(0x20d)]=_0x25cd59['default']['create']({'baseURL':this['baseUrl']+'/bot'+this['token'],'timeout':0x3a98});}async['sendMessage'](_0x133d93){const _0x835993=_0xda39fa,{text:_0x65586,chatId:_0x2d4c6b,options:_0x37a166={}}=_0x133d93,_0x3abc0a=_0x2d4c6b??this['mustDefaultChatId']();this['requestWithRetry']('/sendMessage',{'chat_id':_0x3abc0a,'text':_0x65586,'parse_mode':_0x37a166[_0x835993(0x38c)]??'HTML','disable_web_page_preview':_0x37a166['disableWebPagePreview']??!0x1,'disable_notification':_0x37a166[_0x835993(0x356)]??!0x1,'reply_to_message_id':_0x37a166[_0x835993(0x3ce)]??void 0x0})['catch'](_0x57aa7c=>{const _0x26d551=_0x835993;this['logger']['error'](_0x26d551(0x1fe),_0x57aa7c['stack']);});}async['sendPhotoByUrl'](_0x21ceb6,_0x1239cd=this['mustDefaultChatId'](),_0x1d3a42={}){const _0x52f796=_0xda39fa;await this['requestWithRetry']('/sendPhoto',{'chat_id':_0x1239cd,'photo':_0x21ceb6,'caption':_0x1d3a42['caption'],'parse_mode':_0x1d3a42['parseMode'],'disable_notification':_0x1d3a42[_0x52f796(0x356)]});}async['sendPhotoByFile'](_0x458d25,_0xaec8ad=this['mustDefaultChatId'](),_0x5396ae={}){const _0x228e99=_0xda39fa;try{const _0xec13b9=(0x0,_0x191c47['createReadStream'])(_0x458d25),_0x1f6311=new _0x596f35['default']();_0x1f6311['append']('chat_id',String(_0xaec8ad)),_0x1f6311['append'](_0x228e99(0x2ec),_0xec13b9),_0x5396ae['caption']&&_0x1f6311['append'](_0x228e99(0x1b4),_0x5396ae['caption']),_0x5396ae[_0x228e99(0x38c)]&&_0x1f6311[_0x228e99(0x2b0)]('parse_mode',_0x5396ae[_0x228e99(0x38c)]),void 0x0!==_0x5396ae['disableNotification']&&_0x1f6311['append'](_0x228e99(0x2ed),String(_0x5396ae['disableNotification'])),await this['requestFormWithRetry']('/sendPhoto',_0x1f6311);}catch(_0x5eed09){this['logger'][_0x228e99(0x382)]('Error\x20sending\x20photo\x20by\x20file:\x20'+_0x5eed09[_0x228e99(0x1c8)]);}}async['sendPhotoByBuffer'](_0x3abf48,_0x35c527='image.png',_0x305806='image/png',_0x2b7b63=this['mustDefaultChatId'](),_0x2e4491={}){const _0x36c151=_0xda39fa,_0x37441b=new _0x596f35['default']();_0x37441b['append'](_0x36c151(0x23c),String(_0x2b7b63)),_0x37441b['append']('photo',_0x3abf48,{'filename':_0x35c527,'contentType':_0x305806}),_0x2e4491[_0x36c151(0x1b4)]&&_0x37441b[_0x36c151(0x2b0)]('caption',_0x2e4491['caption']),_0x2e4491['parseMode']&&_0x37441b['append']('parse_mode',_0x2e4491['parseMode']),void 0x0!==_0x2e4491[_0x36c151(0x356)]&&_0x37441b['append']('disable_notification',String(_0x2e4491['disableNotification'])),this['requestFormWithRetry']('/sendPhoto',_0x37441b)['catch'](_0x5ee9ff=>{const _0x284076=_0x36c151;this['logger'][_0x284076(0x382)](_0x284076(0x231),_0x5ee9ff[_0x284076(0x384)]);});}async['sendPhotoByBase64'](_0x58e6ae,_0x4ecf00='image.png',_0x45faf2='image/png',_0x164d8e=this['mustDefaultChatId'](),_0x1c0edb={}){const _0x4a6db8=this['stripBase64Prefix'](_0x58e6ae),_0x92849c=Buffer['from'](_0x4a6db8,'base64');await this['sendPhotoByBuffer'](_0x92849c,_0x4ecf00,_0x45faf2,_0x164d8e,_0x1c0edb);}['mustDefaultChatId'](){const _0x259fc7=_0xda39fa;if(!this[_0x259fc7(0x1bb)])throw new Error('TELEGRAM_DEFAULT_CHAT_ID\x20is\x20missing\x20and\x20no\x20chatId\x20was\x20provided.');return this['defaultChatId'];}[_0xda39fa(0x3dd)](_0x8c74a1){const _0xf0ccfe=_0xda39fa,_0x1ce898=_0x8c74a1[_0xf0ccfe(0x28c)](_0xf0ccfe(0x1d9));return _0x1ce898>=0x0?_0x8c74a1['slice'](_0x1ce898+0x7):_0x8c74a1;}async['requestWithRetry'](_0x20e269,_0x51761f,_0x4f881c=0x2){const _0x2740ec=_0xda39fa;try{const _0x66eefb=await this[_0x2740ec(0x20d)]['post'](_0x20e269,_0x51761f);if(!_0x66eefb[_0x2740ec(0x35a)]?.['ok']){const _0x39c45c=_0x66eefb['data']?.['description']??_0x2740ec(0x16d);throw new Error('Telegram\x20API\x20error:\x20'+_0x39c45c);}}catch(_0x622d27){if(_0x4f881c>0x0&&this['isRetryable'](_0x622d27)){const _0x384120=this['backoffMs'](_0x4f881c);return this['logger'][_0x2740ec(0x3d4)]('Telegram\x20request\x20failed,\x20retrying\x20in\x20'+_0x384120+_0x2740ec(0x324)+this['safeErr'](_0x622d27)),await(0x0,_0x477453[_0x2740ec(0x37f)])(_0x384120),this['requestWithRetry'](_0x20e269,_0x51761f,_0x4f881c-0x1);}throw this[_0x2740ec(0x25d)]['error'](_0x2740ec(0x300)+this['safeErr'](_0x622d27)),_0x622d27;}}async['requestFormWithRetry'](_0x1b3c85,_0x27d181,_0x583b6f=0x2){const _0x161799=_0xda39fa;try{const _0x275af1=await this['http']['post'](_0x1b3c85,_0x27d181,{'headers':_0x27d181['getHeaders'](),'maxBodyLength':0x1/0x0,'maxContentLength':0x1/0x0});if(!_0x275af1['data']?.['ok']){const _0x2878c4=_0x275af1[_0x161799(0x35a)]?.['description']??'Unknown\x20Telegram\x20error';throw new Error('Telegram\x20API\x20error:\x20'+_0x2878c4);}}catch(_0x2e078f){if(_0x583b6f>0x0&&this[_0x161799(0x3a6)](_0x2e078f)){const _0xc984e1=this[_0x161799(0x372)](_0x583b6f);return this[_0x161799(0x25d)]['warn'](_0x161799(0x2be)+_0xc984e1+'ms:\x20'+this['safeErr'](_0x2e078f)),await(0x0,_0x477453['sleep'])(_0xc984e1),this['requestFormWithRetry'](_0x1b3c85,_0x27d181,_0x583b6f-0x1);}this['logger'][_0x161799(0x382)]('Telegram\x20form\x20request\x20failed:\x20'+this[_0x161799(0x333)](_0x2e078f));}}[_0xda39fa(0x3a6)](_0x4e3b95){const _0x50c148=_0xda39fa,_0x51bc9d=_0x4e3b95?.['code'],_0x840592=_0x4e3b95?.['response']?.['status'];return _0x50c148(0x16c)===_0x51bc9d||_0x840592>=0x1f4&&_0x840592<=0x257||!(_0x840592||'ENOTFOUND'!==_0x51bc9d&&_0x50c148(0x3e5)!==_0x51bc9d&&'EAI_AGAIN'!==_0x51bc9d);}['backoffMs'](_0x3034b4){return 0x190*(0x2-_0x3034b4+0x1);}['safeErr'](_0x14264d){const _0x5d4074=_0xda39fa,_0x17e7ab=_0x14264d?.['response']?.['status'],_0x50d4e5=_0x14264d?.['response']?.['data']?.[_0x5d4074(0x326)],_0xd036b9=_0x14264d?.[_0x5d4074(0x1c8)];return[_0x17e7ab?'status='+_0x17e7ab:'',_0x50d4e5?'desc='+_0x50d4e5:'',_0xd036b9?_0x5d4074(0x2a8)+_0xd036b9:'']['filter'](Boolean)['join'](_0x5d4074(0x399));}};_0x3975ef['TelegramService']=_0x97bff0,_0x3975ef['TelegramService']=_0x97bff0=_0x16e7bc=_0x44c1d7([(0x0,_0x49b338['Injectable'])(),_0x2612a9(_0xda39fa(0x2b1),[])],_0x97bff0);},_0x4d36df=>{_0x4d36df['exports']=require('axios');},_0x507707=>{const _0x598090=a0_0x23a4;_0x507707[_0x598090(0x391)]=require('form-data');},function(_0x3dd3a0,_0xc3fbf2,_0x248d57){const _0x48ef1d=a0_0x23a4;var _0x51d2ba,_0x31587d,_0x2d29b0,_0x126148,_0x401760=this&&this['__decorate']||function(_0x52d984,_0x10d79a,_0x5b2cfa,_0x246899){const _0x5907e8=a0_0x23a4;var _0x970974,_0x36f84b=arguments[_0x5907e8(0x1fa)],_0x1cc6c7=_0x36f84b<0x3?_0x10d79a:null===_0x246899?_0x246899=Object[_0x5907e8(0x26e)](_0x10d79a,_0x5b2cfa):_0x246899;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x1cc6c7=Reflect['decorate'](_0x52d984,_0x10d79a,_0x5b2cfa,_0x246899);else{for(var _0x371901=_0x52d984['length']-0x1;_0x371901>=0x0;_0x371901--)(_0x970974=_0x52d984[_0x371901])&&(_0x1cc6c7=(_0x36f84b<0x3?_0x970974(_0x1cc6c7):_0x36f84b>0x3?_0x970974(_0x10d79a,_0x5b2cfa,_0x1cc6c7):_0x970974(_0x10d79a,_0x5b2cfa))||_0x1cc6c7);}return _0x36f84b>0x3&&_0x1cc6c7&&Object['defineProperty'](_0x10d79a,_0x5b2cfa,_0x1cc6c7),_0x1cc6c7;},_0x4ac714=this&&this['__metadata']||function(_0x318b96,_0x1ef483){if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0x318b96,_0x1ef483);},_0x39df7d=this&&this[_0x48ef1d(0x165)]||function(_0x4650aa,_0x4c8b3b){return function(_0x4fbe5e,_0x24749c){_0x4c8b3b(_0x4fbe5e,_0x24749c,_0x4650aa);};};Object['defineProperty'](_0xc3fbf2,'__esModule',{'value':!0x0}),_0xc3fbf2['HdBankService']=void 0x0;const _0x2ec3b6=_0x248d57(0xd),_0xdc52db=_0x248d57(0x13),_0x5112b3=_0x248d57(0x18),_0x532db7=_0x248d57(0x2),_0x118300=_0x248d57(0xe),_0x50c55f=_0x248d57(0x17),_0x2a5f2c=_0x248d57(0x1b),_0x234cb8=_0x248d57(0x2a),_0x1696ed=_0x248d57(0x2b),_0x530de5=_0x248d57(0x30),_0x192e9e=_0x248d57(0x23),_0x18e33f=_0x248d57(0x31),_0x2ae8bc=_0x248d57(0x1e);let _0x2c96a2=class extends _0x50c55f['BaseBankService']{constructor(_0x5c04ee,_0x3c21ed,_0xa2666c,_0x575e9f){super(_0x5c04ee,_0x3c21ed,_0xa2666c,_0x575e9f),this['wsService']=_0x5c04ee,this['BANK_CODE']='HDBANK',this['BUNDLE_ID']='com.vnpay.HDBank';}async['inputPasswordFromConfig'](_0x41f507){const _0x2bfad2=_0x48ef1d,_0x459e54=await this['deviceService'][_0x2bfad2(0x187)](_0x41f507);if(!_0x459e54||!_0x459e54['password'])throw new Error('Password\x20not\x20configured\x20for\x20device\x20'+_0x41f507);await this['clickWithTransition'](_0x41f507,_0x530de5['HD_UI_COORDINATES']['PASSWORD_FIELD']['x'],_0x530de5['HD_UI_COORDINATES'][_0x2bfad2(0x2cb)]['y'],0x5dc),await this['wsService'][_0x2bfad2(0x40d)](_0x41f507,_0x459e54['password']),await(0x0,_0x5112b3['sleep'])(0x3e8);}async['inputSmartOTPFromConfig'](_0x6f49a8,_0x3d7842=0x3){const _0x25e63b=_0x48ef1d,_0x16a6f4=await this[_0x25e63b(0x17f)][_0x25e63b(0x187)](_0x6f49a8);if(!_0x16a6f4||!_0x16a6f4['smartOTP'])throw new Error(_0x25e63b(0x3af)+_0x6f49a8);await(0x0,_0x5112b3[_0x25e63b(0x37f)])(0x1f4),await this['wsService']['inputText'](_0x6f49a8,_0x16a6f4['smartOTP']);}async[_0x48ef1d(0x44b)](_0x306564){const _0x3cfad5=_0x48ef1d;if(await this['wsService'][_0x3cfad5(0x44b)](_0x306564,this['BUNDLE_ID']),!await this['verifyScreenState'](_0x306564,{'expectedTexts':['ƒêƒÉng\x20nh·∫≠p'],'timeout':0x2710,'pollInterval':0x1f4,'roi':_0x192e9e[_0x3cfad5(0x201)]['LAUNCH_APP'],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new Error('Failed\x20to\x20launch\x20HDBank\x20app\x20and\x20go\x20to\x20login\x20screen');this['logger']['log']('['+_0x306564+']\x20-\x20Get\x20login\x20app\x20screen');}async['login'](_0x45f7f8){const _0x2ceb65=_0x48ef1d;if(await this['killApp'](_0x45f7f8),await(0x0,_0x5112b3[_0x2ceb65(0x37f)])(0x7d0),await this[_0x2ceb65(0x44b)](_0x45f7f8),await this['inputPasswordFromConfig'](_0x45f7f8),!await this['clickAndWaitForScreen'](_0x45f7f8,_0x530de5[_0x2ceb65(0x188)]['LOGIN_BTN']['x'],_0x530de5[_0x2ceb65(0x188)]['LOGIN_BTN']['y'],{'expectedTexts':[_0x2ceb65(0x40e),'chuy·ªÉn\x20kho·∫£n'],'timeout':0x4e20,'pollInterval':0x1f4,'roi':_0x192e9e[_0x2ceb65(0x201)]['HOME_SCREEN']}))throw new Error('Failed\x20to\x20login\x20to\x20HDBank');this['logger'][_0x2ceb65(0x230)]('['+_0x45f7f8+_0x2ceb65(0x41c));}async['executeTransferWithQRCode'](_0x546f5e,_0x3adc06){const _0x3a5180=_0x48ef1d;if(this['logger'][_0x3a5180(0x230)](_0x3a5180(0x271)+_0x546f5e[_0x3a5180(0x3bf)]+'\x20on\x20device\x20'+_0x3adc06[_0x3a5180(0x3cb)]),await this['clickWithTransition'](_0x3adc06['deviceId'],_0x530de5['HD_UI_COORDINATES'][_0x3a5180(0x363)]['x'],_0x530de5['HD_UI_COORDINATES']['QR_CODE_BTN']['y'],0xbb8),await(0x0,_0x5112b3['sleep'])(0x7d0),!await this['clickAndWaitForScreen'](_0x3adc06['deviceId'],_0x530de5[_0x3a5180(0x188)][_0x3a5180(0x2a2)]['x'],_0x530de5[_0x3a5180(0x188)]['IMAGE_LIBRARY_BTN']['y'],{'expectedTexts':['·∫¢nh'],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x192e9e[_0x3a5180(0x201)][_0x3a5180(0x402)]}))throw new _0x234cb8['WithdrawalProcessingError']('Failed\x20to\x20click\x20image\x20library\x20button',_0x234cb8['ErrorType'][_0x3a5180(0x390)]);this['logger']['log']('['+_0x3adc06['accountName']+']\x20-\x20Get\x20image\x20library\x20screen'),await this[_0x3a5180(0x37a)](_0x3adc06[_0x3a5180(0x3cb)],_0x530de5['HD_UI_COORDINATES']['FIRST_IMAGE_BTN']['x'],_0x530de5['HD_UI_COORDINATES'][_0x3a5180(0x26d)]['y'],0x7d0);let _0x36bd46=!0x1;if(_0x36bd46=_0x546f5e['bankCode']===_0x1696ed[_0x3a5180(0x41f)]['HDBank']?await this[_0x3a5180(0x344)](_0x3adc06[_0x3a5180(0x3cb)],_0x530de5['HD_UI_COORDINATES']['SELECT_IMAGE_QR_CODE_BTN']['x'],_0x530de5['HD_UI_COORDINATES']['SELECT_IMAGE_QR_CODE_BTN']['y'],{'expectedTexts':[_0x546f5e['beneficiaryAccountNo']],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x192e9e[_0x3a5180(0x201)][_0x3a5180(0x2fc)]}):await this['clickAndWaitForScreen'](_0x3adc06[_0x3a5180(0x3cb)],_0x530de5[_0x3a5180(0x188)]['SELECT_IMAGE_QR_CODE_BTN']['x'],_0x530de5[_0x3a5180(0x188)]['SELECT_IMAGE_QR_CODE_BTN']['y'],{'expectedTexts':[_0x546f5e['beneficiaryName']],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x192e9e['HD_ROI_EXPECTED']['VERIFY_ACCOUNT_NAME']}),!_0x36bd46)throw await this['clickWithTransition'](_0x3adc06[_0x3a5180(0x3cb)],_0x530de5['HD_UI_COORDINATES']['HOME_ICON']['x'],_0x530de5['HD_UI_COORDINATES']['HOME_ICON']['y'],0x7d0),new _0x234cb8[(_0x3a5180(0x196))]('Choose\x20wrong\x20image\x20qrcode',_0x234cb8['ErrorType'][_0x3a5180(0x44e)]);if(this[_0x3a5180(0x25d)]['log']('['+_0x3adc06['accountName']+_0x3a5180(0x2c5)),await(0x0,_0x5112b3['sleep'])(0x1f4),!await this[_0x3a5180(0x19a)](_0x3adc06['deviceId'],{'type':_0x18e33f['PandaSwipeTypeEnum']['SWIPE_UP']},{'expectedTexts':['danh\x20ba\x20th·ª•\x20h∆∞·ªüng'],'timeout':0x2710,'pollInterval':0x1f4,'roi':_0x192e9e[_0x3a5180(0x201)][_0x3a5180(0x371)],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new _0x234cb8['WithdrawalProcessingError']('Swipe\x20up\x20failed',_0x234cb8['ErrorType']['FORCE_LOGIN_AND_REQUEUE']);this[_0x3a5180(0x25d)]['log']('['+_0x3adc06[_0x3a5180(0x398)]+']\x20-\x20Get\x20Swipe\x20up\x20screen'),await this[_0x3a5180(0x37a)](_0x3adc06['deviceId'],_0x530de5[_0x3a5180(0x188)]['CONTINUE_TRANSFER_BTN']['x'],_0x530de5['HD_UI_COORDINATES'][_0x3a5180(0x418)]['y'],0x1f4);const _0x2abcb5=await this['detectScreenByHint'](_0x3adc06[_0x3a5180(0x3cb)],_0x530de5['HD_SCREEN_OTP_HINT'],{'timeout':0x4e20,'pollInterval':0x1f4,'roi':_0x192e9e[_0x3a5180(0x201)]['OTP_ENTER_OR_CONTINUE_TRANSFER'],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}});if(!_0x2abcb5)throw new _0x234cb8['WithdrawalProcessingError']('Couldn\x27t\x20get\x20HD\x20Screen\x20state\x20not\x20found',_0x234cb8['ErrorType']['FORCE_LOGIN_AND_REQUEUE']);switch(await(0x0,_0x5112b3['sleep'])(0x3e8),_0x2abcb5['name']){case _0x530de5['HD_SCREEN_HINT_NAME'][_0x3a5180(0x209)]:if(await this['inputSmartOTPFromConfig'](_0x3adc06['deviceId']),await(0x0,_0x5112b3['sleep'])(0x3e8),!await this['verifyScreenState'](_0x3adc06[_0x3a5180(0x3cb)],{'expectedTexts':['OTP\x20s·∫Ω\x20t·ª±\x20ƒë·ªông\x20l√†m\x20m·ªõi'],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x192e9e[_0x3a5180(0x201)]['CONFIRM_AFTER_OTP'],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new _0x234cb8[(_0x3a5180(0x196))]('Confirm\x20after\x20OTP\x20screen\x20not\x20found',_0x234cb8['ErrorType']['FORCE_LOGIN_AND_REQUEUE']);this['logger']['log']('['+_0x3adc06['accountName']+']\x20-\x20Get\x20Confirm\x20after\x20OTP\x20screen');break;case _0x530de5[_0x3a5180(0x3ae)]['TRANSACTION_VERIFY_NO_INPUT_OTP']:break;default:throw new _0x234cb8[(_0x3a5180(0x196))]('Unknown\x20screen\x20state',_0x234cb8[_0x3a5180(0x325)]['FORCE_LOGIN_AND_REQUEUE']);}if(!await this['clickAndWaitForScreen'](_0x3adc06[_0x3a5180(0x3cb)],_0x530de5['HD_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['x'],_0x530de5['HD_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['y'],{'expectedTexts':['GIAO\x20D·ªäCH\x20TH√ÄNH\x20C√îNG'],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x192e9e['HD_ROI_EXPECTED']['TRANSACTION_SUCCESS'],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new _0x234cb8['WithdrawalProcessingError'](_0x3a5180(0x18d),_0x234cb8['ErrorType']['NO_BILL_AFTER_OTP']);this['logger']['log']('['+_0x3adc06['accountName']+_0x3a5180(0x44a)),await(0x0,_0x5112b3['sleep'])(0x3e8),await this['wsService'][_0x3a5180(0x3a2)](_0x3adc06['deviceId'],{'type':_0x18e33f['PandaSwipeTypeEnum'][_0x3a5180(0x27d)]}),await(0x0,_0x5112b3[_0x3a5180(0x37f)])(0x3e8),await this['captureScreen'](_0x3adc06['deviceId'],{'folderPath':_0x546f5e[_0x3a5180(0x2cd)]}),await(0x0,_0x5112b3['sleep'])(0x7d0);}async['extractTransactionAmount'](_0x5c4c51){const _0x6ba587=_0x48ef1d;try{const _0x25acdf=await this[_0x6ba587(0x3e4)]['recognizeFromFile'](_0x5c4c51,{'fieldType':'singleLine','customROI':{'x':0.05,'y':0.75,'width':0.9,'height':0.12},'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}});if(!_0x25acdf)return this[_0x6ba587(0x25d)]['warn'](_0x6ba587(0x23d)),null;const _0x110795=_0x25acdf['text'][_0x6ba587(0x3cf)](/[^\d.,]/g,'')['replace'](/,/g,''),_0x297956=parseFloat(_0x110795);return isNaN(_0x297956)?(this['logger']['warn']('Could\x20not\x20parse\x20amount\x20from\x20OCR\x20text:\x20'+_0x25acdf['text']),null):(this['logger']['log'](_0x6ba587(0x261)+_0x297956['toLocaleString']('vi-VN')+'\x20VND\x20(confidence:\x20'+_0x25acdf['confidence']['toFixed'](0x2)+'%,\x20time:\x20'+_0x25acdf[_0x6ba587(0x30b)]+'ms)'),_0x297956);}catch(_0x37be0d){return this['logger'][_0x6ba587(0x382)]('Error\x20extracting\x20transaction\x20amount:\x20'+_0x37be0d['message'],_0x37be0d['stack']),null;}}async[_0x48ef1d(0x33a)](){}['onModuleDestroy'](){}};_0xc3fbf2['HdBankService']=_0x2c96a2,_0xc3fbf2['HdBankService']=_0x2c96a2=_0x401760([(0x0,_0x532db7[_0x48ef1d(0x3ea)])(),_0x39df7d(0x0,(0x0,_0x532db7[_0x48ef1d(0x2de)])(_0x2ec3b6[_0x48ef1d(0x429)])),_0x4ac714('design:paramtypes',['function'==typeof(_0x51d2ba=void 0x0!==_0xdc52db['IWebSocketService']&&_0xdc52db['IWebSocketService'])?_0x51d2ba:Object,'function'==typeof(_0x31587d=void 0x0!==_0x118300['DeviceService']&&_0x118300['DeviceService'])?_0x31587d:Object,'function'==typeof(_0x2d29b0=void 0x0!==_0x2a5f2c['OCRService']&&_0x2a5f2c['OCRService'])?_0x2d29b0:Object,'function'==typeof(_0x126148=void 0x0!==_0x2ae8bc['ImagePreprocessingService']&&_0x2ae8bc['ImagePreprocessingService'])?_0x126148:Object])],_0x2c96a2);},(_0x19386a,_0x394d98,_0x400ef3)=>{const _0x52378a=a0_0x23a4;Object['defineProperty'](_0x394d98,'__esModule',{'value':!0x0}),_0x394d98[_0x52378a(0x2d5)]=_0x394d98['HD_SCREEN_HINT_NAME']=_0x394d98['HD_UI_COORDINATES']=void 0x0;const _0x241478=_0x400ef3(0x11),_0xf8db89={'LOGIN_BTN':{'x':0.5,'y':0.6},'PASSWORD_FIELD':{'x':0.5,'y':0.5},'TRANSFER_BTN':{'x':0.7,'y':0.7},'TRANSFER_INTERNAL_BTN':{'x':0.2,'y':0.2},'TRANSFER_EXTERNAL_BTN':{'x':0.4,'y':0.2},'CLOSE_ALLOW_CONTACT_POPUP_BTN':{'x':0.3,'y':0.6},'ACCOUNT_NUMBER_INPUT':{'x':0.4,'y':0.43},'SELECT_BANK_BTN':{'x':0.4,'y':0.47},'SEARCH_BANK_BTN':{'x':0.4,'y':0.48},'INTERNAL_AMOUNT_INPUT':{'x':0.5,'y':0.6},'HIDE_NUMPAD_BTN':{'x':0.05,'y':0.4},'CONTINUE_TRANSFER_BTN':{'x':0.5,'y':0.85},'BANK_SEARCH_BTN':{'x':0.4,'y':0.45},'BANK_SEARCH_INPUT':{'x':0.4,'y':0.45},'EXTERNAL_AMOUNT_INPUT':{'x':0.3,'y':0.37},'BACK_TO_HOME':{'x':0.2,'y':0.98},'QR_CODE_BTN':{'x':0.5,'y':0.95},'IMAGE_LIBRARY_BTN':{'x':0.5,'y':0.85},'FIRST_IMAGE_BTN':{'x':0.3,'y':0.3},'SELECT_IMAGE_QR_CODE_BTN':{'x':0.95,'y':0.95},'HOME_ICON':{'x':0.11,'y':0.94},'CLOSE_WARNING_TRANSACTION_POPUP':{'x':0.73,'y':0.62}},_0x44d770=(0x0,_0x400ef3(0x26)['scaleCoordinates'])(_0xf8db89);_0x394d98['HD_UI_COORDINATES']='PANDA'===_0x241478[_0x52378a(0x219)]['boxType']?_0x44d770:_0xf8db89,_0x394d98['HD_SCREEN_HINT_NAME']={'ENTER_OTP':'ENTER_OTP','TRANSACTION_VERIFY_NO_INPUT_OTP':'TRANSACTION_VERIFY_NO_INPUT_OTP'},_0x394d98['HD_SCREEN_OTP_HINT']=[{'name':_0x394d98['HD_SCREEN_HINT_NAME']['ENTER_OTP'],'hint':'Vui\x20long\x20nhap\x20ma\x20PIN\x20HDBank\x20OTP'},{'name':_0x394d98[_0x52378a(0x3ae)]['TRANSACTION_VERIFY_NO_INPUT_OTP'],'hint':'Mat\x20khau\x20giao\x20dich\x20OTP\x20se\x20tu\x20dong\x20lam\x20moi'}];},(_0x574799,_0x58653e)=>{var _0xd6d0b1;Object['defineProperty'](_0x58653e,'__esModule',{'value':!0x0}),_0x58653e['PandaSwipeTypeEnum']=void 0x0,function(_0x6ffd15){const _0x87baa2=a0_0x23a4;_0x6ffd15[_0x87baa2(0x3d5)]='4',_0x6ffd15['SCROLL_DOWN']='5',_0x6ffd15['SWIPE_UP']='6',_0x6ffd15['SWIPE_DOWN']='7',_0x6ffd15['SWIPE_LEFT']='8',_0x6ffd15['SWIPE_RIGHT']='9',_0x6ffd15['CLICK']='0';}(_0xd6d0b1||(_0x58653e['PandaSwipeTypeEnum']=_0xd6d0b1={}));},function(_0x11546e,_0x479c64,_0x5e7776){const _0x5618a0=a0_0x23a4;var _0x3105e9,_0x1d53bc,_0x1e062a,_0x3b699d,_0x58f8a4=this&&this[_0x5618a0(0x1f9)]||function(_0x538fe7,_0x1780dc,_0xb73fd6,_0x5a14ff){const _0x2a4d0a=_0x5618a0;var _0x1f85f2,_0x157a29=arguments['length'],_0x4c57f7=_0x157a29<0x3?_0x1780dc:null===_0x5a14ff?_0x5a14ff=Object['getOwnPropertyDescriptor'](_0x1780dc,_0xb73fd6):_0x5a14ff;if(_0x2a4d0a(0x34a)==typeof Reflect&&'function'==typeof Reflect[_0x2a4d0a(0x2e3)])_0x4c57f7=Reflect['decorate'](_0x538fe7,_0x1780dc,_0xb73fd6,_0x5a14ff);else{for(var _0x2cf77d=_0x538fe7['length']-0x1;_0x2cf77d>=0x0;_0x2cf77d--)(_0x1f85f2=_0x538fe7[_0x2cf77d])&&(_0x4c57f7=(_0x157a29<0x3?_0x1f85f2(_0x4c57f7):_0x157a29>0x3?_0x1f85f2(_0x1780dc,_0xb73fd6,_0x4c57f7):_0x1f85f2(_0x1780dc,_0xb73fd6))||_0x4c57f7);}return _0x157a29>0x3&&_0x4c57f7&&Object['defineProperty'](_0x1780dc,_0xb73fd6,_0x4c57f7),_0x4c57f7;},_0x2f93d9=this&&this['__metadata']||function(_0x5edc3f,_0x53dc92){const _0x280e9a=_0x5618a0;if(_0x280e9a(0x34a)==typeof Reflect&&_0x280e9a(0x24f)==typeof Reflect['metadata'])return Reflect[_0x280e9a(0x216)](_0x5edc3f,_0x53dc92);},_0x335c2d=this&&this['__param']||function(_0x2457c6,_0x510803){return function(_0x508baa,_0x212ab7){_0x510803(_0x508baa,_0x212ab7,_0x2457c6);};};Object[_0x5618a0(0x213)](_0x479c64,'__esModule',{'value':!0x0}),_0x479c64['VietcombankService']=void 0x0;const _0x2ca682=_0x5e7776(0xd),_0x2909df=_0x5e7776(0x13),_0x52cc36=_0x5e7776(0x18),_0x4b6179=_0x5e7776(0x2),_0x85d540=_0x5e7776(0xe),_0xf130a=_0x5e7776(0x17),_0x15527b=_0x5e7776(0x1b),_0x464c17=_0x5e7776(0x2a),_0x4aadd9=_0x5e7776(0x25),_0x40ba8d=_0x5e7776(0x33),_0x57a19f=_0x5e7776(0x1e);let _0x1088f8=class extends _0xf130a['BaseBankService']{constructor(_0x474753,_0x5c8b0d,_0x598826,_0x1cd012){const _0x37069a=_0x5618a0;super(_0x474753,_0x5c8b0d,_0x598826,_0x1cd012),this['wsService']=_0x474753,this['BANK_CODE']=_0x37069a(0x2a9),this['BUNDLE_ID']=_0x37069a(0x41b);}async['inputPasswordFromConfig'](_0x1db021){const _0x2502b9=_0x5618a0,_0x2892c3=await this['deviceService']['getDeviceConfig'](_0x1db021);if(!_0x2892c3||!_0x2892c3['password'])throw new Error(_0x2502b9(0x171)+_0x1db021);await this[_0x2502b9(0x37a)](_0x1db021,_0x40ba8d['VCB_UI_COORDINATES']['PASSWORD_FIELD']['x'],_0x40ba8d[_0x2502b9(0x2e6)]['PASSWORD_FIELD']['y'],0x5dc),await this[_0x2502b9(0x292)]['inputText'](_0x1db021,_0x2892c3['password']),await(0x0,_0x52cc36['sleep'])(0x3e8),await this['wsService']['pressReturnKey'](_0x1db021),await(0x0,_0x52cc36[_0x2502b9(0x37f)])(0x1f4);}async['inputSmartOTPFromConfig'](_0x5ba9bf,_0x87aab7=0x3){const _0x35846b=_0x5618a0,_0x3cf8c6=await this['deviceService'][_0x35846b(0x187)](_0x5ba9bf);if(!_0x3cf8c6||!_0x3cf8c6[_0x35846b(0x374)])throw new Error('SmartOTP\x20not\x20configured\x20for\x20device\x20'+_0x5ba9bf);await(0x0,_0x52cc36['sleep'])(0x1f4),await this['wsService']['inputText'](_0x5ba9bf,_0x3cf8c6[_0x35846b(0x374)]);}async['launchApp'](_0x1746ad){const _0x2ef59e=_0x5618a0;if(await this['wsService']['launchApp'](_0x1746ad,this['BUNDLE_ID']),!await this[_0x2ef59e(0x32d)](_0x1746ad,{'expectedTexts':['ƒêƒÉng\x20nh·∫≠p'],'timeout':0x2710,'pollInterval':0x1f4,'roi':_0x4aadd9[_0x2ef59e(0x16b)]['LAUNCH_APP'],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new _0x464c17['WithdrawalProcessingError']('Failed\x20to\x20launch\x20VIETCOMBANK\x20app',_0x464c17['ErrorType']['FORCE_LOGIN_AND_REQUEUE']);this['logger']['log']('['+_0x1746ad+']\x20-\x20Get\x20login\x20app\x20screen');}async['login'](_0x1830e9){const _0x2f130b=_0x5618a0;if(await this['killApp'](_0x1830e9),await(0x0,_0x52cc36[_0x2f130b(0x37f)])(0x7d0),await this[_0x2f130b(0x44b)](_0x1830e9),await this[_0x2f130b(0x32d)](_0x1830e9,{'expectedTexts':[_0x2f130b(0x3e9)],'timeout':0x4e20,'pollInterval':0x1f4,'roi':_0x4aadd9['VCB_ROI_EXPECTED']['LAUNCH_APP']}),await this['inputPasswordFromConfig'](_0x1830e9),!await this[_0x2f130b(0x344)](_0x1830e9,_0x40ba8d[_0x2f130b(0x2e6)][_0x2f130b(0x283)]['x'],_0x40ba8d[_0x2f130b(0x2e6)]['LOGIN_BTN']['y'],{'expectedTexts':['Ch·ª©c\x20nƒÉng\x20∆∞a\x20th√≠ch'],'timeout':0x4e20,'pollInterval':0x1f4,'roi':_0x4aadd9['VCB_ROI_EXPECTED']['HOME_SCREEN']}))throw new _0x464c17['WithdrawalProcessingError']('Failed\x20to\x20login\x20to\x20VIETCOMBANK',_0x464c17['ErrorType']['FORCE_LOGIN_AND_REQUEUE']);this[_0x2f130b(0x25d)][_0x2f130b(0x230)]('['+_0x1830e9+']\x20-\x20Login\x20successfully');}async['executeTransferWithQRCode'](_0x68b943,_0x4c0f5d){const _0x16d42f=_0x5618a0;if(this['logger']['log']('Executing\x20VIETCOMBANK\x20transfer\x20for\x20withdrawal\x20'+_0x68b943['withdrawalId']+_0x16d42f(0x1e1)+_0x4c0f5d['deviceId']),await this['clickWithTransition'](_0x4c0f5d['deviceId'],_0x40ba8d['VCB_UI_COORDINATES']['QR_CODE_BTN']['x'],_0x40ba8d['VCB_UI_COORDINATES']['QR_CODE_BTN']['y'],0xbb8),await(0x0,_0x52cc36['sleep'])(0x7d0),!await this['clickAndWaitForScreen'](_0x4c0f5d[_0x16d42f(0x3cb)],_0x40ba8d['VCB_UI_COORDINATES']['IMAGE_LIBRARY_BTN']['x'],_0x40ba8d[_0x16d42f(0x2e6)][_0x16d42f(0x2a2)]['y'],{'expectedTexts':['·∫¢nh','Album'],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x4aadd9['VCB_ROI_EXPECTED'][_0x16d42f(0x402)]}))throw new _0x464c17[(_0x16d42f(0x196))]('Failed\x20to\x20click\x20image\x20library\x20button',_0x464c17['ErrorType']['FORCE_LOGIN_AND_REQUEUE']);if(this['logger']['log']('['+_0x4c0f5d['accountName']+']\x20-\x20Get\x20image\x20library\x20screen'),!await this[_0x16d42f(0x344)](_0x4c0f5d['deviceId'],_0x40ba8d[_0x16d42f(0x2e6)][_0x16d42f(0x26d)]['x'],_0x40ba8d['VCB_UI_COORDINATES']['FIRST_IMAGE_BTN']['y'],{'expectedTexts':[_0x68b943['beneficiaryName']],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x4aadd9['VCB_ROI_EXPECTED']['VERIFY_ACCOUNT_NAME']}))throw await this['clickWithTransition'](_0x4c0f5d['deviceId'],_0x40ba8d['VCB_UI_COORDINATES'][_0x16d42f(0x266)]['x'],_0x40ba8d['VCB_UI_COORDINATES']['HOME_ICON']['y'],0x7d0),new _0x464c17['WithdrawalProcessingError']('Choose\x20wrong\x20image\x20qrcode',_0x464c17['ErrorType'][_0x16d42f(0x44e)]);if(this['logger'][_0x16d42f(0x230)]('['+_0x4c0f5d['accountName']+_0x16d42f(0x2c5)),!await this['clickAndWaitForScreen'](_0x4c0f5d['deviceId'],_0x40ba8d['VCB_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['x'],_0x40ba8d['VCB_UI_COORDINATES'][_0x16d42f(0x418)]['y'],{'expectedTexts':[_0x16d42f(0x287)],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x4aadd9['VCB_ROI_EXPECTED']['TRANSACTION_VERIFY']}))throw new _0x464c17['WithdrawalProcessingError'](_0x16d42f(0x3b2),_0x464c17['ErrorType']['FORCE_LOGIN_AND_REQUEUE']);if(this[_0x16d42f(0x25d)]['log']('['+_0x4c0f5d['accountName']+']\x20-\x20Get\x20Transaction\x20verification\x20screen'),!await this['clickAndWaitForScreen'](_0x4c0f5d[_0x16d42f(0x3cb)],_0x40ba8d['VCB_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['x'],_0x40ba8d['VCB_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['y'],{'expectedTexts':['smart\x20OTP'],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x4aadd9['VCB_ROI_EXPECTED'][_0x16d42f(0x2a5)]}))throw new _0x464c17['WithdrawalProcessingError'](_0x16d42f(0x18d),_0x464c17['ErrorType']['FORCE_LOGIN_AND_REQUEUE']);if(this['logger'][_0x16d42f(0x230)]('['+_0x4c0f5d[_0x16d42f(0x398)]+']\x20-\x20Get\x20Transaction\x20verify\x20screen'),await this[_0x16d42f(0x42c)](_0x4c0f5d['deviceId']),await(0x0,_0x52cc36['sleep'])(0x1f4),!await this['clickAndWaitForScreen'](_0x4c0f5d[_0x16d42f(0x3cb)],_0x40ba8d['VCB_UI_COORDINATES']['OTP_ENTER_TRANSFER_BTN']['x'],_0x40ba8d[_0x16d42f(0x2e6)]['OTP_ENTER_TRANSFER_BTN']['y'],{'expectedTexts':['M√£\x20x√°c\x20th·ª±c\x20giao\x20d·ªãch'],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x4aadd9['VCB_ROI_EXPECTED']['OTP_VERIFY']}))throw new _0x464c17['WithdrawalProcessingError'](_0x16d42f(0x18d),_0x464c17['ErrorType']['NO_BILL_AFTER_OTP']);if(this['logger'][_0x16d42f(0x230)]('['+_0x4c0f5d['accountName']+_0x16d42f(0x44a)),!await this['clickAndWaitForScreen'](_0x4c0f5d['deviceId'],_0x40ba8d[_0x16d42f(0x2e6)]['CONTINUE_OTP_VERIFY_BTN']['x'],_0x40ba8d['VCB_UI_COORDINATES'][_0x16d42f(0x1ad)]['y'],{'expectedTexts':['Giao\x20d·ªãch\x20th√†nh\x20c√¥ng'],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x4aadd9['VCB_ROI_EXPECTED'][_0x16d42f(0x409)],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new _0x464c17[(_0x16d42f(0x196))]('Transaction\x20success\x20screen\x20not\x20found',_0x464c17['ErrorType']['NO_BILL_AFTER_OTP']);this['logger']['log']('['+_0x4c0f5d['accountName']+']\x20-\x20Get\x20Transaction\x20success\x20screen'),await(0x0,_0x52cc36['sleep'])(0x1f4),await this[_0x16d42f(0x2bc)](_0x4c0f5d['deviceId'],{'folderPath':_0x68b943['withdrawalCode']}),await this[_0x16d42f(0x37a)](_0x4c0f5d[_0x16d42f(0x3cb)],_0x40ba8d[_0x16d42f(0x2e6)][_0x16d42f(0x266)]['x'],_0x40ba8d['VCB_UI_COORDINATES']['HOME_ICON']['y'],0x1388,'['+_0x4c0f5d['accountName']+_0x16d42f(0x1f7));}async['extractTransactionAmount'](_0x19bf89){const _0x325685=_0x5618a0;try{const _0x2b28ec=await this['ocrService'][_0x325685(0x3d1)](_0x19bf89,{'fieldType':'singleLine','customROI':{'x':0.05,'y':0.75,'width':0.9,'height':0.12},'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}});if(!_0x2b28ec)return this[_0x325685(0x25d)][_0x325685(0x3d4)]('Failed\x20to\x20extract\x20transaction\x20amount\x20from\x20ROI'),null;const _0x3fb1fa=_0x2b28ec[_0x325685(0x2e4)][_0x325685(0x3cf)](/[^\d.,]/g,'')['replace'](/,/g,''),_0x11777f=parseFloat(_0x3fb1fa);return isNaN(_0x11777f)?(this['logger']['warn']('Could\x20not\x20parse\x20amount\x20from\x20OCR\x20text:\x20'+_0x2b28ec[_0x325685(0x2e4)]),null):(this['logger'][_0x325685(0x230)]('Extracted\x20transaction\x20amount:\x20'+_0x11777f[_0x325685(0x445)]('vi-VN')+'\x20VND\x20(confidence:\x20'+_0x2b28ec['confidence']['toFixed'](0x2)+'%,\x20time:\x20'+_0x2b28ec[_0x325685(0x30b)]+'ms)'),_0x11777f);}catch(_0x182a86){return this['logger']['error']('Error\x20extracting\x20transaction\x20amount:\x20'+_0x182a86[_0x325685(0x1c8)],_0x182a86['stack']),null;}}async['onModuleInit'](){}['onModuleDestroy'](){}};_0x479c64['VietcombankService']=_0x1088f8,_0x479c64['VietcombankService']=_0x1088f8=_0x58f8a4([(0x0,_0x4b6179['Injectable'])(),_0x335c2d(0x0,(0x0,_0x4b6179['Inject'])(_0x2ca682[_0x5618a0(0x429)])),_0x2f93d9('design:paramtypes',[_0x5618a0(0x24f)==typeof(_0x3105e9=void 0x0!==_0x2909df['IWebSocketService']&&_0x2909df[_0x5618a0(0x26a)])?_0x3105e9:Object,'function'==typeof(_0x1d53bc=void 0x0!==_0x85d540[_0x5618a0(0x427)]&&_0x85d540['DeviceService'])?_0x1d53bc:Object,_0x5618a0(0x24f)==typeof(_0x1e062a=void 0x0!==_0x15527b['OCRService']&&_0x15527b[_0x5618a0(0x1b9)])?_0x1e062a:Object,_0x5618a0(0x24f)==typeof(_0x3b699d=void 0x0!==_0x57a19f['ImagePreprocessingService']&&_0x57a19f['ImagePreprocessingService'])?_0x3b699d:Object])],_0x1088f8);},(_0x326ec5,_0x1f728f,_0x3dbde5)=>{const _0x4963b2=a0_0x23a4;Object[_0x4963b2(0x213)](_0x1f728f,'__esModule',{'value':!0x0}),_0x1f728f['VCB_UI_COORDINATES']=void 0x0;const _0xed0c1a=_0x3dbde5(0x11),_0x4046c9={'LOGIN_BTN':{'x':0.5,'y':0.55},'PASSWORD_FIELD':{'x':0.5,'y':0.45},'TRANSFER_BTN':{'x':0.7,'y':0.7},'TRANSFER_INTERNAL_BTN':{'x':0.2,'y':0.2},'TRANSFER_EXTERNAL_BTN':{'x':0.4,'y':0.2},'CLOSE_ALLOW_CONTACT_POPUP_BTN':{'x':0.3,'y':0.6},'ACCOUNT_NUMBER_INPUT':{'x':0.4,'y':0.43},'SELECT_BANK_BTN':{'x':0.4,'y':0.47},'SEARCH_BANK_BTN':{'x':0.4,'y':0.48},'INTERNAL_AMOUNT_INPUT':{'x':0.5,'y':0.6},'HIDE_NUMPAD_BTN':{'x':0.05,'y':0.4},'CONTINUE_TRANSFER_BTN':{'x':0.6,'y':0.92},'CONTINUE_OTP_VERIFY_BTN':{'x':0.5,'y':0.68},'OTP_ENTER_TRANSFER_BTN':{'x':0.5,'y':0.62},'BANK_SEARCH_BTN':{'x':0.4,'y':0.45},'BANK_SEARCH_INPUT':{'x':0.4,'y':0.45},'EXTERNAL_AMOUNT_INPUT':{'x':0.3,'y':0.37},'BACK_TO_HOME':{'x':0.2,'y':0.9},'QR_CODE_BTN':{'x':0.4,'y':0.92},'IMAGE_LIBRARY_BTN':{'x':0.4,'y':0.92},'FIRST_IMAGE_BTN':{'x':0.3,'y':0.3},'SELECT_IMAGE_QR_CODE_BTN':{'x':0.95,'y':0.95},'HOME_ICON':{'x':0.93,'y':0.07}},_0x3cb2a5=(0x0,_0x3dbde5(0x26)[_0x4963b2(0x379)])(_0x4046c9);_0x1f728f['VCB_UI_COORDINATES']='PANDA'===_0xed0c1a['config']['boxType']?_0x3cb2a5:_0x4046c9;},function(_0x423740,_0x1188a2,_0xb95b2b){const _0x535415=a0_0x23a4;var _0x7cb878,_0x57ea99=this&&this['__decorate']||function(_0x36a0f6,_0x1eda09,_0x485162,_0x3c87bb){const _0xee8436=a0_0x23a4;var _0xbd3c72,_0x302ba5=arguments['length'],_0x5c97fb=_0x302ba5<0x3?_0x1eda09:null===_0x3c87bb?_0x3c87bb=Object['getOwnPropertyDescriptor'](_0x1eda09,_0x485162):_0x3c87bb;if(_0xee8436(0x34a)==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x5c97fb=Reflect['decorate'](_0x36a0f6,_0x1eda09,_0x485162,_0x3c87bb);else{for(var _0x704a5a=_0x36a0f6[_0xee8436(0x1fa)]-0x1;_0x704a5a>=0x0;_0x704a5a--)(_0xbd3c72=_0x36a0f6[_0x704a5a])&&(_0x5c97fb=(_0x302ba5<0x3?_0xbd3c72(_0x5c97fb):_0x302ba5>0x3?_0xbd3c72(_0x1eda09,_0x485162,_0x5c97fb):_0xbd3c72(_0x1eda09,_0x485162))||_0x5c97fb);}return _0x302ba5>0x3&&_0x5c97fb&&Object[_0xee8436(0x213)](_0x1eda09,_0x485162,_0x5c97fb),_0x5c97fb;},_0x3903d6=this&&this['__metadata']||function(_0x2ea8d0,_0x4295a2){const _0x44f952=a0_0x23a4;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x44f952(0x216)])return Reflect[_0x44f952(0x216)](_0x2ea8d0,_0x4295a2);};Object['defineProperty'](_0x1188a2,_0x535415(0x3f1),{'value':!0x0}),_0x1188a2['SessionManagementService']=void 0x0;const _0x86feb=_0xb95b2b(0x2),_0x4c4258=_0xb95b2b(0xf);let _0x37a2c6=class{constructor(_0x148e87){const _0x4bef2a=_0x535415;this['redisService']=_0x148e87,this['logger']=new _0x86feb['Logger']('SessionManagementService'),this['REDIS_SESSION_PREFIX']='bank:session:',this['BANK_SESSION_CONFIGS']=new Map([['ACB',{'bankCode':_0x4bef2a(0x27b),'sessionTimeoutMs':0xdbba0,'refreshBeforeMs':0xea60}],['PGBANK',{'bankCode':_0x4bef2a(0x282),'sessionTimeoutMs':0x41eb0,'refreshBeforeMs':0x7530}],[_0x4bef2a(0x3b0),{'bankCode':'HDBANK','sessionTimeoutMs':0x41eb0,'refreshBeforeMs':0x7530}]]);}[_0x535415(0x2a1)](_0x3b100b){const _0x21217c=_0x535415,_0x416acc=this['BANK_SESSION_CONFIGS'][_0x21217c(0x27f)](_0x3b100b['toUpperCase']());return _0x416acc?.[_0x21217c(0x22e)]||0x41eb0;}['getRefreshBeforeTime'](_0x3874cd){const _0x2ef034=_0x535415,_0x3f82b5=this[_0x2ef034(0x1f3)][_0x2ef034(0x27f)](_0x3874cd['toUpperCase']());return _0x3f82b5?.['refreshBeforeMs']||0x7530;}async[_0x535415(0x2c9)](_0x506e37,_0x1328e7){const _0x3f35b4=_0x535415,_0x2bf322=this['getSessionTimeout'](_0x1328e7),_0x1d3cf6=Date['now']()+_0x2bf322,_0x4b2181={'deviceId':_0x506e37,'bankCode':_0x1328e7[_0x3f35b4(0x3e0)](),'loginTime':Date[_0x3f35b4(0x442)](),'expiresAt':_0x1d3cf6,'status':'logged_in'},_0x4bc6da=''+this[_0x3f35b4(0x36a)]+_0x506e37+':'+_0x1328e7['toUpperCase']();await this['redisService'][_0x3f35b4(0x306)](_0x4bc6da,JSON[_0x3f35b4(0x228)](_0x4b2181),_0x2bf322),this['logger']['log']('['+_0x506e37+']\x20Recorded\x20login\x20session\x20(bank:\x20'+_0x1328e7+',\x20expires\x20at:\x20'+new Date(_0x1d3cf6)['toISOString']()+')');}async['markLoggingIn'](_0x34ea5d,_0x4f3d29){const _0x215c30=_0x535415,_0x333a8b=''+this['REDIS_SESSION_PREFIX']+_0x34ea5d+':'+_0x4f3d29['toUpperCase'](),_0x655978=await this['getSession'](_0x34ea5d,_0x4f3d29),_0x1fd5b7={'deviceId':_0x34ea5d,'bankCode':_0x4f3d29['toUpperCase'](),'loginTime':_0x655978?.['loginTime']||Date['now'](),'expiresAt':_0x655978?.['expiresAt']||Date[_0x215c30(0x442)]()+this['getSessionTimeout'](_0x4f3d29),'status':_0x215c30(0x322)};await this['redisService']['set'](_0x333a8b,JSON['stringify'](_0x1fd5b7),0x493e0),this['logger']['log']('Marked\x20device\x20'+_0x34ea5d+_0x215c30(0x24d)+_0x4f3d29+'\x20as\x20logging\x20in');}async['getSession'](_0x2e2060,_0xe64d36){const _0x395294=_0x535415;try{const _0x348a2d=''+this[_0x395294(0x36a)]+_0x2e2060+':'+_0xe64d36['toUpperCase'](),_0x3e8153=await this['redisService']['get'](_0x348a2d);return _0x3e8153?JSON['parse'](_0x3e8153):null;}catch(_0x370cde){return this[_0x395294(0x25d)][_0x395294(0x382)]('Error\x20getting\x20session\x20for\x20device\x20'+_0x2e2060+',\x20bank\x20'+_0xe64d36+':\x20'+_0x370cde['message']),null;}}async['isSessionValid'](_0x3f616c,_0x23a2b9){const _0x42aa07=await this['getSession'](_0x3f616c,_0x23a2b9);return!(!_0x42aa07||_0x42aa07['expiresAt']<Date['now']()||'logging_in'===_0x42aa07['status']||'logged_in'!==_0x42aa07['status']);}async[_0x535415(0x308)](_0x12af68,_0x3850fb){const _0x1f359b=_0x535415,_0x21c0c4=await this['getSession'](_0x12af68,_0x3850fb);if(!_0x21c0c4||'logged_in'!==_0x21c0c4[_0x1f359b(0x455)])return!0x1;const _0x3d3de8=this[_0x1f359b(0x224)](_0x3850fb);return _0x21c0c4['expiresAt']-Date['now']()<=_0x3d3de8;}async['clearSession'](_0x46314e,_0xfe2377){const _0x4305a5=_0x535415,_0x5c0ed5=''+this[_0x4305a5(0x36a)]+_0x46314e+':'+_0xfe2377['toUpperCase']();await this['redisService'][_0x4305a5(0x1f8)](_0x5c0ed5),this['logger']['log']('Cleared\x20session\x20for\x20device\x20'+_0x46314e+',\x20bank\x20'+_0xfe2377);}};_0x1188a2['SessionManagementService']=_0x37a2c6,_0x1188a2['SessionManagementService']=_0x37a2c6=_0x57ea99([(0x0,_0x86feb[_0x535415(0x3ea)])(),_0x3903d6('design:paramtypes',['function'==typeof(_0x7cb878=void 0x0!==_0x4c4258['RedisService']&&_0x4c4258['RedisService'])?_0x7cb878:Object])],_0x37a2c6);},function(_0xd8b67c,_0x19f63f,_0x58b010){const _0x44bfac=a0_0x23a4;var _0x157f7c,_0x53293a=this&&this[_0x44bfac(0x1f9)]||function(_0x4da8e8,_0x390907,_0x1873cb,_0x425ec3){const _0x23fa28=_0x44bfac;var _0x3da57d,_0xc2f71f=arguments[_0x23fa28(0x1fa)],_0x2493d8=_0xc2f71f<0x3?_0x390907:null===_0x425ec3?_0x425ec3=Object[_0x23fa28(0x26e)](_0x390907,_0x1873cb):_0x425ec3;if('object'==typeof Reflect&&_0x23fa28(0x24f)==typeof Reflect['decorate'])_0x2493d8=Reflect['decorate'](_0x4da8e8,_0x390907,_0x1873cb,_0x425ec3);else{for(var _0x37fa59=_0x4da8e8['length']-0x1;_0x37fa59>=0x0;_0x37fa59--)(_0x3da57d=_0x4da8e8[_0x37fa59])&&(_0x2493d8=(_0xc2f71f<0x3?_0x3da57d(_0x2493d8):_0xc2f71f>0x3?_0x3da57d(_0x390907,_0x1873cb,_0x2493d8):_0x3da57d(_0x390907,_0x1873cb))||_0x2493d8);}return _0xc2f71f>0x3&&_0x2493d8&&Object['defineProperty'](_0x390907,_0x1873cb,_0x2493d8),_0x2493d8;},_0x90721d=this&&this['__metadata']||function(_0x120f06,_0x5b0c7c){const _0x2bae11=_0x44bfac;if('object'==typeof Reflect&&_0x2bae11(0x24f)==typeof Reflect['metadata'])return Reflect['metadata'](_0x120f06,_0x5b0c7c);};Object['defineProperty'](_0x19f63f,'__esModule',{'value':!0x0}),_0x19f63f['NotificationService']=void 0x0;const _0x4bb602=_0x58b010(0x2),_0x33af5d=_0x58b010(0x36);let _0x4c844c=class{constructor(_0x3f34e9){this['ezpayBeClient']=_0x3f34e9,this['logger']=new _0x4bb602['Logger']('NotificationService');}async['completeWithdrawal'](_0x24c393,_0x3e7ec4,_0x211172){const _0x558fa2=_0x44bfac;this['ezpayBeClient']['completeWithdrawal'](_0x24c393[_0x558fa2(0x3be)],{'analyzedStatus':_0x3e7ec4['analyzedStatus'],'sourceAccountNo':_0x211172['accountNo'],'sourceBankCode':_0x211172[_0x558fa2(0x385)],'sourceAccountName':_0x211172[_0x558fa2(0x398)]})['catch'](_0xcedfdf=>{const _0x1a4d3e=_0x558fa2;this['logger']['error']('['+_0x24c393['withdrawalCode']+_0x1a4d3e(0x3a8)+_0x24c393['_id']+'\x20-\x20'+_0xcedfdf['stack']);}),this['ezpayBeClient'][_0x558fa2(0x1a9)](_0x24c393['_id'],_0x3e7ec4[_0x558fa2(0x208)])['catch'](_0x18dd63=>{const _0x33f65d=_0x558fa2;this['logger']['error']('['+_0x24c393[_0x33f65d(0x2cd)]+']\x20-\x20Error\x20uploading\x20receipt\x20for\x20'+_0x24c393['_id']+'\x20-\x20'+_0x18dd63[_0x33f65d(0x384)]);});}[_0x44bfac(0x27e)](_0x52dac4,_0x54d514){const _0x3b6489=_0x44bfac;return this['ezpayBeClient'][_0x3b6489(0x27e)](_0x52dac4,_0x54d514);}[_0x44bfac(0x1a9)](_0x26adda,_0x4ee34b){const _0x139d25=_0x44bfac;return this['ezpayBeClient'][_0x139d25(0x1a9)](_0x26adda,_0x4ee34b);}};_0x19f63f[_0x44bfac(0x2ac)]=_0x4c844c,_0x19f63f['NotificationService']=_0x4c844c=_0x53293a([(0x0,_0x4bb602[_0x44bfac(0x3ea)])(),_0x90721d('design:paramtypes',['function'==typeof(_0x157f7c=void 0x0!==_0x33af5d[_0x44bfac(0x426)]&&_0x33af5d['EzpayBeClientService'])?_0x157f7c:Object])],_0x4c844c);},function(_0x365baa,_0x92f7f6,_0x454456){const _0x1c1322=a0_0x23a4;var _0x2bdced,_0x2c8f68=this&&this['__decorate']||function(_0x565dfe,_0x4a89c6,_0x2b61bc,_0x251781){const _0x8b8649=a0_0x23a4;var _0x4d20c4,_0x3284c7=arguments['length'],_0x25e051=_0x3284c7<0x3?_0x4a89c6:null===_0x251781?_0x251781=Object['getOwnPropertyDescriptor'](_0x4a89c6,_0x2b61bc):_0x251781;if(_0x8b8649(0x34a)==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x25e051=Reflect['decorate'](_0x565dfe,_0x4a89c6,_0x2b61bc,_0x251781);else{for(var _0x169147=_0x565dfe[_0x8b8649(0x1fa)]-0x1;_0x169147>=0x0;_0x169147--)(_0x4d20c4=_0x565dfe[_0x169147])&&(_0x25e051=(_0x3284c7<0x3?_0x4d20c4(_0x25e051):_0x3284c7>0x3?_0x4d20c4(_0x4a89c6,_0x2b61bc,_0x25e051):_0x4d20c4(_0x4a89c6,_0x2b61bc))||_0x25e051);}return _0x3284c7>0x3&&_0x25e051&&Object['defineProperty'](_0x4a89c6,_0x2b61bc,_0x25e051),_0x25e051;},_0x450f15=this&&this['__metadata']||function(_0x13af4c,_0x2a2428){const _0x448a11=a0_0x23a4;if('object'==typeof Reflect&&_0x448a11(0x24f)==typeof Reflect['metadata'])return Reflect[_0x448a11(0x216)](_0x13af4c,_0x2a2428);};Object[_0x1c1322(0x213)](_0x92f7f6,'__esModule',{'value':!0x0}),_0x92f7f6['EzpayBeClientService']=void 0x0;const _0x5f5a97=_0x454456(0x2),_0x16f916=_0x454456(0x8),_0x13b6a4=_0x454456(0x37),_0x4a9714=_0x454456(0x2e),_0x1dac61=_0x454456(0x19),_0x27b46b=_0x454456(0x11),_0x3b9069=_0x454456(0x18);let _0x195ac9=class{constructor(_0x444686){const _0x1f9991=_0x1c1322;this[_0x1f9991(0x2ff)]=_0x444686,this['logger']=new _0x5f5a97['Logger']('EzpayBeClientService'),this['apiUrl']=_0x27b46b['config']['ezpayBe']['apiUrl']??'http://localhost:3001',this[_0x1f9991(0x23a)]=_0x27b46b['config'][_0x1f9991(0x179)]['apiKey']??'';}async['completeWithdrawal'](_0x2848a0,_0x38844f){const _0x35e8f0=_0x1c1322;for(let _0x2f0a88=0x0;_0x2f0a88<=0x3;_0x2f0a88++)try{const _0x3a0245=this['apiUrl']+'/api/internal/withdrawals/complete/'+_0x2848a0;this[_0x35e8f0(0x25d)]['log']('Updating\x20withdrawal\x20'+_0x2848a0+'\x20status\x20to\x20'+_0x38844f[_0x35e8f0(0x277)]+'\x20(attempt\x20'+(_0x2f0a88+0x1)+'/4)');const _0xab9ebf={'analyzedStatus':_0x38844f['analyzedStatus'],'sourceBankCode':_0x38844f['sourceBankCode'],'sourceAccountNo':_0x38844f[_0x35e8f0(0x315)],'sourceAccountName':_0x38844f['sourceAccountName']},_0x7fdf1=await(0x0,_0x13b6a4[_0x35e8f0(0x341)])(this['httpService']['patch'](_0x3a0245,_0xab9ebf,{'headers':{'Content-Type':'application/json','X-API-Key':this['apiKey'],'x-internal-secret-key':'uHqE5X9H0QEBsqlZpdTHG0fOyvmMtHjCGgsG4ouls3Gz9WvaWg4w9HV3sqETGWfE'},'timeout':0x4e20}));if(0xc8===_0x7fdf1['status']||0xcc===_0x7fdf1[_0x35e8f0(0x455)])return void this['logger'][_0x35e8f0(0x230)](_0x35e8f0(0x34e)+_0x2848a0+'\x20status\x20to\x20'+_0x38844f['analyzedStatus']);this['logger']['warn']('Unexpected\x20status\x20code\x20'+_0x7fdf1['status']+_0x35e8f0(0x1e8)+_0x2848a0);}catch(_0x57280f){const _0x2eed7d=_0x57280f,_0x3573ec=_0x2eed7d['response']?.['data'],_0x42c4e3=_0x2eed7d[_0x35e8f0(0x1c8)];if(_0x2f0a88<0x3){const _0x3b7506=0x7d0*Math['pow'](0x2,_0x2f0a88);this[_0x35e8f0(0x25d)][_0x35e8f0(0x3d4)](_0x35e8f0(0x433)+_0x2848a0+'\x20(attempt\x20'+(_0x2f0a88+0x1)+'/4):\x20'+_0x42c4e3+'.\x20Payload:\x20'+JSON['stringify'](_0x3573ec)+',\x20Retrying\x20in\x20'+_0x3b7506+'ms'),await(0x0,_0x3b9069['sleep'])(_0x3b7506);}else this['logger']['error'](_0x35e8f0(0x433)+_0x2848a0+'\x20after\x204\x20attempts.\x20Payload:\x20'+JSON['stringify'](_0x3573ec)+',\x20Error:\x20'+_0x42c4e3);}}async['uploadReceipt'](_0x3adb73,_0xb04f36){const _0x53eae8=_0x1c1322;for(let _0x490f86=0x0;_0x490f86<=0x3;_0x490f86++)try{const _0x141af3=this[_0x53eae8(0x2e0)]+'/api/internal/withdrawals/upload-receipt/'+_0x3adb73;if(this['logger'][_0x53eae8(0x230)]('Uploading\x20bill\x20for\x20withdrawal\x20'+_0x3adb73+_0x53eae8(0x3ca)+(_0x490f86+0x1)+'/4)'),!_0xb04f36)return void this['logger']['warn']('No\x20receipt\x20path\x20provided\x20for\x20withdrawal\x20'+_0x3adb73);const _0xc2c412=new _0x4a9714();_0xc2c412['append']('receipt',(0x0,_0x1dac61['createReadStream'])(_0xb04f36));const _0x5e66ca=await(0x0,_0x13b6a4['firstValueFrom'])(this['httpService'][_0x53eae8(0x3d3)](_0x141af3,_0xc2c412,{'headers':{..._0xc2c412[_0x53eae8(0x1fd)](),'X-API-Key':this['apiKey'],'x-internal-secret-key':'uHqE5X9H0QEBsqlZpdTHG0fOyvmMtHjCGgsG4ouls3Gz9WvaWg4w9HV3sqETGWfE'},'timeout':0x4e20}));if(0xc8===_0x5e66ca['status']||0xcc===_0x5e66ca['status'])return void this['logger'][_0x53eae8(0x230)]('Successfully\x20uploaded\x20bill\x20for\x20withdrawal\x20'+_0x3adb73);this['logger'][_0x53eae8(0x3d4)](_0x53eae8(0x2e2)+_0x5e66ca[_0x53eae8(0x455)]+_0x53eae8(0x22f)+_0x3adb73);}catch(_0x426db0){const _0x22981c=_0x426db0,_0x2588b6=_0x22981c['response']?.['data'],_0x3953ea=_0x22981c[_0x53eae8(0x1c8)];if(_0x490f86<0x3){const _0x44cc1b=0x7d0*Math['pow'](0x2,_0x490f86);this['logger'][_0x53eae8(0x3d4)](_0x53eae8(0x2d2)+_0x3adb73+'\x20(attempt\x20'+(_0x490f86+0x1)+'/4):\x20'+_0x3953ea+'.\x20Response:\x20'+JSON['stringify'](_0x2588b6)+',\x20Retrying\x20in\x20'+_0x44cc1b+'ms'),await(0x0,_0x3b9069[_0x53eae8(0x37f)])(_0x44cc1b);}else this['logger'][_0x53eae8(0x382)](_0x53eae8(0x2d2)+_0x3adb73+_0x53eae8(0x15e)+JSON['stringify'](_0x2588b6)+',\x20Error:\x20'+_0x3953ea);}}async['updateWithdrawalStatus'](_0x32e634,_0x27fed3){const _0x368ec1=_0x1c1322;this['logger']['log']('Updating\x20withdrawal\x20'+_0x32e634+_0x368ec1(0x3c5)+_0x27fed3);const _0xeeb8f7=this['apiUrl']+'/api/internal/withdrawals/status/'+_0x32e634;await(0x0,_0x13b6a4['firstValueFrom'])(this[_0x368ec1(0x2ff)]['patch'](_0xeeb8f7,{'status':_0x27fed3},{'headers':{'x-internal-secret-key':'uHqE5X9H0QEBsqlZpdTHG0fOyvmMtHjCGgsG4ouls3Gz9WvaWg4w9HV3sqETGWfE'}}));}};_0x92f7f6['EzpayBeClientService']=_0x195ac9,_0x92f7f6[_0x1c1322(0x426)]=_0x195ac9=_0x2c8f68([(0x0,_0x5f5a97['Injectable'])(),_0x450f15('design:paramtypes',['function'==typeof(_0x2bdced=void 0x0!==_0x16f916[_0x1c1322(0x195)]&&_0x16f916['HttpService'])?_0x2bdced:Object])],_0x195ac9);},_0x58f8fe=>{_0x58f8fe['exports']=require('rxjs');},function(_0x1b3298,_0x33eee8,_0x2882e8){const _0x3ea4ab=a0_0x23a4;var _0x23f4c9,_0x4f48ac,_0x55234c,_0x4b8691,_0x351ca7,_0x51756e,_0x5636cf,_0x598ce6,_0x55ac77,_0x2c5d23,_0xcc1b5f,_0x48a0b6=this&&this[_0x3ea4ab(0x1f9)]||function(_0x326754,_0x320787,_0x58e9a9,_0x45e466){const _0x142ded=_0x3ea4ab;var _0xfdaea1,_0x4dc438=arguments['length'],_0x547850=_0x4dc438<0x3?_0x320787:null===_0x45e466?_0x45e466=Object[_0x142ded(0x26e)](_0x320787,_0x58e9a9):_0x45e466;if(_0x142ded(0x34a)==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x547850=Reflect['decorate'](_0x326754,_0x320787,_0x58e9a9,_0x45e466);else{for(var _0x4b5a9c=_0x326754['length']-0x1;_0x4b5a9c>=0x0;_0x4b5a9c--)(_0xfdaea1=_0x326754[_0x4b5a9c])&&(_0x547850=(_0x4dc438<0x3?_0xfdaea1(_0x547850):_0x4dc438>0x3?_0xfdaea1(_0x320787,_0x58e9a9,_0x547850):_0xfdaea1(_0x320787,_0x58e9a9))||_0x547850);}return _0x4dc438>0x3&&_0x547850&&Object['defineProperty'](_0x320787,_0x58e9a9,_0x547850),_0x547850;},_0x524bc4=this&&this['__metadata']||function(_0x5154f7,_0x11029e){if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0x5154f7,_0x11029e);},_0x2afc44=this&&this[_0x3ea4ab(0x165)]||function(_0x4f21ee,_0x4de97d){return function(_0x20105f,_0xe74629){_0x4de97d(_0x20105f,_0xe74629,_0x4f21ee);};};Object['defineProperty'](_0x33eee8,'__esModule',{'value':!0x0}),_0x33eee8['WithdrawalJobManagerService']=void 0x0;const _0x367087=_0x2882e8(0x2),_0x2067f7=_0x2882e8(0x7),_0x4c7b86=_0x2882e8(0x6),_0x4d2669=_0x2882e8(0x39),_0xdb0b28=_0x2882e8(0xa),_0x4858af=_0x2882e8(0xe),_0x3a1e17=_0x2882e8(0x14),_0x117fff=_0x2882e8(0xd),_0x3751fb=_0x2882e8(0x13),_0x6cafa5=_0x2882e8(0x3a),_0x1f3694=_0x2882e8(0x2a),_0x14c5b3=_0x2882e8(0x16),_0x2deeaf=_0x2882e8(0x3c),_0x421520=_0x2882e8(0xb),_0x1b8daf=_0x2882e8(0x35),_0x51fe5a=_0x2882e8(0x3d),_0xf43df6=_0x2882e8(0x3e),_0x1a7c3a=_0x2882e8(0x41),_0x29b582=_0x2882e8(0x42),_0x355973=_0x2882e8(0x2c),_0x26c756=_0x2882e8(0x18),_0x33ac55=_0x2882e8(0x43),_0x39435a=_0x2882e8(0xf),_0x3eb389=_0x2882e8(0x45),_0x12ce17=_0x2882e8(0x11);let _0x5ab089=class{constructor(_0x51870d,_0x58499c,_0x25c70b,_0xd7131f,_0x5384da,_0x77994e,_0x44e375,_0x3abe28,_0x22a50b,_0x252934,_0x1183e3){const _0xcb7b9d=_0x3ea4ab;this[_0xcb7b9d(0x210)]=_0x51870d,this['withdrawalService']=_0x58499c,this['deviceService']=_0x25c70b,this[_0xcb7b9d(0x407)]=_0xd7131f,this[_0xcb7b9d(0x292)]=_0x5384da,this['bankService']=_0x77994e,this['notificationService']=_0x44e375,this[_0xcb7b9d(0x1a3)]=_0x3abe28,this[_0xcb7b9d(0x34f)]=_0x22a50b,this['telegramService']=_0x252934,this[_0xcb7b9d(0x1f1)]=_0x1183e3,this['logger']=new _0x367087[(_0xcb7b9d(0x34b))](_0xcb7b9d(0x362)),this[_0xcb7b9d(0x2fd)]=new Set(),this['isInitialized']=!0x1,this[_0xcb7b9d(0x207)]=!0x1,this['cronRestartBoxphoneEnabled']=!0x1;}async[_0x3ea4ab(0x33a)](){const _0xb56e35=_0x3ea4ab;this[_0xb56e35(0x25d)]['log'](_0xb56e35(0x170)),this['initializeJobProcessing'](),this['scheduleCronRestartBoxphone']();}async['initializeJobProcessing'](){setTimeout(async()=>{const _0x592ae1=a0_0x23a4;this['isInitialized']||(this['logger'][_0x592ae1(0x230)]('Starting\x20withdrawal\x20job\x20processing...'),await this['pickAndProcessJobs'](),this[_0x592ae1(0x2f7)]=!0x0);},0x1388);}['scheduleCronRestartBoxphone'](){const _0x2a37fc=new Date(),_0x3a9c9b=0x3e8*(0x3c-_0x2a37fc['getSeconds']())-_0x2a37fc['getMilliseconds']();setTimeout(()=>{this['cronRestartBoxphoneEnabled']=!0x0;},_0x3a9c9b);}async[_0x3ea4ab(0x17e)](){const _0x26e02=_0x3ea4ab;if(!await this['deviceLockService'][_0x26e02(0x2d7)]()){const _0x2b71fc='development'===_0x12ce17['config'][_0x26e02(0x410)]?_0x26e02(0x1ef):'üöÄüöÄüöÄ\x20<b>Boxphone\x20software...</b>';this[_0x26e02(0x21e)]['sendMessage']({'text':_0x2b71fc+(_0x26e02(0x421)+new Date()['toLocaleString'](_0x26e02(0x3f6),{'timeZone':'Asia/Ho_Chi_Minh'})+'\x0a<b>D·ª±\x20ki·∫øn:</b>\x203\x20ph√∫t.'),'options':{'parseMode':'HTML'}}),await this[_0x26e02(0x1a3)][_0x26e02(0x1a5)]({'processName':_0x26e02(0x2d6),'exePath':_0x26e02(0x413),'runAsAdmin':!0x0,'killAsAdmin':!0x0}),this[_0x26e02(0x21e)]['sendMessage']({'text':'‚úÖ\x20<b>Boxphone\x20software</b>\x0a\x0a<b>Kh·ªüi\x20ƒë·ªông\x20l·∫°i\x20th√†nh\x20c√¥ng:</b>\x20'+new Date()[_0x26e02(0x445)]('vi-VN',{'timeZone':_0x26e02(0x2f3)})+'\x0aLogin\x20t·∫•t\x20c·∫£\x20thi·∫øt\x20b·ªã\x20sau\x201\x20ph√∫t:','options':{'parseMode':_0x26e02(0x189)}});try{await(0x0,_0x26c756[_0x26e02(0x37f)])(0x1388),await this['bankService']['loginAllActiveBanks']();}catch(_0xf535ac){this['logger']['error']('Error\x20logging\x20in\x20all\x20active\x20banks:\x20'+_0xf535ac[_0x26e02(0x384)]);}finally{await(0x0,_0x26c756[_0x26e02(0x37f)])(0x3e8),await this[_0x26e02(0x34f)]['releaseLock'](_0x29b582[_0x26e02(0x3ab)]);}}}async['pickAndProcessJobs'](_0x5e88c6){const _0x593582=_0x3ea4ab;try{if(await this['redisLockService'][_0x593582(0x199)](_0x29b582['SYSTEM_LOCK_BOXPHONE'])){if(this['isRestartingBoxphone'])return;return this['isRestartingBoxphone']=!0x0,await this['restartBoxphone'](),void(this['isRestartingBoxphone']=!0x1);}if(!this['wsService']['isConnectedStatus']())return void this[_0x593582(0x25d)]['error'](_0x593582(0x28a));const _0x3317b9=await this[_0x593582(0x17f)][_0x593582(0x240)]();if(_0x593582(0x1db)!==_0x3317b9)return void this['logger']['debug']('Service\x20is\x20'+_0x3317b9+',\x20cannot\x20pick\x20jobs');const _0x363dc8=await this['deviceService']['getAvailableDevices'](),_0x3f37f7=_0x363dc8['length'];if(_0x3f37f7<=0x0)return;const _0x2e14e1=_0x5e88c6?Math[_0x593582(0x295)](_0x5e88c6,_0x3f37f7):_0x3f37f7,_0x2e1f04=await this['redisService'][_0x593582(0x44c)](_0x3eb389['JOB_PRIORITY_KEY'],_0x2e14e1);if(0x0===_0x2e1f04['length'])return;this[_0x593582(0x25d)][_0x593582(0x230)](_0x593582(0x225)+_0x363dc8['length']+_0x593582(0x214)+_0x2e1f04[_0x593582(0x1fa)]+'\x20jobs\x20('+(_0x2e1f04||[])['length']+'\x20waiting).');for(let _0x16b616=0x0;_0x16b616<_0x2e1f04['length'];_0x16b616++){const _0x249cd2=_0x2e1f04[_0x16b616][_0x593582(0x34d)],_0x1cee91=await this['withdrawalQueue']['getJob'](_0x249cd2),_0x3fbc40=_0x363dc8[_0x16b616];if(this[_0x593582(0x2fd)][_0x593582(0x3b8)](_0x1cee91['id']))continue;const _0x1712a9='withdraw:'+_0x1cee91['data']['withdrawalId']+':'+_0x3fbc40['deviceId'];await this[_0x593582(0x407)][_0x593582(0x32f)](_0x3fbc40[_0x593582(0x3cb)],'transfer',_0x1712a9,0x35e80)?this['processJob'](_0x1cee91,_0x3fbc40)['catch'](_0x5e5f8a=>{const _0x54bdee=_0x593582;this['logger']['error']('Error\x20processing\x20job\x20'+_0x1cee91['id']+':\x20'+_0x5e5f8a[_0x54bdee(0x1c8)],_0x5e5f8a['stack']);})['finally'](()=>{this['deviceLockService']['releaseLock'](_0x3fbc40['deviceId'])['catch'](()=>{});}):this['logger']['warn']('Device\x20'+_0x3fbc40['deviceId']+_0x593582(0x206)+_0x1cee91['id']);}}catch(_0x1172bc){this['logger']['error']('Error\x20picking\x20jobs:\x20'+_0x1172bc['message'],_0x1172bc['stack']);}}async['processJob'](_0x301682,_0x51dba9){const _0x552fd5=_0x3ea4ab;let _0x2542ca;try{_0x2542ca=(0x0,_0x14c5b3[_0x552fd5(0x43e)])(_0x301682['data']),await _0x301682['remove']();const _0x514c9a=await(0x0,_0x33ac55[_0x552fd5(0x237)])(_0x6cafa5['Withdrawal'],_0x2542ca);if(!_0x514c9a['ok'])throw new _0x1f3694['WithdrawalProcessingError'](_0x552fd5(0x2c3)+_0x514c9a['errors'][_0x552fd5(0x30c)](_0xf2db19=>_0xf2db19['property'])[_0x552fd5(0x25a)](',\x20'),_0x1f3694['ErrorType']['PERMANENT']);this['telegramService']['sendMessage']({'text':'üöÄüöÄüöÄ\x20<b>Executing\x20Withdrawal\x20'+_0x2542ca['withdrawalId']+'...</b>\x0a\x0a<b>Withdrawal\x20Code:</b>\x20'+_0x2542ca['withdrawalCode']+'\x0a<b>From:</b>\x20'+_0x51dba9[_0x552fd5(0x385)]+_0x552fd5(0x3b4)+_0x51dba9[_0x552fd5(0x398)]+_0x552fd5(0x311)+_0x2542ca['beneficiaryAccountNo']+'\x20-\x20'+_0x2542ca['beneficiaryName']+'\x0a<b>Amount:</b>\x20'+_0x2542ca[_0x552fd5(0x3e3)]+'\x0a<b>Description:</b>\x20'+_0x2542ca[_0x552fd5(0x326)],'options':{'parseMode':'HTML'}})['catch'](_0x2e9e17=>{const _0x1a3248=_0x552fd5;this['logger']['error']('Error\x20sending\x20message\x20for\x20withdrawal\x20'+_0x2542ca[_0x1a3248(0x3bf)]+':\x20'+_0x2e9e17[_0x1a3248(0x1c8)],_0x2e9e17['stack']);});const {_id:_0x24fd6d,withdrawalId:_0x449f86}=_0x2542ca;this[_0x552fd5(0x25d)]['log']('Successfully\x20picked\x20and\x20removed\x20withdrawal\x20'+_0x449f86+'\x20from\x20queue'),this['processingJobs']['add'](_0x301682['id']);const _0x270fed=await this['withdrawalService']['getWithdrawalDetails'](_0x24fd6d);if(![_0x51fe5a[_0x552fd5(0x316)]['PENDING'],_0x51fe5a[_0x552fd5(0x316)][_0x552fd5(0x29a)]]['includes'](_0x270fed['status']))throw this[_0x552fd5(0x25d)]['warn'](_0x552fd5(0x2a3)+_0x449f86+'\x20('+_0x270fed[_0x552fd5(0x455)]+')\x20is\x20not\x20pending\x20or\x20retry,\x20skipping'),new _0x1f3694['WithdrawalProcessingError']('Withdrawal\x20not\x20pending\x20or\x20retry,\x20skipping\x20('+_0x270fed['status']+')',_0x1f3694['ErrorType']['PERMANENT']);this[_0x552fd5(0x20e)][_0x552fd5(0x27e)](_0x24fd6d,_0x51fe5a['WithdrawalStatus']['PROCESSING'])['catch'](_0x449309=>{const _0x3e3678=_0x552fd5;this[_0x3e3678(0x25d)]['error']('Error\x20updating\x20withdrawal\x20status\x20for\x20'+_0x449f86+':\x20'+_0x449309['message'],_0x449309['stack']);}),await this['bankService']['createQRCodeAndTransferTo'](_0x51dba9['bankCode'],_0x51dba9[_0x552fd5(0x3cb)],_0x2542ca),await this['bankService']['createBillFolder'](_0x51dba9['bankCode'],_0x2542ca['withdrawalCode']),await this['withdrawalService'][_0x552fd5(0x343)](_0x2542ca,_0x51dba9['deviceId']);}catch(_0xcd3f56){let _0x476b69;_0xcd3f56 instanceof _0x1f3694['WithdrawalProcessingError']&&(_0x476b69=_0xcd3f56[_0x552fd5(0x329)],this[_0x552fd5(0x25d)]['error'](_0x552fd5(0x2e1)+_0x2542ca[_0x552fd5(0x3bf)]+':\x20'+_0x476b69+'-'+_0xcd3f56['message'],_0xcd3f56[_0x552fd5(0x384)]),await this[_0x552fd5(0x29f)](_0x51dba9,_0x2542ca,_0xcd3f56[_0x552fd5(0x1c8)],_0x476b69));}finally{this['processingJobs']['delete'](_0x301682['id']);}}async['handleJobFailure'](_0x298938,_0x4fc0f2,_0x636dfe,_0x10f2ef=_0x1f3694['ErrorType'][_0x3ea4ab(0x3df)]){const _0xfcdf37=_0x3ea4ab,_0x3b1376=_0x4fc0f2[_0xfcdf37(0x381)]??0x1;switch(_0x10f2ef){case _0x1f3694['ErrorType'][_0xfcdf37(0x3df)]:return void this['notificationService'][_0xfcdf37(0x27e)](_0x4fc0f2['_id'],_0x51fe5a['WithdrawalStatus']['FAILED'])['catch'](_0x386f84=>{const _0x3ea869=_0xfcdf37;this[_0x3ea869(0x25d)]['error']('Error\x20updating\x20withdrawal\x20status\x20for\x20'+_0x4fc0f2['withdrawalId']+':\x20'+_0x386f84['message'],_0x386f84['stack']);});case _0x1f3694['ErrorType']['FORCE_LOGIN_NO_REQUEUE']:return void await this['bankService']['login'](_0x298938['bankCode'],_0x298938[_0xfcdf37(0x3cb)],!0x0);case _0x1f3694[_0xfcdf37(0x325)][_0xfcdf37(0x229)]:await this['bankService'][_0xfcdf37(0x2bc)](_0x298938[_0xfcdf37(0x385)],_0x298938[_0xfcdf37(0x3cb)],_0x4fc0f2['withdrawalCode']);const _0x15f12a=await this[_0xfcdf37(0x2cc)]['getBillImagePath'](_0x298938['bankCode'],_0x4fc0f2['withdrawalCode']);return _0x15f12a&&(this['logger'][_0xfcdf37(0x230)]('Uploading\x20receipt\x20for\x20withdrawal\x20'+_0x4fc0f2['withdrawalCode']+'\x20-\x20'+_0x15f12a),await this['notificationService']['uploadReceipt'](_0x4fc0f2['_id'],_0x15f12a)),await this['notificationService']['updateWithdrawalStatus'](_0x4fc0f2['_id'],_0x51fe5a['WithdrawalStatus'][_0xfcdf37(0x245)]),void await this['bankService'][_0xfcdf37(0x388)](_0x298938['bankCode'],_0x298938['deviceId'],!0x0);case _0x1f3694['ErrorType']['FORCE_LOGIN_AND_REQUEUE']:await this['bankService']['login'](_0x298938['bankCode'],_0x298938['deviceId'],!0x0),this['logger']['warn'](_0xfcdf37(0x42a)+_0x4fc0f2['withdrawalId']+'\x20to\x20queue\x20for\x20retrying.\x20('+_0x3b1376+'/2)Reason:\x20'+_0x636dfe+_0xfcdf37(0x3d9)+_0x10f2ef+'.'),_0x3b1376<0x2?(await this[_0xfcdf37(0x210)][_0xfcdf37(0x40a)]('process-withdrawal-request',{..._0x4fc0f2,'manualRetryCount':_0x3b1376+0x1,'lastErrorType':_0x10f2ef,'lastErrorReason':_0x636dfe},{'attempts':0x0,'removeOnComplete':!0x1,'removeOnFail':!0x1,'jobId':_0xfcdf37(0x28b)+_0x4fc0f2[_0xfcdf37(0x3bf)],'priority':0x1,'delay':0x7530}),this[_0xfcdf37(0x20e)]['updateWithdrawalStatus'](_0x4fc0f2[_0xfcdf37(0x3be)],_0x51fe5a['WithdrawalStatus']['RETRY'])['catch'](_0xdb0069=>{const _0x5a87cd=_0xfcdf37;this['logger']['error']('Error\x20updating\x20withdrawal\x20status\x20for\x20'+_0x4fc0f2['withdrawalId']+':\x20'+_0xdb0069[_0x5a87cd(0x1c8)],_0xdb0069['stack']);})):(this['logger']['warn']('Max\x20retries\x20(2)\x20exceeded\x20for\x20withdrawal\x20'+_0x4fc0f2['withdrawalId']+':\x20'+_0x10f2ef+'\x20error:\x20'+_0x636dfe),this[_0xfcdf37(0x20e)]['updateWithdrawalStatus'](_0x4fc0f2['_id'],_0x51fe5a['WithdrawalStatus']['FAILED'])['catch'](_0x303b7a=>{this['logger']['error']('Error\x20updating\x20withdrawal\x20status\x20for\x20'+_0x4fc0f2['withdrawalId']+':\x20'+_0x303b7a['message'],_0x303b7a['stack']);}));}}async['promoteDelayedJobs'](){return(0x0,_0x2deeaf['withCronLock'])('cron:promote_delayed:withdrawal',0x1388,async()=>{const _0x40a208=a0_0x23a4,_0xb153d7=Date['now'](),_0x98e492=await this[_0x40a208(0x210)]['getJobs'](['delayed'],0x0,0x63);if(!_0x98e492['length'])return;let _0x17877c=0x0;for(const _0x3a1f5c of _0x98e492){const _0x47ab4a=_0x40a208(0x317)==typeof _0x3a1f5c[_0x40a208(0x320)]?.[_0x40a208(0x430)]?_0x3a1f5c[_0x40a208(0x320)]['delay']:0x0;if(('number'==typeof _0x3a1f5c[_0x40a208(0x3a9)]?_0x3a1f5c['timestamp']:0x0)+_0x47ab4a<=_0xb153d7)try{await _0x3a1f5c['promote'](),_0x17877c++;}catch(_0xd73d81){this['logger'][_0x40a208(0x3cc)](_0x40a208(0x446)+_0x3a1f5c['id']+':\x20'+String(_0xd73d81));}}_0x17877c>0x0&&this['logger']['log']('Promoted\x20'+_0x17877c+'\x20delayed\x20jobs\x20to\x20waiting');});}async[_0x3ea4ab(0x15f)](_0x52f588=0x1){const _0x3334b9=_0x3ea4ab;await this[_0x3334b9(0x42d)](_0x52f588);}async['getQueueStats'](){const _0x307741=_0x3ea4ab,[_0x4769d6,_0x374890,_0x516947,_0x361d2e,_0x123927,_0xe8ab99,_0x541516]=await Promise['all']([this['withdrawalQueue'][_0x307741(0x294)](),this['withdrawalQueue']['getDelayedCount'](),this['withdrawalQueue']['getActiveCount'](),this['withdrawalQueue'][_0x307741(0x419)](),this['withdrawalQueue']['getFailedCount'](),this['deviceService']['getAvailableDevices'](),this[_0x307741(0x17f)]['getServiceStatus']()]);return{'serviceStatus':_0x541516,'activeDevices':_0xe8ab99['length'],'processingJobs':this['processingJobs']['size'],'isInitialized':this['isInitialized'],'queue':{'waiting':_0x4769d6,'delayed':_0x374890,'active':_0x516947,'completed':_0x361d2e,'failed':_0x123927,'total':_0x4769d6+_0x374890+_0x516947}};}async['debugQueue'](){const _0x443d50=_0x3ea4ab,_0x494e97=await this['getQueueStats'](),[_0x3b28bc,_0x3d0ad3]=await Promise['all']([this['withdrawalQueue']['getJobs'](['waiting'],0x0,0x9),this['withdrawalQueue'][_0x443d50(0x15d)](['delayed'],0x0,0x9)]);return{..._0x494e97,'sampleWaitingJobs':_0x3b28bc['map'](_0x1f7b85=>({'id':_0x1f7b85['id'],'data':_0x1f7b85['data'],'opts':_0x1f7b85['opts'],'manualRetryCount':_0x1f7b85['data']['manualRetryCount']})),'sampleDelayedJobs':_0x3d0ad3['map'](_0x4f39cd=>({'id':_0x4f39cd['id'],'data':_0x4f39cd['data'],'opts':_0x4f39cd['opts'],'manualRetryCount':_0x4f39cd['data'][_0x443d50(0x381)]}))};}async['periodicJobPicking'](){const _0x104095=_0x3ea4ab;await this['redisLockService'][_0x104095(0x222)](_0x29b582['SYSTEM_LOCK_PAUSE_PROCESSING'])?this['logger']['warn'](_0x104095(0x412)):await this['pickAndProcessJobs']();}async[_0x3ea4ab(0x451)](){await this['promoteDelayedJobs']();}async['restartPandaBoxPeriodically'](){const _0x229792=_0x3ea4ab,_0x141ee5=await this[_0x229792(0x17f)]['getServiceStatus']();this['cronRestartBoxphoneEnabled']&&'active'===_0x141ee5&&await this[_0x229792(0x34f)]['acquireLock'](_0x29b582['SYSTEM_LOCK_BOXPHONE'],0x2bf20);}};_0x33eee8[_0x3ea4ab(0x362)]=_0x5ab089,_0x48a0b6([(0x0,_0x2067f7[_0x3ea4ab(0x23f)])(_0x2067f7['CronExpression'][_0x3ea4ab(0x32a)]),_0x524bc4('design:type',Function),_0x524bc4('design:paramtypes',[]),_0x524bc4('design:returntype',Promise)],_0x5ab089['prototype'],'periodicJobPicking',null),_0x48a0b6([(0x0,_0x2067f7['Cron'])(_0x2067f7['CronExpression']['EVERY_5_SECONDS']),_0x524bc4('design:type',Function),_0x524bc4('design:paramtypes',[]),_0x524bc4('design:returntype',Promise)],_0x5ab089['prototype'],'promoteDelayedJobsPeriodically',null),_0x48a0b6([(0x0,_0x2067f7['Cron'])('0\x20*/59\x20*\x20*\x20*\x20*'),_0x524bc4('design:type',Function),_0x524bc4(_0x3ea4ab(0x2b1),[]),_0x524bc4('design:returntype',Promise)],_0x5ab089[_0x3ea4ab(0x18a)],_0x3ea4ab(0x441),null),_0x33eee8['WithdrawalJobManagerService']=_0x5ab089=_0x48a0b6([(0x0,_0x367087['Injectable'])(),_0x2afc44(0x0,(0x0,_0x4c7b86[_0x3ea4ab(0x396)])(_0x3ea4ab(0x40b))),_0x2afc44(0x4,(0x0,_0x367087['Inject'])(_0x117fff['WEBSOCKET_SERVICE'])),_0x524bc4(_0x3ea4ab(0x2b1),['function'==typeof(_0x23f4c9=void 0x0!==_0x4d2669['Queue']&&_0x4d2669[_0x3ea4ab(0x268)])?_0x23f4c9:Object,_0x3ea4ab(0x24f)==typeof(_0x4f48ac=void 0x0!==_0xdb0b28['WithdrawalService']&&_0xdb0b28['WithdrawalService'])?_0x4f48ac:Object,'function'==typeof(_0x55234c=void 0x0!==_0x4858af[_0x3ea4ab(0x427)]&&_0x4858af['DeviceService'])?_0x55234c:Object,'function'==typeof(_0x4b8691=void 0x0!==_0x3a1e17['DeviceLockService']&&_0x3a1e17[_0x3ea4ab(0x3a5)])?_0x4b8691:Object,'function'==typeof(_0x351ca7=void 0x0!==_0x3751fb['IWebSocketService']&&_0x3751fb['IWebSocketService'])?_0x351ca7:Object,'function'==typeof(_0x51756e=void 0x0!==_0x421520['BankService']&&_0x421520['BankService'])?_0x51756e:Object,_0x3ea4ab(0x24f)==typeof(_0x5636cf=void 0x0!==_0x1b8daf[_0x3ea4ab(0x2ac)]&&_0x1b8daf['NotificationService'])?_0x5636cf:Object,'function'==typeof(_0x598ce6=void 0x0!==_0xf43df6['WindowsAppGitBashService']&&_0xf43df6[_0x3ea4ab(0x3ba)])?_0x598ce6:Object,_0x3ea4ab(0x24f)==typeof(_0x55ac77=void 0x0!==_0x1a7c3a['RedisLockService']&&_0x1a7c3a['RedisLockService'])?_0x55ac77:Object,_0x3ea4ab(0x24f)==typeof(_0x2c5d23=void 0x0!==_0x355973['TelegramService']&&_0x355973[_0x3ea4ab(0x2f6)])?_0x2c5d23:Object,_0x3ea4ab(0x24f)==typeof(_0xcc1b5f=void 0x0!==_0x39435a[_0x3ea4ab(0x253)]&&_0x39435a['RedisService'])?_0xcc1b5f:Object])],_0x5ab089);},_0x3abec5=>{_0x3abec5['exports']=require('bull');},function(_0x32ca34,_0x4f1400,_0x5312f7){const _0xe1a062=a0_0x23a4;var _0x33da3c,_0x389ce6=this&&this['__decorate']||function(_0xf8dcb6,_0x2c02f3,_0x372f67,_0x752161){const _0x5d4adc=a0_0x23a4;var _0x2d0c30,_0x6c9a49=arguments['length'],_0x57bfaf=_0x6c9a49<0x3?_0x2c02f3:null===_0x752161?_0x752161=Object[_0x5d4adc(0x26e)](_0x2c02f3,_0x372f67):_0x752161;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x5d4adc(0x2e3)])_0x57bfaf=Reflect[_0x5d4adc(0x2e3)](_0xf8dcb6,_0x2c02f3,_0x372f67,_0x752161);else{for(var _0xb68406=_0xf8dcb6['length']-0x1;_0xb68406>=0x0;_0xb68406--)(_0x2d0c30=_0xf8dcb6[_0xb68406])&&(_0x57bfaf=(_0x6c9a49<0x3?_0x2d0c30(_0x57bfaf):_0x6c9a49>0x3?_0x2d0c30(_0x2c02f3,_0x372f67,_0x57bfaf):_0x2d0c30(_0x2c02f3,_0x372f67))||_0x57bfaf);}return _0x6c9a49>0x3&&_0x57bfaf&&Object['defineProperty'](_0x2c02f3,_0x372f67,_0x57bfaf),_0x57bfaf;},_0xa17ac6=this&&this['__metadata']||function(_0x142a80,_0x13190a){const _0x558f0d=a0_0x23a4;if(_0x558f0d(0x34a)==typeof Reflect&&_0x558f0d(0x24f)==typeof Reflect['metadata'])return Reflect['metadata'](_0x142a80,_0x13190a);};Object['defineProperty'](_0x4f1400,'__esModule',{'value':!0x0}),_0x4f1400['Withdrawal']=void 0x0;const _0xa8d996=_0x5312f7(0x2a),_0x4963e3=_0x5312f7(0x3b);class _0x3e355a{}_0x4f1400['Withdrawal']=_0x3e355a,_0x389ce6([(0x0,_0x4963e3['IsNotEmpty'])(),_0xa17ac6('design:type',String)],_0x3e355a[_0xe1a062(0x18a)],'_id',void 0x0),_0x389ce6([(0x0,_0x4963e3['IsNotEmpty'])(),_0xa17ac6('design:type',String)],_0x3e355a[_0xe1a062(0x18a)],_0xe1a062(0x3bf),void 0x0),_0x389ce6([(0x0,_0x4963e3['IsNotEmpty'])(),_0xa17ac6(_0xe1a062(0x35d),String)],_0x3e355a['prototype'],'withdrawalCode',void 0x0),_0x389ce6([(0x0,_0x4963e3['IsNotEmpty'])(),_0xa17ac6('design:type',String)],_0x3e355a['prototype'],'bankCode',void 0x0),_0x389ce6([(0x0,_0x4963e3[_0xe1a062(0x1c4)])(),_0xa17ac6('design:type',String)],_0x3e355a['prototype'],'beneficiaryAccountNo',void 0x0),_0x389ce6([(0x0,_0x4963e3['IsNotEmpty'])(),_0xa17ac6(_0xe1a062(0x35d),String)],_0x3e355a['prototype'],_0xe1a062(0x218),void 0x0),_0x389ce6([(0x0,_0x4963e3['IsNotEmpty'])(),_0xa17ac6(_0xe1a062(0x35d),Number)],_0x3e355a['prototype'],'amount',void 0x0),_0x389ce6([(0x0,_0x4963e3[_0xe1a062(0x1c4)])(),_0xa17ac6(_0xe1a062(0x35d),String)],_0x3e355a['prototype'],'transferCode',void 0x0),_0x389ce6([(0x0,_0x4963e3['IsNotEmpty'])(),_0xa17ac6('design:type',String)],_0x3e355a['prototype'],_0xe1a062(0x455),void 0x0),_0x389ce6([(0x0,_0x4963e3['IsNotEmpty'])(),_0xa17ac6('design:type',String)],_0x3e355a['prototype'],'description',void 0x0),_0x389ce6([(0x0,_0x4963e3['IsNotEmpty'])(),_0xa17ac6('design:type',String)],_0x3e355a['prototype'],_0xe1a062(0x1d3),void 0x0),_0x389ce6([(0x0,_0x4963e3[_0xe1a062(0x197)])(),_0xa17ac6(_0xe1a062(0x35d),Number)],_0x3e355a[_0xe1a062(0x18a)],_0xe1a062(0x381),void 0x0),_0x389ce6([(0x0,_0x4963e3[_0xe1a062(0x197)])(),_0xa17ac6(_0xe1a062(0x35d),_0xe1a062(0x24f)==typeof(_0x33da3c=void 0x0!==_0xa8d996[_0xe1a062(0x325)]&&_0xa8d996['ErrorType'])?_0x33da3c:Object)],_0x3e355a['prototype'],'lastErrorType',void 0x0),_0x389ce6([(0x0,_0x4963e3['IsOptional'])(),_0xa17ac6('design:type',String)],_0x3e355a['prototype'],'lastErrorReason',void 0x0);},_0x5f4d7b=>{const _0x24046b=a0_0x23a4;_0x5f4d7b[_0x24046b(0x391)]=require('class-validator');},(_0x43253c,_0x28facd,_0x3017ba)=>{const _0x3224d2=a0_0x23a4;Object['defineProperty'](_0x28facd,'__esModule',{'value':!0x0}),_0x28facd[_0x3224d2(0x1a6)]=void 0x0;const _0x330493=_0x3017ba(0x10),_0x1c65ae=_0x3017ba(0x11),_0x214417=new _0x330493['default']({'host':_0x1c65ae['config']['redis']['host'],'port':_0x1c65ae['config'][_0x3224d2(0x3f4)]['port'],'password':_0x1c65ae[_0x3224d2(0x219)]['redis'][_0x3224d2(0x247)],'db':_0x1c65ae[_0x3224d2(0x219)][_0x3224d2(0x3f4)]['db']});_0x28facd['withCronLock']=async(_0xb9a701,_0xf3b9b1,_0x5ca3ad)=>{const _0x304755=process['pid']+':'+Date['now']();if(await _0x214417['set'](_0xb9a701,_0x304755,'PX',_0xf3b9b1,'NX'))try{await _0x5ca3ad();}finally{const _0x4b84d3='\x0a\x20\x20\x20\x20\x20\x20if\x20redis.call(\x22GET\x22,\x20KEYS[1])\x20==\x20ARGV[1]\x20then\x0a\x20\x20\x20\x20\x20\x20\x20\x20return\x20redis.call(\x22DEL\x22,\x20KEYS[1])\x0a\x20\x20\x20\x20\x20\x20end\x0a\x20\x20\x20\x20\x20\x20return\x200\x0a\x20\x20\x20\x20';await _0x214417['eval'](_0x4b84d3,0x1,_0xb9a701,_0x304755);}};},(_0x217fc7,_0x1ceefd)=>{var _0x5f4c83;Object['defineProperty'](_0x1ceefd,'__esModule',{'value':!0x0}),_0x1ceefd['WithdrawalStatus']=void 0x0,function(_0x39ad8b){const _0x1f4a9b=a0_0x23a4;_0x39ad8b[_0x1f4a9b(0x1c6)]='PENDING',_0x39ad8b['FAILED']=_0x1f4a9b(0x3c8),_0x39ad8b[_0x1f4a9b(0x24e)]='PROCESSING',_0x39ad8b['RETRY']='RETRY',_0x39ad8b['COMPLETED']=_0x1f4a9b(0x17b),_0x39ad8b[_0x1f4a9b(0x245)]='UNKNOWN',_0x39ad8b['NA']='NA';}(_0x5f4c83||(_0x1ceefd['WithdrawalStatus']=_0x5f4c83={}));},function(_0x529ab9,_0x3ac054,_0x2f3d7e){const _0x5a29d4=a0_0x23a4;var _0x30daee,_0x6c513e=this&&this['__decorate']||function(_0x118431,_0x4357f4,_0x2c54c2,_0x499434){const _0x58dbca=a0_0x23a4;var _0x28d111,_0x4576bb=arguments[_0x58dbca(0x1fa)],_0x2c546e=_0x4576bb<0x3?_0x4357f4:null===_0x499434?_0x499434=Object['getOwnPropertyDescriptor'](_0x4357f4,_0x2c54c2):_0x499434;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x2c546e=Reflect[_0x58dbca(0x2e3)](_0x118431,_0x4357f4,_0x2c54c2,_0x499434);else{for(var _0x448c3e=_0x118431['length']-0x1;_0x448c3e>=0x0;_0x448c3e--)(_0x28d111=_0x118431[_0x448c3e])&&(_0x2c546e=(_0x4576bb<0x3?_0x28d111(_0x2c546e):_0x4576bb>0x3?_0x28d111(_0x4357f4,_0x2c54c2,_0x2c546e):_0x28d111(_0x4357f4,_0x2c54c2))||_0x2c546e);}return _0x4576bb>0x3&&_0x2c546e&&Object['defineProperty'](_0x4357f4,_0x2c54c2,_0x2c546e),_0x2c546e;};Object[_0x5a29d4(0x213)](_0x3ac054,'__esModule',{'value':!0x0}),_0x3ac054['WindowsAppGitBashService']=void 0x0;const _0x305bbf=_0x2f3d7e(0x2),_0x4d3618=_0x2f3d7e(0x3f),_0x43c2f6=_0x2f3d7e(0x40),_0xa792df=_0x2f3d7e(0x18),_0x44dbfa=(0x0,_0x43c2f6['promisify'])(_0x4d3618['exec']);let _0x150628=_0x30daee=class{constructor(){const _0x58ac62=_0x5a29d4;this['logger']=new _0x305bbf[(_0x58ac62(0x34b))](_0x30daee[_0x58ac62(0x162)]);}async['restartApp'](_0x203253){const _0x805770=_0x5a29d4,{processName:_0x4a22d9,exePath:_0x4e54b0,startTarget:_0x53b550,gracefulWaitMs:_0x1d2080=0x4b0,forceKillWaitMs:_0x10c9b7=0x1f4,startDelayMs:_0x4f5cb2=0x12c,runAsAdmin:_0x8b2ba3=!0x1,killAsAdmin:_0x31ce9e=!0x1}=_0x203253;try{if(await this['closeMainWindow'](_0x4a22d9)['catch'](()=>{}),await(0x0,_0xa792df['sleep'])(_0x1d2080),await this['forceKill'](_0x4a22d9,_0x31ce9e)['catch'](()=>{}),await(0x0,_0xa792df['sleep'])(_0x10c9b7),await this['waitUntilNotRunning'](_0x4a22d9,0x1388)['catch'](()=>{}),await(0x0,_0xa792df['sleep'])(_0x4f5cb2),_0x4e54b0)return void await this['startApp']({'exePath':_0x4e54b0,'runAsAdmin':_0x8b2ba3});if(_0x53b550)return void await this['startApp']({'startTarget':_0x53b550,'runAsAdmin':_0x8b2ba3});const _0x281677=_0x4a22d9[_0x805770(0x3cf)](/\.exe$/i,'');await this['startApp']({'startTarget':_0x281677,'runAsAdmin':_0x8b2ba3});}catch(_0x1c74c1){const _0x5bead0=_0x1c74c1?.[_0x805770(0x1c8)]||String(_0x1c74c1);throw this['logger']['error']('[restart]\x20Failed\x20to\x20restart\x20app:\x20'+_0x5bead0,_0x1c74c1?.['stack']),_0x1c74c1;}}async[_0x5a29d4(0x3e8)](_0x341549){const _0x41639e=_0x5a29d4,_0x2003c5=_0x341549['replace'](/\.exe$/i,''),_0x4e424a=_0x41639e(0x359)+this['escapePs'](_0x2003c5)+'\x22\x20-ErrorAction\x20SilentlyContinue\x20|\x20ForEach-Object\x20{\x20$_.CloseMainWindow()\x20|\x20Out-Null\x20}',_0x4f7b1c=_0x41639e(0x29c)+this[_0x41639e(0x2eb)](_0x4e424a)+'\x22';try{await _0x44dbfa(_0x4f7b1c,{'windowsHide':!0x0});}catch(_0x5bf4cc){if(!(_0x5bf4cc?.['message']||String(_0x5bf4cc)||'')['includes']('Cannot\x20find\x20a\x20process'))throw _0x5bf4cc;}}async['forceKill'](_0x11d78b,_0x580510=!0x1){const _0xf5492c=_0x5a29d4,_0x2e3a59=_0x11d78b['replace'](/\.exe$/i,'');try{return void await this['forceKillWithPowerShell'](_0x2e3a59,_0x580510);}catch(_0x4dfc69){const _0x102fae=(_0x4dfc69?.['message']||_0x4dfc69?.['stderr']||String(_0x4dfc69)||'')[_0xf5492c(0x1f0)]();if(_0x102fae['includes']('cannot\x20find\x20a\x20process')||_0x102fae['includes']('process\x20not\x20found')||_0x102fae['includes']('cannot\x20find\x20process'))return void this[_0xf5492c(0x25d)]['debug']('Process\x20not\x20found\x20(expected):\x20'+_0x11d78b);if((_0x102fae['includes']('access\x20is\x20denied')||_0x102fae['includes']('access\x20denied'))&&!_0x580510){this[_0xf5492c(0x25d)][_0xf5492c(0x3d4)]('Access\x20denied,\x20retrying\x20with\x20admin\x20privileges:\x20'+_0x11d78b);try{return void await this[_0xf5492c(0x337)](_0x2e3a59,!0x0);}catch(_0x581a24){const _0x35d0ed=(_0x581a24?.['message']||_0x581a24?.[_0xf5492c(0x436)]||String(_0x581a24)||'')['toLowerCase']();if(_0x35d0ed['includes']('cannot\x20find\x20a\x20process')||_0x35d0ed['includes']('process\x20not\x20found'))return;this['logger'][_0xf5492c(0x3cc)](_0xf5492c(0x19f)+_0x11d78b);}}try{let _0x130e1b;if(_0x580510||_0x102fae[_0xf5492c(0x31c)](_0xf5492c(0x3f9))||_0x102fae[_0xf5492c(0x31c)](_0xf5492c(0x305)))_0x130e1b=_0xf5492c(0x29c)+('Start-Process\x20taskkill\x20-ArgumentList\x20\x27/F\x27,\x27/IM\x27,\x27'+_0x11d78b['replace'](/"/g,'`\x22')+_0xf5492c(0x43b))[_0xf5492c(0x3cf)](/"/g,'`\x22')['replace'](/\$/g,'`$')+'\x22';else _0x130e1b=_0xf5492c(0x2c1)+_0x11d78b+'\x22\x20/T';await _0x44dbfa(_0x130e1b,{'windowsHide':!0x0});}catch(_0x24463c){const _0x3af587=(_0x24463c?.[_0xf5492c(0x1c8)]||_0x24463c?.['stderr']||String(_0x24463c)||'')['toLowerCase']();if(_0x3af587['includes']('not\x20found')||_0x3af587['includes'](_0xf5492c(0x351))||_0x3af587[_0xf5492c(0x31c)](_0xf5492c(0x420)))return void this['logger']['debug'](_0xf5492c(0x239)+_0x11d78b);if(_0x3af587['includes'](_0xf5492c(0x305))||_0x3af587['includes']('access\x20denied'))return void this['logger']['warn']('Cannot\x20kill\x20process\x20(access\x20denied):\x20'+_0x11d78b+'.\x20Process\x20may\x20require\x20administrator\x20privileges\x20to\x20terminate.');this['logger']['warn']('Kill\x20process\x20warning:\x20'+_0x3af587);}}}async[_0x5a29d4(0x337)](_0x457427,_0x90b7a6=!0x1){const _0x5ccdaf=_0x5a29d4,_0x5a70d0='Get-Process\x20-Name\x20\x27'+_0x457427['replace'](/'/g,'\x27\x27')+'\x27\x20-ErrorAction\x20SilentlyContinue\x20|\x20Stop-Process\x20-Force\x20-ErrorAction\x20Stop';let _0x1eff23;_0x1eff23=_0x90b7a6?'powershell\x20-NoProfile\x20-ExecutionPolicy\x20Bypass\x20-Command\x20\x22'+(_0x5ccdaf(0x1c5)+_0x5a70d0['replace'](/'/g,'\x27\x27')['replace'](/"/g,'`\x22')+'\x22\x20-Verb\x20RunAs\x20-Wait\x20-WindowStyle\x20Hidden')['replace'](/"/g,'`\x22')['replace'](/\$/g,'`$')+'\x22':'powershell\x20-NoProfile\x20-ExecutionPolicy\x20Bypass\x20-Command\x20\x22'+_0x5a70d0['replace'](/"/g,'`\x22')['replace'](/\$/g,'`$')+'\x22';try{await _0x44dbfa(_0x1eff23,{'windowsHide':!0x0});}catch(_0x4a3e9a){const _0x3d71b1=(_0x4a3e9a?.['message']||_0x4a3e9a?.['stderr']||String(_0x4a3e9a)||'')['toLowerCase']();if(_0x3d71b1[_0x5ccdaf(0x31c)](_0x5ccdaf(0x38f))||_0x3d71b1['includes']('process\x20not\x20found')||_0x3d71b1['includes']('cannot\x20find\x20process'))return void this[_0x5ccdaf(0x25d)]['debug']('Process\x20not\x20found\x20(expected):\x20'+_0x457427);throw _0x4a3e9a;}}async['isRunning'](_0x5d6173){const _0x560f53=_0x5a29d4;try{const _0x258290=_0x560f53(0x21b)+_0x5d6173+_0x560f53(0x1ee),{stdout:_0x3b1d7a}=await _0x44dbfa(_0x258290,{'windowsHide':!0x0}),_0x1abcf8=_0x3b1d7a[_0x560f53(0x1f0)]()['trim']();return!(!_0x1abcf8||_0x1abcf8[_0x560f53(0x31c)]('no\x20tasks')||_0x560f53(0x289)===_0x1abcf8)&&_0x1abcf8['includes'](_0x5d6173['toLowerCase']());}catch(_0x1f3f60){return!0x1;}}async['waitUntilNotRunning'](_0x39b8cc,_0x33047e){const _0x12f2b6=_0x5a29d4,_0xb60145=Date[_0x12f2b6(0x442)]();for(;Date['now']()-_0xb60145<_0x33047e;){if(!await this['isRunning'](_0x39b8cc))return;await(0x0,_0xa792df[_0x12f2b6(0x37f)])(0xfa);}this[_0x12f2b6(0x25d)][_0x12f2b6(0x3d4)](_0x12f2b6(0x293)+_0x33047e+'ms:\x20'+_0x39b8cc);}async['startApp'](_0x35c12f){const _0x50350f=_0x5a29d4,_0x32c687=_0x35c12f['exePath']??_0x35c12f[_0x50350f(0x21a)]??'',_0x248e64=_0x35c12f['runAsAdmin']??!0x1;if(!_0x32c687)throw new Error('Start\x20target\x20is\x20empty');try{if(_0x248e64){const _0x101c87='powershell\x20-NoProfile\x20-ExecutionPolicy\x20Bypass\x20-Command\x20\x22'+(_0x50350f(0x255)+_0x32c687['replace'](/'/g,'\x27\x27')+'\x27\x20-Verb\x20RunAs')['replace'](/"/g,'`\x22')['replace'](/\$/g,'`$')+'\x22';await _0x44dbfa(_0x101c87),this[_0x50350f(0x25d)][_0x50350f(0x230)]('App\x20started\x20with\x20Administrator\x20privileges:\x20'+_0x32c687);}else{const _0x5ac879='start\x20\x22\x22\x20\x22'+_0x32c687+'\x22';await _0x44dbfa(_0x5ac879,{'windowsHide':!0x0}),this['logger']['log']('App\x20started\x20successfully:\x20'+_0x32c687);}await(0x0,_0xa792df[_0x50350f(0x37f)])(0x1f4);}catch(_0x18fd6d){const _0x46ad86=_0x18fd6d?.[_0x50350f(0x1c8)]||String(_0x18fd6d);throw this['logger'][_0x50350f(0x382)]('Failed\x20to\x20start\x20app:\x20'+_0x32c687,_0x46ad86),_0x18fd6d;}}['escapePs'](_0x1f7236){const _0x16452c=_0x5a29d4;return _0x1f7236[_0x16452c(0x3cf)](/"/g,'`\x22')['replace'](/\$/g,'`$');}};_0x3ac054[_0x5a29d4(0x3ba)]=_0x150628,_0x3ac054[_0x5a29d4(0x3ba)]=_0x150628=_0x30daee=_0x6c513e([(0x0,_0x305bbf['Injectable'])()],_0x150628);},_0x1e88ef=>{const _0x24cc88=a0_0x23a4;_0x1e88ef[_0x24cc88(0x391)]=require('child_process');},_0x4dafcf=>{_0x4dafcf['exports']=require('util');},function(_0x52017c,_0x1ef035,_0xe4f0f0){const _0x60194d=a0_0x23a4;var _0x2b7933,_0x20398c=this&&this[_0x60194d(0x1f9)]||function(_0x2b50e9,_0x5c34c6,_0xa1edc7,_0xb11efa){var _0x11c914,_0x3eae93=arguments['length'],_0x22ee87=_0x3eae93<0x3?_0x5c34c6:null===_0xb11efa?_0xb11efa=Object['getOwnPropertyDescriptor'](_0x5c34c6,_0xa1edc7):_0xb11efa;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x22ee87=Reflect['decorate'](_0x2b50e9,_0x5c34c6,_0xa1edc7,_0xb11efa);else{for(var _0x5d2ce6=_0x2b50e9['length']-0x1;_0x5d2ce6>=0x0;_0x5d2ce6--)(_0x11c914=_0x2b50e9[_0x5d2ce6])&&(_0x22ee87=(_0x3eae93<0x3?_0x11c914(_0x22ee87):_0x3eae93>0x3?_0x11c914(_0x5c34c6,_0xa1edc7,_0x22ee87):_0x11c914(_0x5c34c6,_0xa1edc7))||_0x22ee87);}return _0x3eae93>0x3&&_0x22ee87&&Object['defineProperty'](_0x5c34c6,_0xa1edc7,_0x22ee87),_0x22ee87;},_0xa497cb=this&&this['__metadata']||function(_0x156fb4,_0x1981b9){const _0xb9e639=_0x60194d;if('object'==typeof Reflect&&_0xb9e639(0x24f)==typeof Reflect[_0xb9e639(0x216)])return Reflect['metadata'](_0x156fb4,_0x1981b9);};Object[_0x60194d(0x213)](_0x1ef035,'__esModule',{'value':!0x0}),_0x1ef035['RedisLockService']=void 0x0;const _0x3ab5be=_0xe4f0f0(0x2),_0x4629a0=_0xe4f0f0(0xf),_0x3209c8=_0xe4f0f0(0x15);let _0x58ce13=class{constructor(_0x2348b7){const _0x1c0646=_0x60194d;this['redisService']=_0x2348b7,this['logger']=new _0x3ab5be['Logger']('RedisLockService'),this[_0x1c0646(0x1d5)]=0x2bf20;}async['acquireLock'](_0x574022,_0x5ed179=this[_0x60194d(0x1d5)]){const _0x4b867d=_0x60194d;try{const _0x48ceef=(0x0,_0x3209c8['randomUUID'])(),_0xd981f5=Math['ceil'](_0x5ed179/0x3e8),_0x15d4a3=await this['redisService'][_0x4b867d(0x31b)]();return'OK'===await _0x15d4a3['set'](_0x574022,_0x48ceef,'EX',_0xd981f5,'NX');}catch(_0x593245){return!0x1;}}async['releaseLock'](_0x418014){const _0x4d405d=_0x60194d;try{const _0x24ea1d=await this[_0x4d405d(0x1f1)]['getClient'](),_0x275001=await _0x24ea1d['get'](_0x418014);if(!_0x275001)return;0x1===await _0x24ea1d['eval']('\x0aif\x20redis.call(\x22GET\x22,\x20KEYS[1])\x20==\x20ARGV[1]\x20then\x0a\x20\x20return\x20redis.call(\x22DEL\x22,\x20KEYS[1])\x0aelse\x0a\x20\x20return\x200\x0aend\x0a',0x1,_0x418014,_0x275001)?this[_0x4d405d(0x25d)]['log']('Released\x20lock\x20(lockId:\x20'+_0x418014+':'+_0x275001+')'):this[_0x4d405d(0x25d)]['warn']('Lock\x20was\x20already\x20released\x20or\x20changed\x20(expected\x20lockId:\x20'+_0x418014+':'+_0x275001+')');}catch(_0x3d5ee8){this[_0x4d405d(0x25d)][_0x4d405d(0x382)]('Error\x20releasing\x20lock:\x20'+_0x418014+'\x20'+_0x3d5ee8[_0x4d405d(0x1c8)],_0x3d5ee8[_0x4d405d(0x384)]);}}async['getLock'](_0x5a7149){const _0x2ac119=_0x60194d;try{return await this[_0x2ac119(0x1f1)][_0x2ac119(0x27f)](_0x5a7149)??null;}catch(_0x1b9213){return this['logger'][_0x2ac119(0x382)]('['+_0x5a7149+']\x20Error\x20getting\x20lock:\x20'+_0x1b9213['message']),null;}}async[_0x60194d(0x222)](_0xf1c3c4){const _0x1e8c08=_0x60194d;try{return!!await this['getLock'](_0xf1c3c4);}catch(_0x2ac7c5){return this[_0x1e8c08(0x25d)]['error']('['+_0xf1c3c4+_0x1e8c08(0x17c)+_0x2ac7c5['message']),!0x1;}}};_0x1ef035['RedisLockService']=_0x58ce13,_0x1ef035[_0x60194d(0x29e)]=_0x58ce13=_0x20398c([(0x0,_0x3ab5be['Injectable'])(),_0xa497cb('design:paramtypes',['function'==typeof(_0x2b7933=void 0x0!==_0x4629a0['RedisService']&&_0x4629a0['RedisService'])?_0x2b7933:Object])],_0x58ce13);},(_0x4fcaa1,_0x5092be)=>{const _0x875bf2=a0_0x23a4;Object['defineProperty'](_0x5092be,_0x875bf2(0x3f1),{'value':!0x0}),_0x5092be[_0x875bf2(0x212)]=_0x5092be[_0x875bf2(0x3ab)]=void 0x0,_0x5092be[_0x875bf2(0x3ab)]='system:lock:boxphone',_0x5092be['SYSTEM_LOCK_PAUSE_PROCESSING']='system:lock:pauseprocessing';},(_0x4973ef,_0x5e4740,_0x5f4cde)=>{Object['defineProperty'](_0x5e4740,'__esModule',{'value':!0x0}),_0x5e4740['validateObjectResult']=void 0x0;const _0x537623=_0x5f4cde(0x44),_0x34346e=_0x5f4cde(0x3b);_0x5e4740['validateObjectResult']=async(_0x1afd43,_0x533b9a)=>{const _0x1a8f6d=a0_0x23a4,_0x431aca=(0x0,_0x537623['plainToInstance'])(_0x1afd43,_0x533b9a,{'enableImplicitConversion':!0x0}),_0x134f08=await(0x0,_0x34346e['validate'])(_0x431aca,{'whitelist':!0x0,'forbidNonWhitelisted':!0x0,'forbidUnknownValues':!0x0,'validationError':{'target':!0x1,'value':!0x1}});return{'ok':0x0===_0x134f08[_0x1a8f6d(0x1fa)],'instance':_0x431aca,'errors':_0x134f08};};},_0x30012c=>{_0x30012c['exports']=require('class-transformer');},(_0x2cb1d7,_0xaa4df2)=>{const _0x403c87=a0_0x23a4;Object[_0x403c87(0x213)](_0xaa4df2,'__esModule',{'value':!0x0}),_0xaa4df2['JOB_PRIORITY_KEY']=void 0x0,_0xaa4df2['JOB_PRIORITY_KEY']='bull:wda-request:priority';},function(_0x2e51f5,_0x1291b1,_0x31e461){const _0x115667=a0_0x23a4;var _0x46cb24,_0x489f6c=this&&this['__decorate']||function(_0x54c7c9,_0x288f25,_0x50d9c5,_0x5917ad){const _0x4f5a3a=a0_0x23a4;var _0x2a2bf0,_0x3d857c=arguments['length'],_0x4ef714=_0x3d857c<0x3?_0x288f25:null===_0x5917ad?_0x5917ad=Object['getOwnPropertyDescriptor'](_0x288f25,_0x50d9c5):_0x5917ad;if(_0x4f5a3a(0x34a)==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x4ef714=Reflect[_0x4f5a3a(0x2e3)](_0x54c7c9,_0x288f25,_0x50d9c5,_0x5917ad);else{for(var _0xdc1f40=_0x54c7c9['length']-0x1;_0xdc1f40>=0x0;_0xdc1f40--)(_0x2a2bf0=_0x54c7c9[_0xdc1f40])&&(_0x4ef714=(_0x3d857c<0x3?_0x2a2bf0(_0x4ef714):_0x3d857c>0x3?_0x2a2bf0(_0x288f25,_0x50d9c5,_0x4ef714):_0x2a2bf0(_0x288f25,_0x50d9c5))||_0x4ef714);}return _0x3d857c>0x3&&_0x4ef714&&Object['defineProperty'](_0x288f25,_0x50d9c5,_0x4ef714),_0x4ef714;},_0x4700c9=this&&this[_0x115667(0x434)]||function(_0x2e33f6,_0x20df7f){const _0x291b0e=_0x115667;if('object'==typeof Reflect&&_0x291b0e(0x24f)==typeof Reflect['metadata'])return Reflect['metadata'](_0x2e33f6,_0x20df7f);};Object['defineProperty'](_0x1291b1,_0x115667(0x3f1),{'value':!0x0}),_0x1291b1['WithdrawalController']=void 0x0;const _0x1af148=_0x31e461(0x2),_0x1de6a6=_0x31e461(0x3),_0xed998b=_0x31e461(0x38);let _0x577644=class{constructor(_0x34cb6d){this['jobManagerService']=_0x34cb6d,this['logger']=new _0x1af148['Logger']('WithdrawalController');}async['getQueueStats'](){const _0x50bfce=_0x115667;return await this[_0x50bfce(0x440)]['getQueueStats']();}async['debugQueue'](){const _0x3a31a6=_0x115667;return await this['jobManagerService'][_0x3a31a6(0x19e)]();}async[_0x115667(0x1c9)](){const _0x25f2d7=_0x115667;return this['logger'][_0x25f2d7(0x230)]('Manually\x20triggering\x20job\x20picking...'),await this['jobManagerService']['triggerPickJobs'](0x1),{'success':!0x0,'message':_0x25f2d7(0x1b8),'stats':await this['jobManagerService']['getQueueStats']()};}};_0x1291b1['WithdrawalController']=_0x577644,_0x489f6c([(0x0,_0x1af148['Get'])('queue/stats'),(0x0,_0x1de6a6['ApiOperation'])({'summary':'Get\x20withdrawal\x20queue\x20statistics'}),(0x0,_0x1de6a6['ApiResponse'])({'status':0xc8,'description':'Queue\x20statistics'}),_0x4700c9(_0x115667(0x35d),Function),_0x4700c9('design:paramtypes',[]),_0x4700c9('design:returntype',Promise)],_0x577644['prototype'],'getQueueStats',null),_0x489f6c([(0x0,_0x1af148['Get'])(_0x115667(0x2ee)),(0x0,_0x1de6a6[_0x115667(0x296)])({'summary':'Get\x20detailed\x20queue\x20debug\x20information'}),(0x0,_0x1de6a6['ApiResponse'])({'status':0xc8,'description':'Detailed\x20queue\x20debug\x20info'}),_0x4700c9('design:type',Function),_0x4700c9(_0x115667(0x2b1),[]),_0x4700c9('design:returntype',Promise)],_0x577644['prototype'],'debugQueue',null),_0x489f6c([(0x0,_0x1af148[_0x115667(0x437)])('queue/trigger'),(0x0,_0x1de6a6['ApiOperation'])({'summary':'Manually\x20trigger\x20job\x20picking'}),(0x0,_0x1de6a6['ApiResponse'])({'status':0xc8,'description':'Job\x20picking\x20triggered'}),_0x4700c9('design:type',Function),_0x4700c9('design:paramtypes',[]),_0x4700c9('design:returntype',Promise)],_0x577644['prototype'],_0x115667(0x1c9),null),_0x1291b1['WithdrawalController']=_0x577644=_0x489f6c([(0x0,_0x1de6a6[_0x115667(0x2ae)])('withdrawal'),(0x0,_0x1af148['Controller'])('api/withdrawal'),_0x4700c9('design:paramtypes',['function'==typeof(_0x46cb24=void 0x0!==_0xed998b['WithdrawalJobManagerService']&&_0xed998b['WithdrawalJobManagerService'])?_0x46cb24:Object])],_0x577644);},function(_0x507632,_0x359432,_0x5eefca){const _0x25fb82=a0_0x23a4;var _0xbfb9c7=this&&this[_0x25fb82(0x1f9)]||function(_0x1ca251,_0x5b23f3,_0x190cd6,_0x1afe9b){const _0x31c92c=_0x25fb82;var _0x364a17,_0x27aee3=arguments[_0x31c92c(0x1fa)],_0x4b50f8=_0x27aee3<0x3?_0x5b23f3:null===_0x1afe9b?_0x1afe9b=Object['getOwnPropertyDescriptor'](_0x5b23f3,_0x190cd6):_0x1afe9b;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x4b50f8=Reflect[_0x31c92c(0x2e3)](_0x1ca251,_0x5b23f3,_0x190cd6,_0x1afe9b);else{for(var _0x25256f=_0x1ca251['length']-0x1;_0x25256f>=0x0;_0x25256f--)(_0x364a17=_0x1ca251[_0x25256f])&&(_0x4b50f8=(_0x27aee3<0x3?_0x364a17(_0x4b50f8):_0x27aee3>0x3?_0x364a17(_0x5b23f3,_0x190cd6,_0x4b50f8):_0x364a17(_0x5b23f3,_0x190cd6))||_0x4b50f8);}return _0x27aee3>0x3&&_0x4b50f8&&Object['defineProperty'](_0x5b23f3,_0x190cd6,_0x4b50f8),_0x4b50f8;};Object['defineProperty'](_0x359432,'__esModule',{'value':!0x0}),_0x359432['HcBoxModule']=void 0x0;const _0x5e534f=_0x5eefca(0x2),_0x3ecb1a=_0x5eefca(0x48);let _0x477f77=class{};_0x359432['HcBoxModule']=_0x477f77,_0x359432['HcBoxModule']=_0x477f77=_0xbfb9c7([(0x0,_0x5e534f[_0x25fb82(0x352)])({'providers':[_0x3ecb1a['HcBoxService']],'exports':[_0x3ecb1a[_0x25fb82(0x168)]]})],_0x477f77);},function(_0x45672b,_0x5222ee,_0x57cadc){const _0x5142b8=a0_0x23a4;var _0x1a95db,_0x3d96b9=this&&this['__decorate']||function(_0x960670,_0x4ab820,_0x686c3b,_0x493437){const _0x14d107=a0_0x23a4;var _0x534817,_0x5785a5=arguments[_0x14d107(0x1fa)],_0x40871b=_0x5785a5<0x3?_0x4ab820:null===_0x493437?_0x493437=Object['getOwnPropertyDescriptor'](_0x4ab820,_0x686c3b):_0x493437;if(_0x14d107(0x34a)==typeof Reflect&&_0x14d107(0x24f)==typeof Reflect['decorate'])_0x40871b=Reflect['decorate'](_0x960670,_0x4ab820,_0x686c3b,_0x493437);else{for(var _0x14dc25=_0x960670['length']-0x1;_0x14dc25>=0x0;_0x14dc25--)(_0x534817=_0x960670[_0x14dc25])&&(_0x40871b=(_0x5785a5<0x3?_0x534817(_0x40871b):_0x5785a5>0x3?_0x534817(_0x4ab820,_0x686c3b,_0x40871b):_0x534817(_0x4ab820,_0x686c3b))||_0x40871b);}return _0x5785a5>0x3&&_0x40871b&&Object[_0x14d107(0x213)](_0x4ab820,_0x686c3b,_0x40871b),_0x40871b;},_0xa4d26a=this&&this['__metadata']||function(_0xaca6f6,_0x12c38d){const _0x561e33=a0_0x23a4;if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect[_0x561e33(0x216)](_0xaca6f6,_0x12c38d);},_0x1cb473=this&&this[_0x5142b8(0x165)]||function(_0x4118d3,_0x49d0af){return function(_0x303bf2,_0x10e32b){_0x49d0af(_0x303bf2,_0x10e32b,_0x4118d3);};};Object[_0x5142b8(0x213)](_0x5222ee,_0x5142b8(0x3f1),{'value':!0x0}),_0x5222ee[_0x5142b8(0x168)]=void 0x0;const _0x18c6f7=_0x57cadc(0x2),_0x456fcb=_0x57cadc(0xd),_0xadae27=_0x57cadc(0x13),_0x106aa7=_0x57cadc(0x18);let _0xd3195c=class{constructor(_0x119873){const _0x47a30a=_0x5142b8;this[_0x47a30a(0x292)]=_0x119873,this['logger']=new _0x18c6f7['Logger']('HcBoxService');}async['listDevices'](){const _0x1937f8=_0x5142b8;try{return await this['wsService']['listDevices']();}catch(_0x1a734d){throw this[_0x1937f8(0x25d)][_0x1937f8(0x382)](_0x1937f8(0x452)+_0x1a734d['message']),_0x1a734d;}}async['executeTransfer'](_0x9abcc8,_0x39ae66){const _0x19d351=_0x5142b8;try{this[_0x19d351(0x25d)]['log']('Executing\x20transfer\x20for\x20withdrawal\x20'+_0x9abcc8['withdrawalId']+_0x19d351(0x1e1)+_0x39ae66);const _0xf8a67f=this[_0x19d351(0x36f)](_0x9abcc8[_0x19d351(0x385)]);return _0xf8a67f&&(await this['wsService']['launchApp'](_0x39ae66,_0xf8a67f),await(0x0,_0x106aa7['sleep'])(0xbb8)),await this['wsService'][_0x19d351(0x238)](_0x39ae66,0.5,0.3,0.2),await(0x0,_0x106aa7['sleep'])(0x7d0),this['logger']['warn']('Transfer\x20execution\x20flow\x20needs\x20to\x20be\x20customized\x20per\x20bank\x20app\x20UI'),this['logger'][_0x19d351(0x230)](_0x19d351(0x1a0)+_0x9abcc8['withdrawalId']),!0x0;}catch(_0x3f4651){throw this['logger']['error']('Error\x20executing\x20transfer\x20for\x20withdrawal\x20'+_0x9abcc8['withdrawalId']+':\x20'+_0x3f4651[_0x19d351(0x1c8)]),_0x3f4651;}}['getBankBundleId'](_0x4fad4e){const _0x8646f5=_0x5142b8;return{'VIETCOMBANK':_0x8646f5(0x3fb),'TPBANK':_0x8646f5(0x220),'TECHCOMBANK':_0x8646f5(0x2fb)}[_0x4fad4e]||null;}async['click'](_0xd61ecf,_0x342c56,_0x32f228,_0x2aeab4=0.2){return this['wsService']['click'](_0xd61ecf,_0x342c56,_0x32f228,_0x2aeab4);}async[_0x5142b8(0x3a2)](_0x2cb53d,_0x173c8c){return this['wsService']['swipe'](_0x2cb53d,_0x173c8c);}async['screen'](_0x13ba6f,_0x3b7521){const _0x3fff29=_0x5142b8;return this[_0x3fff29(0x292)]['captureScreen'](_0x13ba6f,_0x3b7521);}async['home'](_0x4cc969){return this['wsService']['home'](_0x4cc969);}async[_0x5142b8(0x1ed)](_0x499c8e,_0x6f593b){return this['wsService']['inputNumpadNumber'](_0x499c8e,_0x6f593b);}[_0x5142b8(0x40d)](_0x54835d,_0x4fa6a9){return this['wsService']['inputText'](_0x54835d,_0x4fa6a9);}};_0x5222ee[_0x5142b8(0x168)]=_0xd3195c,_0x5222ee['HcBoxService']=_0xd3195c=_0x3d96b9([(0x0,_0x18c6f7[_0x5142b8(0x3ea)])(),_0x1cb473(0x0,(0x0,_0x18c6f7['Inject'])(_0x456fcb['WEBSOCKET_SERVICE'])),_0xa4d26a('design:paramtypes',[_0x5142b8(0x24f)==typeof(_0x1a95db=void 0x0!==_0xadae27['IWebSocketService']&&_0xadae27[_0x5142b8(0x26a)])?_0x1a95db:Object])],_0xd3195c);},function(_0x3d0909,_0x162142,_0x23f89f){const _0x3adb3c=a0_0x23a4;var _0x5710d1=this&&this['__decorate']||function(_0x27e086,_0x5ea8b7,_0x2f7edd,_0x538503){const _0x191015=a0_0x23a4;var _0x44e095,_0xe83edb=arguments[_0x191015(0x1fa)],_0x920d74=_0xe83edb<0x3?_0x5ea8b7:null===_0x538503?_0x538503=Object['getOwnPropertyDescriptor'](_0x5ea8b7,_0x2f7edd):_0x538503;if('object'==typeof Reflect&&_0x191015(0x24f)==typeof Reflect[_0x191015(0x2e3)])_0x920d74=Reflect['decorate'](_0x27e086,_0x5ea8b7,_0x2f7edd,_0x538503);else{for(var _0x1dce60=_0x27e086['length']-0x1;_0x1dce60>=0x0;_0x1dce60--)(_0x44e095=_0x27e086[_0x1dce60])&&(_0x920d74=(_0xe83edb<0x3?_0x44e095(_0x920d74):_0xe83edb>0x3?_0x44e095(_0x5ea8b7,_0x2f7edd,_0x920d74):_0x44e095(_0x5ea8b7,_0x2f7edd))||_0x920d74);}return _0xe83edb>0x3&&_0x920d74&&Object[_0x191015(0x213)](_0x5ea8b7,_0x2f7edd,_0x920d74),_0x920d74;};Object[_0x3adb3c(0x213)](_0x162142,'__esModule',{'value':!0x0}),_0x162142['DeviceModule']=void 0x0;const _0x1e1857=_0x23f89f(0x2),_0x411c23=_0x23f89f(0x4a),_0x1d81ee=_0x23f89f(0xe),_0x4d1492=_0x23f89f(0x14),_0x2f0659=_0x23f89f(0x47),_0x825a4=_0x23f89f(0xf),_0xfbcb9b=_0x23f89f(0x4c);let _0x4b92d4=class{};_0x162142['DeviceModule']=_0x4b92d4,_0x162142['DeviceModule']=_0x4b92d4=_0x5710d1([(0x0,_0x1e1857['Module'])({'imports':[_0x2f0659['HcBoxModule'],(0x0,_0x1e1857['forwardRef'])(()=>_0xfbcb9b['BankModule'])],'controllers':[_0x411c23['DeviceController']],'providers':[_0x1d81ee['DeviceService'],_0x4d1492['DeviceLockService'],_0x825a4[_0x3adb3c(0x253)]],'exports':[_0x1d81ee['DeviceService'],_0x4d1492['DeviceLockService']]})],_0x4b92d4);},function(_0x25a2a3,_0x258cc9,_0x490c94){const _0x3e82d8=a0_0x23a4;var _0xbbb08d,_0x36148b,_0x16fab3,_0x3a0168=this&&this[_0x3e82d8(0x1f9)]||function(_0x295140,_0x3142a5,_0x2f46db,_0x1a8078){const _0x9b776d=_0x3e82d8;var _0x12b4d5,_0x439a47=arguments[_0x9b776d(0x1fa)],_0x24fba0=_0x439a47<0x3?_0x3142a5:null===_0x1a8078?_0x1a8078=Object[_0x9b776d(0x26e)](_0x3142a5,_0x2f46db):_0x1a8078;if(_0x9b776d(0x34a)==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x24fba0=Reflect['decorate'](_0x295140,_0x3142a5,_0x2f46db,_0x1a8078);else{for(var _0x343d7c=_0x295140['length']-0x1;_0x343d7c>=0x0;_0x343d7c--)(_0x12b4d5=_0x295140[_0x343d7c])&&(_0x24fba0=(_0x439a47<0x3?_0x12b4d5(_0x24fba0):_0x439a47>0x3?_0x12b4d5(_0x3142a5,_0x2f46db,_0x24fba0):_0x12b4d5(_0x3142a5,_0x2f46db))||_0x24fba0);}return _0x439a47>0x3&&_0x24fba0&&Object['defineProperty'](_0x3142a5,_0x2f46db,_0x24fba0),_0x24fba0;},_0x1e1e4f=this&&this['__metadata']||function(_0x1f6410,_0x220b97){const _0x7f5575=_0x3e82d8;if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect[_0x7f5575(0x216)](_0x1f6410,_0x220b97);},_0x37af96=this&&this['__param']||function(_0x2fdeac,_0x10db98){return function(_0x32a6f1,_0x1213e6){_0x10db98(_0x32a6f1,_0x1213e6,_0x2fdeac);};};Object['defineProperty'](_0x258cc9,_0x3e82d8(0x3f1),{'value':!0x0}),_0x258cc9[_0x3e82d8(0x22d)]=void 0x0;const _0x52506d=_0x490c94(0x2),_0xb2eb0d=_0x490c94(0xe),_0x509967=_0x490c94(0x4b),_0x5cb1ae=_0x490c94(0xb),_0x21bc43=_0x490c94(0x11);let _0x3a3876=class{constructor(_0x161ee1,_0x54a912){const _0x435869=_0x3e82d8;this['deviceService']=_0x161ee1,this[_0x435869(0x2cc)]=_0x54a912,this['logger']=new _0x52506d['Logger'](_0x435869(0x22d));}async[_0x3e82d8(0x3a3)](){const _0x5cfd57=_0x3e82d8;return{'devices':await this['deviceService']['listDevices'](),'serviceStatus':await this[_0x5cfd57(0x17f)]['getServiceStatus'](),'banks':['ACB','HDBANK','PGBANK','TECHCOMBANK','TPBANK','VIETCOMBANK'],'boxType':_0x21bc43['config']['boxType']};}async['getDevices'](){return{'success':!0x0,'data':await this['deviceService']['listDevices']()};}async['getDeviceConfig'](_0x42241e){return{'success':!0x0,'data':await this['deviceService']['getDeviceConfigSafe'](_0x42241e)};}async['retryLogin'](_0x2ef10a){const _0x24264b=_0x3e82d8;try{this['logger']['log'](_0x24264b(0x3eb)+_0x2ef10a);const _0x740dee=await this[_0x24264b(0x17f)]['getDeviceConfig'](_0x2ef10a);if(!_0x740dee)throw new _0x52506d[(_0x24264b(0x264))]({'success':!0x1,'error':'Device\x20'+_0x2ef10a+_0x24264b(0x349)},_0x52506d['HttpStatus']['BAD_REQUEST']);if(!_0x740dee['bankCode']||''===_0x740dee[_0x24264b(0x385)]['trim']())throw new _0x52506d[(_0x24264b(0x264))]({'success':!0x1,'error':'Device\x20'+_0x2ef10a+'\x20does\x20not\x20have\x20bankCode\x20configured.\x20Please\x20configure\x20bankCode\x20first.'},_0x52506d['HttpStatus']['BAD_REQUEST']);const _0x5e15cc=_0x740dee['bankCode'][_0x24264b(0x3e0)]();return await this[_0x24264b(0x2cc)][_0x24264b(0x388)](_0x5e15cc,_0x2ef10a),{'success':!0x0,'message':'Successfully\x20logged\x20in\x20to\x20'+_0x5e15cc+'\x20on\x20device\x20'+_0x2ef10a};}catch(_0x25a91d){if(_0x25a91d instanceof _0x52506d['HttpException'])throw _0x25a91d;throw this['logger']['error']('Error\x20retrying\x20login\x20for\x20device\x20'+_0x2ef10a+':\x20'+_0x25a91d['message'],_0x25a91d[_0x24264b(0x384)]),new _0x52506d['HttpException']({'success':!0x1,'error':_0x25a91d['message']||'Failed\x20to\x20retry\x20login'},_0x52506d[_0x24264b(0x27c)][_0x24264b(0x2c8)]);}}async['updateDeviceConfig'](_0x11fbe9,_0x5d2c16){const _0x28de5a=_0x3e82d8;try{this['logger'][_0x28de5a(0x230)]('Updating\x20device\x20config\x20for\x20'+_0x11fbe9+':\x20'+JSON['stringify'](_0x5d2c16));const _0x26cd31=await this['deviceService']['getDeviceConfig'](_0x11fbe9);if(_0x28de5a(0x1db)===(void 0x0!==_0x5d2c16['status']?_0x5d2c16[_0x28de5a(0x455)]:_0x26cd31?.['status']||_0x28de5a(0x3c9))){const _0x480be0=[],_0x400ad9=void 0x0!==_0x5d2c16[_0x28de5a(0x385)]?_0x5d2c16['bankCode']:_0x26cd31?.['bankCode'];_0x400ad9&&''!==_0x400ad9['trim']()||_0x480be0[_0x28de5a(0x281)]('Bank\x20Code\x20l√†\x20b·∫Øt\x20bu·ªôc\x20khi\x20status\x20l√†\x20active');const _0x446491=void 0x0!==_0x5d2c16['availableAmount']?_0x5d2c16[_0x28de5a(0x453)]:_0x26cd31?.['availableAmount'];(null==_0x446491||_0x446491<0x0)&&_0x480be0[_0x28de5a(0x281)]('Available\x20Amount\x20l√†\x20b·∫Øt\x20bu·ªôc\x20v√†\x20ph·∫£i\x20>=\x200\x20khi\x20status\x20l√†\x20active');const _0x542303=void 0x0!==_0x5d2c16['password']?_0x5d2c16['password']:_0x26cd31?.[_0x28de5a(0x247)];_0x542303&&''!==_0x542303['trim']()||_0x480be0['push']('Password\x20l√†\x20b·∫Øt\x20bu·ªôc\x20khi\x20status\x20l√†\x20active');const _0x25d91b=void 0x0!==_0x5d2c16['smartOTP']?_0x5d2c16['smartOTP']:_0x26cd31?.[_0x28de5a(0x374)];if(_0x25d91b&&''!==_0x25d91b[_0x28de5a(0x450)]()||_0x480be0['push']('Smart\x20OTP\x20l√†\x20b·∫Øt\x20bu·ªôc\x20khi\x20status\x20l√†\x20active'),_0x480be0[_0x28de5a(0x1fa)]>0x0)throw new _0x52506d['HttpException']({'success':!0x1,'error':_0x480be0['join'](',\x20')},_0x52506d['HttpStatus']['BAD_REQUEST']);}return{'success':!0x0,'data':await this[_0x28de5a(0x17f)][_0x28de5a(0x3db)](_0x11fbe9,_0x5d2c16)};}catch(_0x1a7caf){if(_0x1a7caf instanceof _0x52506d['HttpException'])throw _0x1a7caf;throw this['logger']['error']('Error\x20updating\x20device\x20config\x20for\x20'+_0x11fbe9+':\x20'+_0x1a7caf['message'],_0x1a7caf[_0x28de5a(0x384)]),new _0x52506d[(_0x28de5a(0x264))]({'success':!0x1,'error':_0x1a7caf['message']||'Failed\x20to\x20update\x20device\x20config'},_0x52506d['HttpStatus']['INTERNAL_SERVER_ERROR']);}}async[_0x3e82d8(0x240)](){const _0x442bda=_0x3e82d8;return{'success':!0x0,'data':{'status':await this['deviceService'][_0x442bda(0x240)]()}};}async['startService'](){const _0x9136cc=_0x3e82d8;return await this['deviceService'][_0x9136cc(0x3d0)]();}async['stopService'](){return await this['deviceService']['setServiceStatus']('inactive'),{'success':!0x0,'message':'Service\x20stopped\x20successfully'};}async['deleteDeviceConfig'](_0x272f5b){const _0x156efa=_0x3e82d8;return await this[_0x156efa(0x17f)][_0x156efa(0x23b)](_0x272f5b),{'success':!0x0,'message':_0x156efa(0x1cd)};}};_0x258cc9[_0x3e82d8(0x22d)]=_0x3a3876,_0x3a0168([(0x0,_0x52506d['Get'])(),(0x0,_0x52506d['Render'])(_0x3e82d8(0x3f2)),_0x1e1e4f('design:type',Function),_0x1e1e4f(_0x3e82d8(0x2b1),[]),_0x1e1e4f('design:returntype',Promise)],_0x3a3876[_0x3e82d8(0x18a)],_0x3e82d8(0x3a3),null),_0x3a0168([(0x0,_0x52506d['Get'])(_0x3e82d8(0x365)),_0x1e1e4f(_0x3e82d8(0x35d),Function),_0x1e1e4f('design:paramtypes',[]),_0x1e1e4f(_0x3e82d8(0x194),Promise)],_0x3a3876['prototype'],'getDevices',null),_0x3a0168([(0x0,_0x52506d[_0x3e82d8(0x193)])('api/devices/:deviceId/config'),_0x37af96(0x0,(0x0,_0x52506d[_0x3e82d8(0x2bf)])(_0x3e82d8(0x3cb))),_0x1e1e4f('design:type',Function),_0x1e1e4f('design:paramtypes',[String]),_0x1e1e4f('design:returntype',Promise)],_0x3a3876['prototype'],_0x3e82d8(0x187),null),_0x3a0168([(0x0,_0x52506d['Post'])('api/devices/:deviceId/retryLogin'),_0x37af96(0x0,(0x0,_0x52506d['Param'])('deviceId')),_0x1e1e4f(_0x3e82d8(0x35d),Function),_0x1e1e4f('design:paramtypes',[String]),_0x1e1e4f('design:returntype',Promise)],_0x3a3876['prototype'],'retryLogin',null),_0x3a0168([(0x0,_0x52506d['Put'])('api/devices/:deviceId/config'),_0x37af96(0x0,(0x0,_0x52506d['Param'])('deviceId')),_0x37af96(0x1,(0x0,_0x52506d[_0x3e82d8(0x43d)])()),_0x1e1e4f('design:type',Function),_0x1e1e4f('design:paramtypes',[String,'function'==typeof(_0x16fab3=void 0x0!==_0x509967[_0x3e82d8(0x204)]&&_0x509967[_0x3e82d8(0x204)])?_0x16fab3:Object]),_0x1e1e4f(_0x3e82d8(0x194),Promise)],_0x3a3876['prototype'],'updateDeviceConfig',null),_0x3a0168([(0x0,_0x52506d['Get'])('api/service/status'),_0x1e1e4f(_0x3e82d8(0x35d),Function),_0x1e1e4f('design:paramtypes',[]),_0x1e1e4f(_0x3e82d8(0x194),Promise)],_0x3a3876['prototype'],'getServiceStatus',null),_0x3a0168([(0x0,_0x52506d[_0x3e82d8(0x437)])('api/service/start'),_0x1e1e4f('design:type',Function),_0x1e1e4f('design:paramtypes',[]),_0x1e1e4f('design:returntype',Promise)],_0x3a3876['prototype'],'startService',null),_0x3a0168([(0x0,_0x52506d['Post'])('api/service/stop'),_0x1e1e4f('design:type',Function),_0x1e1e4f(_0x3e82d8(0x2b1),[]),_0x1e1e4f('design:returntype',Promise)],_0x3a3876['prototype'],_0x3e82d8(0x355),null),_0x3a0168([(0x0,_0x52506d['Delete'])(_0x3e82d8(0x3d2)),_0x37af96(0x0,(0x0,_0x52506d['Param'])(_0x3e82d8(0x3cb))),_0x1e1e4f(_0x3e82d8(0x35d),Function),_0x1e1e4f(_0x3e82d8(0x2b1),[String]),_0x1e1e4f('design:returntype',Promise)],_0x3a3876['prototype'],_0x3e82d8(0x23b),null),_0x258cc9['DeviceController']=_0x3a3876=_0x3a0168([(0x0,_0x52506d[_0x3e82d8(0x1e0)])(),_0x1e1e4f('design:paramtypes',[_0x3e82d8(0x24f)==typeof(_0xbbb08d=void 0x0!==_0xb2eb0d['DeviceService']&&_0xb2eb0d['DeviceService'])?_0xbbb08d:Object,'function'==typeof(_0x36148b=void 0x0!==_0x5cb1ae[_0x3e82d8(0x2b3)]&&_0x5cb1ae[_0x3e82d8(0x2b3)])?_0x36148b:Object])],_0x3a3876);},function(_0x3edd79,_0x37928b,_0x3f007a){const _0x5638e5=a0_0x23a4;var _0x1c7cf6=this&&this['__decorate']||function(_0x18f2f6,_0x8c675d,_0x509725,_0x45df89){const _0x3e5383=a0_0x23a4;var _0x43ea76,_0x240b4a=arguments[_0x3e5383(0x1fa)],_0x29d89a=_0x240b4a<0x3?_0x8c675d:null===_0x45df89?_0x45df89=Object[_0x3e5383(0x26e)](_0x8c675d,_0x509725):_0x45df89;if(_0x3e5383(0x34a)==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x29d89a=Reflect['decorate'](_0x18f2f6,_0x8c675d,_0x509725,_0x45df89);else{for(var _0xa41642=_0x18f2f6['length']-0x1;_0xa41642>=0x0;_0xa41642--)(_0x43ea76=_0x18f2f6[_0xa41642])&&(_0x29d89a=(_0x240b4a<0x3?_0x43ea76(_0x29d89a):_0x240b4a>0x3?_0x43ea76(_0x8c675d,_0x509725,_0x29d89a):_0x43ea76(_0x8c675d,_0x509725))||_0x29d89a);}return _0x240b4a>0x3&&_0x29d89a&&Object[_0x3e5383(0x213)](_0x8c675d,_0x509725,_0x29d89a),_0x29d89a;},_0x4ad331=this&&this['__metadata']||function(_0x4e2ba7,_0x47de9b){const _0x6f2a00=a0_0x23a4;if(_0x6f2a00(0x34a)==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0x4e2ba7,_0x47de9b);};Object['defineProperty'](_0x37928b,'__esModule',{'value':!0x0}),_0x37928b['UpdateDeviceConfigDto']=void 0x0;const _0x3e861f=_0x3f007a(0x3b);class _0x152df8{}_0x37928b[_0x5638e5(0x204)]=_0x152df8,_0x1c7cf6([(0x0,_0x3e861f[_0x5638e5(0x42b)])(_0xd0f189=>_0x5638e5(0x1db)===_0xd0f189['status']),(0x0,_0x3e861f['IsNotEmpty'])({'message':'Bank\x20Code\x20is\x20required\x20when\x20status\x20is\x20active'}),(0x0,_0x3e861f['IsString'])(),(0x0,_0x3e861f['IsOptional'])(),_0x4ad331('design:type',String)],_0x152df8['prototype'],_0x5638e5(0x385),void 0x0),_0x1c7cf6([(0x0,_0x3e861f['ValidateIf'])(_0x4746f3=>'active'===_0x4746f3['status']),(0x0,_0x3e861f[_0x5638e5(0x1c4)])({'message':'Available\x20Amount\x20is\x20required\x20when\x20status\x20is\x20active'}),(0x0,_0x3e861f[_0x5638e5(0x368)])(),(0x0,_0x3e861f['Min'])(0x0,{'message':'Available\x20Amount\x20must\x20be\x20greater\x20than\x20or\x20equal\x20to\x200'}),(0x0,_0x3e861f['IsOptional'])(),_0x4ad331('design:type',Number)],_0x152df8['prototype'],_0x5638e5(0x453),void 0x0),_0x1c7cf6([(0x0,_0x3e861f['IsOptional'])(),(0x0,_0x3e861f['IsString'])(),(0x0,_0x3e861f['IsIn'])(['active','deactive']),_0x4ad331('design:type',String)],_0x152df8[_0x5638e5(0x18a)],'status',void 0x0),_0x1c7cf6([(0x0,_0x3e861f['ValidateIf'])(_0x348e7a=>'active'===_0x348e7a[_0x5638e5(0x455)]),(0x0,_0x3e861f['IsNotEmpty'])({'message':'Password\x20is\x20required\x20when\x20status\x20is\x20active'}),(0x0,_0x3e861f['IsString'])(),(0x0,_0x3e861f['IsOptional'])(),_0x4ad331('design:type',String)],_0x152df8['prototype'],'password',void 0x0),_0x1c7cf6([(0x0,_0x3e861f['ValidateIf'])(_0x2f0f46=>'active'===_0x2f0f46['status']),(0x0,_0x3e861f['IsNotEmpty'])({'message':'Smart\x20OTP\x20is\x20required\x20when\x20status\x20is\x20active'}),(0x0,_0x3e861f['IsString'])(),(0x0,_0x3e861f[_0x5638e5(0x197)])(),_0x4ad331('design:type',String)],_0x152df8['prototype'],'smartOTP',void 0x0),_0x1c7cf6([(0x0,_0x3e861f[_0x5638e5(0x42b)])(_0xf9a48f=>'active'===_0xf9a48f['status']),(0x0,_0x3e861f['IsNotEmpty'])({'message':'Account\x20No\x20is\x20required\x20when\x20status\x20is\x20active'}),(0x0,_0x3e861f['IsString'])(),(0x0,_0x3e861f['IsOptional'])(),_0x4ad331(_0x5638e5(0x35d),String)],_0x152df8[_0x5638e5(0x18a)],_0x5638e5(0x1d6),void 0x0),_0x1c7cf6([(0x0,_0x3e861f['ValidateIf'])(_0x41e8a6=>'active'===_0x41e8a6['status']),(0x0,_0x3e861f[_0x5638e5(0x1c4)])({'message':'Account\x20Name\x20is\x20required\x20when\x20status\x20is\x20active'}),(0x0,_0x3e861f['IsString'])(),(0x0,_0x3e861f[_0x5638e5(0x197)])(),_0x4ad331('design:type',String)],_0x152df8['prototype'],'accountName',void 0x0);},function(_0x7077eb,_0x5ef6b7,_0x48a55c){const _0x199928=a0_0x23a4;var _0x1211a0=this&&this['__decorate']||function(_0x4e6f45,_0x15372a,_0x2e39d2,_0x321e58){const _0x2f76da=a0_0x23a4;var _0x97591d,_0x166d3a=arguments[_0x2f76da(0x1fa)],_0x57c311=_0x166d3a<0x3?_0x15372a:null===_0x321e58?_0x321e58=Object['getOwnPropertyDescriptor'](_0x15372a,_0x2e39d2):_0x321e58;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x2f76da(0x2e3)])_0x57c311=Reflect[_0x2f76da(0x2e3)](_0x4e6f45,_0x15372a,_0x2e39d2,_0x321e58);else{for(var _0x5d6fb0=_0x4e6f45[_0x2f76da(0x1fa)]-0x1;_0x5d6fb0>=0x0;_0x5d6fb0--)(_0x97591d=_0x4e6f45[_0x5d6fb0])&&(_0x57c311=(_0x166d3a<0x3?_0x97591d(_0x57c311):_0x166d3a>0x3?_0x97591d(_0x15372a,_0x2e39d2,_0x57c311):_0x97591d(_0x15372a,_0x2e39d2))||_0x57c311);}return _0x166d3a>0x3&&_0x57c311&&Object['defineProperty'](_0x15372a,_0x2e39d2,_0x57c311),_0x57c311;};Object[_0x199928(0x213)](_0x5ef6b7,'__esModule',{'value':!0x0}),_0x5ef6b7[_0x199928(0x20b)]=void 0x0;const _0x209f4d=_0x48a55c(0x2),_0x4eed85=_0x48a55c(0xb),_0x5a3ae1=_0x48a55c(0xc),_0x298952=_0x48a55c(0x28),_0x4d8052=_0x48a55c(0x2f),_0x413a32=_0x48a55c(0x4d),_0x408a9f=_0x48a55c(0x47),_0x3c6cbe=_0x48a55c(0x49),_0x266e42=_0x48a55c(0x4e),_0x496937=_0x48a55c(0x34),_0x296b74=_0x48a55c(0x52),_0x4ad198=_0x48a55c(0xf),_0x19e4b9=_0x48a55c(0x53),_0x17286b=_0x48a55c(0x54),_0x4e2a57=_0x48a55c(0x32);let _0x282061=class{};_0x5ef6b7['BankModule']=_0x282061,_0x5ef6b7['BankModule']=_0x282061=_0x1211a0([(0x0,_0x209f4d[_0x199928(0x352)])({'imports':[_0x408a9f[_0x199928(0x26b)],(0x0,_0x209f4d[_0x199928(0x39a)])(()=>_0x3c6cbe['DeviceModule']),_0x266e42['WebSocketModule'],_0x19e4b9[_0x199928(0x248)],_0x17286b[_0x199928(0x2f2)]],'controllers':[_0x413a32[_0x199928(0x2f0)]],'providers':[_0x4eed85['BankService'],_0x5a3ae1['AcbService'],_0x298952['PgService'],_0x4d8052['HdBankService'],_0x4e2a57['VietcombankService'],_0x496937[_0x199928(0x37c)],_0x296b74[_0x199928(0x273)],_0x4ad198['RedisService']],'exports':[_0x4eed85[_0x199928(0x2b3)]]})],_0x282061);},function(_0x4dc7f3,_0x41138a,_0x1f9beb){const _0x2a32dd=a0_0x23a4;var _0x5c0d1f,_0x37c02f,_0xdf46f8,_0x544061,_0x43bb9f=this&&this[_0x2a32dd(0x1f9)]||function(_0x545af6,_0x437f56,_0x464b79,_0xce25c){const _0x194472=_0x2a32dd;var _0x2948c1,_0x2aa85e=arguments['length'],_0x24b4d9=_0x2aa85e<0x3?_0x437f56:null===_0xce25c?_0xce25c=Object[_0x194472(0x26e)](_0x437f56,_0x464b79):_0xce25c;if(_0x194472(0x34a)==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x24b4d9=Reflect[_0x194472(0x2e3)](_0x545af6,_0x437f56,_0x464b79,_0xce25c);else{for(var _0x59a72f=_0x545af6['length']-0x1;_0x59a72f>=0x0;_0x59a72f--)(_0x2948c1=_0x545af6[_0x59a72f])&&(_0x24b4d9=(_0x2aa85e<0x3?_0x2948c1(_0x24b4d9):_0x2aa85e>0x3?_0x2948c1(_0x437f56,_0x464b79,_0x24b4d9):_0x2948c1(_0x437f56,_0x464b79))||_0x24b4d9);}return _0x2aa85e>0x3&&_0x24b4d9&&Object['defineProperty'](_0x437f56,_0x464b79,_0x24b4d9),_0x24b4d9;},_0x4a7c73=this&&this['__metadata']||function(_0x35bcfd,_0x267f3f){const _0x14eaf2=_0x2a32dd;if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect[_0x14eaf2(0x216)](_0x35bcfd,_0x267f3f);},_0x592544=this&&this['__param']||function(_0x496352,_0x54e078){return function(_0x229a4f,_0x508dda){_0x54e078(_0x229a4f,_0x508dda,_0x496352);};};Object['defineProperty'](_0x41138a,'__esModule',{'value':!0x0}),_0x41138a[_0x2a32dd(0x2f0)]=void 0x0;const _0x4535a6=_0x1f9beb(0x2),_0x12da03=_0x1f9beb(0x3),_0x506765=_0x1f9beb(0xb),_0xf3f22f=_0x1f9beb(0x11),_0xbeed67=_0x1f9beb(0x13),_0x234b1b=_0x1f9beb(0xd),_0x4da3cc=_0x1f9beb(0x1a),_0x1c5919=_0x1f9beb(0x1e),_0x2bd8c4=_0x1f9beb(0x1b),_0x2c873e=_0x1f9beb(0x20);let _0x4b4407=class{constructor(_0x1afaf7,_0x691f8e,_0x40b176,_0x15152c){this['bankService']=_0x1afaf7,this['wsService']=_0x691f8e,this['imagePreprocessingService']=_0x40b176,this['ocrService']=_0x15152c,this['logger']=new _0x4535a6['Logger']('BankController');}['getBankService'](_0x50c1ce){const _0x4a8cd5=_0x2a32dd,_0x4297a0=this['bankService'][_0x4a8cd5(0x1c3)](_0x50c1ce);if(!_0x4297a0)throw new _0x4535a6['HttpException']({'success':!0x1,'error':'Bank\x20service\x20not\x20found\x20for\x20bank\x20code:\x20'+_0x50c1ce+'.\x20Supported\x20banks:\x20'+this['bankService']['getSupportedBanks']()[_0x4a8cd5(0x25a)](',\x20')},_0x4535a6['HttpStatus']['BAD_REQUEST']);return _0x4297a0;}async['getDevices'](_0x514617){const _0x17a7a1=_0x2a32dd;try{return{'success':!0x0,'data':await this['wsService'][_0x17a7a1(0x3aa)]()};}catch(_0x5584b1){return this['logger'][_0x17a7a1(0x382)]('Error\x20getting\x20devices:\x20'+_0x5584b1['message']),{'success':!0x1,'error':_0x5584b1['message']};}}async['testLaunchApp'](_0x5f4c51,_0x36ab21){const _0xdbf11f=_0x2a32dd;try{const _0x55fdf6=this['getBankService'](_0x5f4c51);return this[_0xdbf11f(0x25d)]['log']('Testing\x20'+_0x5f4c51+'\x20app\x20launch\x20on\x20device:\x20'+_0x36ab21),await _0x55fdf6[_0xdbf11f(0x44b)](_0x36ab21),{'success':!0x0,'message':_0x5f4c51+'\x20app\x20launched\x20successfully\x20on\x20device\x20'+_0x36ab21};}catch(_0x1fb91f){return this['logger']['error'](_0xdbf11f(0x2a6)+_0x5f4c51+'\x20app\x20launch:\x20'+_0x1fb91f['message']),{'success':!0x1,'error':_0x1fb91f['message']};}}async['testCaptureScreen'](_0x56e37b,_0x54d61a,_0x36d62f,_0x41406e){const _0x294c08=_0x2a32dd;try{this['logger']['log']('Testing\x20screen\x20capture\x20on\x20device:\x20'+_0x54d61a);const _0x4b7b32=_0x41406e?parseFloat(_0x41406e):0.5,_0x233dc5=_0x36d62f||'test-screen-capture-'+Date['now'](),_0x3a9330=await this['wsService']['captureScreen'](_0x54d61a,{'quality':_0x4b7b32,'folderPath':'C:/boxscreen/'+_0x233dc5+'.png'});return{'success':!0x0,'message':_0x294c08(0x34c)+_0x54d61a,'data':{'base64Image':_0x3a9330,'imageLength':_0x3a9330?.['length']??0x0}};}catch(_0x4b0eec){return this['logger']['error']('Error\x20testing\x20screen\x20capture:\x20'+_0x4b0eec['message']),{'success':!0x1,'error':_0x4b0eec[_0x294c08(0x1c8)]};}}async[_0x2a32dd(0x2ce)](_0x46c7ff,_0x310730,_0x3d6502,_0x3a6406){const _0x25c40f=_0x2a32dd;try{const _0x357531=parseFloat(_0x3d6502),_0x4d24d6=parseFloat(_0x3a6406);return isNaN(_0x357531)||isNaN(_0x4d24d6)?{'success':!0x1,'error':_0x25c40f(0x3c7),'example':'/api/bank/'+_0x46c7ff+'/test/click/{deviceId}?x=0.5&y=0.55'}:(this['logger'][_0x25c40f(0x230)]('Testing\x20click\x20at\x20coordinates\x20('+_0x357531+',\x20'+_0x4d24d6+')\x20on\x20device:\x20'+_0x310730),await this['wsService']['click'](_0x310730,_0x357531,_0x4d24d6),{'success':!0x0,'message':'Click\x20completed\x20successfully\x20at\x20coordinates\x20('+_0x357531+',\x20'+_0x4d24d6+')\x20on\x20device\x20'+_0x310730,'coordinates':{'x':_0x357531,'y':_0x4d24d6}});}catch(_0x29357d){return this['logger']['error']('Error\x20testing\x20click\x20at\x20coordinates:\x20'+_0x29357d[_0x25c40f(0x1c8)]),{'success':!0x1,'error':_0x29357d['message']};}}async['testSwipe'](_0x41c857,_0x203f2b,_0x19b1e1,_0xbe7052,_0x1d0b33,_0x1efd5c,_0xef2c8a,_0x1fc518){const _0x2702b4=_0x2a32dd;try{const _0x4dec94='PANDA'===_0xf3f22f['config']['boxType'],_0x38a0d3='HC'===_0xf3f22f['config'][_0x2702b4(0x1d7)];if(_0x4dec94){if(!_0x1d0b33)return{'success':!0x1,'error':_0x2702b4(0x3b1),'example':'/api/bank/'+_0x41c857+_0x2702b4(0x28d)};if(!['0','1','2','4','5','6','7','8','9','10']['includes'](_0x1d0b33))return{'success':!0x1,'error':'Invalid\x20type.\x20Type\x20must\x20be\x20one\x20of:\x200\x20(Êåâ‰∏ã/press),\x201\x20(Êä¨Ëµ∑/lift),\x202\x20(ÁßªÂä®/move),\x204\x20(ÊªöËΩÆÂêë‰∏ä/scroll\x20up),\x205\x20(ÊªöËΩÆÂêë‰∏ã/scroll\x20down),\x206\x20(‰∏äÊªë/swipe\x20up),\x207\x20(‰∏ãÊªë/swipe\x20down),\x208\x20(Â∑¶Êªë/swipe\x20left),\x209\x20(Âè≥Êªë/swipe\x20right),\x2010\x20(ÁÇπÂáª/click)','example':'/api/bank/'+_0x41c857+_0x2702b4(0x28d)};if(!(['4','5','6','7','8','9'][_0x2702b4(0x31c)](_0x1d0b33)||_0x19b1e1&&_0xbe7052))return{'success':!0x1,'error':'For\x20Panda\x20type\x20'+_0x1d0b33+':\x20x\x20and\x20y\x20are\x20required','example':'/api/bank/'+_0x41c857+'/test/swipe/{deviceId}?x=50&y=30&type='+_0x1d0b33};const _0x16bc1a={'type':_0x1d0b33};if(_0x19b1e1&&_0xbe7052){const _0x5ab3de=parseFloat(_0x19b1e1),_0x20848a=parseFloat(_0xbe7052);if(isNaN(_0x5ab3de)||isNaN(_0x20848a))return{'success':!0x1,'error':'Invalid\x20coordinates.\x20x\x20and\x20y\x20must\x20be\x20numbers\x20between\x200\x20and\x20100\x20for\x20Panda','example':'/api/bank/'+_0x41c857+'/test/swipe/{deviceId}?x=50&y=30&type='+_0x1d0b33};if(_0x5ab3de<0x0||_0x5ab3de>0x64||_0x20848a<0x0||_0x20848a>0x64)return{'success':!0x1,'error':_0x2702b4(0x1ca),'example':'/api/bank/'+_0x41c857+_0x2702b4(0x29b)+_0x1d0b33};_0x16bc1a['x']=_0x5ab3de['toString'](),_0x16bc1a['y']=_0x20848a['toString']();}return this['logger']['log']('Testing\x20Panda\x20swipe\x20on\x20device:\x20'+_0x203f2b+_0x2702b4(0x246)+_0x1d0b33+(_0x19b1e1&&_0xbe7052?',\x20x='+_0x19b1e1+',\x20y='+_0xbe7052:_0x2702b4(0x3fd))),await this['wsService'][_0x2702b4(0x3a2)](_0x203f2b,_0x16bc1a),{'success':!0x0,'message':'Panda\x20swipe\x20completed\x20successfully\x20on\x20device\x20'+_0x203f2b,'coordinates':{'type':_0x1d0b33,..._0x19b1e1&&_0xbe7052?{'x':_0x19b1e1,'y':_0xbe7052}:{}}};}if(_0x38a0d3){if(!(_0x19b1e1&&_0xbe7052&&_0x1efd5c&&_0xef2c8a))return{'success':!0x1,'error':_0x2702b4(0x22a),'example':'/api/bank/'+_0x41c857+'/test/swipe/{deviceId}?x=0.2&y=0.5&endX=0.8&endY=0.5&duration=0.3'};const _0x45cb81=parseFloat(_0x19b1e1),_0x57892f=parseFloat(_0xbe7052),_0x547f4d=parseFloat(_0x1efd5c),_0x295f29=parseFloat(_0xef2c8a),_0x52b982=_0x1fc518?parseFloat(_0x1fc518):0.2;return isNaN(_0x45cb81)||isNaN(_0x57892f)||isNaN(_0x547f4d)||isNaN(_0x295f29)?{'success':!0x1,'error':'Invalid\x20coordinates.\x20x,\x20y,\x20endX,\x20and\x20endY\x20must\x20be\x20numbers\x20between\x200\x20and\x201\x20for\x20HC','example':_0x2702b4(0x439)+_0x41c857+'/test/swipe/{deviceId}?x=0.2&y=0.5&endX=0.8&endY=0.5&duration=0.3'}:_0x45cb81<0x0||_0x45cb81>0x1||_0x57892f<0x0||_0x57892f>0x1||_0x547f4d<0x0||_0x547f4d>0x1||_0x295f29<0x0||_0x295f29>0x1?{'success':!0x1,'error':'Invalid\x20coordinates.\x20x,\x20y,\x20endX,\x20and\x20endY\x20must\x20be\x20between\x200\x20and\x201\x20for\x20HC','example':_0x2702b4(0x439)+_0x41c857+'/test/swipe/{deviceId}?x=0.2&y=0.5&endX=0.8&endY=0.5&duration=0.3'}:(this['logger']['log'](_0x2702b4(0x3d6)+_0x45cb81+',\x20'+_0x57892f+')\x20to\x20('+_0x547f4d+',\x20'+_0x295f29+_0x2702b4(0x3c4)+_0x203f2b),await this['wsService'][_0x2702b4(0x3a2)](_0x203f2b,{'x':_0x45cb81,'y':_0x57892f,'endX':_0x547f4d,'endY':_0x295f29,'duration':_0x52b982}),{'success':!0x0,'message':'HC\x20swipe\x20completed\x20successfully\x20from\x20('+_0x45cb81+',\x20'+_0x57892f+')\x20to\x20('+_0x547f4d+',\x20'+_0x295f29+')\x20on\x20device\x20'+_0x203f2b,'coordinates':{'start':{'x':_0x45cb81,'y':_0x57892f},'end':{'x':_0x547f4d,'y':_0x295f29},'duration':_0x52b982}});}return{'success':!0x1,'error':_0x2702b4(0x42e)+_0xf3f22f['config'][_0x2702b4(0x1d7)]+_0x2702b4(0x447)};}catch(_0x29a00d){return this[_0x2702b4(0x25d)]['error'](_0x2702b4(0x185)+_0x29a00d['message']),{'success':!0x1,'error':_0x29a00d[_0x2702b4(0x1c8)]};}}async['testInputNumpadNumber'](_0x37be2c,_0x35a743,_0x46e6ae){const _0x5b0d22=_0x2a32dd;try{return _0x46e6ae&&0x0!==_0x46e6ae[_0x5b0d22(0x450)]()['length']?/^\d+$/['test'](_0x46e6ae)?(this['logger'][_0x5b0d22(0x230)](_0x5b0d22(0x383)+_0x46e6ae+'\x22\x20on\x20device:\x20'+_0x35a743),await this[_0x5b0d22(0x292)]['inputNumpadNumber'](_0x35a743,_0x46e6ae),{'success':!0x0,'message':'Numpad\x20number\x20input\x20completed\x20successfully\x20on\x20device\x20'+_0x35a743,'data':{'number':_0x46e6ae,'digits':_0x46e6ae['split']('')['map'](_0x13a1fd=>parseInt(_0x13a1fd))}}):{'success':!0x1,'error':'Number\x20must\x20contain\x20only\x20digits\x20(0-9)','example':_0x5b0d22(0x439)+_0x37be2c+'/test/input-numpad/{deviceId}?number=123456'}:{'success':!0x1,'error':'Number\x20is\x20required\x20and\x20cannot\x20be\x20empty','example':'/api/bank/'+_0x37be2c+_0x5b0d22(0x361)};}catch(_0x293e3a){return this['logger']['error']('Error\x20testing\x20numpad\x20number\x20input:\x20'+_0x293e3a['message']),{'success':!0x1,'error':_0x293e3a['message']};}}async['testInputText'](_0x29d90f,_0x4536d0,_0x3dd2dc){const _0x38b5bb=_0x2a32dd;try{return _0x3dd2dc&&0x0!==_0x3dd2dc['trim']()['length']?(this['logger']['log']('Testing\x20text\x20input\x20\x22'+_0x3dd2dc+'\x22\x20on\x20device:\x20'+_0x4536d0),await this['wsService']['inputText'](_0x4536d0,_0x3dd2dc),{'success':!0x0,'message':'Text\x20input\x20completed\x20successfully\x20on\x20device\x20'+_0x4536d0}):{'success':!0x1,'error':_0x38b5bb(0x33c),'example':'/api/bank/'+_0x29d90f+'/test/input-text/{deviceId}?text=abc123'};}catch(_0x3deb10){return this['logger']['error']('Error\x20testing\x20text\x20input:\x20'+_0x3deb10['message']),{'success':!0x1,'error':_0x3deb10['message']};}}async[_0x2a32dd(0x43a)](_0x11312e,_0x527bbb){const _0x357ccb=_0x2a32dd;try{return this['logger']['log'](_0x357ccb(0x17d)+_0x527bbb),await this['wsService']['pressReturnKey'](_0x527bbb),{'success':!0x0,'message':'Return\x20key\x20pressed\x20successfully\x20on\x20device\x20'+_0x527bbb,'note':'This\x20key\x20can\x20dismiss\x20keyboard\x20or\x20submit/enter\x20depending\x20on\x20context'};}catch(_0x2141a9){return this[_0x357ccb(0x25d)]['error']('Error\x20testing\x20press\x20return:\x20'+_0x2141a9[_0x357ccb(0x1c8)]),{'success':!0x1,'error':_0x2141a9['message']};}}async['testRoi'](_0x373b14,_0x27c6a3,_0x1153c2,_0x3c7312,_0x545c81,_0x568a3f){const _0xb22080=_0x2a32dd,_0x53d79f='C:/testroi';try{await(0x0,_0x4da3cc['rm'])(_0x53d79f,{'recursive':!0x0,'force':!0x0}),this['logger']['log'](_0xb22080(0x340)+_0x53d79f);}catch(_0x3a167c){this['logger']['debug'](_0xb22080(0x1dc)+_0x3a167c[_0xb22080(0x1c8)]);}await(0x0,_0x4da3cc['mkdir'])(_0x53d79f,{'recursive':!0x0}),await this['wsService']['captureScreen'](_0x27c6a3,{'folderPath':_0x53d79f});const _0x22c795=await this['bankService']['getLatestImagePath'](_0x53d79f),_0x2c4944=await(0x0,_0x4da3cc['readFile'])(_0x22c795),_0x3901d9=await this['imagePreprocessingService'][_0xb22080(0x417)](_0x2c4944,{'x':parseFloat(_0x1153c2),'y':parseFloat(_0x3c7312),'width':parseFloat(_0x545c81),'height':parseFloat(_0x568a3f)},void 0x0,{'grayscale':!0x0,'enhanceContrast':!0x0}),_0x2d3fdc=await this['ocrService']['recognizeFromBuffer'](_0x3901d9[_0xb22080(0x1fb)]),_0x48a489=_0x53d79f+'/processed-'+Date['now']()+_0xb22080(0x3f0);return await(0x0,_0x4da3cc['writeFile'])(_0x48a489,_0x3901d9[_0xb22080(0x1fb)]),{..._0x2d3fdc,'normalizedText':(0x0,_0x2c873e['removeVietnameseTones'])(_0x2d3fdc[_0xb22080(0x2e4)])};}};_0x41138a['BankController']=_0x4b4407,_0x43bb9f([(0x0,_0x4535a6[_0x2a32dd(0x193)])('devices'),(0x0,_0x12da03['ApiOperation'])({'summary':'Get\x20list\x20of\x20available\x20devices'}),(0x0,_0x12da03[_0x2a32dd(0x260)])({'name':_0x2a32dd(0x385),'description':'Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)'}),(0x0,_0x12da03['ApiResponse'])({'status':0xc8,'description':'List\x20of\x20devices\x20retrieved\x20successfully'}),_0x592544(0x0,(0x0,_0x4535a6['Param'])('bankCode')),_0x4a7c73(_0x2a32dd(0x35d),Function),_0x4a7c73('design:paramtypes',[String]),_0x4a7c73('design:returntype',Promise)],_0x4b4407['prototype'],'getDevices',null),_0x43bb9f([(0x0,_0x4535a6['Post'])('test/launch-app/:deviceId'),(0x0,_0x12da03[_0x2a32dd(0x296)])({'summary':'Test\x20launching\x20bank\x20app\x20on\x20a\x20device'}),(0x0,_0x12da03['ApiParam'])({'name':_0x2a32dd(0x385),'description':'Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)'}),(0x0,_0x12da03['ApiParam'])({'name':'deviceId','description':'Device\x20ID'}),(0x0,_0x12da03['ApiResponse'])({'status':0xc8,'description':'App\x20launched\x20successfully'}),_0x592544(0x0,(0x0,_0x4535a6[_0x2a32dd(0x2bf)])('bankCode')),_0x592544(0x1,(0x0,_0x4535a6['Param'])('deviceId')),_0x4a7c73('design:type',Function),_0x4a7c73('design:paramtypes',[String,String]),_0x4a7c73(_0x2a32dd(0x194),Promise)],_0x4b4407['prototype'],_0x2a32dd(0x30a),null),_0x43bb9f([(0x0,_0x4535a6[_0x2a32dd(0x437)])('test/capture-screen/:deviceId'),(0x0,_0x12da03['ApiOperation'])({'summary':'Test\x20screen\x20capture\x20on\x20a\x20device'}),(0x0,_0x12da03['ApiParam'])({'name':'bankCode','description':'Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)'}),(0x0,_0x12da03['ApiParam'])({'name':'deviceId','description':_0x2a32dd(0x1a8)}),(0x0,_0x12da03[_0x2a32dd(0x41a)])({'name':'name','description':'Screen\x20capture\x20name\x20(optional)','required':!0x1}),(0x0,_0x12da03['ApiQuery'])({'name':_0x2a32dd(0x319),'description':_0x2a32dd(0x1da),'required':!0x1}),(0x0,_0x12da03['ApiResponse'])({'status':0xc8,'description':'Screen\x20captured\x20successfully'}),_0x592544(0x0,(0x0,_0x4535a6['Param'])(_0x2a32dd(0x385))),_0x592544(0x1,(0x0,_0x4535a6['Param'])('deviceId')),_0x592544(0x2,(0x0,_0x4535a6['Query'])('name')),_0x592544(0x3,(0x0,_0x4535a6['Query'])('quality')),_0x4a7c73('design:type',Function),_0x4a7c73('design:paramtypes',[String,String,String,String]),_0x4a7c73('design:returntype',Promise)],_0x4b4407['prototype'],'testCaptureScreen',null),_0x43bb9f([(0x0,_0x4535a6['Post'])(_0x2a32dd(0x394)),(0x0,_0x12da03['ApiOperation'])({'summary':_0x2a32dd(0x172)}),(0x0,_0x12da03[_0x2a32dd(0x260)])({'name':_0x2a32dd(0x385),'description':'Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)'}),(0x0,_0x12da03[_0x2a32dd(0x260)])({'name':'deviceId','description':'Device\x20ID'}),(0x0,_0x12da03['ApiQuery'])({'name':'x','description':_0x2a32dd(0x2aa),'required':!0x0}),(0x0,_0x12da03['ApiQuery'])({'name':'y','description':'Y\x20coordinate\x20(Hc:\x200-1),\x20Panda:\x200-100','required':!0x0}),(0x0,_0x12da03['ApiResponse'])({'status':0xc8,'description':'Click\x20completed\x20successfully'}),_0x592544(0x0,(0x0,_0x4535a6['Param'])('bankCode')),_0x592544(0x1,(0x0,_0x4535a6[_0x2a32dd(0x2bf)])('deviceId')),_0x592544(0x2,(0x0,_0x4535a6['Query'])('x')),_0x592544(0x3,(0x0,_0x4535a6['Query'])('y')),_0x4a7c73(_0x2a32dd(0x35d),Function),_0x4a7c73(_0x2a32dd(0x2b1),[String,String,String,String]),_0x4a7c73(_0x2a32dd(0x194),Promise)],_0x4b4407['prototype'],_0x2a32dd(0x2ce),null),_0x43bb9f([(0x0,_0x4535a6['Post'])(_0x2a32dd(0x1c1)),(0x0,_0x12da03[_0x2a32dd(0x296)])({'summary':'Test\x20swiping\x20on\x20a\x20device.\x20Format\x20is\x20determined\x20by\x20config.boxType\x20(HC\x20or\x20PANDA)'}),(0x0,_0x12da03['ApiParam'])({'name':'bankCode','description':_0x2a32dd(0x2d8)}),(0x0,_0x12da03['ApiParam'])({'name':'deviceId','description':'Device\x20ID'}),(0x0,_0x12da03['ApiQuery'])({'name':'x','description':_0x2a32dd(0x3b7),'required':!0x1}),(0x0,_0x12da03[_0x2a32dd(0x41a)])({'name':'y','description':_0x2a32dd(0x16a),'required':!0x1}),(0x0,_0x12da03[_0x2a32dd(0x41a)])({'name':_0x2a32dd(0x3c3),'description':_0x2a32dd(0x27a),'required':!0x1}),(0x0,_0x12da03['ApiQuery'])({'name':'endX','description':'End\x20X\x20coordinate\x20for\x20HC\x20(required\x20for\x20HC:\x200-1)','required':!0x1}),(0x0,_0x12da03[_0x2a32dd(0x41a)])({'name':'endY','description':_0x2a32dd(0x41e),'required':!0x1}),(0x0,_0x12da03['ApiQuery'])({'name':'duration','description':'Swipe\x20duration\x20for\x20HC\x20(default:\x200.2)','required':!0x1}),(0x0,_0x12da03['ApiResponse'])({'status':0xc8,'description':'Swipe\x20completed\x20successfully'}),_0x592544(0x0,(0x0,_0x4535a6['Param'])('bankCode')),_0x592544(0x1,(0x0,_0x4535a6['Param'])('deviceId')),_0x592544(0x2,(0x0,_0x4535a6['Query'])('x')),_0x592544(0x3,(0x0,_0x4535a6[_0x2a32dd(0x424)])('y')),_0x592544(0x4,(0x0,_0x4535a6[_0x2a32dd(0x424)])('type')),_0x592544(0x5,(0x0,_0x4535a6['Query'])(_0x2a32dd(0x3a1))),_0x592544(0x6,(0x0,_0x4535a6['Query'])('endY')),_0x592544(0x7,(0x0,_0x4535a6['Query'])(_0x2a32dd(0x2fa))),_0x4a7c73('design:type',Function),_0x4a7c73('design:paramtypes',[String,String,String,String,String,String,String,String]),_0x4a7c73('design:returntype',Promise)],_0x4b4407['prototype'],'testSwipe',null),_0x43bb9f([(0x0,_0x4535a6['Post'])(_0x2a32dd(0x15c)),(0x0,_0x12da03[_0x2a32dd(0x296)])({'summary':'Test\x20inputting\x20number\x20using\x20numpad\x20layout\x20on\x20a\x20device'}),(0x0,_0x12da03[_0x2a32dd(0x260)])({'name':'bankCode','description':'Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)'}),(0x0,_0x12da03['ApiParam'])({'name':_0x2a32dd(0x3cb),'description':'Device\x20ID'}),(0x0,_0x12da03[_0x2a32dd(0x41a)])({'name':'number','description':'Number\x20string\x20to\x20input\x20(e.g.,\x20\x22123\x22,\x20\x22456789\x22)','required':!0x0}),(0x0,_0x12da03[_0x2a32dd(0x2c2)])({'status':0xc8,'description':'Numpad\x20number\x20input\x20completed\x20successfully'}),_0x592544(0x0,(0x0,_0x4535a6['Param'])(_0x2a32dd(0x385))),_0x592544(0x1,(0x0,_0x4535a6['Param'])('deviceId')),_0x592544(0x2,(0x0,_0x4535a6['Query'])(_0x2a32dd(0x317))),_0x4a7c73('design:type',Function),_0x4a7c73('design:paramtypes',[String,String,String]),_0x4a7c73('design:returntype',Promise)],_0x4b4407['prototype'],_0x2a32dd(0x243),null),_0x43bb9f([(0x0,_0x4535a6['Post'])(_0x2a32dd(0x26f)),(0x0,_0x12da03['ApiOperation'])({'summary':'Test\x20inputting\x20text\x20using\x20keyboard\x20layout\x20on\x20a\x20device'}),(0x0,_0x12da03['ApiParam'])({'name':'bankCode','description':_0x2a32dd(0x2d8)}),(0x0,_0x12da03['ApiParam'])({'name':_0x2a32dd(0x3cb),'description':'Device\x20ID'}),(0x0,_0x12da03['ApiQuery'])({'name':_0x2a32dd(0x2e4),'description':'Text\x20string\x20to\x20input\x20(e.g.,\x20\x22abc123\x22,\x20\x22test@email.com\x22)','required':!0x0}),(0x0,_0x12da03['ApiResponse'])({'status':0xc8,'description':_0x2a32dd(0x314)}),_0x592544(0x0,(0x0,_0x4535a6[_0x2a32dd(0x2bf)])(_0x2a32dd(0x385))),_0x592544(0x1,(0x0,_0x4535a6['Param'])('deviceId')),_0x592544(0x2,(0x0,_0x4535a6['Query'])('text')),_0x4a7c73(_0x2a32dd(0x35d),Function),_0x4a7c73('design:paramtypes',[String,String,String]),_0x4a7c73('design:returntype',Promise)],_0x4b4407[_0x2a32dd(0x18a)],'testInputText',null),_0x43bb9f([(0x0,_0x4535a6[_0x2a32dd(0x437)])('test/press-return/:deviceId'),(0x0,_0x12da03['ApiOperation'])({'summary':'Test\x20pressing\x20return\x20key\x20on\x20a\x20device'}),(0x0,_0x12da03['ApiParam'])({'name':'bankCode','description':'Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)'}),(0x0,_0x12da03[_0x2a32dd(0x260)])({'name':_0x2a32dd(0x3cb),'description':'Device\x20ID'}),(0x0,_0x12da03['ApiResponse'])({'status':0xc8,'description':_0x2a32dd(0x1cc)}),_0x592544(0x0,(0x0,_0x4535a6['Param'])('bankCode')),_0x592544(0x1,(0x0,_0x4535a6['Param'])('deviceId')),_0x4a7c73('design:type',Function),_0x4a7c73('design:paramtypes',[String,String]),_0x4a7c73('design:returntype',Promise)],_0x4b4407['prototype'],_0x2a32dd(0x43a),null),_0x43bb9f([(0x0,_0x4535a6['Post'])(_0x2a32dd(0x1cf)),(0x0,_0x12da03[_0x2a32dd(0x296)])({'summary':'Test\x20ROI\x20detection\x20on\x20a\x20device'}),(0x0,_0x12da03['ApiParam'])({'name':'bankCode','description':_0x2a32dd(0x2d8)}),(0x0,_0x12da03[_0x2a32dd(0x41a)])({'name':'deviceId','description':'Device\x20ID'}),(0x0,_0x12da03['ApiQuery'])({'name':'x','description':'X\x20coordinate','required':!0x0}),(0x0,_0x12da03['ApiQuery'])({'name':'y','description':'Y\x20coordinate','required':!0x0}),(0x0,_0x12da03['ApiQuery'])({'name':_0x2a32dd(0x423),'description':_0x2a32dd(0x299),'required':!0x0}),(0x0,_0x12da03['ApiQuery'])({'name':'height','description':'Height','required':!0x0}),_0x592544(0x0,(0x0,_0x4535a6[_0x2a32dd(0x2bf)])('bankCode')),_0x592544(0x1,(0x0,_0x4535a6[_0x2a32dd(0x424)])('deviceId')),_0x592544(0x2,(0x0,_0x4535a6['Query'])('x')),_0x592544(0x3,(0x0,_0x4535a6[_0x2a32dd(0x424)])('y')),_0x592544(0x4,(0x0,_0x4535a6['Query'])('width')),_0x592544(0x5,(0x0,_0x4535a6['Query'])('height')),_0x4a7c73('design:type',Function),_0x4a7c73('design:paramtypes',[String,String,String,String,String,String]),_0x4a7c73(_0x2a32dd(0x194),Promise)],_0x4b4407[_0x2a32dd(0x18a)],_0x2a32dd(0x336),null),_0x41138a['BankController']=_0x4b4407=_0x43bb9f([(0x0,_0x12da03[_0x2a32dd(0x2ae)])('bank'),(0x0,_0x4535a6['Controller'])('api/bank/:bankCode'),_0x592544(0x1,(0x0,_0x4535a6[_0x2a32dd(0x2de)])(_0x234b1b['WEBSOCKET_SERVICE'])),_0x4a7c73(_0x2a32dd(0x2b1),[_0x2a32dd(0x24f)==typeof(_0x5c0d1f=void 0x0!==_0x506765['BankService']&&_0x506765['BankService'])?_0x5c0d1f:Object,_0x2a32dd(0x24f)==typeof(_0x37c02f=void 0x0!==_0xbeed67['IWebSocketService']&&_0xbeed67[_0x2a32dd(0x26a)])?_0x37c02f:Object,'function'==typeof(_0xdf46f8=void 0x0!==_0x1c5919[_0x2a32dd(0x375)]&&_0x1c5919['ImagePreprocessingService'])?_0xdf46f8:Object,_0x2a32dd(0x24f)==typeof(_0x544061=void 0x0!==_0x2bd8c4['OCRService']&&_0x2bd8c4[_0x2a32dd(0x1b9)])?_0x544061:Object])],_0x4b4407);},function(_0x57501a,_0x45ed13,_0x3cb8b9){const _0x7ba0a9=a0_0x23a4;var _0x36abd1=this&&this[_0x7ba0a9(0x1f9)]||function(_0x45bd82,_0x26c3f8,_0x1416c3,_0x17470a){const _0x4ab57c=_0x7ba0a9;var _0x35662d,_0x3295d5=arguments['length'],_0x431d46=_0x3295d5<0x3?_0x26c3f8:null===_0x17470a?_0x17470a=Object[_0x4ab57c(0x26e)](_0x26c3f8,_0x1416c3):_0x17470a;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x431d46=Reflect[_0x4ab57c(0x2e3)](_0x45bd82,_0x26c3f8,_0x1416c3,_0x17470a);else{for(var _0x11a9c5=_0x45bd82['length']-0x1;_0x11a9c5>=0x0;_0x11a9c5--)(_0x35662d=_0x45bd82[_0x11a9c5])&&(_0x431d46=(_0x3295d5<0x3?_0x35662d(_0x431d46):_0x3295d5>0x3?_0x35662d(_0x26c3f8,_0x1416c3,_0x431d46):_0x35662d(_0x26c3f8,_0x1416c3))||_0x431d46);}return _0x3295d5>0x3&&_0x431d46&&Object['defineProperty'](_0x26c3f8,_0x1416c3,_0x431d46),_0x431d46;};Object['defineProperty'](_0x45ed13,'__esModule',{'value':!0x0}),_0x45ed13[_0x7ba0a9(0x3c1)]=void 0x0;const _0x370ae3=_0x3cb8b9(0x2),_0x218095=_0x3cb8b9(0x4f),_0x15b0b8=_0x3cb8b9(0x51),_0x19c8e9=_0x3cb8b9(0xd),_0xea730a=_0x3cb8b9(0x11);let _0x1b471e=class{};_0x45ed13['WebSocketModule']=_0x1b471e,_0x45ed13['WebSocketModule']=_0x1b471e=_0x36abd1([(0x0,_0x370ae3['Global'])(),(0x0,_0x370ae3['Module'])({'providers':[{'provide':_0x19c8e9[_0x7ba0a9(0x429)],'useClass':_0x7ba0a9(0x454)===_0xea730a['config']['boxType']?_0x15b0b8['PandaWebSocketService']:_0x218095['HCWebSocketService']}],'exports':[_0x19c8e9['WEBSOCKET_SERVICE']]})],_0x1b471e);},function(_0x537486,_0x428ee9,_0x3d3686){const _0x1bb774=a0_0x23a4;var _0x3c8d6c=this&&this['__decorate']||function(_0x2c3322,_0x59783b,_0x5867eb,_0x48b32f){const _0x232a7e=a0_0x23a4;var _0x10da50,_0x3a2360=arguments['length'],_0xde2b0e=_0x3a2360<0x3?_0x59783b:null===_0x48b32f?_0x48b32f=Object['getOwnPropertyDescriptor'](_0x59783b,_0x5867eb):_0x48b32f;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0xde2b0e=Reflect['decorate'](_0x2c3322,_0x59783b,_0x5867eb,_0x48b32f);else{for(var _0x21b9c0=_0x2c3322[_0x232a7e(0x1fa)]-0x1;_0x21b9c0>=0x0;_0x21b9c0--)(_0x10da50=_0x2c3322[_0x21b9c0])&&(_0xde2b0e=(_0x3a2360<0x3?_0x10da50(_0xde2b0e):_0x3a2360>0x3?_0x10da50(_0x59783b,_0x5867eb,_0xde2b0e):_0x10da50(_0x59783b,_0x5867eb))||_0xde2b0e);}return _0x3a2360>0x3&&_0xde2b0e&&Object['defineProperty'](_0x59783b,_0x5867eb,_0xde2b0e),_0xde2b0e;},_0xc1047d=this&&this['__metadata']||function(_0x296757,_0x466fd8){if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0x296757,_0x466fd8);};Object['defineProperty'](_0x428ee9,'__esModule',{'value':!0x0}),_0x428ee9['HCWebSocketService']=void 0x0;const _0x1300a6=_0x3d3686(0x2),_0x2b73d4=_0x3d3686(0x50),_0x45e0f9=_0x3d3686(0x26),_0x3404bb=_0x3d3686(0x18),_0xac20f6=_0x3d3686(0x16);let _0x44d75c=class{constructor(){const _0x4b43a7=a0_0x23a4;this[_0x4b43a7(0x25d)]=new _0x1300a6['Logger'](_0x4b43a7(0x3e1)),this['ws']=null,this[_0x4b43a7(0x270)]=0x0,this['maxReconnectAttempts']=0xa,this['reconnectDelay']=0x1388,this['requestQueue']=[],this['pendingRequests']=new Map(),this[_0x4b43a7(0x1ec)]=!0x1,this[_0x4b43a7(0x416)]=!0x1,this['wsUrl']=_0x4b43a7(0x180);}async[_0x1bb774(0x33a)](){const _0x29c591=_0x1bb774;await this[_0x29c591(0x241)]();}async['onModuleDestroy'](){await this['disconnect']();}async[_0x1bb774(0x241)](){return new Promise((_0x17d13b,_0x57b829)=>{try{this['logger']['log']('Connecting\x20to\x20HC\x20BOX\x20WebSocket:\x20'+this['wsUrl']),this['ws']=new _0x2b73d4(this['wsUrl']),this['ws']['on']('open',()=>{const _0x30ce22=a0_0x23a4;this['logger']['log'](_0x30ce22(0x3a7)),this['isConnected']=!0x0,this['reconnectAttempts']=0x0,this[_0x30ce22(0x364)](),_0x17d13b();}),this['ws']['on']('message',_0x42ae5d=>{const _0x5f10d7=a0_0x23a4;try{const _0x24a447=JSON[_0x5f10d7(0x252)](_0x42ae5d['toString']());this[_0x5f10d7(0x30e)](_0x24a447);}catch(_0x334a36){this['logger']['error']('Error\x20parsing\x20WebSocket\x20message:\x20'+_0x334a36['message']);}}),this['ws']['on']('error',_0x312381=>{const _0x22dd80=a0_0x23a4;this['logger']['error'](_0x22dd80(0x250)+_0x312381['message']),this[_0x22dd80(0x1ec)]=!0x1,0x0===this['reconnectAttempts']&&_0x57b829(_0x312381);}),this['ws']['on']('close',()=>{const _0x5d3095=a0_0x23a4;this['logger']['warn'](_0x5d3095(0x428)),this['isConnected']=!0x1,this[_0x5d3095(0x3ef)]();});}catch(_0x28810c){this['logger']['error']('Error\x20creating\x20WebSocket\x20connection:\x20'+_0x28810c['message']),_0x57b829(_0x28810c);}});}['scheduleReconnect'](){const _0x5d2038=_0x1bb774;if(this[_0x5d2038(0x270)]>=this['maxReconnectAttempts'])return void this['logger']['error']('Max\x20reconnection\x20attempts\x20reached');this[_0x5d2038(0x270)]++;const _0x52be79=this['reconnectDelay']*this['reconnectAttempts'];this['logger']['log']('Scheduling\x20reconnect\x20attempt\x20'+this[_0x5d2038(0x270)]+'\x20in\x20'+_0x52be79+'ms'),setTimeout(()=>{const _0x2b7e3d=_0x5d2038;this['connect']()[_0x2b7e3d(0x166)](_0x358de8=>{this['logger']['error']('Reconnection\x20failed:\x20'+_0x358de8['message']);});},_0x52be79);}async['disconnect'](){const _0x3dbfa4=_0x1bb774;this['ws']&&(this['ws'][_0x3dbfa4(0x3ff)](),this['ws']=null,this['isConnected']=!0x1);}['handleMessage'](_0x3ebc23){const _0x391159=_0x1bb774;if(this['pendingRequests']['size']>0x0){const [_0x41283a,_0xa324a0]=this['pendingRequests']['entries']()[_0x391159(0x269)]()['value'];this['pendingRequests']['delete'](_0x41283a),0xc8===_0x3ebc23[_0x391159(0x251)]?_0xa324a0['resolve'](_0x3ebc23['result']):_0xa324a0['reject'](new Error('HC\x20BOX\x20error:\x20'+_0x3ebc23[_0x391159(0x251)]));}else this['logger']['warn']('Received\x20response\x20but\x20no\x20pending\x20requests:\x20'+JSON['stringify'](_0x3ebc23));}async[_0x1bb774(0x364)](){const _0x196cfe=_0x1bb774;if(this['isProcessingRequest']||0x0===this['requestQueue'][_0x196cfe(0x1fa)])return;if(!this['isConnected']||!this['ws'])return;this[_0x196cfe(0x416)]=!0x0;const {request:_0x5d8c80,resolve:_0x5e3d56,reject:_0x185256,timeout:_0x20297d}=this['requestQueue'][_0x196cfe(0x301)]();try{_0x5e3d56(await this[_0x196cfe(0x32c)](_0x5d8c80,_0x20297d));}catch(_0x4afd60){_0x185256(_0x4afd60);}finally{this['isProcessingRequest']=!0x1,this['requestQueue']['length']>0x0&&setImmediate(()=>this['processRequestQueue']());}}async['_sendRequestOnce'](_0x6428c8,_0x386e1e=0x7530){return new Promise((_0x375314,_0x8dd31f)=>{const _0xfc4090=a0_0x23a4,_0x61ebaa=Date['now']()[_0xfc4090(0x2ca)]()+Math['random']()['toString'](0x24)['substr'](0x2,0x9);this['pendingRequests']['set'](_0x61ebaa,{'resolve':_0x375314,'reject':_0x8dd31f});const _0x2bdb5e=setTimeout(()=>{this['pendingRequests']['delete'](_0x61ebaa),_0x8dd31f(new Error('WebSocket\x20request\x20timeout'));},_0x386e1e),_0x503aed=_0x375314,_0x5ede06=_0x8dd31f;_0x375314=_0x1be5b8=>{clearTimeout(_0x2bdb5e),_0x503aed(_0x1be5b8);},_0x8dd31f=_0x26b26b=>{clearTimeout(_0x2bdb5e),_0x5ede06(_0x26b26b);},this['pendingRequests'][_0xfc4090(0x306)](_0x61ebaa,{'resolve':_0x375314,'reject':_0x8dd31f});try{this['ws']['send'](JSON['stringify'](_0x6428c8));}catch(_0x2fadf6){this['pendingRequests']['delete'](_0x61ebaa),clearTimeout(_0x2bdb5e),_0x8dd31f(_0x2fadf6);}});}async['sendRequest'](_0x2ab31c,_0x1f53f9=0x7530){return new Promise((_0x544f1b,_0x155a40)=>{this['requestQueue']['push']({'request':_0x2ab31c,'resolve':_0x544f1b,'reject':_0x155a40,'timeout':_0x1f53f9}),this['processRequestQueue']();});}async['listDevices'](){const _0x1e0471=await this['sendRequest']({'action':'list'});return Array['isArray'](_0x1e0471)?_0x1e0471:[];}async[_0x1bb774(0x238)](_0x546d4a,_0x54995e,_0x355d1b,_0x310655=0.2){const _0x3f35fc=Array['isArray'](_0x546d4a)?_0x546d4a['join'](','):_0x546d4a;return this['sendRequest']({'action':'click','comm':{'deviceIds':_0x3f35fc,'x':_0x54995e,'y':_0x355d1b,'duration':_0x310655}});}async['swipe'](_0x4de01c,_0x3ba387){const _0x1564dd=_0x1bb774,_0x4ff76d=Array['isArray'](_0x4de01c)?_0x4de01c['join'](','):_0x4de01c;return this[_0x1564dd(0x3f7)]({'action':_0x1564dd(0x3a2),'comm':{'deviceIds':_0x4ff76d,..._0x3ba387}});}async['captureScreen'](_0x13156f,_0x353474){const _0x1d14fb=_0x1bb774;return this[_0x1d14fb(0x3f7)]({'action':_0x1d14fb(0x190),'comm':{'deviceIds':_0x13156f,...(0x0,_0xac20f6['omit'])(_0x353474,'folderPath'),'filePath':_0x353474['folderPath']}});}async['home'](_0x522ea2){const _0x265c0f=_0x1bb774,_0x3777e4=Array['isArray'](_0x522ea2)?_0x522ea2['join'](','):_0x522ea2;return this['sendRequest']({'action':_0x265c0f(0x3ec),'comm':{'deviceIds':_0x3777e4}});}async['launchApp'](_0x248852,_0x222f9a){const _0x16518d=Array['isArray'](_0x248852)?_0x248852['join'](','):_0x248852;return this['sendRequest']({'action':'launchApp','comm':{'deviceIds':_0x16518d,'content':_0x222f9a}});}async['killApp'](_0x44a873,_0x4c38bb){const _0x204786=Array['isArray'](_0x44a873)?_0x44a873['join'](','):_0x44a873;return this['sendRequest']({'action':'killApp','comm':{'deviceIds':_0x204786,'content':_0x4c38bb}});}['isNumber'](_0x5f3add){const _0x90b575=_0x1bb774;return/^[0-9]$/[_0x90b575(0x3f5)](_0x5f3add);}['isLetter'](_0x4f41fc){return/^[a-zA-Z]$/['test'](_0x4f41fc);}['isSpecialCharInNumberMode'](_0x3afd8a){return['@','!']['includes'](_0x3afd8a);}async['switchKeyboardMode'](_0x737436){const _0x48a24f=_0x1bb774,{x:_0x4ec56e,y:_0x10143b}=_0x45e0f9['COMMON_COORDINATES']['KEYBOARD_SWITCH'];this['logger']['log'](_0x48a24f(0x2a0)+_0x737436+_0x48a24f(0x1be)+_0x4ec56e+',\x20'+_0x10143b+')'),await this['click'](_0x737436,_0x4ec56e,_0x10143b,0.2),await(0x0,_0x3404bb['sleep'])(0x1f4),this['logger']['log']('Keyboard\x20mode\x20switched\x20successfully\x20on\x20device\x20'+_0x737436);}async[_0x1bb774(0x2d3)](_0x2b41ad){const _0xbbc83d=_0x1bb774,{x:_0x33cdce,y:_0x27b75a}=_0x45e0f9['COMMON_COORDINATES'][_0xbbc83d(0x31a)];this['logger']['debug'](_0xbbc83d(0x191)+_0x2b41ad+'\x20at\x20coordinates\x20('+_0x33cdce+',\x20'+_0x27b75a+')'),await this[_0xbbc83d(0x238)](_0x2b41ad,_0x33cdce,_0x27b75a,0.2),await(0x0,_0x3404bb['sleep'])(0xc8),this['logger']['debug']('Shift\x20key\x20pressed\x20successfully\x20on\x20device\x20'+_0x2b41ad);}async['pressReturnKey'](_0x358b35){const _0x384dcc=_0x1bb774,{x:_0x1c7927,y:_0x23751f}=_0x45e0f9['COMMON_COORDINATES']['RETURN_KEY'];this['logger'][_0x384dcc(0x230)]('Pressing\x20return\x20key\x20on\x20device\x20'+_0x358b35+'\x20at\x20coordinates\x20('+_0x1c7927+',\x20'+_0x23751f+')'),await this[_0x384dcc(0x238)](_0x358b35,_0x1c7927,_0x23751f,0.2),await(0x0,_0x3404bb['sleep'])(0x1f4),this['logger']['log']('Return\x20key\x20pressed\x20successfully\x20on\x20device\x20'+_0x358b35);}async['inputText'](_0x3b27d3,_0x2886f2){const _0x94d2f4=_0x1bb774;if(!_0x2886f2||0x0===_0x2886f2[_0x94d2f4(0x1fa)])throw new Error('Password\x20cannot\x20be\x20empty');let _0x5ca491='letter';for(let _0x5d1d3d=0x0;_0x5d1d3d<_0x2886f2['length'];_0x5d1d3d++){const _0x477388=_0x2886f2[_0x5d1d3d],_0x13be31=_0x477388['toLowerCase'](),_0x35a0f7=_0x477388!==_0x13be31&&this['isLetter'](_0x477388),_0x345cda=this['isSpecialCharInNumberMode'](_0x477388)?_0x477388:_0x13be31,_0x120635=_0x45e0f9['KEYBOARD_LAYOUT'][_0x345cda];if(!_0x120635){this['logger']['warn']('Character\x20\x27'+_0x477388+'\x27\x20not\x20found\x20in\x20keyboard\x20layout.\x20Skipping...');continue;}let _0x38440e=null;this[_0x94d2f4(0x1aa)](_0x13be31)?_0x38440e=_0x94d2f4(0x317):this['isLetter'](_0x13be31)?_0x38440e='letter':this['isSpecialCharInNumberMode'](_0x477388)&&(_0x38440e='number'),_0x38440e&&_0x5ca491!==_0x38440e&&(this['logger'][_0x94d2f4(0x3cc)]('Switching\x20keyboard\x20to\x20'+_0x38440e+'\x20mode\x20for\x20character\x20\x27'+_0x477388+'\x27'),await this['switchKeyboardMode'](_0x3b27d3),_0x5ca491=_0x38440e),_0x35a0f7&&_0x94d2f4(0x389)===_0x5ca491&&(this['logger'][_0x94d2f4(0x3cc)]('Pressing\x20shift\x20key\x20for\x20uppercase\x20letter\x20\x27'+_0x477388+'\x27'),await this['pressShiftKey'](_0x3b27d3)),this[_0x94d2f4(0x25d)]['debug']('Clicking\x20key\x20\x27'+_0x345cda+'\x27'+(_0x35a0f7?'\x20(uppercase)':'')+_0x94d2f4(0x24b)+_0x120635['x']+',\x20'+_0x120635['y']+')'),await this['click'](_0x3b27d3,_0x120635['x'],_0x120635['y'],0.15),await(0x0,_0x3404bb['sleep'])(0xc8);}this[_0x94d2f4(0x25d)]['log']('Text\x20input\x20completed\x20on\x20device\x20'+_0x3b27d3);}async['inputNumpadNumber'](_0x54be4e,_0x55d5b9){const _0x136c6e=_0x1bb774;if(!_0x55d5b9||0x0===_0x55d5b9['length'])throw new Error('value\x20cannot\x20be\x20empty');for(let _0x518888=0x0;_0x518888<_0x55d5b9['length'];_0x518888++){const _0x212a7f=_0x55d5b9[_0x518888],_0x2aaf39=_0x45e0f9[_0x136c6e(0x235)][_0x212a7f];await this['click'](_0x54be4e,_0x2aaf39['x'],_0x2aaf39['y'],0.15),this['logger']['debug']('Clicking\x20key\x20\x27'+_0x212a7f+'\x27\x20at\x20('+_0x2aaf39['x']+',\x20'+_0x2aaf39['y']+')'),await(0x0,_0x3404bb['sleep'])(0xc8);}}async['transferFile'](_0x244c80,_0x4a7216,_0x47b1d3=0x1){return Promise['resolve'](null);}[_0x1bb774(0x297)](){return this['isConnected'];}};_0x428ee9['HCWebSocketService']=_0x44d75c,_0x428ee9['HCWebSocketService']=_0x44d75c=_0x3c8d6c([(0x0,_0x1300a6['Injectable'])(),_0xc1047d('design:paramtypes',[])],_0x44d75c);},_0x3338dc=>{_0x3338dc['exports']=require('ws');},function(_0x4de3cb,_0x440a69,_0x587bc0){const _0x1c4e83=a0_0x23a4;var _0x4b6501,_0x5dd5d2=this&&this['__decorate']||function(_0x373b23,_0x2cb1f2,_0x5d9242,_0xea874c){const _0x409011=a0_0x23a4;var _0x3799f7,_0x1e8a98=arguments['length'],_0x3cdff1=_0x1e8a98<0x3?_0x2cb1f2:null===_0xea874c?_0xea874c=Object[_0x409011(0x26e)](_0x2cb1f2,_0x5d9242):_0xea874c;if(_0x409011(0x34a)==typeof Reflect&&_0x409011(0x24f)==typeof Reflect['decorate'])_0x3cdff1=Reflect[_0x409011(0x2e3)](_0x373b23,_0x2cb1f2,_0x5d9242,_0xea874c);else{for(var _0x2d4542=_0x373b23['length']-0x1;_0x2d4542>=0x0;_0x2d4542--)(_0x3799f7=_0x373b23[_0x2d4542])&&(_0x3cdff1=(_0x1e8a98<0x3?_0x3799f7(_0x3cdff1):_0x1e8a98>0x3?_0x3799f7(_0x2cb1f2,_0x5d9242,_0x3cdff1):_0x3799f7(_0x2cb1f2,_0x5d9242))||_0x3cdff1);}return _0x1e8a98>0x3&&_0x3cdff1&&Object['defineProperty'](_0x2cb1f2,_0x5d9242,_0x3cdff1),_0x3cdff1;},_0x34c204=this&&this['__metadata']||function(_0x3c9c03,_0x3477eb){if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0x3c9c03,_0x3477eb);};Object[_0x1c4e83(0x213)](_0x440a69,'__esModule',{'value':!0x0}),_0x440a69[_0x1c4e83(0x278)]=void 0x0;const _0x66687d=_0x587bc0(0x2),_0x6f3822=_0x587bc0(0x50),_0x259534=_0x587bc0(0x16),_0x1aa085=_0x587bc0(0x18),_0x2f3d93=_0x587bc0(0x26),_0x188885=_0x587bc0(0x2c);let _0x5a82b3=class{constructor(_0x354229){const _0x522b55=_0x1c4e83;this['telegramService']=_0x354229,this['logger']=new _0x66687d['Logger'](_0x522b55(0x278)),this['ws']=null,this['reconnectAttempts']=0x0,this['maxReconnectAttempts']=0xa,this['reconnectDelay']=0x1388,this[_0x522b55(0x358)]=[],this[_0x522b55(0x414)]=new Map(),this[_0x522b55(0x1ec)]=!0x1,this['isProcessingRequest']=!0x1,this['wsUrl']='ws://127.0.0.1:33333';}async[_0x1c4e83(0x33a)](){const _0x3f3abe=_0x1c4e83;await this[_0x3f3abe(0x241)]();}async[_0x1c4e83(0x304)](){await this['disconnect']();}async['connect'](){return new Promise((_0x389e8f,_0x46fc57)=>{const _0x32a5a2=a0_0x23a4;try{this['logger']['log'](_0x32a5a2(0x16e)+this['wsUrl']),this['ws']=new _0x6f3822(this['wsUrl']),this['ws']['on'](_0x32a5a2(0x2b8),()=>{const _0x19b09b=_0x32a5a2;this[_0x19b09b(0x25d)]['log'](_0x19b09b(0x3b3)),this['isConnected']=!0x0,this['reconnectAttempts']=0x0,this[_0x19b09b(0x364)](),_0x389e8f();}),this['ws']['on'](_0x32a5a2(0x1c8),_0x46f65d=>{const _0x14bf57=_0x32a5a2;try{const _0x5ba03b=_0x46f65d['toString'](),_0x46d29a=JSON['parse'](_0x5ba03b);this[_0x14bf57(0x30e)](_0x46d29a);}catch(_0x498f11){this['logger'][_0x14bf57(0x382)]('Error\x20parsing\x20WebSocket\x20message:\x20'+_0x498f11['message'],_0x498f11[_0x14bf57(0x384)]),this['logger']['error']('Raw\x20message\x20was:\x20'+_0x46f65d['toString']());}}),this['ws']['on']('error',_0x283e62=>{const _0x5b1967=_0x32a5a2;this['logger']['error'](_0x5b1967(0x250)+_0x283e62['message']),this[_0x5b1967(0x1ec)]=!0x1,0x0===this['reconnectAttempts']&&_0x46fc57(_0x283e62);}),this['ws']['on']('close',()=>{this['logger']['warn']('Panda\x20BOX\x20WebSocket\x20closed'),this['isConnected']=!0x1,this['scheduleReconnect']();});}catch(_0x39c935){this['logger']['error']('Error\x20creating\x20WebSocket\x20connection:\x20'+_0x39c935[_0x32a5a2(0x1c8)]),_0x46fc57(_0x39c935);}});}['scheduleReconnect'](){const _0x4e2268=_0x1c4e83;if(this['reconnectAttempts']>=this[_0x4e2268(0x169)])return this[_0x4e2268(0x25d)]['error'](_0x4e2268(0x2ad)),void this['telegramService']['sendMessage']({'text':_0x4e2268(0x280)+this[_0x4e2268(0x169)]+'\x0a<b>Current\x20retry:</b>\x20'+this['reconnectAttempts']+'\x0a<b>Retry\x20delay:</b>\x20'+this[_0x4e2268(0x1e9)]+'ms','options':{'parseMode':'HTML'}});this['reconnectAttempts']++;const _0x4ba5d0=this['reconnectDelay']*this['reconnectAttempts'];this['logger']['log']('Scheduling\x20reconnect\x20attempt\x20'+this[_0x4e2268(0x270)]+_0x4e2268(0x3b9)+_0x4ba5d0+'ms'),setTimeout(()=>{const _0x57fcbf=_0x4e2268;this['connect']()[_0x57fcbf(0x166)](_0x274ccf=>{const _0x5f2f79=_0x57fcbf;this['logger']['error']('Reconnection\x20failed:\x20'+_0x274ccf[_0x5f2f79(0x1c8)]);});},_0x4ba5d0);}async[_0x1c4e83(0x1b7)](){const _0x161044=_0x1c4e83;this['ws']&&(this['ws'][_0x161044(0x3ff)](),this['ws']=null,this[_0x161044(0x1ec)]=!0x1);}['handleMessage'](_0x2db704){const _0x372f15=_0x1c4e83;if(this['pendingRequests']['size']>0x0){const [_0x2c43d9,_0x3d2128]=this[_0x372f15(0x414)][_0x372f15(0x339)]()[_0x372f15(0x269)]()[_0x372f15(0x2c4)];if(this[_0x372f15(0x414)]['delete'](_0x2c43d9),0x2710===_0x2db704['code'])_0x3d2128['resolve'](_0x2db704['data']);else{const _0x1e1f74=_0x2db704['message']||_0x372f15(0x26c)+_0x2db704[_0x372f15(0x35c)];_0x3d2128[_0x372f15(0x35e)](new Error(_0x1e1f74));}}else{if(Array[_0x372f15(0x1b3)](_0x2db704['data'])&&_0x2db704['data']['length']>0x0&&void 0x0!==_0x2db704[_0x372f15(0x35a)][0x0]?.['serial']&&0x2710===_0x2db704[_0x372f15(0x35c)]){const _0xb7651b=_0x2db704['data'];this['logger'][_0x372f15(0x3cc)](_0x372f15(0x3b6)+_0xb7651b['length']+_0x372f15(0x23e));}else this['logger'][_0x372f15(0x3d4)]('Received\x20response\x20but\x20no\x20pending\x20requests:\x20'+JSON['stringify'](_0x2db704));}}async[_0x1c4e83(0x364)](){const _0x4bbf5c=_0x1c4e83;if(this['isProcessingRequest']||0x0===this['requestQueue'][_0x4bbf5c(0x1fa)])return;if(!this[_0x4bbf5c(0x1ec)]||!this['ws'])return;this[_0x4bbf5c(0x416)]=!0x0;const {request:_0x2d8736,resolve:_0x4469b3,reject:_0x1d34b2,timeout:_0x467c30}=this[_0x4bbf5c(0x358)]['shift']();try{_0x4469b3(await this['_sendRequestOnce'](_0x2d8736,_0x467c30));}catch(_0x4a8b8e){_0x1d34b2(_0x4a8b8e);}finally{this['isProcessingRequest']=!0x1,this['requestQueue'][_0x4bbf5c(0x1fa)]>0x0&&setImmediate(()=>this['processRequestQueue']());}}async[_0x1c4e83(0x32c)](_0x321838,_0x2b856b=0x7530){return new Promise((_0x2e35a1,_0x2412c4)=>{const _0x39c6c9=a0_0x23a4,_0x8e1a54=Date['now']()[_0x39c6c9(0x2ca)]()+Math['random']()[_0x39c6c9(0x2ca)](0x24)['substr'](0x2,0x9);this[_0x39c6c9(0x414)]['set'](_0x8e1a54,{'resolve':_0x2e35a1,'reject':_0x2412c4});const _0x42f641=setTimeout(()=>{this['pendingRequests']['delete'](_0x8e1a54),_0x2412c4(new Error('WebSocket\x20request\x20timeout'));},_0x2b856b),_0xc0e28c=_0x2e35a1,_0x116159=_0x2412c4;_0x2e35a1=_0x46d1bd=>{clearTimeout(_0x42f641),_0xc0e28c(_0x46d1bd);},_0x2412c4=_0x64d9d0=>{clearTimeout(_0x42f641),_0x116159(_0x64d9d0);},this['pendingRequests']['set'](_0x8e1a54,{'resolve':_0x2e35a1,'reject':_0x2412c4});try{const _0x41f48a=JSON['stringify'](_0x321838);this['ws']['send'](_0x41f48a);}catch(_0x186794){this['logger']['error']('Error\x20sending\x20WebSocket\x20request:\x20'+_0x186794['message'],_0x186794['stack']),this['pendingRequests']['delete'](_0x8e1a54),clearTimeout(_0x42f641),_0x2412c4(_0x186794);}});}async['sendRequest'](_0x4abe88,_0x5d88f7=0x7530){return new Promise((_0x329d2c,_0x338360)=>{const _0x16a9d7=a0_0x23a4;this['requestQueue'][_0x16a9d7(0x281)]({'request':_0x4abe88,'resolve':_0x329d2c,'reject':_0x338360,'timeout':_0x5d88f7}),this['processRequestQueue']();});}async['listDevices'](){const _0x35ac98=_0x1c4e83,_0x152490=(await this['sendRequest']({'action':'list'}))['map'](_0x38cc86=>({..._0x38cc86,'udid':_0x38cc86['serial']}));return _0x152490['length']<=0x0&&this['logger']['error'](_0x35ac98(0x186)),_0x152490;}async['click'](_0x38da8b,_0x4d7d8b,_0xa7b627,_0x1386b7=0.2){const _0x490e32=_0x1c4e83;return this[_0x490e32(0x3f7)]({'action':'pointerEvent','devices':Array['isArray'](_0x38da8b)?_0x38da8b['join'](','):_0x38da8b,'data':{'type':'10','x':(0x0,_0x259534['toString'])(_0x4d7d8b),'y':(0x0,_0x259534['toString'])(_0xa7b627)}});}async['swipe'](_0xe47bf6,_0x2f8864){const _0x1f6126=_0x1c4e83,_0x184217=Array['isArray'](_0xe47bf6)?_0xe47bf6[_0x1f6126(0x25a)](','):_0xe47bf6;return this['sendRequest']({'action':'pointerEvent','devices':_0x184217,'data':_0x2f8864});}async['captureScreen'](_0x13bbd6,_0x436eb4){return this['sendRequest']({'action':'screenFile','devices':_0x13bbd6,'data':{'savePath':_0x436eb4['folderPath']}});}async[_0x1c4e83(0x3ec)](_0x4b73d6){const _0x214573=_0x1c4e83;return this[_0x214573(0x3f7)]({'action':'pushEvent','devices':_0x4b73d6,'data':{'type':'2'}});}async['launchApp'](_0x14047c,_0x3daad3){const _0x418146=_0x1c4e83,_0x293ebe=Array['isArray'](_0x14047c)?_0x14047c['join'](','):_0x14047c;return this[_0x418146(0x3f7)]({'action':'startApp','devices':_0x293ebe,'data':{'app':_0x3daad3}});}async['killApp'](_0xdbfefa,_0xbef49f){const _0x40b6a5=_0x1c4e83,_0xd86b26=Array['isArray'](_0xdbfefa)?_0xdbfefa['join'](','):_0xdbfefa;return this['sendRequest']({'action':_0x40b6a5(0x2dc),'devices':_0xd86b26,'data':{'app':_0xbef49f}});}async['switchKeyboardMode'](_0x904f0d){const _0x163f1a=_0x1c4e83,{x:_0x54a917,y:_0xe9281e}=_0x2f3d93[_0x163f1a(0x1ce)][_0x163f1a(0x33f)];this['logger']['log']('Switching\x20keyboard\x20mode\x20on\x20device\x20'+_0x904f0d+'\x20at\x20coordinates\x20('+_0x54a917+',\x20'+_0xe9281e+')'),await this['click'](_0x904f0d,_0x54a917,_0xe9281e,0.2),await(0x0,_0x1aa085[_0x163f1a(0x37f)])(0x1f4),this['logger']['log']('Keyboard\x20mode\x20switched\x20successfully\x20on\x20device\x20'+_0x904f0d);}async['pressShiftKey'](_0x307f9e){const _0x28e3d9=_0x1c4e83,{x:_0x4e6192,y:_0x5e0320}=_0x2f3d93['COMMON_COORDINATES'][_0x28e3d9(0x31a)];this['logger'][_0x28e3d9(0x3cc)]('Pressing\x20shift\x20key\x20on\x20device\x20'+_0x307f9e+'\x20at\x20coordinates\x20('+_0x4e6192+',\x20'+_0x5e0320+')'),await this[_0x28e3d9(0x238)](_0x307f9e,_0x4e6192,_0x5e0320,0.2),await(0x0,_0x1aa085[_0x28e3d9(0x37f)])(0xc8),this['logger'][_0x28e3d9(0x3cc)]('Shift\x20key\x20pressed\x20successfully\x20on\x20device\x20'+_0x307f9e);}async['pressReturnKey'](_0x2598cc){const _0x3e0d3b=_0x1c4e83,{x:_0x322fec,y:_0x222642}=_0x2f3d93[_0x3e0d3b(0x1ce)]['RETURN_KEY'];await this['click'](_0x2598cc,_0x322fec,_0x222642,0.2),await(0x0,_0x1aa085[_0x3e0d3b(0x37f)])(0x1f4);}async['inputText'](_0x1a3994,_0xe5d8a7){const _0x3a87ea=_0x1c4e83,_0x4c4f3d=Array[_0x3a87ea(0x1b3)](_0x1a3994)?_0x1a3994['join'](','):_0x1a3994;return this[_0x3a87ea(0x3f7)]({'action':'inputText','devices':_0x4c4f3d,'data':{'content':_0xe5d8a7}});}async['inputNumpadNumber'](_0xa5f015,_0x303ab2){const _0x4f1539=_0x1c4e83;if(!_0x303ab2||0x0===_0x303ab2['length'])throw new Error(_0x4f1539(0x21c));for(let _0x2affb5=0x0;_0x2affb5<_0x303ab2['length'];_0x2affb5++){const _0x2f385d=_0x303ab2[_0x2affb5],_0x33b5e8=_0x2f3d93[_0x4f1539(0x235)][_0x2f385d];await this['click'](_0xa5f015,_0x33b5e8['x'],_0x33b5e8['y']),this[_0x4f1539(0x25d)]['debug']('Clicking\x20key\x20\x27'+_0x2f385d+_0x4f1539(0x37b)+_0x33b5e8['x']+',\x20'+_0x33b5e8['y']+')'),await(0x0,_0x1aa085[_0x4f1539(0x37f)])(0xc8);}}async['transferFile'](_0x2198a7,_0x6bd124,_0x35af7b=0x1){const _0x24f0dd=_0x1c4e83,_0x3e1509=Array[_0x24f0dd(0x1b3)](_0x2198a7)?_0x2198a7['join'](','):_0x2198a7;return this['logger'][_0x24f0dd(0x230)]('Transferring\x20file\x20'+_0x6bd124+'\x20to\x20device(s)\x20'+_0x3e1509+'\x20with\x20fileType\x20'+_0x35af7b),this[_0x24f0dd(0x3f7)]({'action':'uploadFile','devices':_0x3e1509,'data':{'filePath':_0x6bd124,'fileType':_0x35af7b}});}['isConnectedStatus'](){return this['isConnected'];}};_0x440a69[_0x1c4e83(0x278)]=_0x5a82b3,_0x440a69['PandaWebSocketService']=_0x5a82b3=_0x5dd5d2([(0x0,_0x66687d[_0x1c4e83(0x3ea)])(),_0x34c204('design:paramtypes',['function'==typeof(_0x4b6501=void 0x0!==_0x188885['TelegramService']&&_0x188885[_0x1c4e83(0x2f6)])?_0x4b6501:Object])],_0x5a82b3);},function(_0x14327f,_0x5efa1e,_0x48ff97){const _0x2541d9=a0_0x23a4;var _0x2ab23f,_0x4179f5,_0x3be3e0,_0x112863,_0x392c82=this&&this['__decorate']||function(_0x1477df,_0x323e69,_0x5145df,_0x49838c){const _0x2a1ba3=a0_0x23a4;var _0x1836e7,_0x488d02=arguments[_0x2a1ba3(0x1fa)],_0x1bad06=_0x488d02<0x3?_0x323e69:null===_0x49838c?_0x49838c=Object[_0x2a1ba3(0x26e)](_0x323e69,_0x5145df):_0x49838c;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x1bad06=Reflect['decorate'](_0x1477df,_0x323e69,_0x5145df,_0x49838c);else{for(var _0x339ddc=_0x1477df['length']-0x1;_0x339ddc>=0x0;_0x339ddc--)(_0x1836e7=_0x1477df[_0x339ddc])&&(_0x1bad06=(_0x488d02<0x3?_0x1836e7(_0x1bad06):_0x488d02>0x3?_0x1836e7(_0x323e69,_0x5145df,_0x1bad06):_0x1836e7(_0x323e69,_0x5145df))||_0x1bad06);}return _0x488d02>0x3&&_0x1bad06&&Object['defineProperty'](_0x323e69,_0x5145df,_0x1bad06),_0x1bad06;},_0x5ce1f6=this&&this['__metadata']||function(_0x42eb1c,_0x239dbd){const _0x477bb5=a0_0x23a4;if('object'==typeof Reflect&&_0x477bb5(0x24f)==typeof Reflect['metadata'])return Reflect['metadata'](_0x42eb1c,_0x239dbd);};Object[_0x2541d9(0x213)](_0x5efa1e,'__esModule',{'value':!0x0}),_0x5efa1e[_0x2541d9(0x273)]=void 0x0;const _0x224f7e=_0x48ff97(0x2),_0x562166=_0x48ff97(0x7),_0x22356e=_0x48ff97(0xb),_0x2f12b2=_0x48ff97(0xe),_0x12e737=_0x48ff97(0x34),_0x1efa5d=_0x48ff97(0x41),_0x532486=_0x48ff97(0x42);let _0x5cdb14=class{constructor(_0x122f16,_0x2cbc4e,_0x2fb38b,_0x3e7771){const _0x43ead2=_0x2541d9;this[_0x43ead2(0x2cc)]=_0x122f16,this[_0x43ead2(0x17f)]=_0x2cbc4e,this[_0x43ead2(0x259)]=_0x2fb38b,this['redisLockService']=_0x3e7771,this['logger']=new _0x224f7e[(_0x43ead2(0x34b))]('SessionRefreshScheduler');}async['refreshSessions'](){const _0x338ad8=_0x2541d9;try{if(await this['redisLockService']['getLock'](_0x532486[_0x338ad8(0x3ab)]))return;if(_0x338ad8(0x1db)!==await this['deviceService']['getServiceStatus']())return;const _0x1e0485=(await this['deviceService']['listDevices']())['filter'](_0x300e14=>'active'===_0x300e14[_0x338ad8(0x455)]&&_0x300e14['bankCode']);for(const _0x778267 of _0x1e0485){const _0x22e088=_0x778267['bankCode']['toUpperCase']();try{await this['bankService']['refreshSessionIfNeeded'](_0x778267['udid'],_0x22e088);}catch(_0x5b72bc){this['logger']['error'](_0x338ad8(0x43c)+_0x778267['udid']+',\x20bank\x20'+_0x22e088+':\x20'+_0x5b72bc['message']);}}}catch(_0x14e217){this['logger']['error']('Error\x20in\x20session\x20refresh\x20scheduler:\x20'+_0x14e217['message']);}}};_0x5efa1e[_0x2541d9(0x273)]=_0x5cdb14,_0x392c82([(0x0,_0x562166['Cron'])(_0x562166[_0x2541d9(0x2bd)]['EVERY_30_SECONDS']),_0x5ce1f6('design:type',Function),_0x5ce1f6(_0x2541d9(0x2b1),[]),_0x5ce1f6(_0x2541d9(0x194),Promise)],_0x5cdb14['prototype'],'refreshSessions',null),_0x5efa1e['SessionRefreshScheduler']=_0x5cdb14=_0x392c82([(0x0,_0x224f7e['Injectable'])(),_0x5ce1f6('design:paramtypes',['function'==typeof(_0x2ab23f=void 0x0!==_0x22356e['BankService']&&_0x22356e['BankService'])?_0x2ab23f:Object,_0x2541d9(0x24f)==typeof(_0x4179f5=void 0x0!==_0x2f12b2['DeviceService']&&_0x2f12b2['DeviceService'])?_0x4179f5:Object,_0x2541d9(0x24f)==typeof(_0x3be3e0=void 0x0!==_0x12e737['SessionManagementService']&&_0x12e737['SessionManagementService'])?_0x3be3e0:Object,_0x2541d9(0x24f)==typeof(_0x112863=void 0x0!==_0x1efa5d[_0x2541d9(0x29e)]&&_0x1efa5d[_0x2541d9(0x29e)])?_0x112863:Object])],_0x5cdb14);},function(_0x3cf40f,_0x5f23d1,_0x38e104){const _0x5a131e=a0_0x23a4;var _0x138b2e=this&&this['__decorate']||function(_0x5ddc1b,_0xc26519,_0x5c877b,_0x9e2dd7){const _0x5cf714=a0_0x23a4;var _0x38a7cd,_0x2e4d0b=arguments['length'],_0xe7028e=_0x2e4d0b<0x3?_0xc26519:null===_0x9e2dd7?_0x9e2dd7=Object[_0x5cf714(0x26e)](_0xc26519,_0x5c877b):_0x9e2dd7;if(_0x5cf714(0x34a)==typeof Reflect&&'function'==typeof Reflect[_0x5cf714(0x2e3)])_0xe7028e=Reflect[_0x5cf714(0x2e3)](_0x5ddc1b,_0xc26519,_0x5c877b,_0x9e2dd7);else{for(var _0x548c2f=_0x5ddc1b['length']-0x1;_0x548c2f>=0x0;_0x548c2f--)(_0x38a7cd=_0x5ddc1b[_0x548c2f])&&(_0xe7028e=(_0x2e4d0b<0x3?_0x38a7cd(_0xe7028e):_0x2e4d0b>0x3?_0x38a7cd(_0xc26519,_0x5c877b,_0xe7028e):_0x38a7cd(_0xc26519,_0x5c877b))||_0xe7028e);}return _0x2e4d0b>0x3&&_0xe7028e&&Object['defineProperty'](_0xc26519,_0x5c877b,_0xe7028e),_0xe7028e;};Object['defineProperty'](_0x5f23d1,_0x5a131e(0x3f1),{'value':!0x0}),_0x5f23d1['OCRModule']=void 0x0;const _0x442081=_0x38e104(0x2),_0x343ad2=_0x38e104(0x1c),_0x325bc8=_0x38e104(0x1e),_0x3d0142=_0x38e104(0x1b);let _0x54635c=class{};_0x5f23d1['OCRModule']=_0x54635c,_0x5f23d1['OCRModule']=_0x54635c=_0x138b2e([(0x0,_0x442081['Module'])({'providers':[_0x343ad2['OCRWorkerPoolService'],_0x325bc8['ImagePreprocessingService'],_0x3d0142[_0x5a131e(0x1b9)]],'exports':[_0x3d0142['OCRService'],_0x343ad2['OCRWorkerPoolService'],_0x325bc8[_0x5a131e(0x375)]]})],_0x54635c);},function(_0x190cd4,_0x21d04e,_0x4ae443){const _0x16f679=a0_0x23a4;var _0x40d26b=this&&this[_0x16f679(0x1f9)]||function(_0x2d9c90,_0x3c0f80,_0x475ba9,_0x199d52){const _0x45f650=_0x16f679;var _0x1718be,_0x336590=arguments['length'],_0x479d98=_0x336590<0x3?_0x3c0f80:null===_0x199d52?_0x199d52=Object['getOwnPropertyDescriptor'](_0x3c0f80,_0x475ba9):_0x199d52;if(_0x45f650(0x34a)==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x479d98=Reflect['decorate'](_0x2d9c90,_0x3c0f80,_0x475ba9,_0x199d52);else{for(var _0x176434=_0x2d9c90['length']-0x1;_0x176434>=0x0;_0x176434--)(_0x1718be=_0x2d9c90[_0x176434])&&(_0x479d98=(_0x336590<0x3?_0x1718be(_0x479d98):_0x336590>0x3?_0x1718be(_0x3c0f80,_0x475ba9,_0x479d98):_0x1718be(_0x3c0f80,_0x475ba9))||_0x479d98);}return _0x336590>0x3&&_0x479d98&&Object['defineProperty'](_0x3c0f80,_0x475ba9,_0x479d98),_0x479d98;};Object[_0x16f679(0x213)](_0x21d04e,'__esModule',{'value':!0x0}),_0x21d04e['NotificationModule']=void 0x0;const _0x19f247=_0x4ae443(0x2),_0x75d768=_0x4ae443(0x35),_0x5f2a0d=_0x4ae443(0x36),_0x1ff667=_0x4ae443(0x8),_0x1ebcc7=_0x4ae443(0x2c);let _0x5a0c4f=class{};_0x21d04e['NotificationModule']=_0x5a0c4f,_0x21d04e['NotificationModule']=_0x5a0c4f=_0x40d26b([(0x0,_0x19f247['Global'])(),(0x0,_0x19f247['Module'])({'imports':[_0x1ff667['HttpModule']],'providers':[_0x75d768['NotificationService'],_0x5f2a0d[_0x16f679(0x426)],_0x1ebcc7['TelegramService']],'exports':[_0x75d768[_0x16f679(0x2ac)],_0x1ebcc7['TelegramService']]})],_0x5a0c4f);},function(_0x11b50c,_0x51b530,_0x525e2a){const _0x4ce8fc=a0_0x23a4;var _0x44bca1=this&&this[_0x4ce8fc(0x1f9)]||function(_0x41eb1f,_0x46880c,_0x568bf2,_0x2f6c1f){const _0x3b564b=_0x4ce8fc;var _0x32a7d6,_0x50c097=arguments[_0x3b564b(0x1fa)],_0x5ede3b=_0x50c097<0x3?_0x46880c:null===_0x2f6c1f?_0x2f6c1f=Object['getOwnPropertyDescriptor'](_0x46880c,_0x568bf2):_0x2f6c1f;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x3b564b(0x2e3)])_0x5ede3b=Reflect['decorate'](_0x41eb1f,_0x46880c,_0x568bf2,_0x2f6c1f);else{for(var _0x3a07d6=_0x41eb1f['length']-0x1;_0x3a07d6>=0x0;_0x3a07d6--)(_0x32a7d6=_0x41eb1f[_0x3a07d6])&&(_0x5ede3b=(_0x50c097<0x3?_0x32a7d6(_0x5ede3b):_0x50c097>0x3?_0x32a7d6(_0x46880c,_0x568bf2,_0x5ede3b):_0x32a7d6(_0x46880c,_0x568bf2))||_0x5ede3b);}return _0x50c097>0x3&&_0x5ede3b&&Object['defineProperty'](_0x46880c,_0x568bf2,_0x5ede3b),_0x5ede3b;};Object['defineProperty'](_0x51b530,'__esModule',{'value':!0x0}),_0x51b530['WindowAppModule']=void 0x0;const _0x2ad792=_0x525e2a(0x2),_0x1f673e=_0x525e2a(0x3e);let _0x1bd834=class{};_0x51b530[_0x4ce8fc(0x258)]=_0x1bd834,_0x51b530[_0x4ce8fc(0x258)]=_0x1bd834=_0x44bca1([(0x0,_0x2ad792[_0x4ce8fc(0x352)])({'providers':[_0x1f673e['WindowsAppGitBashService']],'exports':[_0x1f673e[_0x4ce8fc(0x3ba)]]})],_0x1bd834);},function(_0x4b355b,_0x5c611c,_0x4b7ecf){const _0x2c1d80=a0_0x23a4;var _0x4ff554=this&&this['__decorate']||function(_0x47229c,_0x2e1678,_0x469177,_0x3a85c6){const _0x370014=a0_0x23a4;var _0x57d6d6,_0x3ff6b0=arguments['length'],_0x46c507=_0x3ff6b0<0x3?_0x2e1678:null===_0x3a85c6?_0x3a85c6=Object[_0x370014(0x26e)](_0x2e1678,_0x469177):_0x3a85c6;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x46c507=Reflect['decorate'](_0x47229c,_0x2e1678,_0x469177,_0x3a85c6);else{for(var _0x2a3f5d=_0x47229c['length']-0x1;_0x2a3f5d>=0x0;_0x2a3f5d--)(_0x57d6d6=_0x47229c[_0x2a3f5d])&&(_0x46c507=(_0x3ff6b0<0x3?_0x57d6d6(_0x46c507):_0x3ff6b0>0x3?_0x57d6d6(_0x2e1678,_0x469177,_0x46c507):_0x57d6d6(_0x2e1678,_0x469177))||_0x46c507);}return _0x3ff6b0>0x3&&_0x46c507&&Object['defineProperty'](_0x2e1678,_0x469177,_0x46c507),_0x46c507;};Object[_0x2c1d80(0x213)](_0x5c611c,'__esModule',{'value':!0x0}),_0x5c611c['RedisLockModule']=void 0x0;const _0x372506=_0x4b7ecf(0x2),_0x354460=_0x4b7ecf(0xf),_0x10bd61=_0x4b7ecf(0x41);let _0x479d93=class{};_0x5c611c[_0x2c1d80(0x1f2)]=_0x479d93,_0x5c611c[_0x2c1d80(0x1f2)]=_0x479d93=_0x4ff554([(0x0,_0x372506['Global'])(),(0x0,_0x372506[_0x2c1d80(0x352)])({'providers':[_0x354460['RedisService'],_0x10bd61['RedisLockService']],'exports':[_0x10bd61['RedisLockService']]})],_0x479d93);}],_0x64dda6={};function _0x4550d9(_0x567670){var _0x21469e=_0x64dda6[_0x567670];if(void 0x0!==_0x21469e)return _0x21469e['exports'];var _0x3ba7a4=_0x64dda6[_0x567670]={'exports':{}};return _0x4fccc8[_0x567670]['call'](_0x3ba7a4['exports'],_0x3ba7a4,_0x3ba7a4['exports'],_0x4550d9),_0x3ba7a4['exports'];}var _0x342dcf={};((()=>{const _0x38ee22=a0_0x23a4;var _0x5bf488=_0x342dcf;Object[_0x38ee22(0x213)](_0x5bf488,_0x38ee22(0x3f1),{'value':!0x0});const _0x5bf0ab=_0x4550d9(0x1),_0x4953fd=_0x4550d9(0x2),_0x23ca50=_0x4550d9(0x3),_0xca0931=_0x4550d9(0x4),_0x5239b5=_0x4550d9(0x5),_0x595070=_0x4550d9(0x11);!(async function(){const _0x576801=_0x38ee22,_0x3be405=await _0x5bf0ab['NestFactory'][_0x576801(0x181)](_0x5239b5[_0x576801(0x2c6)],{}),_0x8440a9=new _0x4953fd['Logger']('Bootstrap'),_0x207938='production'===process['env']['NODE_ENV']?(0x0,_0xca0931['join'])(__dirname,'views'):(0x0,_0xca0931[_0x576801(0x25a)])(process[_0x576801(0x25e)](),'src','views');_0x3be405[_0x576801(0x3bd)](_0x207938),_0x3be405['setViewEngine']('ejs'),_0x8440a9['log'](_0x576801(0x3c0)+_0x207938),_0x3be405['useGlobalPipes'](new _0x4953fd[(_0x576801(0x2d4))]({'transform':!0x0,'whitelist':!0x0,'forbidNonWhitelisted':!0x0}));const _0x1f57f1=new _0x23ca50['DocumentBuilder']()[_0x576801(0x2fe)](_0x576801(0x3ad))['setDescription'](_0x576801(0x232))['setVersion']('1.0')['addTag']('bank','Bank\x20operations')['addTag']('withdrawal','Withdrawal\x20processing')['addTag'](_0x576801(0x279),'Device\x20management')['addTag'](_0x576801(0x3fa),'HC\x20Box\x20integration')[_0x576801(0x160)](),_0x59c236=_0x23ca50['SwaggerModule']['createDocument'](_0x3be405,_0x1f57f1);_0x23ca50['SwaggerModule']['setup']('docs',_0x3be405,_0x59c236);const _0x2a3726=process['env'][_0x576801(0x2f9)]||0xbba;_0x8440a9['log']('üìö\x20Swagger\x20documentation\x20available\x20at:\x20http://localhost:'+_0x2a3726+'/docs'),await _0x3be405['listen'](_0x2a3726),_0x8440a9[_0x576801(0x230)](_0x576801(0x18e)+_0x2a3726),_0x8440a9[_0x576801(0x230)]('üìä\x20Withdrawal\x20processing\x20started\x20by\x20'+_0x595070['config']['boxType']+'\x20box'),_0x8440a9['log']('üåê\x20Device\x20management:\x20http://localhost:'+_0x2a3726);}());})());})()));
//# sourceMappingURL=main.js.map
//# sourceMappingURL=main.js.map