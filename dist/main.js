(function(_0x53b123,_0xe75dd4){const _0x3373b7=a0_0x14ea,_0x4d771f=_0x53b123();while(!![]){try{const _0x309e1a=-parseInt(_0x3373b7(0xa4))/0x1*(parseInt(_0x3373b7(0x1a8))/0x2)+-parseInt(_0x3373b7(0x20d))/0x3*(parseInt(_0x3373b7(0xe7))/0x4)+parseInt(_0x3373b7(0x1fc))/0x5*(-parseInt(_0x3373b7(0x20e))/0x6)+-parseInt(_0x3373b7(0x20c))/0x7*(-parseInt(_0x3373b7(0x174))/0x8)+parseInt(_0x3373b7(0x12c))/0x9+-parseInt(_0x3373b7(0x298))/0xa*(-parseInt(_0x3373b7(0x1a5))/0xb)+parseInt(_0x3373b7(0x13a))/0xc;if(_0x309e1a===_0xe75dd4)break;else _0x4d771f['push'](_0x4d771f['shift']());}catch(_0xcd0737){_0x4d771f['push'](_0x4d771f['shift']());}}}(a0_0x5c01,0xd666c),((()=>{'use strict';var _0x29d046=[,_0x5f33aa=>{const _0x9c94b3=a0_0x14ea;_0x5f33aa[_0x9c94b3(0x1f0)]=require('@nestjs/core');},_0x5a26c1=>{_0x5a26c1['exports']=require('@nestjs/common');},_0x553876=>{_0x553876['exports']=require('@nestjs/swagger');},_0xf73e2b=>{_0xf73e2b['exports']=require('path');},function(_0x57efa5,_0x5f3bd1,_0x2c810b){const _0x4b6d86=a0_0x14ea;var _0x7ec1=this&&this[_0x4b6d86(0x13c)]||function(_0x3a9110,_0x5d9e91,_0x47f503,_0x2b7829){const _0x199b19=_0x4b6d86;var _0x118882,_0x5ebccf=arguments[_0x199b19(0x132)],_0xf464e5=_0x5ebccf<0x3?_0x5d9e91:null===_0x2b7829?_0x2b7829=Object['getOwnPropertyDescriptor'](_0x5d9e91,_0x47f503):_0x2b7829;if('object'==typeof Reflect&&_0x199b19(0x10a)==typeof Reflect['decorate'])_0xf464e5=Reflect['decorate'](_0x3a9110,_0x5d9e91,_0x47f503,_0x2b7829);else{for(var _0x13bbd4=_0x3a9110['length']-0x1;_0x13bbd4>=0x0;_0x13bbd4--)(_0x118882=_0x3a9110[_0x13bbd4])&&(_0xf464e5=(_0x5ebccf<0x3?_0x118882(_0xf464e5):_0x5ebccf>0x3?_0x118882(_0x5d9e91,_0x47f503,_0xf464e5):_0x118882(_0x5d9e91,_0x47f503))||_0xf464e5);}return _0x5ebccf>0x3&&_0xf464e5&&Object['defineProperty'](_0x5d9e91,_0x47f503,_0xf464e5),_0xf464e5;};Object['defineProperty'](_0x5f3bd1,_0x4b6d86(0x22f),{'value':!0x0}),_0x5f3bd1[_0x4b6d86(0x212)]=void 0x0;const _0x24162f=_0x2c810b(0x2),_0x42cf7e=_0x2c810b(0x6),_0x2f782c=_0x2c810b(0x7),_0xfcb26c=_0x2c810b(0x8),_0x427a94=_0x2c810b(0x9),_0x23cc38=_0x2c810b(0x32),_0x74fcff=_0x2c810b(0x33),_0x155f37=_0x2c810b(0x16),_0x3211ab=_0x2c810b(0x39),_0x4c681a=_0x2c810b(0xf),_0x326841=_0x2c810b(0x37),_0x1d6754=_0x2c810b(0x3e);let _0x28c6a2=class{};_0x5f3bd1['AppModule']=_0x28c6a2,_0x5f3bd1[_0x4b6d86(0x212)]=_0x28c6a2=_0x7ec1([(0x0,_0x24162f[_0x4b6d86(0x27f)])({'imports':[_0x42cf7e['BullModule']['forRoot']({'redis':{'host':_0x4c681a['config']['redis']['host'],'port':_0x4c681a['config'][_0x4b6d86(0x1dd)]['port'],'db':_0x4c681a[_0x4b6d86(0x14f)]['redis']['db'],'password':_0x4c681a['config']['redis'][_0x4b6d86(0x276)]},'defaultJobOptions':{'removeOnComplete':0xa,'removeOnFail':0x32,'attempts':0x3,'backoff':{'type':'exponential','delay':0x7d0}}}),_0x2f782c[_0x4b6d86(0xb4)][_0x4b6d86(0x29c)](),_0xfcb26c['HttpModule'],_0x427a94['WithdrawalModule'],_0x23cc38['HcBoxModule'],_0x74fcff['DeviceModule'],_0x3211ab['WebSocketModule'],_0x326841['BankModule'],_0x1d6754['OCRModule']],'providers':[_0x155f37[_0x4b6d86(0x27c)]],'exports':[_0x155f37['RedisService']]})],_0x28c6a2);},_0x5b14d8=>{const _0x306e99=a0_0x14ea;_0x5b14d8[_0x306e99(0x1f0)]=require('@nestjs/bull');},_0x264738=>{_0x264738['exports']=require('@nestjs/schedule');},_0x19d308=>{_0x19d308['exports']=require('@nestjs/axios');},function(_0xd394b5,_0x21f961,_0x5b9e93){const _0x4f0dab=a0_0x14ea;var _0x13907e=this&&this[_0x4f0dab(0x13c)]||function(_0x8fba32,_0x103195,_0x126188,_0x154383){const _0x1039f5=_0x4f0dab;var _0x3b80cd,_0x34f322=arguments['length'],_0x3ee82b=_0x34f322<0x3?_0x103195:null===_0x154383?_0x154383=Object['getOwnPropertyDescriptor'](_0x103195,_0x126188):_0x154383;if('object'==typeof Reflect&&_0x1039f5(0x10a)==typeof Reflect['decorate'])_0x3ee82b=Reflect['decorate'](_0x8fba32,_0x103195,_0x126188,_0x154383);else{for(var _0x1534bf=_0x8fba32[_0x1039f5(0x132)]-0x1;_0x1534bf>=0x0;_0x1534bf--)(_0x3b80cd=_0x8fba32[_0x1534bf])&&(_0x3ee82b=(_0x34f322<0x3?_0x3b80cd(_0x3ee82b):_0x34f322>0x3?_0x3b80cd(_0x103195,_0x126188,_0x3ee82b):_0x3b80cd(_0x103195,_0x126188))||_0x3ee82b);}return _0x34f322>0x3&&_0x3ee82b&&Object[_0x1039f5(0x176)](_0x103195,_0x126188,_0x3ee82b),_0x3ee82b;};Object['defineProperty'](_0x21f961,'__esModule',{'value':!0x0}),_0x21f961['WithdrawalModule']=void 0x0;const _0x28f9ae=_0x5b9e93(0x2),_0x7231fe=_0x5b9e93(0x6),_0x4e52c7=_0x5b9e93(0x7),_0x5cf1cc=_0x5b9e93(0xa),_0x13e1df=_0x5b9e93(0x2d),_0xf71da8=_0x5b9e93(0x31),_0x4746f0=_0x5b9e93(0xb),_0x4a1742=_0x5b9e93(0x16),_0x3fafab=_0x5b9e93(0x32),_0x529e4c=_0x5b9e93(0x33),_0x426795=_0x5b9e93(0x37),_0x5cd8d9=_0x5b9e93(0x8);let _0x41e1eb=class{};_0x21f961['WithdrawalModule']=_0x41e1eb,_0x21f961[_0x4f0dab(0x204)]=_0x41e1eb=_0x13907e([(0x0,_0x28f9ae['Module'])({'imports':[_0x7231fe[_0x4f0dab(0xb9)][_0x4f0dab(0x196)]({'name':'wda-request'}),_0x4e52c7['ScheduleModule'],_0x3fafab[_0x4f0dab(0x1c1)],(0x0,_0x28f9ae['forwardRef'])(()=>_0x529e4c['DeviceModule']),_0x426795['BankModule'],_0x5cd8d9['HttpModule']],'controllers':[_0xf71da8['WithdrawalController']],'providers':[_0x5cf1cc['WithdrawalService'],_0x13e1df[_0x4f0dab(0x225)],_0x4746f0['EzpayBeClientService'],_0x4a1742['RedisService']],'exports':[_0x5cf1cc[_0x4f0dab(0x117)]]})],_0x41e1eb);},function(_0x276aad,_0xe885eb,_0x4948e7){const _0x26ed0d=a0_0x14ea;var _0x57d4dd,_0xcc6099,_0x5a0dba,_0x1b50fc,_0x19943a,_0x4150d7,_0x4cdee6=this&&this[_0x26ed0d(0x13c)]||function(_0x5a6a69,_0x33ad23,_0x55bf5b,_0x1c0e4d){const _0x87fab9=_0x26ed0d;var _0x39eef3,_0x6b321f=arguments[_0x87fab9(0x132)],_0x48c248=_0x6b321f<0x3?_0x33ad23:null===_0x1c0e4d?_0x1c0e4d=Object['getOwnPropertyDescriptor'](_0x33ad23,_0x55bf5b):_0x1c0e4d;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x48c248=Reflect['decorate'](_0x5a6a69,_0x33ad23,_0x55bf5b,_0x1c0e4d);else{for(var _0x3c17e0=_0x5a6a69['length']-0x1;_0x3c17e0>=0x0;_0x3c17e0--)(_0x39eef3=_0x5a6a69[_0x3c17e0])&&(_0x48c248=(_0x6b321f<0x3?_0x39eef3(_0x48c248):_0x6b321f>0x3?_0x39eef3(_0x33ad23,_0x55bf5b,_0x48c248):_0x39eef3(_0x33ad23,_0x55bf5b))||_0x48c248);}return _0x6b321f>0x3&&_0x48c248&&Object[_0x87fab9(0x176)](_0x33ad23,_0x55bf5b,_0x48c248),_0x48c248;},_0x33bec2=this&&this['__metadata']||function(_0x8d8062,_0x816fd4){const _0x2ca985=_0x26ed0d;if(_0x2ca985(0x217)==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect[_0x2ca985(0x21e)](_0x8d8062,_0x816fd4);},_0x2078f2=this&&this['__param']||function(_0x1850d7,_0x109794){return function(_0x193cd5,_0xd5d6bb){_0x109794(_0x193cd5,_0xd5d6bb,_0x1850d7);};};Object['defineProperty'](_0xe885eb,'__esModule',{'value':!0x0}),_0xe885eb[_0x26ed0d(0x117)]=void 0x0;const _0xe4de38=_0x4948e7(0x2),_0x21cd0f=_0x4948e7(0xb),_0xc500dd=_0x4948e7(0x12),_0xa5680f=_0x4948e7(0x15),_0x377011=_0x4948e7(0x2b),_0x2ce03f=_0x4948e7(0x16),_0x186088=_0x4948e7(0x14),_0x4138db=_0x4948e7(0x19),_0x404bee=_0x4948e7(0x28);let _0xe193f4=class{constructor(_0x566573,_0x48a4e4,_0x1a38d7,_0x27ba07,_0x2afb0a,_0x1dc566){const _0x20bbed=_0x26ed0d;this[_0x20bbed(0x28d)]=_0x566573,this['wsService']=_0x48a4e4,this['bankService']=_0x1a38d7,this[_0x20bbed(0x1f8)]=_0x27ba07,this[_0x20bbed(0x293)]=_0x2afb0a,this[_0x20bbed(0x1ff)]=_0x1dc566,this[_0x20bbed(0x27d)]=new _0xe4de38['Logger'](_0x20bbed(0x117)),this['REDIS_PROCESSED_PREFIX']='withdrawal:processed:',this['PROCESSING_TTL']=0xf731400,this[_0x20bbed(0x197)]=0xf731400;}async['checkIfProcessed'](_0x7d4f4b){const _0x26b0b8=_0x26ed0d;try{const _0x21c0e5=''+this[_0x26b0b8(0xaf)]+_0x7d4f4b,_0x5386f8=await this['redisService']['get'](_0x21c0e5);return'completed'===_0x5386f8?(this['logger']['warn']('Withdrawal\x20'+_0x7d4f4b+'\x20already\x20completed'),!0x0):'processing'===_0x5386f8&&(this['logger'][_0x26b0b8(0x26d)]('Withdrawal\x20'+_0x7d4f4b+'\x20is\x20being\x20processed\x20by\x20another\x20instance'),!0x0);}catch(_0x3c3c54){return this['logger'][_0x26b0b8(0xf2)]('Error\x20checking\x20processed\x20status\x20for\x20'+_0x7d4f4b+':\x20'+_0x3c3c54['message']),!0x1;}}async['markAsProcessing'](_0x3e39f8){const _0x3d83ea=_0x26ed0d;try{const _0x9f62b9=''+this['REDIS_PROCESSED_PREFIX']+_0x3e39f8;return'OK'===await this['redisService']['setnx'](_0x9f62b9,_0x3d83ea(0x163),this['PROCESSING_TTL'])?(this['logger'][_0x3d83ea(0x1e5)](_0x3d83ea(0x195)+_0x3e39f8+'\x20as\x20processing'),!0x0):(this['logger']['warn']('Withdrawal\x20'+_0x3e39f8+_0x3d83ea(0x203)),!0x1);}catch(_0x3f7409){return this[_0x3d83ea(0x27d)]['error'](_0x3d83ea(0xbc)+_0x3e39f8+'\x20as\x20processing:\x20'+_0x3f7409['message']),!0x0;}}async['markAsCompleted'](_0x59e229){const _0x420c60=_0x26ed0d;try{const _0x5b36db=''+this[_0x420c60(0xaf)]+_0x59e229;await this['redisService'][_0x420c60(0x21c)](_0x5b36db,'completed',this['COMPLETED_TTL']),this[_0x420c60(0x27d)]['log'](_0x420c60(0x195)+_0x59e229+'\x20as\x20completed');}catch(_0x11d62e){this[_0x420c60(0x27d)]['error'](_0x420c60(0xbc)+_0x59e229+'\x20as\x20completed:\x20'+_0x11d62e['message']);}}async[_0x26ed0d(0xc4)](_0x3f90c5){const _0xd49a39=_0x26ed0d;try{const _0x800f20=''+this['REDIS_PROCESSED_PREFIX']+_0x3f90c5;await this[_0xd49a39(0x1ff)]['del'](_0x800f20),this['logger']['log']('Marked\x20withdrawal\x20'+_0x3f90c5+'\x20as\x20failed\x20(removed\x20from\x20processed\x20list)');}catch(_0xf54748){this[_0xd49a39(0x27d)][_0xd49a39(0xf2)]('Error\x20marking\x20withdrawal\x20'+_0x3f90c5+'\x20as\x20failed:\x20'+_0xf54748[_0xd49a39(0x1dc)]);}}async[_0x26ed0d(0x152)](_0x18168e,_0x35d1b7){const _0x3dab5e=_0x26ed0d,{withdrawalId:_0x5a6ac0,bankCode:_0x33db02,amount:_0x19f639}=_0x18168e;if(await this['checkIfProcessed'](_0x5a6ac0))return void this['logger']['warn']('Withdrawal\x20'+_0x5a6ac0+'\x20already\x20processed\x20or\x20being\x20processed,\x20skipping');if(!await this['markAsProcessing'](_0x5a6ac0)){const _0x5139fe='Withdrawal\x20'+_0x5a6ac0+_0x3dab5e(0xdc);throw this['logger']['warn'](_0x5139fe),new _0x404bee['WithdrawalProcessingError'](_0x5139fe,_0x404bee['ErrorType']['TEMPORARY']);}let _0x50fa8b=!0x0,_0x417736=!0x1;try{this[_0x3dab5e(0x27d)]['log']('Processing\x20withdrawal:\x20'+_0x5a6ac0+'\x20for\x20bank:\x20'+_0x33db02+',\x20amount:\x20'+_0x19f639+_0x3dab5e(0x2af)+_0x35d1b7);const _0x3a0af9=await this[_0x3dab5e(0x1f8)]['getDeviceConfig'](_0x35d1b7);if(!_0x3a0af9||'active'!==_0x3a0af9['status']){const _0x4ad786=_0x3dab5e(0x227)+_0x35d1b7+'\x20is\x20not\x20active\x20or\x20not\x20found';throw this['logger']['error'](_0x4ad786),await this['markAsFailed'](_0x5a6ac0),_0x50fa8b=!0x1,new _0x404bee[(_0x3dab5e(0x18b))](_0x4ad786,_0x404bee[_0x3dab5e(0x121)]['TEMPORARY']);}if(_0x3a0af9[_0x3dab5e(0x1ef)]<_0x19f639){const _0x51195c=_0x3dab5e(0x227)+_0x35d1b7+'\x20has\x20insufficient\x20amount.\x20Available:\x20'+_0x3a0af9[_0x3dab5e(0x1ef)]+_0x3dab5e(0x21d)+_0x19f639;throw this['logger'][_0x3dab5e(0xf2)](_0x51195c),await this['markAsFailed'](_0x5a6ac0),_0x50fa8b=!0x1,await this['deviceService']['updateDeviceConfig'](_0x35d1b7,{'status':'deactive'}),new _0x404bee['WithdrawalProcessingError'](_0x51195c,_0x404bee[_0x3dab5e(0x121)]['TEMPORARY']);}if(!await this['bankService']['isSessionValid'](_0x35d1b7,_0x3a0af9['bankCode'])){const _0x465b57='Assigned\x20device\x20'+_0x35d1b7+'\x20does\x20not\x20have\x20valid\x20session\x20for\x20bank\x20'+_0x3a0af9['bankCode'];throw this['logger'][_0x3dab5e(0xf2)](_0x465b57),await this['markAsFailed'](_0x5a6ac0),_0x50fa8b=!0x1,new _0x404bee['WithdrawalProcessingError'](_0x465b57,_0x404bee['ErrorType']['TEMPORARY']);}const _0x1cd93f=_0x35d1b7;await this['bankService']['executeTransferWithQRCode'](_0x18168e,_0x3a0af9,_0x3a0af9['bankCode']),this[_0x3dab5e(0x1f8)]['deductDeviceAmount'](_0x1cd93f,_0x19f639)['catch'](()=>{}),await this['markAsCompleted'](_0x5a6ac0),_0x417736=!0x0,_0x50fa8b=!0x1;const _0xceb87a=await this['bankService']['analyzeTransferBill'](_0x3a0af9['bankCode'],_0x18168e);this['notifyEzpayBe'](_0x18168e,_0xceb87a,_0x3a0af9)[_0x3dab5e(0x1c9)](()=>{}),_0x3dab5e(0xcb)===_0xceb87a['analyzedStatus']&&await this[_0x3dab5e(0x1de)]['login'](_0x3a0af9['bankCode'],_0x1cd93f,!0x0),this['logger'][_0x3dab5e(0x133)](_0x3dab5e(0x286)+_0x5a6ac0);}catch(_0x3fc007){if(_0x3fc007 instanceof _0x404bee['WithdrawalProcessingError'])throw _0x3fc007;throw this[_0x3dab5e(0x27d)][_0x3dab5e(0xf2)](_0x3dab5e(0x186)+_0x5a6ac0+':\x20'+_0x3fc007['message'],_0x3fc007['stack']),await this['markAsFailed'](_0x5a6ac0),_0x50fa8b=!0x1,new _0x404bee['WithdrawalProcessingError'](_0x3fc007['message']||'Unknown\x20error',_0x404bee['ErrorType'][_0x3dab5e(0xc3)]);}finally{await this['deviceLock'][_0x3dab5e(0x1a3)](_0x35d1b7),_0x50fa8b&&!_0x417736&&await this[_0x3dab5e(0xc4)](_0x5a6ac0);}}async['notifyEzpayBe'](_0x546f58,_0x69aa53,_0x493f1){const _0x596d26=_0x26ed0d;this['ezpayBeClient']['updateWithdrawalStatus'](_0x546f58['_id'],{'analyzedStatus':_0x69aa53['analyzedStatus'],'sourceAccountNo':_0x493f1['accountNo'],'sourceBankCode':_0x493f1[_0x596d26(0x200)],'sourceAccountName':_0x493f1['accountName']})[_0x596d26(0x1c9)](_0x16909f=>{const _0x306de8=_0x596d26;this['logger'][_0x306de8(0xf2)]('['+_0x546f58['withdrawalCode']+']\x20-\x20Error\x20updating\x20withdrawal\x20status\x20for\x20'+_0x546f58['_id']+'\x20-\x20'+_0x16909f['stack']);}),this[_0x596d26(0x28d)]['uploadReceipt'](_0x546f58[_0x596d26(0xd4)],_0x69aa53[_0x596d26(0x1a1)])['catch'](_0x490a84=>{const _0x543b46=_0x596d26;this['logger'][_0x543b46(0xf2)]('['+_0x546f58['withdrawalCode']+_0x543b46(0x218)+_0x546f58['_id']+'\x20-\x20'+_0x490a84[_0x543b46(0x2ad)]);});}};_0xe885eb[_0x26ed0d(0x117)]=_0xe193f4,_0xe885eb[_0x26ed0d(0x117)]=_0xe193f4=_0x4cdee6([(0x0,_0xe4de38['Injectable'])(),_0x2078f2(0x1,(0x0,_0xe4de38[_0x26ed0d(0x22d)])(_0x186088['WEBSOCKET_SERVICE'])),_0x2078f2(0x3,(0x0,_0xe4de38[_0x26ed0d(0x22d)])((0x0,_0xe4de38[_0x26ed0d(0x12a)])(()=>_0xa5680f[_0x26ed0d(0x100)]))),_0x33bec2(_0x26ed0d(0x109),[_0x26ed0d(0x10a)==typeof(_0x57d4dd=void 0x0!==_0x21cd0f[_0x26ed0d(0x1fb)]&&_0x21cd0f[_0x26ed0d(0x1fb)])?_0x57d4dd:Object,'function'==typeof(_0xcc6099=void 0x0!==_0x4138db['IWebSocketService']&&_0x4138db['IWebSocketService'])?_0xcc6099:Object,'function'==typeof(_0x5a0dba=void 0x0!==_0xc500dd[_0x26ed0d(0x26f)]&&_0xc500dd['BankService'])?_0x5a0dba:Object,'function'==typeof(_0x1b50fc=void 0x0!==_0xa5680f['DeviceService']&&_0xa5680f['DeviceService'])?_0x1b50fc:Object,'function'==typeof(_0x19943a=void 0x0!==_0x377011['DeviceLockService']&&_0x377011['DeviceLockService'])?_0x19943a:Object,'function'==typeof(_0x4150d7=void 0x0!==_0x2ce03f['RedisService']&&_0x2ce03f['RedisService'])?_0x4150d7:Object])],_0xe193f4);},function(_0xd6731a,_0x58bff3,_0x64ba1f){const _0x45216b=a0_0x14ea;var _0xf3754b,_0x4cb735=this&&this[_0x45216b(0x13c)]||function(_0x48822f,_0x2c68ee,_0x3e9dec,_0x13e891){const _0x21502b=_0x45216b;var _0x1f277b,_0x1f7bba=arguments['length'],_0x408275=_0x1f7bba<0x3?_0x2c68ee:null===_0x13e891?_0x13e891=Object['getOwnPropertyDescriptor'](_0x2c68ee,_0x3e9dec):_0x13e891;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x21502b(0xcf)])_0x408275=Reflect[_0x21502b(0xcf)](_0x48822f,_0x2c68ee,_0x3e9dec,_0x13e891);else{for(var _0x4aecbd=_0x48822f[_0x21502b(0x132)]-0x1;_0x4aecbd>=0x0;_0x4aecbd--)(_0x1f277b=_0x48822f[_0x4aecbd])&&(_0x408275=(_0x1f7bba<0x3?_0x1f277b(_0x408275):_0x1f7bba>0x3?_0x1f277b(_0x2c68ee,_0x3e9dec,_0x408275):_0x1f277b(_0x2c68ee,_0x3e9dec))||_0x408275);}return _0x1f7bba>0x3&&_0x408275&&Object['defineProperty'](_0x2c68ee,_0x3e9dec,_0x408275),_0x408275;},_0x2b2518=this&&this['__metadata']||function(_0x437057,_0x54e829){const _0x293572=_0x45216b;if('object'==typeof Reflect&&_0x293572(0x10a)==typeof Reflect['metadata'])return Reflect['metadata'](_0x437057,_0x54e829);};Object[_0x45216b(0x176)](_0x58bff3,'__esModule',{'value':!0x0}),_0x58bff3['EzpayBeClientService']=void 0x0;const _0x53b7fe=_0x64ba1f(0x2),_0x3907e1=_0x64ba1f(0x8),_0x14520f=_0x64ba1f(0xc),_0x5deb99=_0x64ba1f(0xd),_0x5818f2=_0x64ba1f(0xe),_0x4194f9=_0x64ba1f(0xf),_0x414fd5=_0x64ba1f(0x11);let _0x585910=class{constructor(_0x325f8a){const _0x48de68=_0x45216b;this[_0x48de68(0x283)]=_0x325f8a,this[_0x48de68(0x27d)]=new _0x53b7fe['Logger']('EzpayBeClientService'),this[_0x48de68(0x213)]=_0x4194f9['config'][_0x48de68(0x2c1)]['apiUrl']??'http://localhost:3001',this[_0x48de68(0x1c8)]=_0x4194f9['config']['ezpayBe']['apiKey']??'';}async[_0x45216b(0x1b6)](_0x386cfe,_0x536d3e){const _0x405695=_0x45216b;for(let _0x172a8b=0x0;_0x172a8b<=0x3;_0x172a8b++)try{const _0x44961a=this['apiUrl']+'/api/internal/withdrawals/complete/'+_0x386cfe;this['logger']['log']('Updating\x20withdrawal\x20'+_0x386cfe+_0x405695(0xd5)+_0x536d3e[_0x405695(0x28e)]+'\x20(attempt\x20'+(_0x172a8b+0x1)+_0x405695(0xb7));const _0x52508f={'analyzedStatus':_0x536d3e[_0x405695(0x28e)],'sourceBankCode':_0x536d3e['sourceBankCode'],'sourceAccountNo':_0x536d3e['sourceAccountNo'],'sourceAccountName':_0x536d3e[_0x405695(0x145)]},_0x48cb02=await(0x0,_0x14520f['firstValueFrom'])(this['httpService'][_0x405695(0x14d)](_0x44961a,_0x52508f,{'headers':{'Content-Type':'application/json','X-API-Key':this['apiKey'],'x-internal-secret-key':'uHqE5X9H0QEBsqlZpdTHG0fOyvmMtHjCGgsG4ouls3Gz9WvaWg4w9HV3sqETGWfE'},'timeout':0x4e20}));if(0xc8===_0x48cb02['status']||0xcc===_0x48cb02[_0x405695(0x158)])return void this['logger'][_0x405695(0x133)]('Successfully\x20updated\x20withdrawal\x20'+_0x386cfe+'\x20status\x20to\x20'+_0x536d3e['analyzedStatus']);this['logger']['warn']('Unexpected\x20status\x20code\x20'+_0x48cb02['status']+'\x20when\x20updating\x20withdrawal\x20'+_0x386cfe);}catch(_0x5c1197){const _0x4d3510=_0x5c1197,_0x971d09=_0x4d3510[_0x405695(0xf9)]?.['data'],_0x23d224=_0x4d3510['message'];if(_0x172a8b<0x3){const _0x881d7c=0x7d0*Math['pow'](0x2,_0x172a8b);this['logger']['warn']('Failed\x20to\x20update\x20withdrawal\x20'+_0x386cfe+_0x405695(0x1c7)+(_0x172a8b+0x1)+'/4):\x20'+_0x23d224+'.\x20Payload:\x20'+JSON['stringify'](_0x971d09)+',\x20Retrying\x20in\x20'+_0x881d7c+'ms'),await(0x0,_0x414fd5['sleep'])(_0x881d7c);}else this[_0x405695(0x27d)]['error']('Failed\x20to\x20update\x20withdrawal\x20'+_0x386cfe+'\x20after\x204\x20attempts.\x20Payload:\x20'+JSON['stringify'](_0x971d09)+',\x20Error:\x20'+_0x23d224);}}async['uploadReceipt'](_0x1c1819,_0x47377b){const _0x1f68f3=_0x45216b;for(let _0xf15573=0x0;_0xf15573<=0x3;_0xf15573++)try{const _0x3be4e7=this[_0x1f68f3(0x213)]+'/api/internal/withdrawals/upload-receipt/'+_0x1c1819;if(this['logger'][_0x1f68f3(0x133)]('Uploading\x20bill\x20for\x20withdrawal\x20'+_0x1c1819+'\x20(attempt\x20'+(_0xf15573+0x1)+'/4)'),!_0x47377b)return void this['logger']['warn'](_0x1f68f3(0x92)+_0x1c1819);const _0x3ecad3=new _0x5deb99();_0x3ecad3[_0x1f68f3(0x123)]('receipt',(0x0,_0x5818f2['createReadStream'])(_0x47377b));const _0x4d3b7f=await(0x0,_0x14520f['firstValueFrom'])(this['httpService'][_0x1f68f3(0x14d)](_0x3be4e7,_0x3ecad3,{'headers':{..._0x3ecad3['getHeaders'](),'X-API-Key':this[_0x1f68f3(0x1c8)],'x-internal-secret-key':_0x1f68f3(0x2c3)},'timeout':0x4e20}));if(0xc8===_0x4d3b7f['status']||0xcc===_0x4d3b7f['status'])return void this[_0x1f68f3(0x27d)]['log']('Successfully\x20uploaded\x20bill\x20for\x20withdrawal\x20'+_0x1c1819);this[_0x1f68f3(0x27d)][_0x1f68f3(0x26d)]('Unexpected\x20status\x20code\x20'+_0x4d3b7f['status']+'\x20when\x20uploading\x20bill\x20for\x20withdrawal\x20'+_0x1c1819);}catch(_0x398103){const _0x2128ff=_0x398103,_0x5eef80=_0x2128ff['response']?.['data'],_0x168618=_0x2128ff['message'];if(_0xf15573<0x3){const _0xcbc27b=0x7d0*Math['pow'](0x2,_0xf15573);this['logger']['warn'](_0x1f68f3(0xbb)+_0x1c1819+_0x1f68f3(0x1c7)+(_0xf15573+0x1)+'/4):\x20'+_0x168618+_0x1f68f3(0x270)+JSON['stringify'](_0x5eef80)+_0x1f68f3(0xea)+_0xcbc27b+'ms'),await(0x0,_0x414fd5[_0x1f68f3(0x1e6)])(_0xcbc27b);}else this['logger']['error']('Failed\x20to\x20upload\x20bill\x20for\x20withdrawal\x20'+_0x1c1819+_0x1f68f3(0x222)+JSON['stringify'](_0x5eef80)+_0x1f68f3(0x115)+_0x168618);}}};_0x58bff3['EzpayBeClientService']=_0x585910,_0x58bff3['EzpayBeClientService']=_0x585910=_0x4cb735([(0x0,_0x53b7fe['Injectable'])(),_0x2b2518('design:paramtypes',[_0x45216b(0x10a)==typeof(_0xf3754b=void 0x0!==_0x3907e1['HttpService']&&_0x3907e1[_0x45216b(0x12e)])?_0xf3754b:Object])],_0x585910);},_0x53a066=>{_0x53a066['exports']=require('rxjs');},_0x2f07f8=>{_0x2f07f8['exports']=require('form-data');},_0x4e862c=>{const _0x9593c0=a0_0x14ea;_0x4e862c[_0x9593c0(0x1f0)]=require('fs');},(_0x15be7e,_0x3f6e25,_0x18a527)=>{const _0x19185f=a0_0x14ea;Object['defineProperty'](_0x3f6e25,_0x19185f(0x22f),{'value':!0x0}),_0x3f6e25['config']=void 0x0;const _0xb3fd22=_0x18a527(0x10),_0x550c88=_0x18a527(0x4);(0x0,_0xb3fd22['config'])({'path':(0x0,_0x550c88['join'])(process['cwd'](),'.env')}),_0x3f6e25[_0x19185f(0x14f)]={'boxType':'PANDA','redis':{'host':process[_0x19185f(0x1bb)][_0x19185f(0x1ce)]??'14.225.44.234','port':parseInt(process[_0x19185f(0x1bb)][_0x19185f(0x1d2)]??_0x19185f(0x182)),'db':0x3,'password':process['env']['REDIS_PWD']??_0x19185f(0x1a6)},'ezpayBe':{'apiUrl':process['env']['EZZPAY_BE']??'https://api-hn.botpro.world/payment','apiKey':process['env']['EZZPAY_KEY']??_0x19185f(0x2c3)},'ocr':{'poolSize':parseInt(process['env']['OCR_POOL_SIZE']||'4',0xa),'lang':process[_0x19185f(0x1bb)]['OCR_LANG']||'vie','rois':{'singleLine':{'crop':{'x':parseFloat(process['env']['OCR_ROI_SINGLE_X']||'0'),'y':parseFloat(process[_0x19185f(0x1bb)]['OCR_ROI_SINGLE_Y']||'0'),'width':parseFloat(process['env']['OCR_ROI_SINGLE_WIDTH']||'1'),'height':parseFloat(process['env']['OCR_ROI_SINGLE_HEIGHT']||'1')},'psm':parseInt(process['env']['OCR_PSM_SINGLE']||'7',0xa),'charWhitelist':process['env'][_0x19185f(0x1d4)]||'0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\x20.-','maxWidth':parseInt(process['env']['OCR_MAX_WIDTH_SINGLE']||'800',0xa)},'block':{'crop':{'x':parseFloat(process['env']['OCR_ROI_BLOCK_X']||'0'),'y':parseFloat(process[_0x19185f(0x1bb)][_0x19185f(0x1c6)]||'0'),'width':parseFloat(process['env']['OCR_ROI_BLOCK_WIDTH']||'1'),'height':parseFloat(process['env']['OCR_ROI_BLOCK_HEIGHT']||'1')},'psm':parseInt(process['env']['OCR_PSM_BLOCK']||'6',0xa),'charWhitelist':process['env']['OCR_WHITELIST_BLOCK']||void 0x0,'maxWidth':parseInt(process['env']['OCR_MAX_WIDTH_BLOCK']||'1200',0xa)},'full':{'crop':{'x':0x0,'y':0x0,'width':0x1,'height':0x1},'psm':parseInt(process['env']['OCR_PSM_FULL']||'6',0xa),'charWhitelist':void 0x0,'maxWidth':parseInt(process['env']['OCR_MAX_WIDTH_FULL']||'1200',0xa)}}},'spaceocr':{'datacenterPrimary':'https://apipro1.ocr.space/parse/image','datacenterSecond':'https://apipro2.ocr.space/parse/image','key':'G888CWKP2Y06X','keyFree':'K82766678488957'}};},_0x22de70=>{_0x22de70['exports']=require('dotenv');},(_0x143cf4,_0x43ce24)=>{const _0x57028e=a0_0x14ea;Object['defineProperty'](_0x43ce24,'__esModule',{'value':!0x0}),_0x43ce24['sleep']=void 0x0,_0x43ce24[_0x57028e(0x1e6)]=_0x5b26e2=>new Promise(_0x498048=>setTimeout(_0x498048,_0x5b26e2));},function(_0x4f6e67,_0x57a04d,_0x41c74c){const _0x2960a1=a0_0x14ea;var _0x29e7ff,_0x446a57,_0x35f62c,_0x48801f,_0x298714,_0xc93d6a=this&&this[_0x2960a1(0x13c)]||function(_0x1ed76e,_0x282c98,_0x41cba5,_0x57002c){const _0x243bd6=_0x2960a1;var _0x473ffb,_0x282cd9=arguments['length'],_0x5b1db4=_0x282cd9<0x3?_0x282c98:null===_0x57002c?_0x57002c=Object['getOwnPropertyDescriptor'](_0x282c98,_0x41cba5):_0x57002c;if(_0x243bd6(0x217)==typeof Reflect&&'function'==typeof Reflect[_0x243bd6(0xcf)])_0x5b1db4=Reflect['decorate'](_0x1ed76e,_0x282c98,_0x41cba5,_0x57002c);else{for(var _0x1409d8=_0x1ed76e[_0x243bd6(0x132)]-0x1;_0x1409d8>=0x0;_0x1409d8--)(_0x473ffb=_0x1ed76e[_0x1409d8])&&(_0x5b1db4=(_0x282cd9<0x3?_0x473ffb(_0x5b1db4):_0x282cd9>0x3?_0x473ffb(_0x282c98,_0x41cba5,_0x5b1db4):_0x473ffb(_0x282c98,_0x41cba5))||_0x5b1db4);}return _0x282cd9>0x3&&_0x5b1db4&&Object['defineProperty'](_0x282c98,_0x41cba5,_0x5b1db4),_0x5b1db4;},_0x381351=this&&this['__metadata']||function(_0x210f99,_0x23f37d){if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0x210f99,_0x23f37d);};Object['defineProperty'](_0x57a04d,'__esModule',{'value':!0x0}),_0x57a04d[_0x2960a1(0x26f)]=void 0x0;const _0x517747=_0x41c74c(0x2),_0x4a5871=_0x41c74c(0x13),_0x532b04=_0x41c74c(0x26),_0x46c388=_0x41c74c(0x15),_0xb1b46b=_0x41c74c(0x2a),_0x5e4c4b=_0x41c74c(0x2b),_0x49139b=_0x41c74c(0x28);let _0x4daf27=class{constructor(_0xf4601a,_0x19d1c5,_0x4adfd0,_0x5cf4c6,_0x324558){const _0x1d6e7a=_0x2960a1;this[_0x1d6e7a(0x21b)]=_0xf4601a,this[_0x1d6e7a(0xc9)]=_0x19d1c5,this['deviceService']=_0x4adfd0,this['sessionManagement']=_0x5cf4c6,this['deviceLock']=_0x324558,this['logger']=new _0x517747['Logger'](_0x1d6e7a(0x26f)),this['bankServices']=new Map(),this['registerBankService'](this['acbService']),this[_0x1d6e7a(0xec)](this['pgService']);}['registerBankService'](_0x20d541){const _0x51128c=_0x2960a1,_0x3d2bc3=_0x20d541[_0x51128c(0x19b)]()['toUpperCase']();this['bankServices']['set'](_0x3d2bc3,_0x20d541),this['logger']['log']('Registered\x20bank\x20service:\x20'+_0x3d2bc3);}['getBankService'](_0x174f93){const _0x318b3e=_0x2960a1,_0x12dc41=this['bankServices']['get'](_0x174f93[_0x318b3e(0x1f6)]());if(!_0x12dc41)throw new _0x49139b['WithdrawalProcessingError']('Bank\x20'+_0x174f93+'\x20not\x20supported!\x20Cannot\x20find\x20bank\x20service\x20out!',_0x49139b['ErrorType']['PERMANENT']);return _0x12dc41;}['getSupportedBanks'](){return Array['from'](this['bankServices']['keys']());}async[_0x2960a1(0xb8)](_0x652f11,_0xea6cfb,_0x4ebfa0=!0x1){const _0xf270d5=_0x2960a1;if(_0x4ebfa0&&await this[_0xf270d5(0x293)]['releaseLock'](_0xea6cfb),await this['deviceLock']['isLocked'](_0xea6cfb)){const _0x5c2e1d=await this['deviceLock']['getLock'](_0xea6cfb);throw new Error('Device\x20'+_0xea6cfb+'\x20is\x20currently\x20locked\x20by\x20'+_0x5c2e1d?.['lockType']+'\x20('+_0x5c2e1d?.[_0xf270d5(0x1cd)]+').\x20Cannot\x20login.');}const _0x2e2763=_0xf270d5(0xfe)+_0x652f11+':'+_0xea6cfb+':'+Date['now']();if(!await this['deviceLock']['acquireLock'](_0xea6cfb,'login',_0x2e2763,0x41eb0))throw new Error(_0xf270d5(0xd2)+_0xea6cfb);try{await this['sessionManagement']['markLoggingIn'](_0xea6cfb,_0x652f11);const _0x26e393=this['getBankService'](_0x652f11);if(!_0x26e393)throw new Error('Bank\x20service\x20not\x20found\x20for\x20bank\x20code:\x20'+_0x652f11);this['logger']['log']('['+_0xea6cfb+']\x20Logging\x20in\x20to\x20'+_0x652f11),await _0x26e393[_0xf270d5(0xb8)](_0xea6cfb),await this['sessionManagement']['recordLogin'](_0xea6cfb,_0x652f11),this['logger']['log']('['+_0xea6cfb+']\x20Successfully\x20logged\x20in\x20to\x20'+_0x652f11);}catch(_0x821009){throw await this['sessionManagement'][_0xf270d5(0x277)](_0xea6cfb,_0x652f11),_0x821009;}finally{await this[_0xf270d5(0x293)][_0xf270d5(0x1a3)](_0xea6cfb);}}async['loginAllActiveBanks'](){const _0x14a7ae=_0x2960a1;try{const _0x63e58f=(await this['deviceService']['listDevices']())['filter'](_0x435d78=>'active'===_0x435d78['status']&&_0x435d78['bankCode']);if(0x0===_0x63e58f['length'])return void this[_0x14a7ae(0x27d)]['warn']('No\x20active\x20devices\x20found\x20to\x20login');this[_0x14a7ae(0x27d)]['log']('Logging\x20in\x20to\x20'+_0x63e58f[_0x14a7ae(0x132)]+'\x20active\x20device(s)');for(const _0x24bbda of _0x63e58f){const _0x3df6e4=_0x24bbda['udid'];try{await this['deviceLock']['releaseLockByType'](_0x3df6e4,'transfer');}catch(_0x27e6aa){this['logger'][_0x14a7ae(0x26d)](_0x14a7ae(0x135)+_0x3df6e4+':\x20'+_0x27e6aa[_0x14a7ae(0x1dc)]);}}const _0xa1014d=[];for(const _0x30c995 of _0x63e58f){const _0xb80351=_0x30c995[_0x14a7ae(0x200)][_0x14a7ae(0x1f6)](),_0x587785=_0x30c995['udid'];_0xa1014d['push'](this['login'](_0xb80351,_0x587785,!0x0)['catch'](_0x256b88=>{const _0x908895=_0x14a7ae;this['logger'][_0x908895(0xf2)]('Failed\x20to\x20login\x20'+_0xb80351+'\x20on\x20device\x20'+_0x587785+':\x20'+_0x256b88[_0x908895(0x1dc)]);}));}await Promise['allSettled'](_0xa1014d),this['logger']['log']('Completed\x20login\x20process\x20for\x20all\x20active\x20banks');}catch(_0xcb3dcb){throw this['logger']['error'](_0x14a7ae(0x210)+_0xcb3dcb['message']),_0xcb3dcb;}}[_0x2960a1(0x29f)](_0x23ee6a,_0x542db5,_0x516b03){return this['getBankService'](_0x516b03)['executeTransferWithQRCode'](_0x23ee6a,_0x542db5);}async['isSessionValid'](_0x3f917a,_0x400738){const _0x217a1f=_0x2960a1;return await this[_0x217a1f(0x25d)][_0x217a1f(0x1e9)](_0x3f917a,_0x400738);}['analyzeTransferBill'](_0x13af65,_0x4b8633){return this['getBankService'](_0x13af65)['analyzeTransferBill'](_0x4b8633);}async['refreshSessionIfNeeded'](_0x1e9880,_0x457a48){const _0x52d9f3=_0x2960a1,_0x35ab6d=await this['sessionManagement']['getSession'](_0x1e9880,_0x457a48);if(_0x52d9f3(0x262)===_0x35ab6d?.['status'])return!0x1;const _0x3ae89b=await this['sessionManagement']['needsRefresh'](_0x1e9880,_0x457a48),_0x3d2c8b=await this['sessionManagement'][_0x52d9f3(0x1e9)](_0x1e9880,_0x457a48);if(!_0x3ae89b&&_0x3d2c8b)return!0x1;if(await this['deviceLock']['isLocked'](_0x1e9880))return this['logger']['warn'](_0x52d9f3(0x29b)+_0x1e9880+'\x20-\x20device\x20is\x20locked'),!0x1;try{return _0x3d2c8b?this['logger'][_0x52d9f3(0x133)](_0x52d9f3(0x144)+_0x1e9880+',\x20bank\x20'+_0x457a48):this[_0x52d9f3(0x27d)]['log'](_0x52d9f3(0x1aa)+_0x1e9880+_0x52d9f3(0x10d)+_0x457a48+'.\x20Retrying\x20login...'),await this[_0x52d9f3(0xb8)](_0x457a48,_0x1e9880),!0x0;}catch(_0x29df97){return this['logger']['error'](_0x52d9f3(0x113)+_0x1e9880+':\x20'+_0x29df97['message']),!0x1;}}async['createQRCodeAndTransferTo'](_0x16a090,_0x1677d1,_0x174b7b){const _0x48a082=this['getBankService'](_0x16a090);await _0x48a082['createQRCodeAndTransferTo'](_0x1677d1,_0x174b7b);}};_0x57a04d['BankService']=_0x4daf27,_0x57a04d[_0x2960a1(0x26f)]=_0x4daf27=_0xc93d6a([(0x0,_0x517747[_0x2960a1(0x150)])(),_0x381351('design:paramtypes',['function'==typeof(_0x29e7ff=void 0x0!==_0x4a5871['AcbService']&&_0x4a5871['AcbService'])?_0x29e7ff:Object,'function'==typeof(_0x446a57=void 0x0!==_0x532b04['PgService']&&_0x532b04['PgService'])?_0x446a57:Object,'function'==typeof(_0x35f62c=void 0x0!==_0x46c388['DeviceService']&&_0x46c388['DeviceService'])?_0x35f62c:Object,_0x2960a1(0x10a)==typeof(_0x48801f=void 0x0!==_0xb1b46b['SessionManagementService']&&_0xb1b46b['SessionManagementService'])?_0x48801f:Object,'function'==typeof(_0x298714=void 0x0!==_0x5e4c4b[_0x2960a1(0xad)]&&_0x5e4c4b[_0x2960a1(0xad)])?_0x298714:Object])],_0x4daf27);},function(_0x2f1037,_0x1d2989,_0x344957){const _0x25db93=a0_0x14ea;var _0x2ae66f,_0x53cf32,_0x5d9ef7,_0x1b5eaf=this&&this['__decorate']||function(_0x2a32ab,_0x68cfa0,_0x1fa912,_0x13e0bd){const _0x2d6ca0=a0_0x14ea;var _0x5e46c4,_0x2665cb=arguments['length'],_0x53b171=_0x2665cb<0x3?_0x68cfa0:null===_0x13e0bd?_0x13e0bd=Object['getOwnPropertyDescriptor'](_0x68cfa0,_0x1fa912):_0x13e0bd;if(_0x2d6ca0(0x217)==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x53b171=Reflect[_0x2d6ca0(0xcf)](_0x2a32ab,_0x68cfa0,_0x1fa912,_0x13e0bd);else{for(var _0x25dec1=_0x2a32ab['length']-0x1;_0x25dec1>=0x0;_0x25dec1--)(_0x5e46c4=_0x2a32ab[_0x25dec1])&&(_0x53b171=(_0x2665cb<0x3?_0x5e46c4(_0x53b171):_0x2665cb>0x3?_0x5e46c4(_0x68cfa0,_0x1fa912,_0x53b171):_0x5e46c4(_0x68cfa0,_0x1fa912))||_0x53b171);}return _0x2665cb>0x3&&_0x53b171&&Object[_0x2d6ca0(0x176)](_0x68cfa0,_0x1fa912,_0x53b171),_0x53b171;},_0x294ade=this&&this['__metadata']||function(_0x3c0fb9,_0x1a28af){const _0x508890=a0_0x14ea;if('object'==typeof Reflect&&_0x508890(0x10a)==typeof Reflect['metadata'])return Reflect['metadata'](_0x3c0fb9,_0x1a28af);},_0x4c4629=this&&this['__param']||function(_0x2d916c,_0x2218be){return function(_0x58e39d,_0x18997e){_0x2218be(_0x58e39d,_0x18997e,_0x2d916c);};};Object[_0x25db93(0x176)](_0x1d2989,_0x25db93(0x22f),{'value':!0x0}),_0x1d2989['AcbService']=void 0x0;const _0x5bab64=_0x344957(0x2),_0x30f68c=_0x344957(0x14),_0x311258=_0x344957(0x15),_0x3ac07c=_0x344957(0x1a),_0x269d18=_0x344957(0x19),_0x3b4d01=_0x344957(0x11),_0x2e278f=_0x344957(0x24),_0x56be10=_0x344957(0x25),_0x1d5f63=_0x344957(0x1c);let _0x493358=class extends _0x3ac07c['BaseBankService']{constructor(_0x126cff,_0x485d50,_0x1a0c21){const _0x1f96e5=_0x25db93;super(_0x126cff,_0x485d50,_0x1a0c21),this[_0x1f96e5(0xb6)]=_0x126cff,this['BANK_CODE']='ACB',this['BUNDLE_ID']='mobileapp.acb.com.vn';}['launchApp'](_0x3ec799){throw new Error('Method\x20not\x20implemented.');}async['captureScreen'](_0x5534a6,_0x5e328b){}async['clickPasswordField'](_0x2b0da0){const _0x55c236=_0x25db93;try{const {x:_0x1e391f,y:_0x2e3c10}=_0x56be10['ACB_UI_COORDINATES']['PASSWORD_FIELD'];this['logger']['log'](_0x55c236(0x8f)+_0x2b0da0+'\x20at\x20coordinates\x20('+_0x1e391f+',\x20'+_0x2e3c10+')'),await this['clickWithTransition'](_0x2b0da0,_0x1e391f,_0x2e3c10,0.2),await(0x0,_0x3b4d01['sleep'])(0x3e8),this[_0x55c236(0x27d)]['log']('Password\x20field\x20clicked\x20successfully\x20on\x20device\x20'+_0x2b0da0);}catch(_0x3de08a){throw this[_0x55c236(0x27d)]['error'](_0x55c236(0x9c)+_0x2b0da0+':\x20'+_0x3de08a[_0x55c236(0x1dc)]),_0x3de08a;}}async['inputPasswordFromConfig'](_0x11f8b3){const _0x358858=_0x25db93;try{const _0x34a145=await this['deviceService']['getDeviceConfig'](_0x11f8b3);if(!_0x34a145||!_0x34a145['password'])throw new Error(_0x358858(0xf6)+_0x11f8b3);await this[_0x358858(0xb6)][_0x358858(0xa1)](_0x11f8b3,_0x34a145['password']);}catch(_0x331c6b){throw this['logger']['error']('Error\x20inputting\x20password\x20from\x20config\x20for\x20device\x20'+_0x11f8b3+':\x20'+_0x331c6b[_0x358858(0x1dc)]),_0x331c6b;}}async[_0x25db93(0x289)](_0x47b38a){const _0x44e7d3=_0x25db93;try{const {x:_0xe824fc,y:_0x11128c}=_0x56be10['ACB_UI_COORDINATES'][_0x44e7d3(0xf7)];this['logger']['log'](_0x44e7d3(0x10c)+_0x47b38a+'\x20at\x20coordinates\x20('+_0xe824fc+',\x20'+_0x11128c+')'),await this['wsService']['click'](_0x47b38a,_0xe824fc,_0x11128c,0.2),await(0x0,_0x3b4d01['sleep'])(0x1388),this[_0x44e7d3(0x27d)][_0x44e7d3(0x133)]('Login\x20button\x20clicked\x20successfully\x20on\x20device\x20'+_0x47b38a);}catch(_0xabe219){throw this['logger']['error'](_0x44e7d3(0x23b)+_0x47b38a+':\x20'+_0xabe219[_0x44e7d3(0x1dc)]),_0xabe219;}}async['login'](_0x5e1dbf){const _0x3a7e84=_0x25db93;try{await this['killApp'](_0x5e1dbf),await this[_0x3a7e84(0x27e)](_0x5e1dbf);const {x:_0x130661,y:_0x4ec2b9}=_0x56be10['ACB_UI_COORDINATES'][_0x3a7e84(0xf7)];this['logger']['log'](_0x3a7e84(0x10c)+_0x5e1dbf+'\x20at\x20coordinates\x20('+_0x130661+',\x20'+_0x4ec2b9+')'),await this['wsService'][_0x3a7e84(0xa8)](_0x5e1dbf,_0x130661,_0x4ec2b9,0.2),await(0x0,_0x3b4d01['sleep'])(0x7d0),await this['inputPasswordFromConfig'](_0x5e1dbf),await(0x0,_0x3b4d01[_0x3a7e84(0x1e6)])(0x7d0);const {x:_0x22e6f1,y:_0x283a7f}=_0x2e278f['COMMON_COORDINATES']['RETURN_KEY'];this['logger']['log'](_0x3a7e84(0x122)+_0x5e1dbf+'\x20at\x20coordinates\x20('+_0x22e6f1+',\x20'+_0x283a7f+')'),await this['wsService']['click'](_0x5e1dbf,_0x22e6f1,_0x283a7f,0.2),await(0x0,_0x3b4d01['sleep'])(0x7d0),await this[_0x3a7e84(0xb6)]['click'](_0x5e1dbf,0.5,0.62,0.2),await(0x0,_0x3b4d01['sleep'])(0x1388),await this[_0x3a7e84(0xb6)][_0x3a7e84(0xa8)](_0x5e1dbf,0.3,0.55,0.2),await this['wsService']['click'](_0x5e1dbf,0.5,0.65,0.2);}catch(_0x4c6fca){throw this['logger']['error']('Error\x20logging\x20in\x20on\x20device\x20'+_0x5e1dbf+':\x20'+_0x4c6fca['message']),_0x4c6fca;}}async['executeTransfer'](_0x57c20e,_0x2ffb58){}async[_0x25db93(0x29f)](_0x556c2c,_0x1326a8){console['warn']('ACB\x20executeTransferWithQRCode');}async['executeInternalTransfer'](_0x54d0a4,_0x25d02c){return this['executeExternalTransfer'](_0x54d0a4,_0x25d02c);}async[_0x25db93(0x101)](_0x51bc07,_0x5af5be){console['warn']('ACB\x20executeExternalTransfer');}};_0x1d2989['AcbService']=_0x493358,_0x1d2989['AcbService']=_0x493358=_0x1b5eaf([(0x0,_0x5bab64['Injectable'])(),_0x4c4629(0x0,(0x0,_0x5bab64['Inject'])(_0x30f68c['WEBSOCKET_SERVICE'])),_0x294ade('design:paramtypes',['function'==typeof(_0x2ae66f=void 0x0!==_0x269d18['IWebSocketService']&&_0x269d18['IWebSocketService'])?_0x2ae66f:Object,'function'==typeof(_0x53cf32=void 0x0!==_0x311258['DeviceService']&&_0x311258['DeviceService'])?_0x53cf32:Object,_0x25db93(0x10a)==typeof(_0x5d9ef7=void 0x0!==_0x1d5f63['OCRService']&&_0x1d5f63[_0x25db93(0x173)])?_0x5d9ef7:Object])],_0x493358);},(_0x424607,_0x2a8a5b)=>{const _0x30ec66=a0_0x14ea;Object['defineProperty'](_0x2a8a5b,'__esModule',{'value':!0x0}),_0x2a8a5b[_0x30ec66(0x253)]=void 0x0,_0x2a8a5b['WEBSOCKET_SERVICE']=Symbol('WEBSOCKET_SERVICE');},function(_0x1982e2,_0x5e38fb,_0x7bd3db){const _0x5caea2=a0_0x14ea;var _0x2872cd,_0x1bdbe0,_0x1073b8=this&&this[_0x5caea2(0x13c)]||function(_0x187ea8,_0x43865e,_0xc55fa2,_0x5f4d8b){const _0x298af0=_0x5caea2;var _0x2ac30e,_0x42b6cb=arguments[_0x298af0(0x132)],_0xca37ca=_0x42b6cb<0x3?_0x43865e:null===_0x5f4d8b?_0x5f4d8b=Object['getOwnPropertyDescriptor'](_0x43865e,_0xc55fa2):_0x5f4d8b;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x298af0(0xcf)])_0xca37ca=Reflect['decorate'](_0x187ea8,_0x43865e,_0xc55fa2,_0x5f4d8b);else{for(var _0x137e22=_0x187ea8['length']-0x1;_0x137e22>=0x0;_0x137e22--)(_0x2ac30e=_0x187ea8[_0x137e22])&&(_0xca37ca=(_0x42b6cb<0x3?_0x2ac30e(_0xca37ca):_0x42b6cb>0x3?_0x2ac30e(_0x43865e,_0xc55fa2,_0xca37ca):_0x2ac30e(_0x43865e,_0xc55fa2))||_0xca37ca);}return _0x42b6cb>0x3&&_0xca37ca&&Object['defineProperty'](_0x43865e,_0xc55fa2,_0xca37ca),_0xca37ca;},_0x44ca04=this&&this['__metadata']||function(_0x81c27a,_0x45db39){const _0x5a8deb=_0x5caea2;if(_0x5a8deb(0x217)==typeof Reflect&&_0x5a8deb(0x10a)==typeof Reflect['metadata'])return Reflect['metadata'](_0x81c27a,_0x45db39);};Object[_0x5caea2(0x176)](_0x5e38fb,_0x5caea2(0x22f),{'value':!0x0}),_0x5e38fb['DeviceService']=void 0x0;const _0x288fe0=_0x7bd3db(0x2),_0x3e0ec7=_0x7bd3db(0x16),_0x3d1d08=_0x7bd3db(0x18);let _0x110eda=class{constructor(_0x8a65b3,_0x892547){const _0x3c66ec=_0x5caea2;this[_0x3c66ec(0x1ff)]=_0x8a65b3,this['hcBoxService']=_0x892547,this['logger']=new _0x288fe0[(_0x3c66ec(0x108))]('DeviceService'),this['REDIS_DEVICE_CONFIG_PREFIX']='device:',this[_0x3c66ec(0xe3)]=_0x3c66ec(0x185),this['REDIS_SERVICE_STATUS_KEY']='service:status';}async['onModuleInit'](){const _0xe0dc13=_0x5caea2;try{await this[_0xe0dc13(0x255)](_0xe0dc13(0x282)),this[_0xe0dc13(0x27d)]['log'](_0xe0dc13(0x24b));}catch(_0x46c03a){this['logger']['error']('Failed\x20to\x20initialize\x20service\x20status:\x20'+_0x46c03a['message']);}}async['listDevices'](){const _0x35c6d4=_0x5caea2;try{const _0x2d3a7d=await this['hcBoxService']['listDevices']();return await Promise['all'](_0x2d3a7d['map'](async _0x202939=>{const _0x393fdd=a0_0x14ea,_0x2d7d75=await this['getDeviceConfig'](_0x202939['udid']);return{..._0x202939,'bankCode':_0x2d7d75?.['bankCode']||'','availableAmount':_0x2d7d75?.['availableAmount']||0x0,'status':_0x2d7d75?.[_0x393fdd(0x158)]||'deactive','password':_0x2d7d75?.['password']||'','smartOTP':_0x2d7d75?.['smartOTP']||'','accountNo':_0x2d7d75?.['accountNo']||'','accountName':_0x2d7d75?.[_0x393fdd(0x245)]||''};}));}catch(_0x4b5f46){throw this[_0x35c6d4(0x27d)]['error']('Error\x20listing\x20devices:\x20'+_0x4b5f46['message']),_0x4b5f46;}}async['getDeviceConfig'](_0x5db0c3){const _0x2b33eb=_0x5caea2;try{const _0x2adcbd=''+this['REDIS_DEVICE_CONFIG_PREFIX']+_0x5db0c3+this['REDIS_DEVICE_CONFIG_SUFFIX'],_0x380241=await this[_0x2b33eb(0x1ff)]['get'](_0x2adcbd);return _0x380241?JSON['parse'](_0x380241):null;}catch(_0x53a400){return this['logger']['error'](_0x2b33eb(0x2be)+_0x5db0c3+':\x20'+_0x53a400['message']),null;}}async['updateDeviceConfig'](_0x413c22,_0x4076be){const _0x9b9b32=_0x5caea2;try{const _0xffd0f9=''+this[_0x9b9b32(0x8e)]+_0x413c22+this['REDIS_DEVICE_CONFIG_SUFFIX'],_0x258825=await this['getDeviceConfig'](_0x413c22),_0xdaae19={'deviceId':_0x413c22,'bankCode':void 0x0!==_0x4076be['bankCode']?_0x4076be[_0x9b9b32(0x200)]:_0x258825?.[_0x9b9b32(0x200)]||'','availableAmount':void 0x0!==_0x4076be['availableAmount']?_0x4076be['availableAmount']:_0x258825?.['availableAmount']||0x0,'status':void 0x0!==_0x4076be['status']?_0x4076be['status']:_0x258825?.['status']||'deactive','password':void 0x0!==_0x4076be['password']?_0x4076be['password']:_0x258825?.['password']||'','smartOTP':void 0x0!==_0x4076be['smartOTP']?_0x4076be['smartOTP']:_0x258825?.['smartOTP']||'','accountNo':void 0x0!==_0x4076be['accountNo']?_0x4076be[_0x9b9b32(0x137)]:_0x258825?.[_0x9b9b32(0x137)]||'','accountName':void 0x0!==_0x4076be['accountName']?_0x4076be['accountName']:_0x258825?.[_0x9b9b32(0x245)]||''};return await this[_0x9b9b32(0x1ff)][_0x9b9b32(0x21c)](_0xffd0f9,JSON['stringify'](_0xdaae19)),this['logger']['log']('['+_0x413c22+']\x20Updated\x20device\x20config\x20(bankCode:\x20'+(_0xdaae19[_0x9b9b32(0x200)]||_0x9b9b32(0xc7))+_0x9b9b32(0x165)+JSON[_0x9b9b32(0x1b9)](_0xdaae19)),_0xdaae19;}catch(_0x163b25){throw this['logger']['error']('['+_0x413c22+']\x20Error\x20updating\x20device\x20config:\x20'+_0x163b25[_0x9b9b32(0x1dc)]),_0x163b25;}}async[_0x5caea2(0x2ae)](){const _0x5cfdda=_0x5caea2;try{return await this['redisService']['get'](this[_0x5cfdda(0x1b0)])||'inactive';}catch(_0x10ad42){return this['logger']['error']('Error\x20getting\x20service\x20status:\x20'+_0x10ad42['message']),'inactive';}}async['setServiceStatus'](_0x55525e){const _0xc4735c=_0x5caea2;try{await this[_0xc4735c(0x1ff)]['set'](this['REDIS_SERVICE_STATUS_KEY'],_0x55525e),this['logger'][_0xc4735c(0x133)]('Service\x20status\x20set\x20to:\x20'+_0x55525e);}catch(_0x28cca9){throw this[_0xc4735c(0x27d)]['error'](_0xc4735c(0x106)+_0x28cca9['message']),_0x28cca9;}}async['deductDeviceAmount'](_0x45b1f0,_0x2cd260){const _0x3268b4=_0x5caea2;try{const _0x5ac9e9=await this['getDeviceConfig'](_0x45b1f0);if(!_0x5ac9e9)return!0x1;const _0x507d30=_0x5ac9e9[_0x3268b4(0x1ef)]-_0x2cd260;return _0x507d30<0x0?(this['logger'][_0x3268b4(0x26d)]('Insufficient\x20amount\x20for\x20device\x20'+_0x45b1f0+'.\x20Available:\x20'+_0x5ac9e9['availableAmount']+',\x20Requested:\x20'+_0x2cd260),!0x1):(await this['updateDeviceConfig'](_0x45b1f0,{'availableAmount':_0x507d30}),!0x0);}catch(_0x230bb4){return this['logger']['error']('Error\x20deducting\x20amount\x20for\x20device\x20'+_0x45b1f0+':\x20'+_0x230bb4['message']),!0x1;}}async[_0x5caea2(0x2a1)](){const _0x1db765=_0x5caea2;try{return(await this['listDevices']())[_0x1db765(0x157)](_0x38f91a=>_0x1db765(0xff)===_0x38f91a['status']);}catch(_0x4df177){return this['logger'][_0x1db765(0xf2)]('Error\x20checking\x20active\x20devices:\x20'+_0x4df177[_0x1db765(0x1dc)]),!0x1;}}};_0x5e38fb['DeviceService']=_0x110eda,_0x5e38fb['DeviceService']=_0x110eda=_0x1073b8([(0x0,_0x288fe0[_0x5caea2(0x150)])(),_0x44ca04('design:paramtypes',['function'==typeof(_0x2872cd=void 0x0!==_0x3e0ec7['RedisService']&&_0x3e0ec7['RedisService'])?_0x2872cd:Object,'function'==typeof(_0x1bdbe0=void 0x0!==_0x3d1d08['HcBoxService']&&_0x3d1d08['HcBoxService'])?_0x1bdbe0:Object])],_0x110eda);},function(_0x39414c,_0x15cde4,_0x488a09){const _0x3b499a=a0_0x14ea;var _0x4d1387=this&&this['__decorate']||function(_0x34d06d,_0x2ff37a,_0x324129,_0x285b8a){const _0x42384d=a0_0x14ea;var _0x2a483a,_0x245a79=arguments[_0x42384d(0x132)],_0x28d641=_0x245a79<0x3?_0x2ff37a:null===_0x285b8a?_0x285b8a=Object['getOwnPropertyDescriptor'](_0x2ff37a,_0x324129):_0x285b8a;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x28d641=Reflect['decorate'](_0x34d06d,_0x2ff37a,_0x324129,_0x285b8a);else{for(var _0x2e5efd=_0x34d06d['length']-0x1;_0x2e5efd>=0x0;_0x2e5efd--)(_0x2a483a=_0x34d06d[_0x2e5efd])&&(_0x28d641=(_0x245a79<0x3?_0x2a483a(_0x28d641):_0x245a79>0x3?_0x2a483a(_0x2ff37a,_0x324129,_0x28d641):_0x2a483a(_0x2ff37a,_0x324129))||_0x28d641);}return _0x245a79>0x3&&_0x28d641&&Object['defineProperty'](_0x2ff37a,_0x324129,_0x28d641),_0x28d641;},_0x201ca3=this&&this['__metadata']||function(_0x2ed90b,_0x2f5967){const _0x54ad7c=a0_0x14ea;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x54ad7c(0x21e)])return Reflect[_0x54ad7c(0x21e)](_0x2ed90b,_0x2f5967);};Object['defineProperty'](_0x15cde4,'__esModule',{'value':!0x0}),_0x15cde4['RedisService']=void 0x0;const _0x2e03f3=_0x488a09(0x2),_0x323591=_0x488a09(0x17),_0x21c8ce=_0x488a09(0xf);let _0x376d00=class{constructor(){const _0x47afa9=a0_0x14ea;this['logger']=new _0x2e03f3['Logger']('RedisService'),this[_0x47afa9(0xd3)]=null;}async['getClient'](){const _0x5588b2=a0_0x14ea;if(this[_0x5588b2(0xd3)])return this[_0x5588b2(0xd3)];const _0x26a25a=_0x21c8ce['config']['redis']['host']??'localhost',_0x31e6b0=_0x21c8ce['config'][_0x5588b2(0x1dd)]['port']??0x18eb,_0x1a38f7=_0x21c8ce[_0x5588b2(0x14f)]['redis']['password']??void 0x0,_0x5de8de=_0x21c8ce['config']['redis']['db']??0x3;return this['redisClient']=new _0x323591['default']({'host':_0x26a25a,'port':_0x31e6b0,'password':_0x1a38f7,'db':_0x5de8de,'enableReadyCheck':!0x1,'maxRetriesPerRequest':null,'lazyConnect':!0x0}),this['redisClient']['on']('error',_0x4938b9=>{this['logger']['error']('Redis\x20Client\x20Error',_0x4938b9['stack']||_0x4938b9['message']);}),this['redisClient']['on']('connect',()=>{const _0x30e3e8=_0x5588b2;this[_0x30e3e8(0x27d)]['log']('Redis\x20Client\x20Connected');}),this['redisClient']['on']('ready',()=>{this['logger']['log']('Redis\x20Client\x20Ready');}),this[_0x5588b2(0xd3)]['on']('close',()=>{this['logger']['warn']('Redis\x20Client\x20Connection\x20Closed');}),this['redisClient']['on']('reconnecting',()=>{this['logger']['log']('Redis\x20Client\x20Reconnecting...');}),await this['redisClient'][_0x5588b2(0x16e)](),this['redisClient'];}async['disconnect'](){const _0x4cf893=a0_0x14ea;this[_0x4cf893(0xd3)]&&(await this[_0x4cf893(0xd3)]['disconnect'](),this['redisClient']=null,this[_0x4cf893(0x27d)]['log']('Redis\x20Client\x20Disconnected'));}async['onModuleDestroy'](){const _0x4f75f6=a0_0x14ea;await this[_0x4f75f6(0x241)]();}async['get'](_0x1d36de){return(await this['getClient']())['get'](_0x1d36de);}async['set'](_0x2a281a,_0x3ac0f8,_0x9b2484){const _0x10c3f1=await this['getClient']();if(_0x9b2484){const _0x272996=Math['ceil'](_0x9b2484/0x3e8);return _0x10c3f1['setex'](_0x2a281a,_0x272996,_0x3ac0f8);}return _0x10c3f1['set'](_0x2a281a,_0x3ac0f8);}async[_0x3b499a(0x205)](_0x8e3cad,_0x2995a1,_0x2fac8d){const _0x4f60ac=_0x3b499a,_0x1292e1=await this[_0x4f60ac(0x142)](),_0x361e83=Math[_0x4f60ac(0x2ac)](_0x2995a1/0x3e8);return _0x1292e1['setex'](_0x8e3cad,_0x361e83,_0x2fac8d);}async[_0x3b499a(0x1f5)](_0x292583){return(await this['getClient']())['del'](_0x292583);}async['exists'](_0x2372c7){return(await this['getClient']())['exists'](_0x2372c7);}async['zadd'](_0x338ec8,_0x590bea,_0x1d41a7){const _0x254824=_0x3b499a;return(await this[_0x254824(0x142)]())[_0x254824(0x1ea)](_0x338ec8,_0x590bea,_0x1d41a7);}async['zrange'](_0x269662,_0x438deb,_0x2bb930){return(await this['getClient']())['zrange'](_0x269662,_0x438deb,_0x2bb930);}async['zrangebyscore'](_0x7aa463,_0x136b8e,_0x376c64,_0x1cc28a){const _0x440db8=_0x3b499a,_0x3355c1=await this['getClient']();return _0x1cc28a?_0x3355c1['zrangebyscore'](_0x7aa463,_0x136b8e,_0x376c64,'LIMIT',_0x1cc28a[_0x440db8(0x25a)],_0x1cc28a['count']):_0x3355c1['zrangebyscore'](_0x7aa463,_0x136b8e,_0x376c64);}async['zrem'](_0x27fe46,..._0x13e806){const _0xd4b741=_0x3b499a;return(await this[_0xd4b741(0x142)]())['zrem'](_0x27fe46,..._0x13e806);}async[_0x3b499a(0xf5)](_0x47c0df,..._0x2b3895){return(await this['getClient']())['sadd'](_0x47c0df,..._0x2b3895);}async['sismember'](_0x1a74fd,_0x1c9dcd){return(await this['getClient']())['sismember'](_0x1a74fd,_0x1c9dcd);}async['hset'](_0x2bbf8d,_0x194405,_0x149651){return(await this['getClient']())['hset'](_0x2bbf8d,_0x194405,_0x149651);}async['hget'](_0x1216da,_0x4b811f){return(await this['getClient']())['hget'](_0x1216da,_0x4b811f);}async[_0x3b499a(0x272)](_0xf439b0){return(await this['getClient']())['hgetall'](_0xf439b0);}async['expire'](_0x54f3df,_0x12e889){return(await this['getClient']())['expire'](_0x54f3df,_0x12e889);}async[_0x3b499a(0x2a8)](_0x5a5b0a,_0x40e8e8,_0xee4e8f){const _0x2263a4=_0x3b499a,_0x528a33=await this[_0x2263a4(0x142)]();if(_0xee4e8f){const _0x5f5d15=Math[_0x2263a4(0x2ac)](_0xee4e8f/0x3e8);return await _0x528a33['set'](_0x5a5b0a,_0x40e8e8,'EX',_0x5f5d15,'NX');}return await _0x528a33['set'](_0x5a5b0a,_0x40e8e8,'NX');}};_0x15cde4['RedisService']=_0x376d00,_0x15cde4['RedisService']=_0x376d00=_0x4d1387([(0x0,_0x2e03f3['Injectable'])(),_0x201ca3('design:paramtypes',[])],_0x376d00);},_0x1b2a32=>{_0x1b2a32['exports']=require('ioredis');},function(_0x6f3ee9,_0x3e14be,_0x16f1b8){const _0x354120=a0_0x14ea;var _0xf9adc,_0x2779c8=this&&this['__decorate']||function(_0x26942a,_0x242f3b,_0x19778f,_0x449b0e){const _0x53f23a=a0_0x14ea;var _0x39a7a1,_0x1cb766=arguments[_0x53f23a(0x132)],_0x360a84=_0x1cb766<0x3?_0x242f3b:null===_0x449b0e?_0x449b0e=Object['getOwnPropertyDescriptor'](_0x242f3b,_0x19778f):_0x449b0e;if(_0x53f23a(0x217)==typeof Reflect&&_0x53f23a(0x10a)==typeof Reflect['decorate'])_0x360a84=Reflect['decorate'](_0x26942a,_0x242f3b,_0x19778f,_0x449b0e);else{for(var _0x2cab21=_0x26942a['length']-0x1;_0x2cab21>=0x0;_0x2cab21--)(_0x39a7a1=_0x26942a[_0x2cab21])&&(_0x360a84=(_0x1cb766<0x3?_0x39a7a1(_0x360a84):_0x1cb766>0x3?_0x39a7a1(_0x242f3b,_0x19778f,_0x360a84):_0x39a7a1(_0x242f3b,_0x19778f))||_0x360a84);}return _0x1cb766>0x3&&_0x360a84&&Object['defineProperty'](_0x242f3b,_0x19778f,_0x360a84),_0x360a84;},_0x53c5c3=this&&this['__metadata']||function(_0x4ac3b7,_0x40b98f){const _0x58e73e=a0_0x14ea;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x58e73e(0x21e)])return Reflect['metadata'](_0x4ac3b7,_0x40b98f);},_0x349457=this&&this['__param']||function(_0x372d5e,_0x4d609b){return function(_0x4f104b,_0x5bf5e8){_0x4d609b(_0x4f104b,_0x5bf5e8,_0x372d5e);};};Object[_0x354120(0x176)](_0x3e14be,'__esModule',{'value':!0x0}),_0x3e14be[_0x354120(0x1c4)]=void 0x0;const _0x228da2=_0x16f1b8(0x2),_0x2e0f86=_0x16f1b8(0x14),_0x3dab8b=_0x16f1b8(0x19),_0x57b8f6=_0x16f1b8(0x11);let _0x49d656=class{constructor(_0x308b18){const _0x22e702=_0x354120;this['wsService']=_0x308b18,this[_0x22e702(0x27d)]=new _0x228da2['Logger']('HcBoxService');}async['listDevices'](){const _0x28dbbd=_0x354120;try{return await this[_0x28dbbd(0xb6)]['listDevices']();}catch(_0x24bf1f){throw this['logger']['error']('Error\x20listing\x20devices:\x20'+_0x24bf1f['message']),_0x24bf1f;}}async['executeTransfer'](_0x2df707,_0x29421c){const _0x5036be=_0x354120;try{this[_0x5036be(0x27d)]['log'](_0x5036be(0xfa)+_0x2df707[_0x5036be(0x164)]+'\x20on\x20device\x20'+_0x29421c);const _0x4e90b6=this['getBankBundleId'](_0x2df707[_0x5036be(0x200)]);return _0x4e90b6&&(await this[_0x5036be(0xb6)][_0x5036be(0x27e)](_0x29421c,_0x4e90b6),await(0x0,_0x57b8f6[_0x5036be(0x1e6)])(0xbb8)),await this[_0x5036be(0xb6)][_0x5036be(0xa8)](_0x29421c,0.5,0.3,0.2),await(0x0,_0x57b8f6['sleep'])(0x7d0),this['logger'][_0x5036be(0x26d)]('Transfer\x20execution\x20flow\x20needs\x20to\x20be\x20customized\x20per\x20bank\x20app\x20UI'),this['logger'][_0x5036be(0x133)]('Transfer\x20execution\x20completed\x20for\x20withdrawal\x20'+_0x2df707[_0x5036be(0x164)]),!0x0;}catch(_0x28d7af){throw this['logger']['error'](_0x5036be(0x1cc)+_0x2df707[_0x5036be(0x164)]+':\x20'+_0x28d7af['message']),_0x28d7af;}}['getBankBundleId'](_0x496e98){const _0x23ef79=_0x354120;return{'VIETCOMBANK':'com.vietcombank.mobilebanking','TPBANK':_0x23ef79(0x1eb),'TECHCOMBANK':_0x23ef79(0x263)}[_0x496e98]||null;}async['click'](_0x1c62b6,_0x103919,_0x41aa96,_0xc75e8c=0.2){const _0x386c05=_0x354120;return this[_0x386c05(0xb6)]['click'](_0x1c62b6,_0x103919,_0x41aa96,_0xc75e8c);}async['swipe'](_0x583dad,_0x27ea2d){const _0x5e4cf1=_0x354120;return this[_0x5e4cf1(0xb6)]['swipe'](_0x583dad,_0x27ea2d);}async[_0x354120(0x19f)](_0xa47275,_0x48e19b){return this['wsService']['captureScreen'](_0xa47275,_0x48e19b);}async['home'](_0x1c6a6d){return this['wsService']['home'](_0x1c6a6d);}async[_0x354120(0xac)](_0x2d0e01,_0x20032c){const _0xeb022e=_0x354120;return this[_0xeb022e(0xb6)]['inputNumpadNumber'](_0x2d0e01,_0x20032c);}['inputText'](_0x1b2e80,_0x2b3d11){return this['wsService']['inputText'](_0x1b2e80,_0x2b3d11);}};_0x3e14be['HcBoxService']=_0x49d656,_0x3e14be[_0x354120(0x1c4)]=_0x49d656=_0x2779c8([(0x0,_0x228da2['Injectable'])(),_0x349457(0x0,(0x0,_0x228da2[_0x354120(0x22d)])(_0x2e0f86['WEBSOCKET_SERVICE'])),_0x53c5c3('design:paramtypes',['function'==typeof(_0xf9adc=void 0x0!==_0x3dab8b[_0x354120(0xcc)]&&_0x3dab8b[_0x354120(0xcc)])?_0xf9adc:Object])],_0x49d656);},(_0x52c57c,_0x1c394f)=>{Object['defineProperty'](_0x1c394f,'__esModule',{'value':!0x0});},function(_0xf893c5,_0x157d7c,_0x90d30c){const _0x9a65f2=a0_0x14ea;var _0xbb7d11,_0x258f63,_0x2f9d3d,_0x467395,_0x1a3d95=this&&this['__decorate']||function(_0x1b3e93,_0x5ab3b6,_0x3cb4ed,_0x31466c){const _0x2b0dca=a0_0x14ea;var _0x5c1214,_0x516caf=arguments['length'],_0x2918e4=_0x516caf<0x3?_0x5ab3b6:null===_0x31466c?_0x31466c=Object['getOwnPropertyDescriptor'](_0x5ab3b6,_0x3cb4ed):_0x31466c;if(_0x2b0dca(0x217)==typeof Reflect&&'function'==typeof Reflect[_0x2b0dca(0xcf)])_0x2918e4=Reflect[_0x2b0dca(0xcf)](_0x1b3e93,_0x5ab3b6,_0x3cb4ed,_0x31466c);else{for(var _0x2684a0=_0x1b3e93['length']-0x1;_0x2684a0>=0x0;_0x2684a0--)(_0x5c1214=_0x1b3e93[_0x2684a0])&&(_0x2918e4=(_0x516caf<0x3?_0x5c1214(_0x2918e4):_0x516caf>0x3?_0x5c1214(_0x5ab3b6,_0x3cb4ed,_0x2918e4):_0x5c1214(_0x5ab3b6,_0x3cb4ed))||_0x2918e4);}return _0x516caf>0x3&&_0x2918e4&&Object[_0x2b0dca(0x176)](_0x5ab3b6,_0x3cb4ed,_0x2918e4),_0x2918e4;},_0x5a86ff=this&&this[_0x9a65f2(0x23c)]||function(_0x5790d7,_0x13838e){const _0x5ac435=_0x9a65f2;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x5ac435(0x21e)])return Reflect['metadata'](_0x5790d7,_0x13838e);},_0xacf874=this&&this[_0x9a65f2(0x98)]||function(_0x4168dd,_0x2bf341){return function(_0x5fdc80,_0x43b069){_0x2bf341(_0x5fdc80,_0x43b069,_0x4168dd);};};Object['defineProperty'](_0x157d7c,'__esModule',{'value':!0x0}),_0x157d7c['BaseBankService']=void 0x0;const _0x9fc41a=_0x90d30c(0x2),_0x7099c0=_0x90d30c(0x15),_0x5f5a86=_0x90d30c(0x19),_0x3f7f4b=_0x90d30c(0x14),_0x3ec7ac=_0x90d30c(0x11),_0x3597fe=_0x90d30c(0xe),_0x5cbb48=_0x90d30c(0x1b),_0x4ec274=_0x90d30c(0x4),_0x305420=_0x90d30c(0x1c),_0x3e89fb=_0x90d30c(0x22),_0x3fe5ef=_0x90d30c(0x23);let _0xd7a0dc=_0xbb7d11=class{constructor(_0xc5d84d,_0x4b6c1c,_0x100096){const _0x48cd74=_0x9a65f2;this['wsService']=_0xc5d84d,this['deviceService']=_0x4b6c1c,this[_0x48cd74(0x247)]=_0x100096,this['baseTransactionFolderPath']='C:/EasyData',this['baseTransactionExecutionFolder']='C:/EasyTrx',this['logger']=new _0x9fc41a['Logger']('BaseBankService'),_0xbb7d11[_0x48cd74(0xd7)](this['baseTransactionFolderPath'],this[_0x48cd74(0x27d)]),_0xbb7d11[_0x48cd74(0xd7)](this['baseTransactionExecutionFolder'],this[_0x48cd74(0x27d)]);}static[_0x9a65f2(0xd7)](_0x223834,_0x140715){const _0x459726=_0x9a65f2;if(!_0xbb7d11[_0x459726(0x20f)]){if(_0xbb7d11['folderCreationInProgress']){let _0x38afd8=0x0;const _0x97a739=0xa;for(;_0xbb7d11['folderCreationInProgress']&&_0x38afd8<_0x97a739;){_0x38afd8++;const _0x55fd9b=Date['now']();for(;Date['now']()-_0x55fd9b<0xa;);}if(_0xbb7d11['folderCreated']||(0x0,_0x3597fe[_0x459726(0x1ab)])(_0x223834))return void(_0xbb7d11['folderCreated']=!0x0);}try{_0xbb7d11[_0x459726(0xf8)]=!0x0,(0x0,_0x3597fe[_0x459726(0x1ab)])(_0x223834)?_0x140715[_0x459726(0x1e5)]('Base\x20folder\x20already\x20exists:\x20'+_0x223834):((0x0,_0x3597fe['mkdirSync'])(_0x223834,{'recursive':!0x0}),_0x140715['log']('Created\x20base\x20folder:\x20'+_0x223834)),_0xbb7d11[_0x459726(0x20f)]=!0x0;}catch(_0x18dff7){'EEXIST'!==_0x18dff7['code']?_0x140715['error']('Failed\x20to\x20create\x20base\x20folder\x20'+_0x223834+':\x20'+_0x18dff7[_0x459726(0x1dc)]):(_0xbb7d11['folderCreated']=!0x0,_0x140715['debug']('Base\x20folder\x20already\x20exists\x20(created\x20by\x20another\x20process):\x20'+_0x223834));}finally{_0xbb7d11['folderCreationInProgress']=!0x1;}}}['getBankCode'](){return this['BANK_CODE'];}async[_0x9a65f2(0x90)](_0xc0ea6){const _0x59b184=_0x9a65f2;this['logger']['log']('['+_0xc0ea6+']\x20Killing\x20'+this['BANK_CODE']+'\x20app'),await this[_0x59b184(0xb6)]['killApp'](_0xc0ea6,this['BUNDLE_ID']);}async['clickWithTransition'](_0x239a4d,_0x4f59ce,_0x43083e,_0x3a4982,_0x49a124=''){const _0xb3f000=_0x9a65f2;await this[_0xb3f000(0xb6)][_0xb3f000(0xa8)](_0x239a4d,_0x4f59ce,_0x43083e,0.2),_0x49a124&&this[_0xb3f000(0x27d)]['log'](_0x49a124),await(0x0,_0x3ec7ac['sleep'])(_0x3a4982);}async['verifyScreenState'](_0x145ea1,_0x17b62d){const _0x44decf=_0x9a65f2,{expectedTexts:_0x3989d4=[],unexpectedTexts:_0x4e0755=[],timeout:_0x5ea6d2=0x7530,pollInterval:_0x55ac75=0x1f4,roi:_0x35a3cc,fieldType:_0x7adae4=_0x44decf(0x21a),preprocess:_0xe532f3}=_0x17b62d,_0x3cdd63=Date['now']();let _0x24608b=0x0;const _0x1ee7b7=_0x35a3cc?'ROI:\x20x='+_0x35a3cc['x']+',\x20y='+_0x35a3cc['y']+',\x20w='+_0x35a3cc['width']+',\x20h='+_0x35a3cc[_0x44decf(0x198)]:'Full\x20screen';for(this['logger']['debug']('['+_0x145ea1+']\x20Starting\x20screen\x20verification.\x20Expected:\x20['+_0x3989d4[_0x44decf(0x14e)](',\x20')+'],\x20Unexpected:\x20['+_0x4e0755['join'](',\x20')+'],\x20'+_0x1ee7b7+',\x20Timeout:\x20'+_0x5ea6d2+'ms,\x20Poll:\x20'+_0x55ac75+'ms');Date[_0x44decf(0x9b)]()-_0x3cdd63<_0x5ea6d2;){_0x24608b++;let _0x14e338=null;try{const _0x351db3=(0x0,_0x4ec274['join'])(this['baseTransactionExecutionFolder'],'scan_'+_0x145ea1);try{await(0x0,_0x5cbb48['mkdir'])(_0x351db3,{'recursive':!0x0});}catch(_0x24533a){}const _0xe29171=Date['now']();await this['wsService']['captureScreen'](_0x145ea1,{'folderPath':_0x351db3}),await(0x0,_0x3ec7ac['sleep'])(0x320);let _0x3af45f=null,_0x35fa2c=0x0;try{const _0x2123cc=(await(0x0,_0x5cbb48[_0x44decf(0x110)])(_0x351db3))[_0x44decf(0x252)](_0x188bde=>_0x188bde['endsWith']('.png'));if(0x0===_0x2123cc['length']){this['logger']['debug']('['+_0x145ea1+_0x44decf(0x13e)),await(0x0,_0x3ec7ac[_0x44decf(0x1e6)])(_0x55ac75);continue;}const _0x56904=Date[_0x44decf(0x9b)]();for(const _0x2b3873 of _0x2123cc){const _0x5e12a7=(0x0,_0x4ec274['join'])(_0x351db3,_0x2b3873);try{const _0x454a25=await(0x0,_0x5cbb48['stat'])(_0x5e12a7);if(0x0===_0x454a25['size'])continue;_0x56904-_0x454a25['mtimeMs']<0x1388&&_0x454a25['mtimeMs']>=_0xe29171-0x7d0&&_0x454a25['mtimeMs']>_0x35fa2c&&(_0x35fa2c=_0x454a25['mtimeMs'],_0x3af45f=_0x5e12a7);}catch(_0x366f97){continue;}}if(!_0x3af45f){await(0x0,_0x3ec7ac[_0x44decf(0x1e6)])(_0x55ac75);continue;}_0x14e338=_0x3af45f;}catch(_0x359d73){this['logger']['debug']('['+_0x145ea1+']\x20Cannot\x20read\x20screenshot\x20folder,\x20retrying...'),await(0x0,_0x3ec7ac['sleep'])(_0x55ac75);continue;}const _0x242599=[..._0x3989d4,..._0x4e0755],_0x52fcd3=await this[_0x44decf(0x247)]['fastScreenOCR'](_0x14e338,_0x242599,{'fieldType':_0x35a3cc?'singleLine':_0x7adae4,'customROI':_0x35a3cc,'preprocess':_0xe532f3});if(_0x14e338)try{await(0x0,_0x5cbb48[_0x44decf(0x1d8)])(_0x14e338),_0x14e338=null;}catch(_0x2c6c66){}if(!_0x52fcd3||!_0x52fcd3['found']){await(0x0,_0x3ec7ac['sleep'])(_0x55ac75);continue;}const _0xbf2e75=_0x52fcd3['found'],_0x9a094d=_0x4e0755['some'](_0x5b2fe8=>_0x52fcd3[_0x44decf(0xba)]['includes'](_0x5b2fe8));if(_0xbf2e75&&!_0x9a094d)return!0x0;_0x24608b%0x5==0x0&&this['logger']['debug']('['+_0x145ea1+_0x44decf(0x2b8)+_0x24608b+_0x44decf(0x27b)+_0x52fcd3['matchedTexts'][_0x44decf(0x14e)](',\x20')+'],\x20Expected:\x20['+_0x3989d4['join'](',\x20')+']'),await(0x0,_0x3ec7ac['sleep'])(_0x55ac75);}catch(_0x4b1a1e){if(_0x14e338)try{await(0x0,_0x5cbb48['unlink'])(_0x14e338);}catch{}this['logger']['debug']('['+_0x145ea1+']\x20Error\x20verifying\x20screen\x20(attempt\x20'+_0x24608b+'):\x20'+_0x4b1a1e['message']+_0x44decf(0x95)),await(0x0,_0x3ec7ac[_0x44decf(0x1e6)])(_0x55ac75);}}const _0x4c1110=Date[_0x44decf(0x9b)]()-_0x3cdd63;return this[_0x44decf(0x27d)][_0x44decf(0x26d)]('['+_0x145ea1+']\x20Screen\x20verification\x20timeout\x20after\x20'+_0x4c1110+'ms\x20('+_0x24608b+_0x44decf(0x1d3)+_0x3989d4[_0x44decf(0x14e)](',\x20')+']'),!0x1;}async[_0x9a65f2(0x1bf)](_0x1fd145,_0x32a0c1,_0x2c1d5c,_0x37975f,_0x498b88){return await this['wsService']['click'](_0x1fd145,_0x32a0c1,_0x2c1d5c,0.2),_0x498b88&&this['logger']['log'](_0x498b88),await this['verifyScreenState'](_0x1fd145,_0x37975f);}async[_0x9a65f2(0x170)](_0x3483e5){const _0x204dd8=_0x9a65f2,_0x1772ed=(0x0,_0x4ec274['resolve'])(this['baseTransactionFolderPath'],_0x3483e5);await(0x0,_0x5cbb48[_0x204dd8(0x1e2)])(_0x1772ed,{'recursive':!0x0});}async[_0x9a65f2(0x23a)](_0xd26768,_0x40bf27){const _0x55b3b6=_0x9a65f2;this['logger']['log']('Capturing\x20screen\x20on\x20device\x20'+_0xd26768+'\x20with\x20folderPath:\x20'+_0x40bf27['folderPath']);const _0x589baf=(0x0,_0x4ec274['resolve'])(this['baseTransactionFolderPath'],_0x40bf27['folderPath']);await this[_0x55b3b6(0xb6)]['captureScreen'](_0xd26768,{..._0x40bf27,'folderPath':_0x589baf});}async['getBillImagePath'](_0x5853d7,_0x4c1286=0x2710,_0x16e9de=0x1f4){const _0x5c45f4=_0x9a65f2;if(!_0x5853d7)return this['logger'][_0x5c45f4(0x26d)]('Folder\x20path\x20is\x20null\x20or\x20empty'),null;const _0x530d2d=(0x0,_0x4ec274['join'])(this[_0x5c45f4(0x264)],_0x5853d7),_0x5244c5=Date['now']();let _0x20fe92=0x0;for(this['logger']['debug'](_0x5c45f4(0x193)+_0x5853d7+',\x20timeout:\x20'+_0x4c1286+_0x5c45f4(0x256)+_0x16e9de+'ms');Date[_0x5c45f4(0x9b)]()-_0x5244c5<_0x4c1286;){_0x20fe92++;try{if(!(0x0,_0x3597fe[_0x5c45f4(0x1ab)])(_0x530d2d)){await(0x0,_0x3ec7ac[_0x5c45f4(0x1e6)])(_0x16e9de);continue;}const _0x4b4996=await(0x0,_0x5cbb48['readdir'])(_0x530d2d);if(0x0===_0x4b4996[_0x5c45f4(0x132)]){await(0x0,_0x3ec7ac['sleep'])(_0x16e9de);continue;}const _0x282931=(await Promise['all'](_0x4b4996[_0x5c45f4(0x146)](async _0x2a53ec=>{const _0x2aec61=_0x5c45f4;try{const _0x4540da=(0x0,_0x4ec274['join'])(_0x530d2d,_0x2a53ec),_0x4d19bd=await(0x0,_0x5cbb48['stat'])(_0x4540da);return{'fullPath':_0x4540da,'mtime':_0x4d19bd['mtimeMs'],'size':_0x4d19bd[_0x2aec61(0x26e)]};}catch(_0x537a14){return null;}})))[_0x5c45f4(0x252)](_0x2f5691=>null!==_0x2f5691&&_0x2f5691['size']>0x0);if(0x0===_0x282931['length']){await(0x0,_0x3ec7ac[_0x5c45f4(0x1e6)])(_0x16e9de);continue;}_0x282931['sort']((_0x8c1fdb,_0x4a8227)=>_0x4a8227[_0x5c45f4(0x1ac)]-_0x8c1fdb['mtime']);const _0xe14f26=_0x282931[0x0]['fullPath'],_0x509fc9=Date['now']()-_0x5244c5;return this['logger']['log'](_0x5c45f4(0x274)+_0xe14f26+'\x20after\x20'+_0x509fc9+'ms\x20('+_0x20fe92+_0x5c45f4(0x2bb)),_0xe14f26;}catch(_0x140ca0){this[_0x5c45f4(0x27d)][_0x5c45f4(0x1e5)]('Error\x20scanning\x20folder\x20'+_0x5853d7+'\x20(attempt\x20'+_0x20fe92+_0x5c45f4(0x165)+_0x140ca0['message']+',\x20retrying...'),await(0x0,_0x3ec7ac['sleep'])(_0x16e9de);}}const _0xde53b5=Date['now']()-_0x5244c5;return this['logger']['warn']('Timeout\x20scanning\x20folder\x20for\x20bill\x20image:\x20'+_0x5853d7+'\x20after\x20'+_0xde53b5+'ms\x20('+_0x20fe92+'\x20attempts)'),null;}async['analyzeTransferBill'](_0x4825aa){const _0x293493=_0x9a65f2,_0x331dc9=await this['getBillImagePath'](_0x4825aa[_0x293493(0x239)]);try{if(!_0x331dc9)return this['logger']['warn']('No\x20bill\x20image\x20path\x20'+_0x4825aa['withdrawalCode']),{'rawPath':null,'analyzedStatus':'na'};const _0x545c76=await this['ocrService'][_0x293493(0xc0)](_0x331dc9,[_0x293493(0x107)],{'fieldType':_0x293493(0x190),'customROI':_0x3fe5ef[_0x293493(0x25f)][_0x293493(0x102)],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}});return _0x545c76['found']?{'rawPath':_0x331dc9,'analyzedStatus':_0x545c76['found']?_0x293493(0x226):_0x293493(0xcb)}:(this['logger']['warn']('No\x20OCR\x20result\x20found\x20for\x20'+_0x4825aa['withdrawalCode']),{'rawPath':_0x331dc9,'analyzedStatus':'na'});}catch(_0x128cfd){return this['logger'][_0x293493(0xf2)]('Error\x20analyzing\x20transfer\x20bill:\x20'+_0x128cfd['message']),{'rawPath':_0x331dc9,'analyzedStatus':'na'};}}async['createQRCodeAndTransferTo'](_0x11cad4,_0x52941a){const _0x4b7c83=_0x9a65f2,_0x1aaf25=(0x0,_0x4ec274[_0x4b7c83(0x14e)])(this[_0x4b7c83(0xa7)],'qrcode');await(0x0,_0x5cbb48['mkdir'])(_0x1aaf25,{'recursive':!0x0});const _0x468b4f='qr_'+_0x52941a['withdrawalCode']+'.png',_0x5b0ac5=(0x0,_0x4ec274[_0x4b7c83(0x14e)])(_0x1aaf25,_0x468b4f);await(0x0,_0x3e89fb[_0x4b7c83(0x160)])(_0x5b0ac5,_0x52941a['transferCode'],{'type':_0x4b7c83(0xd8),'width':0xe4,'margin':0x2}),await(0x0,_0x3ec7ac[_0x4b7c83(0x1e6)])(0x1f4),await this['wsService']['transferFile'](_0x11cad4,_0x5b0ac5,0x1),await(0x0,_0x3ec7ac['sleep'])(0x1f4),this['logger']['log']('['+_0x11cad4+_0x4b7c83(0x1f7)+_0x52941a[_0x4b7c83(0x164)]);}};_0x157d7c['BaseBankService']=_0xd7a0dc,_0xd7a0dc['folderCreationInProgress']=!0x1,_0xd7a0dc[_0x9a65f2(0x20f)]=!0x1,_0x157d7c['BaseBankService']=_0xd7a0dc=_0xbb7d11=_0x1a3d95([(0x0,_0x9fc41a['Injectable'])(),_0xacf874(0x0,(0x0,_0x9fc41a['Inject'])(_0x3f7f4b['WEBSOCKET_SERVICE'])),_0x5a86ff('design:paramtypes',['function'==typeof(_0x258f63=void 0x0!==_0x5f5a86['IWebSocketService']&&_0x5f5a86['IWebSocketService'])?_0x258f63:Object,'function'==typeof(_0x2f9d3d=void 0x0!==_0x7099c0['DeviceService']&&_0x7099c0['DeviceService'])?_0x2f9d3d:Object,'function'==typeof(_0x467395=void 0x0!==_0x305420['OCRService']&&_0x305420[_0x9a65f2(0x173)])?_0x467395:Object])],_0xd7a0dc);},_0x5c5e9a=>{_0x5c5e9a['exports']=require('fs/promises');},function(_0x42171e,_0xb1a7a7,_0x5706d3){const _0x1c3c04=a0_0x14ea;var _0x49153a,_0x264d61,_0xc6b9eb,_0x5009f5=this&&this['__decorate']||function(_0x9ab5d5,_0x316030,_0x3aeb69,_0x224081){var _0xf6d3c,_0x5bb806=arguments['length'],_0x237992=_0x5bb806<0x3?_0x316030:null===_0x224081?_0x224081=Object['getOwnPropertyDescriptor'](_0x316030,_0x3aeb69):_0x224081;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x237992=Reflect['decorate'](_0x9ab5d5,_0x316030,_0x3aeb69,_0x224081);else{for(var _0x37b355=_0x9ab5d5['length']-0x1;_0x37b355>=0x0;_0x37b355--)(_0xf6d3c=_0x9ab5d5[_0x37b355])&&(_0x237992=(_0x5bb806<0x3?_0xf6d3c(_0x237992):_0x5bb806>0x3?_0xf6d3c(_0x316030,_0x3aeb69,_0x237992):_0xf6d3c(_0x316030,_0x3aeb69))||_0x237992);}return _0x5bb806>0x3&&_0x237992&&Object['defineProperty'](_0x316030,_0x3aeb69,_0x237992),_0x237992;},_0xeb6493=this&&this['__metadata']||function(_0x3e3bed,_0xcc508d){const _0x181c03=a0_0x14ea;if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect[_0x181c03(0x21e)](_0x3e3bed,_0xcc508d);};Object['defineProperty'](_0xb1a7a7,'__esModule',{'value':!0x0}),_0xb1a7a7['OCRService']=_0xb1a7a7['PreprocessOptions']=_0xb1a7a7['ROI']=void 0x0;const _0x2ab7b5=_0x5706d3(0x2),_0x4f59a4=_0x5706d3(0x1b),_0x513c44=_0x5706d3(0x1d),_0x10c2de=_0x5706d3(0x1f),_0x2403e4=_0x5706d3(0x21),_0x5c3c3b=_0x5706d3(0xf);var _0x4436c1=_0x5706d3(0x1f);Object[_0x1c3c04(0x176)](_0xb1a7a7,'ROI',{'enumerable':!0x0,'get':function(){return _0x4436c1['ROI'];}}),Object[_0x1c3c04(0x176)](_0xb1a7a7,_0x1c3c04(0x24c),{'enumerable':!0x0,'get':function(){return _0x4436c1['PreprocessOptions'];}});const _0x158550={'crop':{'x':0x0,'y':0x0,'width':0x1,'height':0x1},'psm':0x6,'charWhitelist':void 0x0,'maxWidth':0x4b0};let _0x2f9fb7=_0x49153a=class{constructor(_0x119895,_0x90ce20){const _0x5d5820=_0x1c3c04;this[_0x5d5820(0xa0)]=_0x119895,this[_0x5d5820(0x1a0)]=_0x90ce20,this[_0x5d5820(0x27d)]=new _0x2ab7b5['Logger'](_0x49153a[_0x5d5820(0x1b3)]),this[_0x5d5820(0x17c)]={'poolSize':_0x5c3c3b[_0x5d5820(0x14f)]['ocr']['poolSize'],'lang':_0x5c3c3b['config']['ocr']['lang'],'rois':{'full':_0x158550,'singleLine':{..._0x158550,'psm':0x7},'block':{..._0x158550,'psm':0x6}}};}['validateROI'](_0x284f32){const _0x5691e0=_0x1c3c04;return{'x':Math['max'](0x0,Math['min'](0x1,_0x284f32['x']||0x0)),'y':Math['max'](0x0,Math['min'](0x1,_0x284f32['y']||0x0)),'width':Math['max'](0.01,Math['min'](0x1,_0x284f32['width']||0x1)),'height':Math['max'](0.01,Math[_0x5691e0(0x24a)](0x1,_0x284f32['height']||0x1))};}['getROIConfig'](_0x2e59ab){const _0x402595=_0x1c3c04,_0xc3671f=this['ocrConfig'][_0x402595(0x1ca)]?.[_0x2e59ab]||this[_0x402595(0x17c)]['rois']?.[_0x402595(0x21a)]||_0x158550;return{'crop':_0xc3671f[_0x402595(0xe9)]||_0x158550['crop'],'psm':_0xc3671f[_0x402595(0x147)]??_0x158550['psm'],'charWhitelist':_0xc3671f['charWhitelist'],'maxWidth':_0xc3671f['maxWidth']??_0x158550['maxWidth']};}async['recognizeFromFile'](_0xe267b,_0x822bc0={}){const _0x42d004=_0x1c3c04,_0x544d50=Date['now'](),_0x4b196a={'decodeImage':0x0,'preprocess':0x0,'ocrRecognize':0x0,'postprocess':0x0};try{const _0xc3328b=Date['now'](),_0x30ca17=await(0x0,_0x4f59a4['readFile'])(_0xe267b);_0x4b196a['decodeImage']=Date[_0x42d004(0x9b)]()-_0xc3328b;const _0x358b4c=_0x822bc0['fieldType']||'full',_0x118a8f=this['getROIConfig'](_0x358b4c),_0x4344ee=this['validateROI'](_0x822bc0['customROI']||_0x118a8f['crop']),_0x744780=Date['now'](),_0xfca878=await this['imagePreprocessingService']['preprocess'](_0x30ca17,_0x4344ee,_0x118a8f['maxWidth'],_0x822bc0['preprocess']);_0x4b196a[_0x42d004(0x1e7)]=Date[_0x42d004(0x9b)]()-_0x744780;const _0x1523d2=Date['now'](),_0x3f7eb1=await this['workerPoolService']['recognize'](_0xfca878['buffer'],{'psm':_0x118a8f['psm'],'charWhitelist':_0x118a8f['charWhitelist']});_0x4b196a['ocrRecognize']=Date['now']()-_0x1523d2;const _0x57abbb=Date['now'](),_0x43c0ac=this['postprocessText'](_0x3f7eb1[_0x42d004(0x295)]);_0x4b196a['postprocess']=Date['now']()-_0x57abbb;const _0xdc6a79=Date['now']()-_0x544d50;return this[_0x42d004(0x19a)](_0xe267b,_0x358b4c,_0xdc6a79,_0x4b196a,_0x3f7eb1['confidence']),{'text':_0x43c0ac,'confidence':_0x3f7eb1[_0x42d004(0x177)],'processingTime':_0xdc6a79,'timingBreakdown':_0x4b196a};}catch(_0x2a8cb0){return this['logger']['error']('OCR\x20error\x20for\x20'+_0xe267b+':\x20'+_0x2a8cb0[_0x42d004(0x1dc)],_0x2a8cb0[_0x42d004(0x2ad)]),null;}}async['recognizeFromBuffer'](_0x54316b,_0xbcf69b={}){const _0x2b8f4c=_0x1c3c04,_0xf53f39=Date['now'](),_0x4d5d58={'decodeImage':0x0,'preprocess':0x0,'ocrRecognize':0x0,'postprocess':0x0};try{_0x4d5d58['decodeImage']=0x0;const _0x4cc934=_0xbcf69b['fieldType']||'full',_0x21485d=this[_0x2b8f4c(0x267)](_0x4cc934),_0x54aae0=this['validateROI'](_0xbcf69b['customROI']||_0x21485d[_0x2b8f4c(0xe9)]),_0x325d76=Date['now'](),_0x3400a0=await this['imagePreprocessingService'][_0x2b8f4c(0x1e7)](_0x54316b,_0x54aae0,_0x21485d['maxWidth'],_0xbcf69b[_0x2b8f4c(0x1e7)]);_0x4d5d58['preprocess']=Date['now']()-_0x325d76;const _0x5b429b=Date['now'](),_0x3ed10b=await this['workerPoolService']['recognize'](_0x3400a0['buffer'],{'psm':_0x21485d['psm'],'charWhitelist':_0x21485d['charWhitelist']});_0x4d5d58[_0x2b8f4c(0x266)]=Date[_0x2b8f4c(0x9b)]()-_0x5b429b;const _0x450e90=Date[_0x2b8f4c(0x9b)](),_0x59b989=this['postprocessText'](_0x3ed10b['text']);_0x4d5d58['postprocess']=Date['now']()-_0x450e90;const _0x356102=Date[_0x2b8f4c(0x9b)]()-_0xf53f39;return this[_0x2b8f4c(0x19a)]('buffer',_0x4cc934,_0x356102,_0x4d5d58,_0x3ed10b[_0x2b8f4c(0x177)]),{'text':_0x59b989,'confidence':_0x3ed10b['confidence'],'processingTime':_0x356102,'timingBreakdown':_0x4d5d58};}catch(_0x35c7cc){return this['logger']['error']('OCR\x20error\x20from\x20buffer:\x20'+_0x35c7cc['message'],_0x35c7cc['stack']),null;}}async[_0x1c3c04(0xc0)](_0x5e35ab,_0x525a2c,_0x371c27={}){const _0x56bc49=_0x1c3c04,_0x1733b4=await this['recognizeFromFile'](_0x5e35ab,{'fieldType':_0x371c27['fieldType']||_0x56bc49(0x21a),'customROI':_0x371c27[_0x56bc49(0x11f)],'preprocess':_0x371c27['preprocess']});if(!_0x1733b4||!_0x1733b4['text'])return{'found':!0x1,'matchedTexts':[],'result':_0x1733b4};const _0x29143a=(0x0,_0x2403e4['normalizeBankAccountName'])(_0x1733b4['text']),_0x137a0a=_0x525a2c[_0x56bc49(0x252)](_0x2a0b75=>_0x29143a[_0x56bc49(0xf0)]((0x0,_0x2403e4['normalizeBankAccountName'])(_0x2a0b75)));return{'found':_0x137a0a[_0x56bc49(0x132)]>0x0,'matchedTexts':_0x137a0a,'result':_0x1733b4};}['postprocessText'](_0x5894c3){return _0x5894c3['trim']()['replace'](/\s+/g,'\x20')['replace'](/\n{3,}/g,'\x0a\x0a');}['logTimingBreakdown'](_0xf51ed2,_0x4a9899,_0x242840,_0x34dbe6,_0x2bbed6){const _0x2d0668=_0x1c3c04;['decode='+_0x34dbe6['decodeImage']+'ms','preprocess='+_0x34dbe6['preprocess']+'ms','ocr='+_0x34dbe6[_0x2d0668(0x266)]+'ms','postprocess='+_0x34dbe6['postprocess']+'ms']['join']('\x20|\x20'),_0x242840>0x3e8&&this['logger'][_0x2d0668(0x26d)]('\x20OCR\x20latency\x20exceeded\x20target:\x20'+_0x242840+'ms\x20>\x201000ms\x20(p95\x20target)');}};_0xb1a7a7[_0x1c3c04(0x173)]=_0x2f9fb7,_0xb1a7a7['OCRService']=_0x2f9fb7=_0x49153a=_0x5009f5([(0x0,_0x2ab7b5['Injectable'])(),_0xeb6493(_0x1c3c04(0x109),[_0x1c3c04(0x10a)==typeof(_0x264d61=void 0x0!==_0x513c44['OCRWorkerPoolService']&&_0x513c44['OCRWorkerPoolService'])?_0x264d61:Object,'function'==typeof(_0xc6b9eb=void 0x0!==_0x10c2de['ImagePreprocessingService']&&_0x10c2de[_0x1c3c04(0xeb)])?_0xc6b9eb:Object])],_0x2f9fb7);},function(_0xaa56e7,_0x21b0a9,_0x5e0c38){const _0x4f88ca=a0_0x14ea;var _0x56b124=this&&this[_0x4f88ca(0x13c)]||function(_0x40e115,_0x2d4a93,_0x8f6b10,_0x255dce){const _0x432d21=_0x4f88ca;var _0xc4c830,_0x11f169=arguments[_0x432d21(0x132)],_0xd605b3=_0x11f169<0x3?_0x2d4a93:null===_0x255dce?_0x255dce=Object[_0x432d21(0xfb)](_0x2d4a93,_0x8f6b10):_0x255dce;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0xd605b3=Reflect[_0x432d21(0xcf)](_0x40e115,_0x2d4a93,_0x8f6b10,_0x255dce);else{for(var _0x593c02=_0x40e115['length']-0x1;_0x593c02>=0x0;_0x593c02--)(_0xc4c830=_0x40e115[_0x593c02])&&(_0xd605b3=(_0x11f169<0x3?_0xc4c830(_0xd605b3):_0x11f169>0x3?_0xc4c830(_0x2d4a93,_0x8f6b10,_0xd605b3):_0xc4c830(_0x2d4a93,_0x8f6b10))||_0xd605b3);}return _0x11f169>0x3&&_0xd605b3&&Object['defineProperty'](_0x2d4a93,_0x8f6b10,_0xd605b3),_0xd605b3;},_0x1362df=this&&this[_0x4f88ca(0x23c)]||function(_0x416574,_0x1c958c){const _0x4ef1cc=_0x4f88ca;if(_0x4ef1cc(0x217)==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0x416574,_0x1c958c);};Object['defineProperty'](_0x21b0a9,'__esModule',{'value':!0x0}),_0x21b0a9[_0x4f88ca(0xb5)]=void 0x0;const _0x4b602a=_0x5e0c38(0x2),_0x12b866=_0x5e0c38(0x1e),_0x157a17=_0x5e0c38(0xf);let _0x5110e6=class{constructor(){const _0x17a4c2=_0x4f88ca;this['logger']=new _0x4b602a['Logger']('OCRWorkerPoolService'),this['pool']=[],this['waitingQueue']=[],this[_0x17a4c2(0x219)]=0x1388,this['maxPoolSize']=0xa,this['isInitializing']=!0x1,this['isDestroyed']=!0x1,this['isAcquiring']=!0x1,this['initializationPromise']=null,this[_0x17a4c2(0x2a5)]=Math['max'](0x1,Math['min'](_0x157a17['config']['ocr'][_0x17a4c2(0x2a5)],this['maxPoolSize'])),this['lang']=_0x157a17['config'][_0x17a4c2(0x287)]['lang'],_0x157a17[_0x17a4c2(0x14f)]['ocr']['poolSize']>this['maxPoolSize']&&this[_0x17a4c2(0x27d)]['warn']('OCR_POOL_SIZE\x20('+_0x157a17['config'][_0x17a4c2(0x287)][_0x17a4c2(0x2a5)]+')\x20exceeds\x20maximum\x20('+this['maxPoolSize']+_0x17a4c2(0x2b6)+this['maxPoolSize']+'.');}async['onModuleInit'](){await this['warmPool']();}async['onModuleDestroy'](){const _0x453fff=_0x4f88ca;this['isDestroyed']=!0x0,this[_0x453fff(0x271)](new Error('OCR\x20service\x20is\x20shutting\x20down')),await this['terminateAll']();}async['warmPool'](){const _0x4bd1f7=_0x4f88ca;if(this['isInitializing'])return this['initializationPromise']||Promise['resolve']();this['isInitializing']=!0x0,this['initializationPromise']=this[_0x4bd1f7(0xaa)]();try{await this['initializationPromise'];}finally{this['isInitializing']=!0x1;}}async['doWarmPool'](){const _0x2128e8=_0x4f88ca,_0x53e897=Date['now']();this['logger']['log']('Warming\x20up\x20OCR\x20worker\x20pool\x20(size:\x20'+this['poolSize']+',\x20lang:\x20'+this['lang']+_0x2128e8(0x24e));const _0xd827b7=Array['from']({'length':this['poolSize']},(_0x2633b6,_0x1260bc)=>this['createWorker'](_0x1260bc));try{await Promise['all'](_0xd827b7);const _0x3c3a92=Date['now']()-_0x53e897;this['logger']['log'](_0x2128e8(0x28c)+_0x3c3a92+_0x2128e8(0x155)+this[_0x2128e8(0x18c)]['length']);}catch(_0x29444d){throw this['logger']['error']('Failed\x20to\x20warm\x20up\x20worker\x20pool:\x20'+_0x29444d['message'],_0x29444d['stack']),await this['terminateAll'](),_0x29444d;}}async[_0x4f88ca(0x12b)](_0x2a0e64){const _0xf1bc9f=_0x4f88ca;try{const _0x3174ca=await _0x12b866['createWorker'](this['lang'],0x1,{'logger':_0x27a7df=>{const _0x1843eb=a0_0x14ea;'error'===_0x27a7df['status']&&this['logger']['error'](_0x1843eb(0x15b)+_0x2a0e64+'\x20error:\x20'+_0x27a7df['message']);}});this['pool']['push']({'id':_0x2a0e64,'worker':_0x3174ca,'inUse':!0x1,'lastUsed':Date['now']()}),this[_0xf1bc9f(0x27d)]['debug']('Worker\x20'+_0x2a0e64+'\x20created\x20successfully');}catch(_0x43f4ab){throw this['logger']['error'](_0xf1bc9f(0x1ae)+_0x2a0e64+':\x20'+_0x43f4ab['message']),_0x43f4ab;}}async['acquireWorker'](){const _0x447bc3=_0x4f88ca;if(this['isDestroyed'])throw new Error('OCR\x20service\x20is\x20destroyed');return this[_0x447bc3(0x10b)]&&this['initializationPromise']&&await this[_0x447bc3(0x1f1)],this['tryAcquireFromPool']()||this[_0x447bc3(0x284)]();}[_0x4f88ca(0x26a)](){const _0x402b78=_0x4f88ca;if(this[_0x402b78(0x11a)])return null;this['isAcquiring']=!0x0;try{for(const _0x3c922c of this[_0x402b78(0x18c)])if(!_0x3c922c['inUse'])return _0x3c922c[_0x402b78(0x1e0)]=!0x0,_0x3c922c[_0x402b78(0x12f)]=Date[_0x402b78(0x9b)](),_0x3c922c;return null;}finally{this['isAcquiring']=!0x1;}}['waitForWorker'](){return new Promise((_0x237b8d,_0x4f0f5c)=>{const _0x1bc3f2=setTimeout(()=>{const _0x4f18af=a0_0x14ea,_0x3c9e7b=this[_0x4f18af(0x258)]['findIndex'](_0x2e2447=>_0x2e2447['resolve']===_0x237b8d);-0x1!==_0x3c9e7b&&this['waitingQueue']['splice'](_0x3c9e7b,0x1),this[_0x4f18af(0x27d)]['warn']('Timeout\x20waiting\x20for\x20worker,\x20creating\x20temporary\x20worker'),this['createTemporaryWorker']()[_0x4f18af(0x2aa)](_0x237b8d)['catch'](_0x4f0f5c);},this['maxWaitTime']);this['waitingQueue']['push']({'resolve':_0x237b8d,'reject':_0x4f0f5c,'timeout':_0x1bc3f2});});}async['createTemporaryWorker'](){const _0xe07554=_0x4f88ca;return{'id':-0x1,'worker':await _0x12b866['createWorker'](this[_0xe07554(0xe8)],0x1,{'logger':()=>{}}),'inUse':!0x0,'lastUsed':Date['now']()};}[_0x4f88ca(0x91)](_0x187014){const _0x46dcd4=_0x4f88ca;if(this['waitingQueue']['length']>0x0){const _0x503384=this[_0x46dcd4(0x258)][_0x46dcd4(0x1c3)]();clearTimeout(_0x503384['timeout']),_0x187014['lastUsed']=Date['now'](),_0x503384['resolve'](_0x187014);}else _0x187014['inUse']=!0x1,_0x187014['lastUsed']=Date[_0x46dcd4(0x9b)]();}['rejectAllPending'](_0x98ff62){const _0x20664d=_0x4f88ca;for(;this['waitingQueue']['length']>0x0;){const _0x397e36=this['waitingQueue'][_0x20664d(0x1c3)]();clearTimeout(_0x397e36['timeout']),_0x397e36['reject'](_0x98ff62);}}async[_0x4f88ca(0xef)](_0x231125,_0xfa84e6={}){const _0x3a74e7=_0x4f88ca,_0x2f7e01=await this[_0x3a74e7(0x281)](),_0x196a3a=_0x2f7e01['id']<0x0,{psm:_0xd2464a,charWhitelist:_0x53acdc}=_0xfa84e6,_0x41656d=void 0x0!==_0xd2464a||!!_0x53acdc;try{const _0x44c73a={};void 0x0!==_0xd2464a&&(_0x44c73a['tessedit_pageseg_mode']=_0xd2464a),_0x53acdc&&(_0x44c73a['tessedit_char_whitelist']=_0x53acdc),Object['keys'](_0x44c73a)['length']>0x0&&await _0x2f7e01['worker'][_0x3a74e7(0x292)](_0x44c73a);const {data:_0x59fce2}=await _0x2f7e01[_0x3a74e7(0x167)]['recognize'](_0x231125);return{'text':_0x59fce2['text'],'confidence':_0x59fce2['confidence']};}finally{if(_0x196a3a)try{await _0x2f7e01['worker'][_0x3a74e7(0x188)]();}catch(_0x331d79){this['logger']['warn']('Failed\x20to\x20terminate\x20temporary\x20worker:\x20'+_0x331d79['message']);}else{if(_0x41656d)try{await _0x2f7e01[_0x3a74e7(0x167)]['setParameters']({'tessedit_pageseg_mode':0x6,'tessedit_char_whitelist':''});}catch(_0x157d29){this['logger'][_0x3a74e7(0x26d)](_0x3a74e7(0x1f2)+_0x157d29[_0x3a74e7(0x1dc)]);}this['releaseWorker'](_0x2f7e01);}}}['getPoolStats'](){const _0x24cd42=_0x4f88ca;return{'total':this['pool']['length'],'inUse':this['pool']['filter'](_0x65f19f=>_0x65f19f['inUse'])['length'],'waiting':this[_0x24cd42(0x258)]['length']};}async[_0x4f88ca(0x11e)](){const _0x15f18f=_0x4f88ca;if(0x0===this['pool']['length'])return;this['logger']['log'](_0x15f18f(0x285)+this[_0x15f18f(0x18c)][_0x15f18f(0x132)]+_0x15f18f(0x235));const _0x2cd41f=this['pool']['map'](_0x18814b=>_0x18814b[_0x15f18f(0x167)]['terminate']()[_0x15f18f(0x2aa)](()=>{const _0x1b3149=_0x15f18f;this['logger']['debug'](_0x1b3149(0x290)+_0x18814b['id']+'\x20terminated');})['catch'](_0x374e74=>{const _0x5b103d=_0x15f18f;this['logger'][_0x5b103d(0xf2)]('Error\x20terminating\x20worker\x20'+_0x18814b['id']+':\x20'+_0x374e74[_0x5b103d(0x1dc)]);}));await Promise['all'](_0x2cd41f),this['pool']['length']=0x0,this[_0x15f18f(0x27d)]['log'](_0x15f18f(0x104));}};_0x21b0a9['OCRWorkerPoolService']=_0x5110e6,_0x21b0a9['OCRWorkerPoolService']=_0x5110e6=_0x56b124([(0x0,_0x4b602a['Injectable'])(),_0x1362df('design:paramtypes',[])],_0x5110e6);},_0xf2c78d=>{_0xf2c78d['exports']=require('tesseract.js');},function(_0x5d46dd,_0x2e8db8,_0x489ed4){const _0x3cad5b=a0_0x14ea;var _0xe5d86=this&&this[_0x3cad5b(0x13c)]||function(_0x56c442,_0x5aa30f,_0x45e0ed,_0x5a8623){const _0x56948f=_0x3cad5b;var _0x4c03c6,_0x183623=arguments[_0x56948f(0x132)],_0x3172f9=_0x183623<0x3?_0x5aa30f:null===_0x5a8623?_0x5a8623=Object['getOwnPropertyDescriptor'](_0x5aa30f,_0x45e0ed):_0x5a8623;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x3172f9=Reflect[_0x56948f(0xcf)](_0x56c442,_0x5aa30f,_0x45e0ed,_0x5a8623);else{for(var _0x303985=_0x56c442[_0x56948f(0x132)]-0x1;_0x303985>=0x0;_0x303985--)(_0x4c03c6=_0x56c442[_0x303985])&&(_0x3172f9=(_0x183623<0x3?_0x4c03c6(_0x3172f9):_0x183623>0x3?_0x4c03c6(_0x5aa30f,_0x45e0ed,_0x3172f9):_0x4c03c6(_0x5aa30f,_0x45e0ed))||_0x3172f9);}return _0x183623>0x3&&_0x3172f9&&Object['defineProperty'](_0x5aa30f,_0x45e0ed,_0x3172f9),_0x3172f9;};Object['defineProperty'](_0x2e8db8,'__esModule',{'value':!0x0}),_0x2e8db8[_0x3cad5b(0xeb)]=void 0x0;const _0x151774=_0x489ed4(0x2),_0x23f101=_0x489ed4(0x20);let _0x3d883b=class{constructor(){const _0x547648=_0x3cad5b;this['logger']=new _0x151774[(_0x547648(0x108))](_0x547648(0xeb)),this['MIN_DIMENSION']=0xa;}['validateROI'](_0x529e5e){const _0x48c014=_0x3cad5b;if(_0x529e5e['x']<0x0||_0x529e5e['x']>0x1)throw new Error(_0x48c014(0x17e)+_0x529e5e['x']+'\x20(must\x20be\x200-1)');if(_0x529e5e['y']<0x0||_0x529e5e['y']>0x1)throw new Error('Invalid\x20ROI\x20y:\x20'+_0x529e5e['y']+'\x20(must\x20be\x200-1)');if(_0x529e5e[_0x48c014(0xf1)]<=0x0||_0x529e5e['width']>0x1)throw new Error('Invalid\x20ROI\x20width:\x20'+_0x529e5e[_0x48c014(0xf1)]+_0x48c014(0x2c7));if(_0x529e5e[_0x48c014(0x198)]<=0x0||_0x529e5e[_0x48c014(0x198)]>0x1)throw new Error(_0x48c014(0x15d)+_0x529e5e[_0x48c014(0x198)]+_0x48c014(0x2c7));if(_0x529e5e['x']+_0x529e5e[_0x48c014(0xf1)]>1.001)throw new Error('ROI\x20extends\x20beyond\x20image:\x20x('+_0x529e5e['x']+')\x20+\x20width('+_0x529e5e['width']+')\x20>\x201');if(_0x529e5e['y']+_0x529e5e['height']>1.001)throw new Error('ROI\x20extends\x20beyond\x20image:\x20y('+_0x529e5e['y']+')\x20+\x20height('+_0x529e5e['height']+')\x20>\x201');}async[_0x3cad5b(0x1e7)](_0x3b9c9b,_0x410d01,_0x247621,_0x5e040c={}){const _0x14a0f0=_0x3cad5b;Date[_0x14a0f0(0x9b)]();try{this['validateROI'](_0x410d01);const _0x463c57=_0x23f101(_0x3b9c9b),_0x41c5bf=await _0x463c57['metadata'](),_0x1f2463=_0x41c5bf[_0x14a0f0(0xf1)]||0x0,_0x1c1718=_0x41c5bf[_0x14a0f0(0x198)]||0x0;if(0x0===_0x1f2463||0x0===_0x1c1718)throw new Error(_0x14a0f0(0xd9));if(_0x1f2463<this['MIN_DIMENSION']||_0x1c1718<this[_0x14a0f0(0x131)])throw new Error(_0x14a0f0(0x15e)+_0x1f2463+'x'+_0x1c1718+'\x20(min:\x20'+this[_0x14a0f0(0x131)]+'x'+this['MIN_DIMENSION']+')');const _0x1baa62=Math['floor'](_0x410d01['x']*_0x1f2463),_0x4d81d7=Math[_0x14a0f0(0x125)](_0x410d01['y']*_0x1c1718),_0x5907bf=Math[_0x14a0f0(0x125)](_0x410d01[_0x14a0f0(0xf1)]*_0x1f2463),_0x29f7e9=Math['floor'](_0x410d01[_0x14a0f0(0x198)]*_0x1c1718),_0x519164=Math['max'](0x0,Math['min'](_0x1baa62,_0x1f2463-0x1)),_0x2bf5df=Math[_0x14a0f0(0x166)](0x0,Math['min'](_0x4d81d7,_0x1c1718-0x1)),_0x2df957=Math['max'](this['MIN_DIMENSION'],Math[_0x14a0f0(0x24a)](_0x5907bf,_0x1f2463-_0x519164)),_0xe0ad18=Math['max'](this['MIN_DIMENSION'],Math['min'](_0x29f7e9,_0x1c1718-_0x2bf5df));let _0x3f0911=_0x463c57[_0x14a0f0(0x2b2)]({'left':_0x519164,'top':_0x2bf5df,'width':_0x2df957,'height':_0xe0ad18}),_0xdc6c6f=_0x2df957,_0x17e3f3=_0xe0ad18,_0x23d1d4=0x1;return _0x247621&&_0x2df957>_0x247621&&(_0x23d1d4=_0x247621/_0x2df957,_0xdc6c6f=_0x247621,_0x17e3f3=Math['max'](this['MIN_DIMENSION'],Math['floor'](_0xe0ad18*_0x23d1d4)),_0x3f0911=_0x3f0911[_0x14a0f0(0x18d)](_0xdc6c6f,_0x17e3f3,{'kernel':_0x23f101['kernel'][_0x14a0f0(0xe1)],'withoutEnlargement':!0x0})),_0x5e040c[_0x14a0f0(0x199)]&&(_0x3f0911=_0x3f0911['grayscale']()),_0x5e040c['enhanceContrast']&&(_0x3f0911=_0x3f0911['normalize']()),{'buffer':await _0x3f0911['png']()['toBuffer'](),'metadata':{'originalWidth':_0x1f2463,'originalHeight':_0x1c1718,'processedWidth':_0xdc6c6f,'processedHeight':_0x17e3f3,'scaleFactor':_0x23d1d4}};}catch(_0x5665a8){throw this['logger']['error']('Image\x20preprocessing\x20error:\x20'+_0x5665a8['message'],_0x5665a8['stack']),_0x5665a8;}}};_0x2e8db8[_0x3cad5b(0xeb)]=_0x3d883b,_0x2e8db8['ImagePreprocessingService']=_0x3d883b=_0xe5d86([(0x0,_0x151774[_0x3cad5b(0x150)])()],_0x3d883b);},_0x300997=>{_0x300997['exports']=require('sharp');},(_0x20ee37,_0x1568e8)=>{const _0x51accb=a0_0x14ea;Object['defineProperty'](_0x1568e8,'__esModule',{'value':!0x0}),_0x1568e8[_0x51accb(0xb1)]=_0x1568e8['removeVietnameseTones']=void 0x0,_0x1568e8['removeVietnameseTones']=_0xa8399=>_0xa8399?_0xa8399[_0x51accb(0x259)]('NFD')['replace'](/[\u0300-\u036f]/g,'')['replace'](//g,'d')['replace'](//g,'D'):'',_0x1568e8['normalizeBankAccountName']=_0x2736e0=>_0x2736e0?(0x0,_0x1568e8['removeVietnameseTones'])(_0x2736e0)['trim']()['replace'](/ /g,'')['toLocaleUpperCase']():'';},_0xf2153d=>{_0xf2153d['exports']=require('qrcode');},(_0x5e9901,_0x1717e8)=>{const _0x29ea58=a0_0x14ea;Object['defineProperty'](_0x1717e8,'__esModule',{'value':!0x0}),_0x1717e8[_0x29ea58(0x25f)]=void 0x0,_0x1717e8['PG_ROI_EXPECTED']={'LAUNCH_APP':{'x':0.05,'y':0.54,'width':0.7,'height':0.1},'VERIFY_ACCOUNT_NAME':{'x':0.05,'y':0.55,'width':0.9,'height':0.25},'TRANSACTION_CONFIRM':{'x':0.05,'y':0.05,'width':0.9,'height':0.2},'TRANSACTION_VERIFY':{'x':0.05,'y':0.05,'width':0.9,'height':0.2},'TRANSACTION_SUCCESS':{'x':0.1,'y':0.2,'width':0.9,'height':0.3},'HOME_SCREEN':{'x':0.02,'y':0.7,'width':0.98,'height':0.3}};},(_0x29bcbb,_0x554d74,_0x2732e9)=>{const _0x4b8102=a0_0x14ea;Object['defineProperty'](_0x554d74,_0x4b8102(0x22f),{'value':!0x0}),_0x554d74[_0x4b8102(0x261)]=_0x554d74[_0x4b8102(0x103)]=_0x554d74['COMMON_COORDINATES']=_0x554d74[_0x4b8102(0x192)]=void 0x0;const _0xeeaa2e=_0x2732e9(0xf);_0x554d74['scaleCoordinates']=(_0x4ce795,_0x74031b=0x64)=>Object['fromEntries'](Object[_0x4b8102(0x220)](_0x4ce795)[_0x4b8102(0x146)](([_0x127fe4,_0x36c187])=>[_0x127fe4,{'x':Math['round'](_0x36c187['x']*_0x74031b),'y':Math['round'](_0x36c187['y']*_0x74031b)}]));const _0xcd9e88={0x0:{'x':0.55,'y':0.95},0x1:{'x':0.25,'y':0.7},0x2:{'x':0.55,'y':0.7},0x3:{'x':0.85,'y':0.7},0x4:{'x':0.25,'y':0.8},0x5:{'x':0.55,'y':0.8},0x6:{'x':0.85,'y':0.8},0x7:{'x':0.25,'y':0.9},0x8:{'x':0.55,'y':0.9},0x9:{'x':0.85,'y':0.9}},_0x45232e={'KEYBOARD_SWITCH':{'x':0.05,'y':0.95},'SHIFT_KEY':{'x':0.05,'y':0.88},'RETURN_KEY':{'x':0.95,'y':0.95}},_0x2921c4=(0x0,_0x554d74['scaleCoordinates'])(_0x45232e),_0x15af9d=(0x0,_0x554d74['scaleCoordinates'])(_0xcd9e88);_0x554d74['COMMON_COORDINATES']='PANDA'===_0xeeaa2e[_0x4b8102(0x14f)]['boxType']?_0x2921c4:_0x45232e,_0x554d74[_0x4b8102(0x103)]={0x0:{'x':0.95,'y':0.68},0x1:{'x':0.05,'y':0.68},0x2:{'x':0.15,'y':0.68},0x3:{'x':0.25,'y':0.68},0x4:{'x':0.35,'y':0.68},0x5:{'x':0.45,'y':0.68},0x6:{'x':0.55,'y':0.68},0x7:{'x':0.65,'y':0.68},0x8:{'x':0.75,'y':0.68},0x9:{'x':0.85,'y':0.68},'@':{'x':0.85,'y':0.78},'!':{'x':0.65,'y':0.88},'a':{'x':0.1,'y':0.78},'b':{'x':0.6,'y':0.88},'c':{'x':0.4,'y':0.88},'d':{'x':0.3,'y':0.78},'e':{'x':0.25,'y':0.68},'f':{'x':0.4,'y':0.78},'g':{'x':0.5,'y':0.78},'h':{'x':0.6,'y':0.78},'i':{'x':0.75,'y':0.68},'j':{'x':0.7,'y':0.78},'k':{'x':0.8,'y':0.78},'l':{'x':0.9,'y':0.78},'m':{'x':0.8,'y':0.88},'n':{'x':0.7,'y':0.88},'o':{'x':0.85,'y':0.68},'p':{'x':0.95,'y':0.68},'q':{'x':0.05,'y':0.68},'r':{'x':0.35,'y':0.68},'s':{'x':0.2,'y':0.78},'t':{'x':0.45,'y':0.68},'u':{'x':0.65,'y':0.68},'v':{'x':0.5,'y':0.88},'w':{'x':0.15,'y':0.68},'x':{'x':0.3,'y':0.88},'y':{'x':0.55,'y':0.68},'z':{'x':0.2,'y':0.88},'\x20':{'x':0.55,'y':0.95}},_0x554d74[_0x4b8102(0x261)]='PANDA'===_0xeeaa2e['config']['boxType']?_0x15af9d:_0xcd9e88;},(_0x563992,_0x4934cc,_0x305307)=>{const _0x137919=a0_0x14ea;Object[_0x137919(0x176)](_0x4934cc,_0x137919(0x22f),{'value':!0x0}),_0x4934cc['ACB_UI_COORDINATES']=void 0x0;const _0x22717e=_0x305307(0xf),_0x5645e5={'LOGIN_BUTTON':{'x':0.5,'y':0.8},'LOGIN_BUTTON_API':{'x':0.5,'y':0.62},'PASSWORD_FIELD':{'x':0.5,'y':0.45}},_0x52456f=(0x0,_0x305307(0x24)['scaleCoordinates'])(_0x5645e5);_0x4934cc['ACB_UI_COORDINATES']=_0x137919(0x17b)===_0x22717e['config']['boxType']?_0x52456f:_0x5645e5;},function(_0x59dd2c,_0x542819,_0x33236a){const _0x3ee3d3=a0_0x14ea;var _0x284139,_0x4d4cfb,_0x2ac495,_0x184678=this&&this[_0x3ee3d3(0x13c)]||function(_0x34de18,_0x38ca98,_0x50999e,_0x2a8294){const _0x1ef7bf=_0x3ee3d3;var _0x5ef93b,_0x5e7825=arguments['length'],_0x512c41=_0x5e7825<0x3?_0x38ca98:null===_0x2a8294?_0x2a8294=Object['getOwnPropertyDescriptor'](_0x38ca98,_0x50999e):_0x2a8294;if('object'==typeof Reflect&&_0x1ef7bf(0x10a)==typeof Reflect[_0x1ef7bf(0xcf)])_0x512c41=Reflect[_0x1ef7bf(0xcf)](_0x34de18,_0x38ca98,_0x50999e,_0x2a8294);else{for(var _0x5d545f=_0x34de18[_0x1ef7bf(0x132)]-0x1;_0x5d545f>=0x0;_0x5d545f--)(_0x5ef93b=_0x34de18[_0x5d545f])&&(_0x512c41=(_0x5e7825<0x3?_0x5ef93b(_0x512c41):_0x5e7825>0x3?_0x5ef93b(_0x38ca98,_0x50999e,_0x512c41):_0x5ef93b(_0x38ca98,_0x50999e))||_0x512c41);}return _0x5e7825>0x3&&_0x512c41&&Object['defineProperty'](_0x38ca98,_0x50999e,_0x512c41),_0x512c41;},_0x229039=this&&this['__metadata']||function(_0x28c03d,_0x305add){const _0x31149f=_0x3ee3d3;if('object'==typeof Reflect&&_0x31149f(0x10a)==typeof Reflect[_0x31149f(0x21e)])return Reflect['metadata'](_0x28c03d,_0x305add);},_0x83d761=this&&this['__param']||function(_0x519021,_0x4e564f){return function(_0x30c23c,_0x56084c){_0x4e564f(_0x30c23c,_0x56084c,_0x519021);};};Object['defineProperty'](_0x542819,_0x3ee3d3(0x22f),{'value':!0x0}),_0x542819[_0x3ee3d3(0x1db)]=void 0x0;const _0x36f985=_0x33236a(0x2),_0x152370=_0x33236a(0x15),_0x4df556=_0x33236a(0x1a),_0x4d906c=_0x33236a(0x19),_0x43e150=_0x33236a(0x14),_0x5da5b6=_0x33236a(0x11),_0x3cbecd=_0x33236a(0x27),_0x70605=_0x33236a(0x1c),_0x1bf487=_0x33236a(0x28),_0x1e1a30=_0x33236a(0x23),_0x13fe4d=_0x33236a(0x29);let _0x19e5bf=class extends _0x4df556[_0x3ee3d3(0x13f)]{constructor(_0x5a46cb,_0x45ff84,_0x4a7961){super(_0x5a46cb,_0x45ff84,_0x4a7961),this['wsService']=_0x5a46cb,this['BANK_CODE']='PGBANK',this['BUNDLE_ID']='pgbankApp.pgbank.com.vn';}async['inputPasswordFromConfig'](_0x21b402){const _0x194556=_0x3ee3d3,_0x31c5b0=await this[_0x194556(0x1f8)]['getDeviceConfig'](_0x21b402);if(!_0x31c5b0||!_0x31c5b0[_0x194556(0x276)])throw new Error('Password\x20not\x20configured\x20for\x20device\x20'+_0x21b402);await this[_0x194556(0x1bc)](_0x21b402,_0x3cbecd['PG_UI_COORDINATES']['PASSWORD_FIELD']['x'],_0x3cbecd['PG_UI_COORDINATES']['PASSWORD_FIELD']['y'],0x5dc),await this[_0x194556(0xb6)]['inputText'](_0x21b402,_0x31c5b0[_0x194556(0x276)]),await(0x0,_0x5da5b6['sleep'])(0x3e8),await this['wsService'][_0x194556(0x2c4)](_0x21b402),await(0x0,_0x5da5b6['sleep'])(0x3e8);}async['inputSmartOTPFromConfig'](_0x3ef28f,_0x19abe8=0x3){const _0x24411a=_0x3ee3d3,_0x4c64b2=await this[_0x24411a(0x1f8)][_0x24411a(0x275)](_0x3ef28f);if(!_0x4c64b2||!_0x4c64b2[_0x24411a(0x28f)])throw new Error(_0x24411a(0xa6)+_0x3ef28f);await(0x0,_0x5da5b6['sleep'])(0x7d0),await this[_0x24411a(0xb6)]['inputText'](_0x3ef28f,_0x4c64b2[_0x24411a(0x28f)]);}async['launchApp'](_0x5ee02c){const _0x21ca8d=_0x3ee3d3;if(await this[_0x21ca8d(0xb6)]['launchApp'](_0x5ee02c,this['BUNDLE_ID']),!await this['verifyScreenState'](_0x5ee02c,{'expectedTexts':['ng\x20nhp'],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x1e1a30['PG_ROI_EXPECTED'][_0x21ca8d(0xde)],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new _0x1bf487[(_0x21ca8d(0x18b))](_0x21ca8d(0x119),_0x1bf487[_0x21ca8d(0x121)]['FORCE_LOGIN']);this['logger']['log']('['+_0x5ee02c+']\x20-\x20Get\x20login\x20app\x20screen');}async[_0x3ee3d3(0xb8)](_0x3f5c3c){const _0x3a28d7=_0x3ee3d3;if(await this[_0x3a28d7(0x90)](_0x3f5c3c),await(0x0,_0x5da5b6['sleep'])(0x7d0),await this['launchApp'](_0x3f5c3c),await this['inputPasswordFromConfig'](_0x3f5c3c),!await this['clickAndWaitForScreen'](_0x3f5c3c,_0x3cbecd['PG_UI_COORDINATES']['LOGIN_BTN']['x'],_0x3cbecd['PG_UI_COORDINATES'][_0x3a28d7(0xab)]['y'],{'expectedTexts':['ti\x20khon','chuyn\x20tin','tit\x20kim'],'timeout':0x4e20,'pollInterval':0x1f4,'roi':_0x1e1a30['PG_ROI_EXPECTED'][_0x3a28d7(0x244)]}))throw new _0x1bf487['WithdrawalProcessingError']('Failed\x20to\x20login\x20to\x20PGBank',_0x1bf487['ErrorType']['FORCE_LOGIN']);this['logger']['log']('['+_0x3f5c3c+']\x20-\x20Login\x20successfully');}async['executeTransferWithQRCode'](_0x7b51d5,_0x21592d){const _0x4569f2=_0x3ee3d3;if(this['logger'][_0x4569f2(0x133)]('Executing\x20PG\x20transfer\x20for\x20withdrawal\x20'+_0x7b51d5['withdrawalId']+_0x4569f2(0xcd)+_0x21592d['deviceId']),await this['createBillFolder'](_0x7b51d5['withdrawalCode']),await this['createQRCodeAndTransferTo'](_0x21592d['deviceId'],_0x7b51d5),await this[_0x4569f2(0x1bc)](_0x21592d['deviceId'],_0x3cbecd['PG_UI_COORDINATES']['QR_CODE_BTN']['x'],_0x3cbecd['PG_UI_COORDINATES']['QR_CODE_BTN']['y'],0xbb8),await this['clickWithTransition'](_0x21592d['deviceId'],_0x3cbecd['PG_UI_COORDINATES']['IMAGE_LIBRARY_BTN']['x'],_0x3cbecd['PG_UI_COORDINATES']['IMAGE_LIBRARY_BTN']['y'],0x7d0),await this['clickWithTransition'](_0x21592d['deviceId'],_0x3cbecd['PG_UI_COORDINATES'][_0x4569f2(0x2a3)]['x'],_0x3cbecd['PG_UI_COORDINATES'][_0x4569f2(0x2a3)]['y'],0x7d0),_0x7b51d5[_0x4569f2(0x200)]===_0x13fe4d['BankCodeWithdrawal']['PGBANK']&&await this[_0x4569f2(0x1bc)](_0x21592d['deviceId'],_0x3cbecd[_0x4569f2(0xb3)]['CLOSE_ALLOW_CONTACT_POPUP_BTN']['x'],_0x3cbecd[_0x4569f2(0xb3)][_0x4569f2(0x2b5)]['y'],0x3e8),!await this['clickAndWaitForScreen'](_0x21592d['deviceId'],_0x3cbecd[_0x4569f2(0xb3)]['SELECT_IMAGE_QR_CODE_BTN']['x'],_0x3cbecd['PG_UI_COORDINATES']['SELECT_IMAGE_QR_CODE_BTN']['y'],{'expectedTexts':[_0x7b51d5['beneficiaryName']],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x1e1a30['PG_ROI_EXPECTED']['VERIFY_ACCOUNT_NAME']}))throw await this['clickWithTransition'](_0x21592d[_0x4569f2(0x16f)],_0x3cbecd[_0x4569f2(0xb3)]['HOME_ICON_HEADER']['x'],_0x3cbecd['PG_UI_COORDINATES']['HOME_ICON_HEADER']['y'],0x7d0),new _0x1bf487[(_0x4569f2(0x18b))](_0x4569f2(0xdf),_0x1bf487['ErrorType']['TEMPORARY']);if(this['logger']['log']('['+_0x21592d[_0x4569f2(0x245)]+_0x4569f2(0x15a)),!await this['clickAndWaitForScreen'](_0x21592d[_0x4569f2(0x16f)],_0x3cbecd[_0x4569f2(0xb3)]['CONTINUE_TRANSFER_BTN']['x'],_0x3cbecd[_0x4569f2(0xb3)]['CONTINUE_TRANSFER_BTN']['y'],{'expectedTexts':[_0x4569f2(0x1cf)],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x1e1a30['PG_ROI_EXPECTED']['TRANSACTION_CONFIRM']}))throw new _0x1bf487[(_0x4569f2(0x18b))]('Transaction\x20confirm\x20screen\x20not\x20found',_0x1bf487[_0x4569f2(0x121)]['FORCE_LOGIN']);if(this['logger']['log']('['+_0x21592d['accountName']+_0x4569f2(0xc6)),!await this[_0x4569f2(0x1bf)](_0x21592d[_0x4569f2(0x16f)],_0x3cbecd[_0x4569f2(0xb3)][_0x4569f2(0xb2)]['x'],_0x3cbecd[_0x4569f2(0xb3)]['CONTINUE_TRANSFER_BTN']['y'],{'expectedTexts':[_0x4569f2(0x1be)],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x1e1a30[_0x4569f2(0x25f)][_0x4569f2(0x232)]}))throw new _0x1bf487[(_0x4569f2(0x18b))](_0x4569f2(0x18a),_0x1bf487['ErrorType']['FORCE_LOGIN']);if(this['logger'][_0x4569f2(0x133)]('['+_0x21592d['accountName']+']\x20-\x20Get\x20Transaction\x20verification\x20screen'),await this['inputSmartOTPFromConfig'](_0x21592d[_0x4569f2(0x16f)]),!await this['verifyScreenState'](_0x21592d['deviceId'],{'expectedTexts':[_0x4569f2(0xc5)],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x1e1a30['PG_ROI_EXPECTED']['TRANSACTION_SUCCESS'],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new _0x1bf487[(_0x4569f2(0x18b))]('Transaction\x20success\x20screen\x20not\x20found',_0x1bf487[_0x4569f2(0x121)]['FORCE_LOGIN']);this[_0x4569f2(0x27d)][_0x4569f2(0x133)]('['+_0x21592d['accountName']+_0x4569f2(0x11c)),this['captureScreen'](_0x21592d[_0x4569f2(0x16f)],{'folderPath':_0x7b51d5['withdrawalCode']})[_0x4569f2(0x1c9)](()=>{this['logger']['error']('['+_0x21592d['accountName']+']\x20-\x20Error\x20capturing\x20screen\x20for\x20withdrawal\x20'+_0x7b51d5['withdrawalId']+'\x20-\x20'+_0x7b51d5['withdrawalCode']);}),await this['clickWithTransition'](_0x21592d[_0x4569f2(0x16f)],_0x3cbecd['PG_UI_COORDINATES']['BACK_TO_HOME']['x'],_0x3cbecd['PG_UI_COORDINATES'][_0x4569f2(0x17a)]['y'],0x1388,'['+_0x21592d[_0x4569f2(0x245)]+_0x4569f2(0xe4));}async['extractTransactionAmount'](_0x469a60){const _0xf04ab9=_0x3ee3d3;try{const _0x17dbc2=await this['ocrService']['recognizeFromFile'](_0x469a60,{'fieldType':'singleLine','customROI':{'x':0.05,'y':0.75,'width':0.9,'height':0.12},'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}});if(!_0x17dbc2)return this['logger'][_0xf04ab9(0x26d)]('Failed\x20to\x20extract\x20transaction\x20amount\x20from\x20ROI'),null;const _0x4944e3=_0x17dbc2['text'][_0xf04ab9(0x159)](/[^\d.,]/g,'')['replace'](/,/g,''),_0x5e53e7=parseFloat(_0x4944e3);return isNaN(_0x5e53e7)?(this['logger']['warn']('Could\x20not\x20parse\x20amount\x20from\x20OCR\x20text:\x20'+_0x17dbc2['text']),null):(this['logger']['log']('Extracted\x20transaction\x20amount:\x20'+_0x5e53e7['toLocaleString']('vi-VN')+'\x20VND\x20(confidence:\x20'+_0x17dbc2['confidence']['toFixed'](0x2)+_0xf04ab9(0x2a4)+_0x17dbc2['processingTime']+'ms)'),_0x5e53e7);}catch(_0x2cbff8){return this['logger'][_0xf04ab9(0xf2)]('Error\x20extracting\x20transaction\x20amount:\x20'+_0x2cbff8[_0xf04ab9(0x1dc)],_0x2cbff8['stack']),null;}}async['onModuleInit'](){}['onModuleDestroy'](){}};_0x542819[_0x3ee3d3(0x1db)]=_0x19e5bf,_0x542819[_0x3ee3d3(0x1db)]=_0x19e5bf=_0x184678([(0x0,_0x36f985['Injectable'])(),_0x83d761(0x0,(0x0,_0x36f985['Inject'])(_0x43e150[_0x3ee3d3(0x253)])),_0x229039(_0x3ee3d3(0x109),['function'==typeof(_0x284139=void 0x0!==_0x4d906c['IWebSocketService']&&_0x4d906c['IWebSocketService'])?_0x284139:Object,'function'==typeof(_0x4d4cfb=void 0x0!==_0x152370[_0x3ee3d3(0x100)]&&_0x152370['DeviceService'])?_0x4d4cfb:Object,'function'==typeof(_0x2ac495=void 0x0!==_0x70605[_0x3ee3d3(0x173)]&&_0x70605['OCRService'])?_0x2ac495:Object])],_0x19e5bf);},(_0x410963,_0x55abaa,_0x1fae31)=>{const _0x150bb3=a0_0x14ea;Object['defineProperty'](_0x55abaa,'__esModule',{'value':!0x0}),_0x55abaa['PG_UI_COORDINATES']=void 0x0;const _0x3be2f3=_0x1fae31(0xf),_0x269669={'LOGIN_BTN':{'x':0.5,'y':0.6},'PASSWORD_FIELD':{'x':0.5,'y':0.4},'TRANSFER_BTN':{'x':0.7,'y':0.7},'TRANSFER_INTERNAL_BTN':{'x':0.2,'y':0.2},'TRANSFER_EXTERNAL_BTN':{'x':0.4,'y':0.2},'CLOSE_ALLOW_CONTACT_POPUP_BTN':{'x':0.3,'y':0.6},'ACCOUNT_NUMBER_INPUT':{'x':0.4,'y':0.43},'SELECT_BANK_BTN':{'x':0.4,'y':0.47},'SEARCH_BANK_BTN':{'x':0.4,'y':0.48},'INTERNAL_AMOUNT_INPUT':{'x':0.5,'y':0.6},'HIDE_NUMPAD_BTN':{'x':0.05,'y':0.4},'CONTINUE_TRANSFER_BTN':{'x':0.5,'y':0.9},'BANK_SEARCH_BTN':{'x':0.4,'y':0.45},'BANK_SEARCH_INPUT':{'x':0.4,'y':0.45},'EXTERNAL_AMOUNT_INPUT':{'x':0.3,'y':0.37},'BACK_TO_HOME':{'x':0.2,'y':0.9},'QR_CODE_BTN':{'x':0.2,'y':0.9},'IMAGE_LIBRARY_BTN':{'x':0.8,'y':0.9},'FIRST_IMAGE_BTN':{'x':0.3,'y':0.3},'SELECT_IMAGE_QR_CODE_BTN':{'x':0.95,'y':0.95},'HOME_ICON_HEADER':{'x':0.95,'y':0.05}},_0x315e34=(0x0,_0x1fae31(0x24)['scaleCoordinates'])(_0x269669);_0x55abaa[_0x150bb3(0xb3)]='PANDA'===_0x3be2f3['config']['boxType']?_0x315e34:_0x269669;},(_0x4fe833,_0x3d52cc)=>{const _0x1c6997=a0_0x14ea;var _0x153bb4;Object['defineProperty'](_0x3d52cc,_0x1c6997(0x22f),{'value':!0x0}),_0x3d52cc['WithdrawalProcessingError']=_0x3d52cc['ErrorType']=void 0x0,function(_0x2bb6e5){const _0x256c6b=_0x1c6997;_0x2bb6e5['TEMPORARY']='TEMPORARY',_0x2bb6e5['PERMANENT']='PERMANENT',_0x2bb6e5['FORCE_LOGIN']=_0x256c6b(0x134);}(_0x153bb4||(_0x3d52cc['ErrorType']=_0x153bb4={}));class _0x1a957f extends Error{constructor(_0x5aef57,_0x279886){const _0x5bf212=_0x1c6997;super(_0x5aef57),this[_0x5bf212(0x296)]=_0x279886,this[_0x5bf212(0x1b3)]=_0x5bf212(0x18b),Error[_0x5bf212(0x11b)](this,this['constructor']);}}_0x3d52cc[_0x1c6997(0x18b)]=_0x1a957f;},(_0x1fd091,_0x221990)=>{var _0x299421;Object['defineProperty'](_0x221990,'__esModule',{'value':!0x0}),_0x221990['BankCodeWithdrawal']=void 0x0,function(_0x268488){const _0x5c5174=a0_0x14ea;_0x268488['VIETCOMBANK']='VIETCOMBANK',_0x268488['AGRIBANK']=_0x5c5174(0x1fd),_0x268488['BIDV']='BIDV',_0x268488['SACOMBANK']='SACOMBANK',_0x268488[_0x5c5174(0x25c)]='TECHCOMBANK',_0x268488[_0x5c5174(0x2b4)]='TPBANK',_0x268488['HDBank']=_0x5c5174(0x124),_0x268488[_0x5c5174(0xe5)]='VPBANK',_0x268488['MBBANK']='MBBANK',_0x268488['MSB']=_0x5c5174(0x211),_0x268488[_0x5c5174(0x162)]='LPBANK',_0x268488[_0x5c5174(0x14a)]='ACB',_0x268488[_0x5c5174(0xb0)]='ABBANK',_0x268488['NCB']=_0x5c5174(0x1a2),_0x268488['EXIMBANK']='EXIMBANK',_0x268488['SEABANK']='SEABANK',_0x268488['SCB']=_0x5c5174(0x254),_0x268488['PVCOMBANK']=_0x5c5174(0x2bf),_0x268488[_0x5c5174(0x202)]='KIENLONGBANK',_0x268488['BVBANK']='BVBANK',_0x268488['VIETINBANK']='VIETINBANK',_0x268488['OCB']=_0x5c5174(0x10f),_0x268488['VIETBANK']=_0x5c5174(0x15f),_0x268488['SHB']='SHB',_0x268488[_0x5c5174(0x12d)]='NAMABANK',_0x268488['SHINHANBANKVIETNAM']=_0x5c5174(0x105),_0x268488['CIMB']='CIMB',_0x268488['SAIGONBANK']='SAIGONBANK',_0x268488['BACABANK']='BACABANK',_0x268488['VIETABANK']='VIETABANK',_0x268488[_0x5c5174(0x8c)]='GPBANK',_0x268488[_0x5c5174(0xa3)]='HSBC',_0x268488['VRB']=_0x5c5174(0xe6),_0x268488['VIB']='VIB',_0x268488[_0x5c5174(0x1cb)]='PGBANK';}(_0x299421||(_0x221990['BankCodeWithdrawal']=_0x299421={}));},function(_0x444790,_0x288212,_0x2d6f56){const _0x10d538=a0_0x14ea;var _0x588a6c,_0x2093b4=this&&this['__decorate']||function(_0x5e909d,_0x27e986,_0x15a963,_0x1e15b3){const _0x41f2f3=a0_0x14ea;var _0x2e7216,_0x3caad6=arguments[_0x41f2f3(0x132)],_0x377a4a=_0x3caad6<0x3?_0x27e986:null===_0x1e15b3?_0x1e15b3=Object[_0x41f2f3(0xfb)](_0x27e986,_0x15a963):_0x1e15b3;if('object'==typeof Reflect&&_0x41f2f3(0x10a)==typeof Reflect['decorate'])_0x377a4a=Reflect['decorate'](_0x5e909d,_0x27e986,_0x15a963,_0x1e15b3);else{for(var _0x1d18ae=_0x5e909d['length']-0x1;_0x1d18ae>=0x0;_0x1d18ae--)(_0x2e7216=_0x5e909d[_0x1d18ae])&&(_0x377a4a=(_0x3caad6<0x3?_0x2e7216(_0x377a4a):_0x3caad6>0x3?_0x2e7216(_0x27e986,_0x15a963,_0x377a4a):_0x2e7216(_0x27e986,_0x15a963))||_0x377a4a);}return _0x3caad6>0x3&&_0x377a4a&&Object['defineProperty'](_0x27e986,_0x15a963,_0x377a4a),_0x377a4a;},_0x2ed679=this&&this['__metadata']||function(_0x41fd4f,_0x317ae7){const _0x4351e3=a0_0x14ea;if('object'==typeof Reflect&&_0x4351e3(0x10a)==typeof Reflect['metadata'])return Reflect['metadata'](_0x41fd4f,_0x317ae7);};Object['defineProperty'](_0x288212,'__esModule',{'value':!0x0}),_0x288212['SessionManagementService']=void 0x0;const _0x20ad5c=_0x2d6f56(0x2),_0x19a0db=_0x2d6f56(0x16);let _0x5b378c=class{constructor(_0x4dbcec){const _0x26c29c=a0_0x14ea;this['redisService']=_0x4dbcec,this[_0x26c29c(0x27d)]=new _0x20ad5c['Logger']('SessionManagementService'),this['REDIS_SESSION_PREFIX']='bank:session:',this['BANK_SESSION_CONFIGS']=new Map([[_0x26c29c(0x14a),{'bankCode':'ACB','sessionTimeoutMs':0xdbba0,'refreshBeforeMs':0xea60}],['PGBANK',{'bankCode':'PGBANK','sessionTimeoutMs':0x41eb0,'refreshBeforeMs':0x7530}]]);}['getSessionTimeout'](_0x456b7b){const _0x5a3ee4=a0_0x14ea,_0xe791d8=this['BANK_SESSION_CONFIGS']['get'](_0x456b7b['toUpperCase']());return _0xe791d8?.[_0x5a3ee4(0x2bd)]||0x41eb0;}['getRefreshBeforeTime'](_0x4c2cff){const _0x512c93=a0_0x14ea,_0x5daeb8=this[_0x512c93(0x22e)]['get'](_0x4c2cff['toUpperCase']());return _0x5daeb8?.[_0x512c93(0x194)]||0x7530;}async['recordLogin'](_0x2ca2bb,_0x29beac){const _0x51ad8c=a0_0x14ea,_0x4a202b=this[_0x51ad8c(0x10e)](_0x29beac),_0x27229a=Date['now']()+_0x4a202b,_0x299f8e={'deviceId':_0x2ca2bb,'bankCode':_0x29beac['toUpperCase'](),'loginTime':Date[_0x51ad8c(0x9b)](),'expiresAt':_0x27229a,'status':'logged_in'},_0x31fcdb=''+this[_0x51ad8c(0x1ee)]+_0x2ca2bb+':'+_0x29beac['toUpperCase']();await this[_0x51ad8c(0x1ff)]['set'](_0x31fcdb,JSON['stringify'](_0x299f8e),_0x4a202b),this['logger']['log']('['+_0x2ca2bb+_0x51ad8c(0x127)+_0x29beac+_0x51ad8c(0x20a)+new Date(_0x27229a)['toISOString']()+')');}async['markLoggingIn'](_0x2949a8,_0x465381){const _0x4ce449=a0_0x14ea,_0x366501=''+this['REDIS_SESSION_PREFIX']+_0x2949a8+':'+_0x465381['toUpperCase'](),_0x1b7356=await this['getSession'](_0x2949a8,_0x465381),_0x2ca17b={'deviceId':_0x2949a8,'bankCode':_0x465381['toUpperCase'](),'loginTime':_0x1b7356?.[_0x4ce449(0xae)]||Date[_0x4ce449(0x9b)](),'expiresAt':_0x1b7356?.['expiresAt']||Date['now']()+this['getSessionTimeout'](_0x465381),'status':'logging_in'};await this['redisService']['set'](_0x366501,JSON[_0x4ce449(0x1b9)](_0x2ca17b),0x493e0),this[_0x4ce449(0x27d)]['log']('Marked\x20device\x20'+_0x2949a8+',\x20bank\x20'+_0x465381+_0x4ce449(0x112));}async['getSession'](_0x4b9470,_0x564df7){const _0x118f82=a0_0x14ea;try{const _0x5cc819=''+this[_0x118f82(0x1ee)]+_0x4b9470+':'+_0x564df7['toUpperCase'](),_0x27dd58=await this[_0x118f82(0x1ff)]['get'](_0x5cc819);return _0x27dd58?JSON['parse'](_0x27dd58):null;}catch(_0x3b45fa){return this[_0x118f82(0x27d)][_0x118f82(0xf2)]('Error\x20getting\x20session\x20for\x20device\x20'+_0x4b9470+',\x20bank\x20'+_0x564df7+':\x20'+_0x3b45fa['message']),null;}}async['isSessionValid'](_0x326546,_0x88fc43){const _0x25dc0f=await this['getSession'](_0x326546,_0x88fc43);return!(!_0x25dc0f||_0x25dc0f['expiresAt']<Date['now']()||'logging_in'===_0x25dc0f['status']||'logged_in'!==_0x25dc0f['status']);}async['needsRefresh'](_0xe0f1ca,_0x22ecf0){const _0x4df176=await this['getSession'](_0xe0f1ca,_0x22ecf0);if(!_0x4df176||'logged_in'!==_0x4df176['status'])return!0x1;const _0x120475=this['getRefreshBeforeTime'](_0x22ecf0);return _0x4df176['expiresAt']-Date['now']()<=_0x120475;}async['clearSession'](_0x462f64,_0x3db4e8){const _0x56afbf=a0_0x14ea,_0x3bff96=''+this[_0x56afbf(0x1ee)]+_0x462f64+':'+_0x3db4e8['toUpperCase']();await this[_0x56afbf(0x1ff)]['del'](_0x3bff96),this[_0x56afbf(0x27d)]['log'](_0x56afbf(0x179)+_0x462f64+',\x20bank\x20'+_0x3db4e8);}};_0x288212['SessionManagementService']=_0x5b378c,_0x288212['SessionManagementService']=_0x5b378c=_0x2093b4([(0x0,_0x20ad5c[_0x10d538(0x150)])(),_0x2ed679('design:paramtypes',['function'==typeof(_0x588a6c=void 0x0!==_0x19a0db['RedisService']&&_0x19a0db['RedisService'])?_0x588a6c:Object])],_0x5b378c);},function(_0x46cf5f,_0x4f5217,_0x8b35d1){const _0x37518b=a0_0x14ea;var _0x2c8a58,_0x2830bc=this&&this[_0x37518b(0x13c)]||function(_0x2d175b,_0x3c4841,_0x5ed2fc,_0x1da41e){const _0x28790c=_0x37518b;var _0x421822,_0x430ee5=arguments['length'],_0xf1ee79=_0x430ee5<0x3?_0x3c4841:null===_0x1da41e?_0x1da41e=Object['getOwnPropertyDescriptor'](_0x3c4841,_0x5ed2fc):_0x1da41e;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x28790c(0xcf)])_0xf1ee79=Reflect[_0x28790c(0xcf)](_0x2d175b,_0x3c4841,_0x5ed2fc,_0x1da41e);else{for(var _0x449b66=_0x2d175b['length']-0x1;_0x449b66>=0x0;_0x449b66--)(_0x421822=_0x2d175b[_0x449b66])&&(_0xf1ee79=(_0x430ee5<0x3?_0x421822(_0xf1ee79):_0x430ee5>0x3?_0x421822(_0x3c4841,_0x5ed2fc,_0xf1ee79):_0x421822(_0x3c4841,_0x5ed2fc))||_0xf1ee79);}return _0x430ee5>0x3&&_0xf1ee79&&Object['defineProperty'](_0x3c4841,_0x5ed2fc,_0xf1ee79),_0xf1ee79;},_0x5cc5b8=this&&this['__metadata']||function(_0x3b747f,_0x58184d){if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0x3b747f,_0x58184d);};Object[_0x37518b(0x176)](_0x4f5217,'__esModule',{'value':!0x0}),_0x4f5217[_0x37518b(0xad)]=void 0x0;const _0x4d93ea=_0x8b35d1(0x2),_0x57a029=_0x8b35d1(0x16),_0xc4b535=_0x8b35d1(0x2c);let _0x4aaa71=class{constructor(_0x4164c2){const _0x59d6d6=_0x37518b;this['redisService']=_0x4164c2,this['logger']=new _0x4d93ea[(_0x59d6d6(0x108))](_0x59d6d6(0xad)),this['REDIS_LOCK_PREFIX']='device:lock:',this['DEFAULT_LOCK_TTL']=0x927c0;}async[_0x37518b(0x297)](_0x576c1d,_0x16a562,_0x580142,_0x5b0278=this['DEFAULT_LOCK_TTL']){const _0x22be98=_0x37518b;try{const _0x11642e=''+this['REDIS_LOCK_PREFIX']+_0x576c1d,_0x5310a1=''+this['REDIS_LOCK_PREFIX']+_0x576c1d+':meta',_0x24578e=(0x0,_0xc4b535['randomUUID'])(),_0x51ee31=Math['ceil'](_0x5b0278/0x3e8),_0x480491=await this[_0x22be98(0x1ff)]['getClient']();if('OK'===await _0x480491['set'](_0x11642e,_0x24578e,'EX',_0x51ee31,'NX')){const _0x587200={'deviceId':_0x576c1d,'lockType':_0x16a562,'lockedAt':Date['now'](),'lockedBy':_0x580142,'ttl':_0x5b0278};return await this['redisService']['setex'](_0x5310a1,_0x51ee31,JSON['stringify'](_0x587200)),this['logger']['log']('Acquired\x20'+_0x16a562+'\x20lock\x20for\x20device\x20'+_0x576c1d+'\x20('+_0x580142+')\x20with\x20lockId\x20'+_0x24578e),!0x0;}return this['logger']['warn']('Device\x20'+_0x576c1d+'\x20is\x20already\x20locked,\x20cannot\x20acquire\x20lock'),!0x1;}catch(_0x1856bd){return this['logger'][_0x22be98(0xf2)]('Error\x20acquiring\x20lock\x20for\x20device\x20'+_0x576c1d+':\x20'+_0x1856bd['message']),!0x1;}}async['releaseLock'](_0x595281){const _0x4bf0d1=_0x37518b;try{const _0x4139af=''+this[_0x4bf0d1(0x136)]+_0x595281,_0x129bfd=''+this['REDIS_LOCK_PREFIX']+_0x595281+_0x4bf0d1(0x17d),_0x4ca71a=await this['redisService'][_0x4bf0d1(0x142)](),_0x5f30fc=await _0x4ca71a[_0x4bf0d1(0x184)](_0x4139af);if(!_0x5f30fc)return await this[_0x4bf0d1(0x1ff)]['del'](_0x129bfd),void this['logger'][_0x4bf0d1(0x1e5)](_0x4bf0d1(0x1ec)+_0x595281+'\x20is\x20not\x20locked,\x20nothing\x20to\x20release');0x1===await _0x4ca71a['eval']('\x0aif\x20redis.call(\x22GET\x22,\x20KEYS[1])\x20==\x20ARGV[1]\x20then\x0a\x20\x20redis.call(\x22DEL\x22,\x20KEYS[2])\x0a\x20\x20return\x20redis.call(\x22DEL\x22,\x20KEYS[1])\x0aelse\x0a\x20\x20return\x200\x0aend\x0a',0x2,_0x4139af,_0x129bfd,_0x5f30fc)?this['logger']['log']('['+_0x595281+']\x20Released\x20lock\x20(lockId:\x20'+_0x5f30fc+')'):this['logger']['warn']('['+_0x595281+']\x20Lock\x20was\x20already\x20released\x20or\x20changed\x20(expected\x20lockId:\x20'+_0x5f30fc+')');}catch(_0x43c03b){this[_0x4bf0d1(0x27d)][_0x4bf0d1(0xf2)]('['+_0x595281+']\x20Error\x20releasing\x20lock:\x20'+_0x43c03b['message'],_0x43c03b['stack']);}}async['getLock'](_0x163ca5){const _0x57c9fc=_0x37518b;try{const _0x4a3220=''+this['REDIS_LOCK_PREFIX']+_0x163ca5,_0x33177d=await this['redisService']['get'](_0x4a3220);if(!_0x33177d)return null;const _0x4e4ebd=''+this['REDIS_LOCK_PREFIX']+_0x163ca5+':meta',_0x4aa702=await this['redisService']['get'](_0x4e4ebd);return _0x4aa702?{...JSON[_0x57c9fc(0x14c)](_0x4aa702),'lockId':_0x33177d}:{'deviceId':_0x163ca5,'lockType':'transfer','lockedAt':Date['now'](),'lockedBy':_0x57c9fc(0xcb),'ttl':this['DEFAULT_LOCK_TTL'],'lockId':_0x33177d};}catch(_0x3cf195){return this['logger']['error']('Error\x20getting\x20lock\x20for\x20device\x20'+_0x163ca5+':\x20'+_0x3cf195['message']),null;}}async['isLocked'](_0x55ade6,_0x1dea4b){const _0x229c79=_0x37518b;try{const _0x4cc8e6=''+this['REDIS_LOCK_PREFIX']+_0x55ade6;if(!await this['redisService']['exists'](_0x4cc8e6))return!0x1;const _0xd91426=await this['getLock'](_0x55ade6);return!(!_0xd91426||_0x1dea4b&&_0xd91426['lockType']===_0x1dea4b);}catch(_0x32aa84){return this[_0x229c79(0x27d)]['error']('Error\x20checking\x20lock\x20status\x20for\x20device\x20'+_0x55ade6+':\x20'+_0x32aa84['message']),!0x1;}}async[_0x37518b(0x1df)](_0x533bd8,_0x247370){const _0x5b1098=_0x37518b;try{if(!await this[_0x5b1098(0x228)](_0x533bd8))return!0x1;const _0x2dd7cf=''+this['REDIS_LOCK_PREFIX']+_0x533bd8,_0x391b7c=''+this['REDIS_LOCK_PREFIX']+_0x533bd8+_0x5b1098(0x17d),_0x9883c3=await this['redisService']['getClient'](),_0x46fe34=await _0x9883c3[_0x5b1098(0xdd)](_0x2dd7cf);if(_0x46fe34<=0x0)return!0x1;const _0x46384c=Math[_0x5b1098(0x2ac)]((0x3e8*_0x46fe34+_0x247370)/0x3e8);return 0x1===await _0x9883c3['expire'](_0x2dd7cf,_0x46384c)&&(await this[_0x5b1098(0x1ff)][_0x5b1098(0x1d9)](_0x391b7c,_0x46384c),this['logger']['log']('Extended\x20lock\x20for\x20device\x20'+_0x533bd8+'\x20by\x20'+_0x247370+'ms'),!0x0);}catch(_0x2a7069){return this['logger'][_0x5b1098(0xf2)]('Error\x20extending\x20lock\x20for\x20device\x20'+_0x533bd8+':\x20'+_0x2a7069[_0x5b1098(0x1dc)]),!0x1;}}async['releaseLockByType'](_0x391b8f,_0x2aa78a){const _0x579171=_0x37518b;try{const _0x33f661=await this['getLock'](_0x391b8f);if(!_0x33f661)return!0x1;if(_0x33f661[_0x579171(0x129)]!==_0x2aa78a)return!0x1;const _0x11ead3=''+this['REDIS_LOCK_PREFIX']+_0x391b8f,_0x2437ef=''+this['REDIS_LOCK_PREFIX']+_0x391b8f+_0x579171(0x17d);return await this['redisService']['del'](_0x11ead3),await this['redisService']['del'](_0x2437ef),this[_0x579171(0x27d)][_0x579171(0x133)]('Force\x20released\x20'+_0x2aa78a+'\x20lock\x20for\x20device\x20'+_0x391b8f),!0x0;}catch(_0x5068ab){return this['logger']['error']('Error\x20releasing\x20'+_0x2aa78a+'\x20lock\x20for\x20device\x20'+_0x391b8f+':\x20'+_0x5068ab[_0x579171(0x1dc)]),!0x1;}}};_0x4f5217['DeviceLockService']=_0x4aaa71,_0x4f5217['DeviceLockService']=_0x4aaa71=_0x2830bc([(0x0,_0x4d93ea['Injectable'])(),_0x5cc5b8('design:paramtypes',['function'==typeof(_0x2c8a58=void 0x0!==_0x57a029['RedisService']&&_0x57a029[_0x37518b(0x27c)])?_0x2c8a58:Object])],_0x4aaa71);},_0x37aa6b=>{_0x37aa6b['exports']=require('crypto');},function(_0x4c3131,_0x193a62,_0x80e80e){const _0x163a10=a0_0x14ea;var _0x20311d,_0xc80a35,_0x4f3e22,_0x451d52,_0x223e3b,_0x175d96,_0xd52581=this&&this['__decorate']||function(_0x57f0c0,_0x3a8b2d,_0x45fbdf,_0x55792f){const _0x1a7851=a0_0x14ea;var _0xca2b48,_0x56fad1=arguments['length'],_0xfb0e35=_0x56fad1<0x3?_0x3a8b2d:null===_0x55792f?_0x55792f=Object[_0x1a7851(0xfb)](_0x3a8b2d,_0x45fbdf):_0x55792f;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x1a7851(0xcf)])_0xfb0e35=Reflect['decorate'](_0x57f0c0,_0x3a8b2d,_0x45fbdf,_0x55792f);else{for(var _0x1ce51e=_0x57f0c0['length']-0x1;_0x1ce51e>=0x0;_0x1ce51e--)(_0xca2b48=_0x57f0c0[_0x1ce51e])&&(_0xfb0e35=(_0x56fad1<0x3?_0xca2b48(_0xfb0e35):_0x56fad1>0x3?_0xca2b48(_0x3a8b2d,_0x45fbdf,_0xfb0e35):_0xca2b48(_0x3a8b2d,_0x45fbdf))||_0xfb0e35);}return _0x56fad1>0x3&&_0xfb0e35&&Object[_0x1a7851(0x176)](_0x3a8b2d,_0x45fbdf,_0xfb0e35),_0xfb0e35;},_0x1e4490=this&&this['__metadata']||function(_0x62e55d,_0x281e8b){const _0x337a9f=a0_0x14ea;if('object'==typeof Reflect&&_0x337a9f(0x10a)==typeof Reflect['metadata'])return Reflect[_0x337a9f(0x21e)](_0x62e55d,_0x281e8b);},_0x25b88a=this&&this['__param']||function(_0x5c642d,_0x2a4b16){return function(_0x182926,_0x4b6134){_0x2a4b16(_0x182926,_0x4b6134,_0x5c642d);};};Object[_0x163a10(0x176)](_0x193a62,'__esModule',{'value':!0x0}),_0x193a62['WithdrawalJobManagerService']=void 0x0;const _0x379304=_0x80e80e(0x2),_0x1a467a=_0x80e80e(0x7),_0x2e143c=_0x80e80e(0x6),_0x3a13d2=_0x80e80e(0x2e),_0x13464a=_0x80e80e(0xa),_0x453b9e=_0x80e80e(0x15),_0x2bb577=_0x80e80e(0x2b),_0x34dc66=_0x80e80e(0x14),_0x4d6b91=_0x80e80e(0x19),_0x54a1a1=_0x80e80e(0x28),_0x1eb25e=_0x80e80e(0x2f),_0x17793e=_0x80e80e(0x30),_0x50c6a6=_0x80e80e(0x12);let _0x42530c=class{constructor(_0x285c2e,_0x5d7f12,_0x33c784,_0x51fe3e,_0x208764,_0x39f9d9){const _0xe49727=_0x163a10;this['withdrawalQueue']=_0x285c2e,this['withdrawalService']=_0x5d7f12,this['deviceService']=_0x33c784,this['deviceLock']=_0x51fe3e,this['wsService']=_0x208764,this[_0xe49727(0x1de)]=_0x39f9d9,this[_0xe49727(0x27d)]=new _0x379304['Logger'](_0xe49727(0x225)),this['processingJobs']=new Set(),this[_0xe49727(0x2b1)]=!0x1;}async['onModuleInit'](){const _0x147add=_0x163a10;this['logger']['log'](_0x147add(0xed)),setTimeout(()=>{this['initializeJobProcessing']();},0x1388);}async['initializeJobProcessing'](){this['isInitialized']||await this['startProcessing']();}async['startProcessing'](){const _0x28f46f=_0x163a10;try{this[_0x28f46f(0x27d)]['log']('Starting\x20withdrawal\x20job\x20processing...'),await this['pickAndProcessJobs'](),this['isInitialized']=!0x0;}catch(_0x189243){this[_0x28f46f(0x27d)]['error']('Error\x20starting\x20job\x20processing:\x20'+_0x189243[_0x28f46f(0x1dc)],_0x189243['stack']);}}async[_0x163a10(0x231)](){const _0x40b006=_0x163a10;try{const _0x44eb8a=await this['wsService']['listDevices'](),_0x3c65b6=[];for(const _0x3768b4 of _0x44eb8a){const _0x1c4f73=await this[_0x40b006(0x1f8)]['getDeviceConfig'](_0x3768b4['udid']);'active'===_0x1c4f73?.['status']&&(await this['deviceLock']['isLocked'](_0x3768b4[_0x40b006(0x1c5)])||_0x3c65b6['push']({'udid':_0x3768b4[_0x40b006(0x1c5)],'config':_0x1c4f73}));}return _0x3c65b6;}catch(_0x23c55b){return this['logger'][_0x40b006(0xf2)](_0x40b006(0x291)+_0x23c55b['message']),[];}}async[_0x163a10(0x2ab)](_0x2bdd81){const _0x320e82=_0x163a10;try{const _0x279904=await this['deviceService']['getServiceStatus']();if(_0x320e82(0xff)!==_0x279904)return void this['logger']['debug']('Service\x20is\x20'+_0x279904+',\x20cannot\x20pick\x20jobs');const _0x9b5cd4=await this['getAvailableDevices'](),_0x4056c0=_0x9b5cd4['length'];if(_0x4056c0<=0x0)return;const _0x2f8514=_0x2bdd81?Math['min'](_0x2bdd81,_0x4056c0):_0x4056c0,_0x4c21d7=await this['withdrawalQueue']['getJobs']([_0x320e82(0x19c)],0x0,_0x2f8514-0x1);if(0x0===_0x4c21d7['length'])return;this['logger']['log']('Found\x20'+_0x9b5cd4['length']+'\x20available\x20devices.\x20Picking\x20'+_0x4c21d7['length']+_0x320e82(0x1f3)+(_0x4c21d7||[])[_0x320e82(0x132)]+'\x20waiting.');for(let _0x432aa5=0x0;_0x432aa5<_0x4c21d7[_0x320e82(0x132)];_0x432aa5++){const _0x456137=_0x4c21d7[_0x432aa5],_0x208992=_0x9b5cd4[_0x432aa5];if(this['processingJobs']['has'](_0x456137['id']))continue;const _0x238e64=_0x320e82(0x2bc)+_0x456137['data'][_0x320e82(0x164)]+':'+_0x208992[_0x320e82(0x1c5)];await this[_0x320e82(0x293)]['acquireLock'](_0x208992['udid'],'transfer',_0x238e64,0x35e80)?this['processJob'](_0x456137,_0x208992['udid'])[_0x320e82(0x1c9)](_0x348c5d=>{const _0x106da6=_0x320e82;this['deviceLock'][_0x106da6(0x1a3)](_0x208992['udid'])[_0x106da6(0x1c9)](()=>{}),this[_0x106da6(0x27d)]['error']('Error\x20processing\x20job\x20'+_0x456137['id']+':\x20'+_0x348c5d['message'],_0x348c5d['stack']);}):this['logger']['warn'](_0x320e82(0x1ec)+_0x208992['udid']+'\x20was\x20locked\x20after\x20assignment,\x20skipping\x20job\x20'+_0x456137['id']);}}catch(_0x5b88f4){this['logger']['error']('Error\x20picking\x20jobs:\x20'+_0x5b88f4[_0x320e82(0x1dc)],_0x5b88f4['stack']);}}async['processJob'](_0x31c60c,_0x2c97df){const _0x4da9a8=_0x163a10,_0x2e9f9b=(0x0,_0x1eb25e['cloneDeep'])(_0x31c60c[_0x4da9a8(0x2a7)]),{withdrawalId:_0xabce7a}=_0x2e9f9b,_0x4ba7fa=await this['deviceService'][_0x4da9a8(0x275)](_0x2c97df);try{this['logger']['log']('Successfully\x20processed\x20and\x20removed\x20withdrawal\x20'+_0xabce7a+_0x4da9a8(0x1e4)),await _0x31c60c['remove']();}catch(_0x4bfce7){this['logger']['warn']('Could\x20not\x20remove\x20completed\x20job\x20'+_0x31c60c['id']+':\x20'+_0x4bfce7['message']);}if(_0x2e9f9b&&_0x2e9f9b['withdrawalId']||this[_0x4da9a8(0x27d)]['error']('Invalid\x20withdrawal\x20data\x20in\x20job\x20'+_0x31c60c['id']),!_0x2e9f9b[_0x4da9a8(0x215)])throw new _0x54a1a1['WithdrawalProcessingError'](_0x4da9a8(0x22c)+_0xabce7a,_0x54a1a1['ErrorType']['PERMANENT']);await this['bankService'][_0x4da9a8(0x1d0)](_0x4ba7fa[_0x4da9a8(0x200)],_0x2c97df,_0x2e9f9b),this['processingJobs'][_0x4da9a8(0xe2)](_0x31c60c['id']);try{await this[_0x4da9a8(0x2b0)]['processWithdrawal'](_0x2e9f9b,_0x2c97df);}catch(_0x45a94c){let _0x244446;this[_0x4da9a8(0x27d)]['error'](_0x4da9a8(0x186)+_0xabce7a+':\x20'+_0x45a94c['message'],_0x45a94c['stack']),_0x45a94c instanceof _0x54a1a1['WithdrawalProcessingError']&&(_0x244446=_0x45a94c['errorType']),_0x244446===_0x54a1a1['ErrorType']['FORCE_LOGIN']&&await this['bankService']['login'](_0x4ba7fa[_0x4da9a8(0x200)],_0x2c97df,!0x0),await this['handleJobFailure'](_0x2e9f9b,_0x45a94c[_0x4da9a8(0x1dc)],_0x244446);}finally{this['processingJobs']['delete'](_0x31c60c['id']);}}async['handleJobFailure'](_0x132475,_0x3cf727,_0x364c11=_0x54a1a1[_0x163a10(0x121)]['PERMANENT']){const _0x485d15=_0x163a10,_0xe30e7d=_0x132475[_0x485d15(0x280)]??0x0;if(this['logger'][_0x485d15(0x26d)](_0x485d15(0x19e)+_0x132475[_0x485d15(0x164)]+'\x20failed.\x20Reason:\x20'+_0x3cf727+'.\x20Error\x20Type:\x20'+_0x364c11+'.\x20Retry\x20attempt:\x20'+_0xe30e7d+'/3'),_0xe30e7d<0x3){if(_0x364c11===_0x54a1a1['ErrorType']['PERMANENT'])return;await this['withdrawalQueue']['add']('process-withdrawal-request',{..._0x132475,'manualRetryCount':_0xe30e7d+0x1,'lastErrorType':_0x364c11,'lastErrorReason':_0x3cf727},{'attempts':0x0,'removeOnComplete':!0x1,'removeOnFail':!0x1,'jobId':'withdrawal-request-'+_0x132475[_0x485d15(0x164)],'priority':0x0,'delay':0x7530});}else this['logger'][_0x485d15(0x26d)](_0x485d15(0x187)+_0x132475['withdrawalId']+':\x20'+_0x364c11+'\x20error:\x20'+_0x3cf727);}async['promoteDelayedJobs'](){return(0x0,_0x17793e['withCronLock'])('cron:promote_delayed:withdrawal',0x1388,async()=>{const _0x1ffcad=a0_0x14ea,_0x22686f=Date['now'](),_0x4563a2=await this[_0x1ffcad(0x299)][_0x1ffcad(0x171)]([_0x1ffcad(0x28a)],0x0,0x63);if(!_0x4563a2['length'])return;let _0x52c43a=0x0;for(const _0x166306 of _0x4563a2){const _0x21dbb7='number'==typeof _0x166306['opts']?.['delay']?_0x166306['opts'][_0x1ffcad(0x221)]:0x0;if((_0x1ffcad(0x1b5)==typeof _0x166306['timestamp']?_0x166306['timestamp']:0x0)+_0x21dbb7<=_0x22686f)try{await _0x166306['promote'](),_0x52c43a++;}catch(_0x1a7ce1){this['logger']['debug']('Promote\x20skipped\x20for\x20job\x20'+_0x166306['id']+':\x20'+String(_0x1a7ce1));}}_0x52c43a>0x0&&this[_0x1ffcad(0x27d)][_0x1ffcad(0x133)]('Promoted\x20'+_0x52c43a+'\x20delayed\x20jobs\x20to\x20waiting');});}async['triggerPickJobs'](_0x1e7ca7=0x1){const _0x32efd1=_0x163a10;await this[_0x32efd1(0x2ab)](_0x1e7ca7);}async['getQueueStats'](){const _0x4295fe=_0x163a10,[_0x3dc3eb,_0x14a173,_0x30a404,_0x391982,_0x1fef67,_0x41b2e9,_0x202167]=await Promise[_0x4295fe(0x1e1)]([this['withdrawalQueue']['getWaitingCount'](),this['withdrawalQueue']['getDelayedCount'](),this[_0x4295fe(0x299)][_0x4295fe(0x9d)](),this['withdrawalQueue']['getCompletedCount'](),this['withdrawalQueue']['getFailedCount'](),this['getAvailableDevices'](),this[_0x4295fe(0x1f8)][_0x4295fe(0x2ae)]()]);return{'serviceStatus':_0x202167,'activeDevices':_0x41b2e9['length'],'processingJobs':this['processingJobs']['size'],'isInitialized':this['isInitialized'],'queue':{'waiting':_0x3dc3eb,'delayed':_0x14a173,'active':_0x30a404,'completed':_0x391982,'failed':_0x1fef67,'total':_0x3dc3eb+_0x14a173+_0x30a404}};}async['debugQueue'](){const _0x510363=_0x163a10,_0x4fc2d8=await this['getQueueStats'](),[_0x2793da,_0x269430]=await Promise['all']([this[_0x510363(0x299)]['getJobs'](['waiting'],0x0,0x9),this['withdrawalQueue']['getJobs'](['delayed'],0x0,0x9)]);return{..._0x4fc2d8,'sampleWaitingJobs':_0x2793da[_0x510363(0x146)](_0x23a816=>({'id':_0x23a816['id'],'data':_0x23a816['data'],'opts':_0x23a816['opts'],'manualRetryCount':_0x23a816['data']['manualRetryCount']})),'sampleDelayedJobs':_0x269430[_0x510363(0x146)](_0x430619=>({'id':_0x430619['id'],'data':_0x430619[_0x510363(0x2a7)],'opts':_0x430619['opts'],'manualRetryCount':_0x430619['data'][_0x510363(0x280)]}))};}async['periodicJobPicking'](){await this['pickAndProcessJobs']();}async['promoteDelayedJobsPeriodically'](){await this['promoteDelayedJobs']();}};_0x193a62[_0x163a10(0x225)]=_0x42530c,_0xd52581([(0x0,_0x1a467a['Cron'])('*/5\x20*\x20*\x20*\x20*\x20*'),_0x1e4490(_0x163a10(0x268),Function),_0x1e4490('design:paramtypes',[]),_0x1e4490('design:returntype',Promise)],_0x42530c['prototype'],'periodicJobPicking',null),_0xd52581([(0x0,_0x1a467a['Cron'])('*/5\x20*\x20*\x20*\x20*\x20*'),_0x1e4490('design:type',Function),_0x1e4490(_0x163a10(0x109),[]),_0x1e4490(_0x163a10(0xa2),Promise)],_0x42530c['prototype'],_0x163a10(0x250),null),_0x193a62['WithdrawalJobManagerService']=_0x42530c=_0xd52581([(0x0,_0x379304['Injectable'])(),_0x25b88a(0x0,(0x0,_0x2e143c['InjectQueue'])('wda-request')),_0x25b88a(0x4,(0x0,_0x379304[_0x163a10(0x22d)])(_0x34dc66['WEBSOCKET_SERVICE'])),_0x1e4490('design:paramtypes',['function'==typeof(_0x20311d=void 0x0!==_0x3a13d2[_0x163a10(0x140)]&&_0x3a13d2['Queue'])?_0x20311d:Object,'function'==typeof(_0xc80a35=void 0x0!==_0x13464a[_0x163a10(0x117)]&&_0x13464a['WithdrawalService'])?_0xc80a35:Object,'function'==typeof(_0x4f3e22=void 0x0!==_0x453b9e['DeviceService']&&_0x453b9e['DeviceService'])?_0x4f3e22:Object,_0x163a10(0x10a)==typeof(_0x451d52=void 0x0!==_0x2bb577[_0x163a10(0xad)]&&_0x2bb577['DeviceLockService'])?_0x451d52:Object,_0x163a10(0x10a)==typeof(_0x223e3b=void 0x0!==_0x4d6b91['IWebSocketService']&&_0x4d6b91['IWebSocketService'])?_0x223e3b:Object,'function'==typeof(_0x175d96=void 0x0!==_0x50c6a6['BankService']&&_0x50c6a6['BankService'])?_0x175d96:Object])],_0x42530c);},_0x5aa050=>{_0x5aa050['exports']=require('bull');},_0x17e90d=>{_0x17e90d['exports']=require('lodash');},(_0x5f53f0,_0x149131,_0x2eca3d)=>{const _0x588f26=a0_0x14ea;Object[_0x588f26(0x176)](_0x149131,'__esModule',{'value':!0x0}),_0x149131[_0x588f26(0x1fa)]=void 0x0;const _0x4b288b=_0x2eca3d(0x17),_0x4efb7b=_0x2eca3d(0xf),_0x3e9bbf=new _0x4b288b['default']({'host':_0x4efb7b['config']['redis'][_0x588f26(0xc1)],'port':_0x4efb7b[_0x588f26(0x14f)]['redis']['port'],'password':_0x4efb7b[_0x588f26(0x14f)]['redis'][_0x588f26(0x276)],'db':_0x4efb7b['config']['redis']['db']});_0x149131['withCronLock']=async(_0x19b2b5,_0x576d39,_0x42271b)=>{const _0x4761f4=_0x588f26,_0x7a2a75=process[_0x4761f4(0x16c)]+':'+Date['now']();if(await _0x3e9bbf['set'](_0x19b2b5,_0x7a2a75,'PX',_0x576d39,'NX'))try{await _0x42271b();}finally{const _0x3351a6='\x0a\x20\x20\x20\x20\x20\x20if\x20redis.call(\x22GET\x22,\x20KEYS[1])\x20==\x20ARGV[1]\x20then\x0a\x20\x20\x20\x20\x20\x20\x20\x20return\x20redis.call(\x22DEL\x22,\x20KEYS[1])\x0a\x20\x20\x20\x20\x20\x20end\x0a\x20\x20\x20\x20\x20\x20return\x200\x0a\x20\x20\x20\x20';await _0x3e9bbf['eval'](_0x3351a6,0x1,_0x19b2b5,_0x7a2a75);}};},function(_0x3320d9,_0x5187bd,_0x595dbd){const _0x1667e3=a0_0x14ea;var _0x1dd2af,_0x33b0d1=this&&this['__decorate']||function(_0x3cc5d7,_0x219cc,_0x4e2538,_0x55f7ad){const _0x157bd7=a0_0x14ea;var _0x15207c,_0x2ecdd4=arguments['length'],_0x39d397=_0x2ecdd4<0x3?_0x219cc:null===_0x55f7ad?_0x55f7ad=Object['getOwnPropertyDescriptor'](_0x219cc,_0x4e2538):_0x55f7ad;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x39d397=Reflect['decorate'](_0x3cc5d7,_0x219cc,_0x4e2538,_0x55f7ad);else{for(var _0x5ba0fc=_0x3cc5d7['length']-0x1;_0x5ba0fc>=0x0;_0x5ba0fc--)(_0x15207c=_0x3cc5d7[_0x5ba0fc])&&(_0x39d397=(_0x2ecdd4<0x3?_0x15207c(_0x39d397):_0x2ecdd4>0x3?_0x15207c(_0x219cc,_0x4e2538,_0x39d397):_0x15207c(_0x219cc,_0x4e2538))||_0x39d397);}return _0x2ecdd4>0x3&&_0x39d397&&Object[_0x157bd7(0x176)](_0x219cc,_0x4e2538,_0x39d397),_0x39d397;},_0x7f69ad=this&&this['__metadata']||function(_0x5a9186,_0x2c5bf6){const _0x416478=a0_0x14ea;if(_0x416478(0x217)==typeof Reflect&&_0x416478(0x10a)==typeof Reflect['metadata'])return Reflect['metadata'](_0x5a9186,_0x2c5bf6);};Object['defineProperty'](_0x5187bd,'__esModule',{'value':!0x0}),_0x5187bd['WithdrawalController']=void 0x0;const _0x5a9914=_0x595dbd(0x2),_0x4d13c3=_0x595dbd(0x3),_0x913b6f=_0x595dbd(0x2d);let _0x3af09a=class{constructor(_0x8f5252){this['jobManagerService']=_0x8f5252,this['logger']=new _0x5a9914['Logger']('WithdrawalController');}async['getQueueStats'](){return await this['jobManagerService']['getQueueStats']();}async['debugQueue'](){return await this['jobManagerService']['debugQueue']();}async['triggerJobPicking'](){const _0x5cbc16=a0_0x14ea;return this['logger']['log'](_0x5cbc16(0x143)),await this['jobManagerService']['triggerPickJobs'](0x1),{'success':!0x0,'message':'Job\x20picking\x20triggered','stats':await this['jobManagerService']['getQueueStats']()};}async['startProcessing'](){const _0xb201f8=a0_0x14ea;return this[_0xb201f8(0x27d)]['log'](_0xb201f8(0x278)),await this['jobManagerService'][_0xb201f8(0x1b7)](),{'success':!0x0,'message':'Job\x20processing\x20started','stats':await this['jobManagerService']['getQueueStats']()};}};_0x5187bd['WithdrawalController']=_0x3af09a,_0x33b0d1([(0x0,_0x5a9914['Get'])(_0x1667e3(0x1d6)),(0x0,_0x4d13c3[_0x1667e3(0x120)])({'summary':_0x1667e3(0x1bd)}),(0x0,_0x4d13c3['ApiResponse'])({'status':0xc8,'description':_0x1667e3(0x27a)}),_0x7f69ad(_0x1667e3(0x268),Function),_0x7f69ad('design:paramtypes',[]),_0x7f69ad('design:returntype',Promise)],_0x3af09a['prototype'],'getQueueStats',null),_0x33b0d1([(0x0,_0x5a9914[_0x1667e3(0x25e)])(_0x1667e3(0x9a)),(0x0,_0x4d13c3['ApiOperation'])({'summary':'Get\x20detailed\x20queue\x20debug\x20information'}),(0x0,_0x4d13c3['ApiResponse'])({'status':0xc8,'description':'Detailed\x20queue\x20debug\x20info'}),_0x7f69ad(_0x1667e3(0x268),Function),_0x7f69ad('design:paramtypes',[]),_0x7f69ad('design:returntype',Promise)],_0x3af09a[_0x1667e3(0x97)],'debugQueue',null),_0x33b0d1([(0x0,_0x5a9914['Post'])('queue/trigger'),(0x0,_0x4d13c3['ApiOperation'])({'summary':_0x1667e3(0x22a)}),(0x0,_0x4d13c3['ApiResponse'])({'status':0xc8,'description':_0x1667e3(0x29d)}),_0x7f69ad('design:type',Function),_0x7f69ad(_0x1667e3(0x109),[]),_0x7f69ad(_0x1667e3(0xa2),Promise)],_0x3af09a[_0x1667e3(0x97)],'triggerJobPicking',null),_0x33b0d1([(0x0,_0x5a9914['Post'])(_0x1667e3(0x223)),(0x0,_0x4d13c3['ApiOperation'])({'summary':'Manually\x20start\x20job\x20processing'}),(0x0,_0x4d13c3['ApiResponse'])({'status':0xc8,'description':'Job\x20processing\x20started'}),_0x7f69ad('design:type',Function),_0x7f69ad('design:paramtypes',[]),_0x7f69ad('design:returntype',Promise)],_0x3af09a['prototype'],'startProcessing',null),_0x5187bd['WithdrawalController']=_0x3af09a=_0x33b0d1([(0x0,_0x4d13c3[_0x1667e3(0x169)])(_0x1667e3(0x1a7)),(0x0,_0x5a9914['Controller'])('api/withdrawal'),_0x7f69ad('design:paramtypes',[_0x1667e3(0x10a)==typeof(_0x1dd2af=void 0x0!==_0x913b6f[_0x1667e3(0x225)]&&_0x913b6f['WithdrawalJobManagerService'])?_0x1dd2af:Object])],_0x3af09a);},function(_0x2fb26e,_0x200b92,_0x33f334){const _0x552eaf=a0_0x14ea;var _0x1d1a01=this&&this[_0x552eaf(0x13c)]||function(_0x2e534a,_0x49ba3b,_0xcfe7ba,_0x3fd468){var _0x198c2f,_0x7bc2d7=arguments['length'],_0x5a3c81=_0x7bc2d7<0x3?_0x49ba3b:null===_0x3fd468?_0x3fd468=Object['getOwnPropertyDescriptor'](_0x49ba3b,_0xcfe7ba):_0x3fd468;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x5a3c81=Reflect['decorate'](_0x2e534a,_0x49ba3b,_0xcfe7ba,_0x3fd468);else{for(var _0x3438fc=_0x2e534a['length']-0x1;_0x3438fc>=0x0;_0x3438fc--)(_0x198c2f=_0x2e534a[_0x3438fc])&&(_0x5a3c81=(_0x7bc2d7<0x3?_0x198c2f(_0x5a3c81):_0x7bc2d7>0x3?_0x198c2f(_0x49ba3b,_0xcfe7ba,_0x5a3c81):_0x198c2f(_0x49ba3b,_0xcfe7ba))||_0x5a3c81);}return _0x7bc2d7>0x3&&_0x5a3c81&&Object['defineProperty'](_0x49ba3b,_0xcfe7ba,_0x5a3c81),_0x5a3c81;};Object['defineProperty'](_0x200b92,'__esModule',{'value':!0x0}),_0x200b92[_0x552eaf(0x1c1)]=void 0x0;const _0x2687d3=_0x33f334(0x2),_0x57373e=_0x33f334(0x18);let _0x4fa04c=class{};_0x200b92[_0x552eaf(0x1c1)]=_0x4fa04c,_0x200b92['HcBoxModule']=_0x4fa04c=_0x1d1a01([(0x0,_0x2687d3['Module'])({'providers':[_0x57373e[_0x552eaf(0x1c4)]],'exports':[_0x57373e['HcBoxService']]})],_0x4fa04c);},function(_0x2261c3,_0x476b80,_0x505077){const _0x4cf8a3=a0_0x14ea;var _0x5660cd=this&&this['__decorate']||function(_0x1d5ed2,_0x1afa3f,_0x18a96b,_0x351e61){const _0x412de9=a0_0x14ea;var _0x38c0bc,_0x3b8386=arguments[_0x412de9(0x132)],_0x3b2232=_0x3b8386<0x3?_0x1afa3f:null===_0x351e61?_0x351e61=Object['getOwnPropertyDescriptor'](_0x1afa3f,_0x18a96b):_0x351e61;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x3b2232=Reflect['decorate'](_0x1d5ed2,_0x1afa3f,_0x18a96b,_0x351e61);else{for(var _0x3c37c3=_0x1d5ed2['length']-0x1;_0x3c37c3>=0x0;_0x3c37c3--)(_0x38c0bc=_0x1d5ed2[_0x3c37c3])&&(_0x3b2232=(_0x3b8386<0x3?_0x38c0bc(_0x3b2232):_0x3b8386>0x3?_0x38c0bc(_0x1afa3f,_0x18a96b,_0x3b2232):_0x38c0bc(_0x1afa3f,_0x18a96b))||_0x3b2232);}return _0x3b8386>0x3&&_0x3b2232&&Object['defineProperty'](_0x1afa3f,_0x18a96b,_0x3b2232),_0x3b2232;};Object['defineProperty'](_0x476b80,'__esModule',{'value':!0x0}),_0x476b80[_0x4cf8a3(0x1ed)]=void 0x0;const _0x4c0c52=_0x505077(0x2),_0x3697ad=_0x505077(0x34),_0x57aac3=_0x505077(0x15),_0x163a95=_0x505077(0x2b),_0x18131a=_0x505077(0x32),_0x25af2d=_0x505077(0x16),_0x5d3633=_0x505077(0x37);let _0x11e14e=class{};_0x476b80['DeviceModule']=_0x11e14e,_0x476b80['DeviceModule']=_0x11e14e=_0x5660cd([(0x0,_0x4c0c52[_0x4cf8a3(0x27f)])({'imports':[_0x18131a['HcBoxModule'],(0x0,_0x4c0c52['forwardRef'])(()=>_0x5d3633['BankModule'])],'controllers':[_0x3697ad['DeviceController']],'providers':[_0x57aac3['DeviceService'],_0x163a95['DeviceLockService'],_0x25af2d[_0x4cf8a3(0x27c)]],'exports':[_0x57aac3[_0x4cf8a3(0x100)],_0x163a95['DeviceLockService']]})],_0x11e14e);},function(_0x23aa07,_0x33967b,_0x161552){const _0x4cea49=a0_0x14ea;var _0x2c8398,_0x529168,_0x2795b0,_0x220aac=this&&this[_0x4cea49(0x13c)]||function(_0x411e34,_0x101865,_0xdd01a3,_0x2ac65e){const _0x4de735=_0x4cea49;var _0x1fd00b,_0x4ac5b6=arguments['length'],_0x56f029=_0x4ac5b6<0x3?_0x101865:null===_0x2ac65e?_0x2ac65e=Object[_0x4de735(0xfb)](_0x101865,_0xdd01a3):_0x2ac65e;if('object'==typeof Reflect&&_0x4de735(0x10a)==typeof Reflect['decorate'])_0x56f029=Reflect['decorate'](_0x411e34,_0x101865,_0xdd01a3,_0x2ac65e);else{for(var _0x120f29=_0x411e34['length']-0x1;_0x120f29>=0x0;_0x120f29--)(_0x1fd00b=_0x411e34[_0x120f29])&&(_0x56f029=(_0x4ac5b6<0x3?_0x1fd00b(_0x56f029):_0x4ac5b6>0x3?_0x1fd00b(_0x101865,_0xdd01a3,_0x56f029):_0x1fd00b(_0x101865,_0xdd01a3))||_0x56f029);}return _0x4ac5b6>0x3&&_0x56f029&&Object[_0x4de735(0x176)](_0x101865,_0xdd01a3,_0x56f029),_0x56f029;},_0x8211ec=this&&this['__metadata']||function(_0x5af5cb,_0x431037){const _0xd1e7b8=_0x4cea49;if(_0xd1e7b8(0x217)==typeof Reflect&&_0xd1e7b8(0x10a)==typeof Reflect['metadata'])return Reflect[_0xd1e7b8(0x21e)](_0x5af5cb,_0x431037);},_0x5cd741=this&&this['__param']||function(_0x2cf770,_0x33729e){return function(_0x56b405,_0x74d426){_0x33729e(_0x56b405,_0x74d426,_0x2cf770);};};Object['defineProperty'](_0x33967b,'__esModule',{'value':!0x0}),_0x33967b['DeviceController']=void 0x0;const _0x506077=_0x161552(0x2),_0x9faf61=_0x161552(0x15),_0x2cb14e=_0x161552(0x35),_0xeb1b44=_0x161552(0x12),_0x45a927=_0x161552(0xf);let _0x48308f=class{constructor(_0x469f34,_0x4c560a){const _0x560156=_0x4cea49;this['deviceService']=_0x469f34,this['bankService']=_0x4c560a,this['logger']=new _0x506077[(_0x560156(0x108))](_0x560156(0x1e8));}async['getDevicesPage'](){const _0x54ad0d=_0x4cea49;return{'devices':await this[_0x54ad0d(0x1f8)]['listDevices'](),'serviceStatus':await this[_0x54ad0d(0x1f8)]['getServiceStatus'](),'banks':['VIETCOMBANK',_0x54ad0d(0x2b4),'TECHCOMBANK',_0x54ad0d(0x14a),'PGBANK'],'boxType':_0x45a927['config']['boxType']};}async[_0x4cea49(0x29e)](){const _0x42d6aa=_0x4cea49;return{'success':!0x0,'data':await this[_0x42d6aa(0x1f8)]['listDevices']()};}async['getDeviceConfig'](_0x29963b){const _0x5c1d68=_0x4cea49;return{'success':!0x0,'data':await this['deviceService'][_0x5c1d68(0x275)](_0x29963b)};}async['retryLogin'](_0x3637b9){const _0x399483=_0x4cea49;try{this[_0x399483(0x27d)]['log']('Retry\x20login\x20requested\x20for\x20device\x20'+_0x3637b9);const _0x4959a0=await this['deviceService']['getDeviceConfig'](_0x3637b9);if(!_0x4959a0)throw new _0x506077[(_0x399483(0x23f))]({'success':!0x1,'error':_0x399483(0x1ec)+_0x3637b9+'\x20not\x20found\x20or\x20not\x20configured'},_0x506077['HttpStatus'][_0x399483(0x26b)]);if(!_0x4959a0[_0x399483(0x200)]||''===_0x4959a0['bankCode']['trim']())throw new _0x506077[(_0x399483(0x23f))]({'success':!0x1,'error':'Device\x20'+_0x3637b9+'\x20does\x20not\x20have\x20bankCode\x20configured.\x20Please\x20configure\x20bankCode\x20first.'},_0x506077[_0x399483(0x9e)][_0x399483(0x26b)]);if('active'!==_0x4959a0['status'])throw new _0x506077[(_0x399483(0x23f))]({'success':!0x1,'error':'Device\x20'+_0x3637b9+_0x399483(0x2c5)},_0x506077[_0x399483(0x9e)]['BAD_REQUEST']);const _0x523d3d=_0x4959a0['bankCode']['toUpperCase']();return await this['bankService'][_0x399483(0xb8)](_0x523d3d,_0x3637b9),{'success':!0x0,'message':'Successfully\x20logged\x20in\x20to\x20'+_0x523d3d+'\x20on\x20device\x20'+_0x3637b9};}catch(_0x26feeb){if(_0x26feeb instanceof _0x506077[_0x399483(0x23f)])throw _0x26feeb;throw this['logger']['error']('Error\x20retrying\x20login\x20for\x20device\x20'+_0x3637b9+':\x20'+_0x26feeb[_0x399483(0x1dc)],_0x26feeb['stack']),new _0x506077['HttpException']({'success':!0x1,'error':_0x26feeb['message']||'Failed\x20to\x20retry\x20login'},_0x506077['HttpStatus']['INTERNAL_SERVER_ERROR']);}}async['updateDeviceConfig'](_0x4606e6,_0x18b77a){const _0x55b157=_0x4cea49;try{this[_0x55b157(0x27d)]['log']('Updating\x20device\x20config\x20for\x20'+_0x4606e6+':\x20'+JSON['stringify'](_0x18b77a));const _0x3a0d28=await this['deviceService']['getDeviceConfig'](_0x4606e6);if('active'===(void 0x0!==_0x18b77a['status']?_0x18b77a['status']:_0x3a0d28?.[_0x55b157(0x158)]||'deactive')){const _0x3f654f=[],_0x4ae3ac=void 0x0!==_0x18b77a[_0x55b157(0x200)]?_0x18b77a[_0x55b157(0x200)]:_0x3a0d28?.['bankCode'];_0x4ae3ac&&''!==_0x4ae3ac['trim']()||_0x3f654f['push']('Bank\x20Code\x20l\x20bt\x20buc\x20khi\x20status\x20l\x20active');const _0x208d7d=void 0x0!==_0x18b77a['availableAmount']?_0x18b77a[_0x55b157(0x1ef)]:_0x3a0d28?.['availableAmount'];(null==_0x208d7d||_0x208d7d<0x0)&&_0x3f654f[_0x55b157(0x18f)]('Available\x20Amount\x20l\x20bt\x20buc\x20v\x20phi\x20>=\x200\x20khi\x20status\x20l\x20active');const _0x148842=void 0x0!==_0x18b77a['password']?_0x18b77a[_0x55b157(0x276)]:_0x3a0d28?.['password'];_0x148842&&''!==_0x148842['trim']()||_0x3f654f['push']('Password\x20l\x20bt\x20buc\x20khi\x20status\x20l\x20active');const _0x18afe4=void 0x0!==_0x18b77a['smartOTP']?_0x18b77a['smartOTP']:_0x3a0d28?.['smartOTP'];if(_0x18afe4&&''!==_0x18afe4[_0x55b157(0x2c2)]()||_0x3f654f[_0x55b157(0x18f)]('Smart\x20OTP\x20l\x20bt\x20buc\x20khi\x20status\x20l\x20active'),_0x3f654f['length']>0x0)throw new _0x506077['HttpException']({'success':!0x1,'error':_0x3f654f['join'](',\x20')},_0x506077['HttpStatus']['BAD_REQUEST']);}return{'success':!0x0,'data':await this[_0x55b157(0x1f8)]['updateDeviceConfig'](_0x4606e6,_0x18b77a)};}catch(_0x6b659b){if(_0x6b659b instanceof _0x506077['HttpException'])throw _0x6b659b;throw this['logger']['error']('Error\x20updating\x20device\x20config\x20for\x20'+_0x4606e6+':\x20'+_0x6b659b[_0x55b157(0x1dc)],_0x6b659b['stack']),new _0x506077['HttpException']({'success':!0x1,'error':_0x6b659b['message']||_0x55b157(0x229)},_0x506077['HttpStatus']['INTERNAL_SERVER_ERROR']);}}async['getServiceStatus'](){return{'success':!0x0,'data':{'status':await this['deviceService']['getServiceStatus']()}};}async['startService'](){const _0x210ba2=_0x4cea49;try{if(!await this['deviceService']['hasActiveDevice']())throw new _0x506077['HttpException']({'success':!0x1,'error':'Vui\x20lng\x20active\x20bank\x20trc\x20khi\x20start'},_0x506077['HttpStatus']['BAD_REQUEST']);return this['bankService']['loginAllActiveBanks']()['catch'](_0x1ac42e=>{this['logger']['error']('Error\x20during\x20background\x20login\x20process:\x20'+_0x1ac42e['message']);}),await new Promise(_0x56d669=>setTimeout(_0x56d669,0x7d0)),await this[_0x210ba2(0x1f8)]['setServiceStatus']('active'),{'success':!0x0,'message':'Service\x20started\x20successfully.\x20Devices\x20are\x20logging\x20in\x20and\x20will\x20accept\x20jobs\x20when\x20ready.'};}catch(_0x8f61ed){if(_0x8f61ed instanceof _0x506077['HttpException'])throw _0x8f61ed;throw this['logger']['error'](_0x210ba2(0x178)+_0x8f61ed['message'],_0x8f61ed['stack']),new _0x506077['HttpException']({'success':!0x1,'error':_0x8f61ed['message']||'Failed\x20to\x20start\x20service'},_0x506077['HttpStatus']['INTERNAL_SERVER_ERROR']);}}async[_0x4cea49(0x9f)](){const _0x35cb09=_0x4cea49;return await this['deviceService'][_0x35cb09(0x255)](_0x35cb09(0x282)),{'success':!0x0,'message':'Service\x20stopped\x20successfully'};}};_0x33967b['DeviceController']=_0x48308f,_0x220aac([(0x0,_0x506077['Get'])(),(0x0,_0x506077[_0x4cea49(0x16a)])('devices'),_0x8211ec('design:type',Function),_0x8211ec('design:paramtypes',[]),_0x8211ec(_0x4cea49(0xa2),Promise)],_0x48308f['prototype'],_0x4cea49(0x180),null),_0x220aac([(0x0,_0x506077['Get'])('api/devices'),_0x8211ec('design:type',Function),_0x8211ec('design:paramtypes',[]),_0x8211ec('design:returntype',Promise)],_0x48308f[_0x4cea49(0x97)],_0x4cea49(0x29e),null),_0x220aac([(0x0,_0x506077['Get'])('api/devices/:deviceId/config'),_0x5cd741(0x0,(0x0,_0x506077[_0x4cea49(0x1c0)])('deviceId')),_0x8211ec('design:type',Function),_0x8211ec('design:paramtypes',[String]),_0x8211ec(_0x4cea49(0xa2),Promise)],_0x48308f['prototype'],_0x4cea49(0x275),null),_0x220aac([(0x0,_0x506077['Post'])('api/devices/:deviceId/retryLogin'),_0x5cd741(0x0,(0x0,_0x506077['Param'])(_0x4cea49(0x16f))),_0x8211ec('design:type',Function),_0x8211ec('design:paramtypes',[String]),_0x8211ec('design:returntype',Promise)],_0x48308f['prototype'],'retryLogin',null),_0x220aac([(0x0,_0x506077['Put'])(_0x4cea49(0x2a0)),_0x5cd741(0x0,(0x0,_0x506077[_0x4cea49(0x1c0)])(_0x4cea49(0x16f))),_0x5cd741(0x1,(0x0,_0x506077['Body'])()),_0x8211ec('design:type',Function),_0x8211ec('design:paramtypes',[String,_0x4cea49(0x10a)==typeof(_0x2795b0=void 0x0!==_0x2cb14e['UpdateDeviceConfigDto']&&_0x2cb14e['UpdateDeviceConfigDto'])?_0x2795b0:Object]),_0x8211ec(_0x4cea49(0xa2),Promise)],_0x48308f[_0x4cea49(0x97)],_0x4cea49(0xdb),null),_0x220aac([(0x0,_0x506077['Get'])('api/service/status'),_0x8211ec('design:type',Function),_0x8211ec('design:paramtypes',[]),_0x8211ec('design:returntype',Promise)],_0x48308f['prototype'],'getServiceStatus',null),_0x220aac([(0x0,_0x506077['Post'])('api/service/start'),_0x8211ec('design:type',Function),_0x8211ec(_0x4cea49(0x109),[]),_0x8211ec('design:returntype',Promise)],_0x48308f['prototype'],'startService',null),_0x220aac([(0x0,_0x506077['Post'])('api/service/stop'),_0x8211ec('design:type',Function),_0x8211ec(_0x4cea49(0x109),[]),_0x8211ec('design:returntype',Promise)],_0x48308f['prototype'],_0x4cea49(0x9f),null),_0x33967b['DeviceController']=_0x48308f=_0x220aac([(0x0,_0x506077['Controller'])(),_0x8211ec(_0x4cea49(0x109),['function'==typeof(_0x2c8398=void 0x0!==_0x9faf61[_0x4cea49(0x100)]&&_0x9faf61['DeviceService'])?_0x2c8398:Object,_0x4cea49(0x10a)==typeof(_0x529168=void 0x0!==_0xeb1b44['BankService']&&_0xeb1b44['BankService'])?_0x529168:Object])],_0x48308f);},function(_0x7e9e77,_0x16dd27,_0x4ea390){const _0x160f57=a0_0x14ea;var _0x24d708=this&&this['__decorate']||function(_0x5ea23d,_0x869624,_0x34d99b,_0x87b64){const _0x8eabc1=a0_0x14ea;var _0x113f16,_0x515880=arguments[_0x8eabc1(0x132)],_0x2d04ea=_0x515880<0x3?_0x869624:null===_0x87b64?_0x87b64=Object[_0x8eabc1(0xfb)](_0x869624,_0x34d99b):_0x87b64;if(_0x8eabc1(0x217)==typeof Reflect&&_0x8eabc1(0x10a)==typeof Reflect['decorate'])_0x2d04ea=Reflect['decorate'](_0x5ea23d,_0x869624,_0x34d99b,_0x87b64);else{for(var _0x568637=_0x5ea23d['length']-0x1;_0x568637>=0x0;_0x568637--)(_0x113f16=_0x5ea23d[_0x568637])&&(_0x2d04ea=(_0x515880<0x3?_0x113f16(_0x2d04ea):_0x515880>0x3?_0x113f16(_0x869624,_0x34d99b,_0x2d04ea):_0x113f16(_0x869624,_0x34d99b))||_0x2d04ea);}return _0x515880>0x3&&_0x2d04ea&&Object['defineProperty'](_0x869624,_0x34d99b,_0x2d04ea),_0x2d04ea;},_0xf904cb=this&&this['__metadata']||function(_0x46b173,_0x3456f2){const _0x394b69=a0_0x14ea;if(_0x394b69(0x217)==typeof Reflect&&'function'==typeof Reflect[_0x394b69(0x21e)])return Reflect[_0x394b69(0x21e)](_0x46b173,_0x3456f2);};Object[_0x160f57(0x176)](_0x16dd27,_0x160f57(0x22f),{'value':!0x0}),_0x16dd27['UpdateDeviceConfigDto']=void 0x0;const _0x5e2001=_0x4ea390(0x36);class _0xe7f39a{}_0x16dd27['UpdateDeviceConfigDto']=_0xe7f39a,_0x24d708([(0x0,_0x5e2001['ValidateIf'])(_0x4822c5=>_0x160f57(0xff)===_0x4822c5[_0x160f57(0x158)]),(0x0,_0x5e2001[_0x160f57(0x25b)])({'message':'Bank\x20Code\x20is\x20required\x20when\x20status\x20is\x20active'}),(0x0,_0x5e2001['IsString'])(),(0x0,_0x5e2001['IsOptional'])(),_0xf904cb('design:type',String)],_0xe7f39a['prototype'],'bankCode',void 0x0),_0x24d708([(0x0,_0x5e2001['ValidateIf'])(_0x1a023f=>'active'===_0x1a023f['status']),(0x0,_0x5e2001['IsNotEmpty'])({'message':_0x160f57(0x1fe)}),(0x0,_0x5e2001['IsNumber'])(),(0x0,_0x5e2001['Min'])(0x0,{'message':_0x160f57(0x22b)}),(0x0,_0x5e2001['IsOptional'])(),_0xf904cb(_0x160f57(0x268),Number)],_0xe7f39a[_0x160f57(0x97)],'availableAmount',void 0x0),_0x24d708([(0x0,_0x5e2001['IsOptional'])(),(0x0,_0x5e2001['IsString'])(),(0x0,_0x5e2001['IsIn'])([_0x160f57(0xff),'deactive']),_0xf904cb(_0x160f57(0x268),String)],_0xe7f39a['prototype'],_0x160f57(0x158),void 0x0),_0x24d708([(0x0,_0x5e2001[_0x160f57(0x94)])(_0x21d2ed=>'active'===_0x21d2ed['status']),(0x0,_0x5e2001[_0x160f57(0x25b)])({'message':'Password\x20is\x20required\x20when\x20status\x20is\x20active'}),(0x0,_0x5e2001[_0x160f57(0x154)])(),(0x0,_0x5e2001['IsOptional'])(),_0xf904cb('design:type',String)],_0xe7f39a['prototype'],_0x160f57(0x276),void 0x0),_0x24d708([(0x0,_0x5e2001[_0x160f57(0x94)])(_0x352191=>_0x160f57(0xff)===_0x352191['status']),(0x0,_0x5e2001[_0x160f57(0x25b)])({'message':_0x160f57(0xd0)}),(0x0,_0x5e2001[_0x160f57(0x154)])(),(0x0,_0x5e2001['IsOptional'])(),_0xf904cb(_0x160f57(0x268),String)],_0xe7f39a['prototype'],'smartOTP',void 0x0),_0x24d708([(0x0,_0x5e2001['ValidateIf'])(_0x1fc5e2=>'active'===_0x1fc5e2['status']),(0x0,_0x5e2001['IsNotEmpty'])({'message':'Account\x20No\x20is\x20required\x20when\x20status\x20is\x20active'}),(0x0,_0x5e2001['IsString'])(),(0x0,_0x5e2001['IsOptional'])(),_0xf904cb(_0x160f57(0x268),String)],_0xe7f39a['prototype'],'accountNo',void 0x0),_0x24d708([(0x0,_0x5e2001['ValidateIf'])(_0x9054f2=>'active'===_0x9054f2['status']),(0x0,_0x5e2001['IsNotEmpty'])({'message':'Account\x20Name\x20is\x20required\x20when\x20status\x20is\x20active'}),(0x0,_0x5e2001['IsString'])(),(0x0,_0x5e2001['IsOptional'])(),_0xf904cb('design:type',String)],_0xe7f39a['prototype'],'accountName',void 0x0);},_0x2d5939=>{const _0x37c8a3=a0_0x14ea;_0x2d5939[_0x37c8a3(0x1f0)]=require('class-validator');},function(_0x1ab45c,_0x32ff97,_0x34b240){const _0x20f09d=a0_0x14ea;var _0x891e72=this&&this['__decorate']||function(_0x509345,_0x1f5062,_0x8bd7bf,_0x28f984){const _0x460253=a0_0x14ea;var _0xc33ca0,_0x41ecb1=arguments['length'],_0x30c83e=_0x41ecb1<0x3?_0x1f5062:null===_0x28f984?_0x28f984=Object['getOwnPropertyDescriptor'](_0x1f5062,_0x8bd7bf):_0x28f984;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x460253(0xcf)])_0x30c83e=Reflect[_0x460253(0xcf)](_0x509345,_0x1f5062,_0x8bd7bf,_0x28f984);else{for(var _0x25fbe1=_0x509345['length']-0x1;_0x25fbe1>=0x0;_0x25fbe1--)(_0xc33ca0=_0x509345[_0x25fbe1])&&(_0x30c83e=(_0x41ecb1<0x3?_0xc33ca0(_0x30c83e):_0x41ecb1>0x3?_0xc33ca0(_0x1f5062,_0x8bd7bf,_0x30c83e):_0xc33ca0(_0x1f5062,_0x8bd7bf))||_0x30c83e);}return _0x41ecb1>0x3&&_0x30c83e&&Object[_0x460253(0x176)](_0x1f5062,_0x8bd7bf,_0x30c83e),_0x30c83e;};Object['defineProperty'](_0x32ff97,'__esModule',{'value':!0x0}),_0x32ff97['BankModule']=void 0x0;const _0x5a4f14=_0x34b240(0x2),_0x4cca63=_0x34b240(0x12),_0x3e1988=_0x34b240(0x13),_0x293d3e=_0x34b240(0x26),_0x1d57a5=_0x34b240(0x38),_0x1fc27e=_0x34b240(0x32),_0xf8c581=_0x34b240(0x33),_0x26876a=_0x34b240(0x39),_0x359b6e=_0x34b240(0x2a),_0x56f305=_0x34b240(0x3d),_0x3f263b=_0x34b240(0x16),_0x3ac017=_0x34b240(0x3e);let _0x4dcaaf=class{};_0x32ff97['BankModule']=_0x4dcaaf,_0x32ff97['BankModule']=_0x4dcaaf=_0x891e72([(0x0,_0x5a4f14['Module'])({'imports':[_0x1fc27e['HcBoxModule'],(0x0,_0x5a4f14[_0x20f09d(0x12a)])(()=>_0xf8c581['DeviceModule']),_0x26876a['WebSocketModule'],_0x3ac017[_0x20f09d(0x29a)]],'controllers':[_0x1d57a5['BankController']],'providers':[_0x4cca63[_0x20f09d(0x26f)],_0x3e1988[_0x20f09d(0xda)],_0x293d3e['PgService'],_0x359b6e['SessionManagementService'],_0x56f305['SessionRefreshScheduler'],_0x3f263b['RedisService']],'exports':[_0x4cca63['BankService']]})],_0x4dcaaf);},function(_0x182a84,_0x36f888,_0x96b3ba){const _0x4bb23e=a0_0x14ea;var _0x2d20d7,_0x2363a9,_0x3fd536,_0x10d5d5=this&&this['__decorate']||function(_0x56a89c,_0x270f03,_0x294bfd,_0x5d344c){const _0x521d47=a0_0x14ea;var _0x3c1100,_0x44f914=arguments['length'],_0x134954=_0x44f914<0x3?_0x270f03:null===_0x5d344c?_0x5d344c=Object['getOwnPropertyDescriptor'](_0x270f03,_0x294bfd):_0x5d344c;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x521d47(0xcf)])_0x134954=Reflect['decorate'](_0x56a89c,_0x270f03,_0x294bfd,_0x5d344c);else{for(var _0x1ddbe8=_0x56a89c['length']-0x1;_0x1ddbe8>=0x0;_0x1ddbe8--)(_0x3c1100=_0x56a89c[_0x1ddbe8])&&(_0x134954=(_0x44f914<0x3?_0x3c1100(_0x134954):_0x44f914>0x3?_0x3c1100(_0x270f03,_0x294bfd,_0x134954):_0x3c1100(_0x270f03,_0x294bfd))||_0x134954);}return _0x44f914>0x3&&_0x134954&&Object[_0x521d47(0x176)](_0x270f03,_0x294bfd,_0x134954),_0x134954;},_0x10b784=this&&this['__metadata']||function(_0x4d44cd,_0xd40967){const _0x1f7870=a0_0x14ea;if('object'==typeof Reflect&&_0x1f7870(0x10a)==typeof Reflect['metadata'])return Reflect[_0x1f7870(0x21e)](_0x4d44cd,_0xd40967);},_0x4c8413=this&&this['__param']||function(_0x502ba6,_0x5c7019){return function(_0xc7c7c2,_0x3fd98d){_0x5c7019(_0xc7c7c2,_0x3fd98d,_0x502ba6);};};Object['defineProperty'](_0x36f888,'__esModule',{'value':!0x0}),_0x36f888[_0x4bb23e(0x1f4)]=void 0x0;const _0x19d59d=_0x96b3ba(0x2),_0x3f2817=_0x96b3ba(0x3),_0x5b39e7=_0x96b3ba(0x12),_0x5587df=_0x96b3ba(0x18),_0x3e0a60=_0x96b3ba(0xf),_0x482284=_0x96b3ba(0x19),_0x5cdf4c=_0x96b3ba(0x14);let _0xcc2018=class{constructor(_0x5f500a,_0x190545,_0x353065){const _0xc13d35=_0x4bb23e;this['bankService']=_0x5f500a,this[_0xc13d35(0x16d)]=_0x190545,this['wsService']=_0x353065,this[_0xc13d35(0x27d)]=new _0x19d59d['Logger'](_0xc13d35(0x1f4));}['getBankService'](_0x553489){const _0xb5f9d1=_0x4bb23e,_0xdf5458=this['bankService']['getBankService'](_0x553489);if(!_0xdf5458)throw new _0x19d59d[(_0xb5f9d1(0x23f))]({'success':!0x1,'error':'Bank\x20service\x20not\x20found\x20for\x20bank\x20code:\x20'+_0x553489+'.\x20Supported\x20banks:\x20'+this[_0xb5f9d1(0x1de)]['getSupportedBanks']()['join'](',\x20')},_0x19d59d['HttpStatus']['BAD_REQUEST']);return _0xdf5458;}async['getDevices'](_0x118c91){const _0x5188e1=_0x4bb23e;try{return{'success':!0x0,'data':await this['hcBoxService'][_0x5188e1(0x116)]()};}catch(_0x40ffa0){return this[_0x5188e1(0x27d)][_0x5188e1(0xf2)]('Error\x20getting\x20devices:\x20'+_0x40ffa0['message']),{'success':!0x1,'error':_0x40ffa0['message']};}}async['testLaunchApp'](_0x34dedf,_0x279ff8){const _0x5228e2=_0x4bb23e;try{const _0x4b4d7f=this['getBankService'](_0x34dedf);return this['logger']['log'](_0x5228e2(0xc8)+_0x34dedf+'\x20app\x20launch\x20on\x20device:\x20'+_0x279ff8),await _0x4b4d7f[_0x5228e2(0x27e)](_0x279ff8),{'success':!0x0,'message':_0x34dedf+'\x20app\x20launched\x20successfully\x20on\x20device\x20'+_0x279ff8};}catch(_0x51758d){return this['logger']['error'](_0x5228e2(0x11d)+_0x34dedf+'\x20app\x20launch:\x20'+_0x51758d['message']),{'success':!0x1,'error':_0x51758d['message']};}}async['testCaptureScreen'](_0x461f0d,_0x3712d8,_0x17d85b,_0x5848cf){const _0x3ff49c=_0x4bb23e;try{this['getBankService'](_0x461f0d),this['logger'][_0x3ff49c(0x133)](_0x3ff49c(0x18e)+_0x3712d8);const _0x260175=_0x5848cf?parseFloat(_0x5848cf):0.5,_0x3a000b=_0x17d85b||_0x3ff49c(0xc2)+Date['now'](),_0x4f2c6e=await this[_0x3ff49c(0xb6)]['captureScreen'](_0x3712d8,{'quality':_0x260175,'folderPath':'C:/boxscreen/'+_0x3a000b+'.png'});return{'success':!0x0,'message':'Screen\x20captured\x20successfully\x20on\x20device\x20'+_0x3712d8,'data':{'base64Image':_0x4f2c6e,'imageLength':_0x4f2c6e?.[_0x3ff49c(0x132)]??0x0}};}catch(_0x35fb9c){return this['logger'][_0x3ff49c(0xf2)](_0x3ff49c(0x15c)+_0x35fb9c['message']),{'success':!0x1,'error':_0x35fb9c[_0x3ff49c(0x1dc)]};}}async['testClickAtCoordinates'](_0x81c205,_0x5db454,_0x1f49d4,_0x77e7dc){const _0x24bea5=_0x4bb23e;try{const _0x509251=parseFloat(_0x1f49d4),_0x37bbbc=parseFloat(_0x77e7dc);return isNaN(_0x509251)||isNaN(_0x37bbbc)?{'success':!0x1,'error':'Invalid\x20coordinates.\x20x\x20and\x20y\x20must\x20be\x20numbers\x20between\x200\x20and\x201','example':'/api/bank/'+_0x81c205+'/test/click/{deviceId}?x=0.5&y=0.55'}:(this['logger']['log']('Testing\x20click\x20at\x20coordinates\x20('+_0x509251+',\x20'+_0x37bbbc+_0x24bea5(0x236)+_0x5db454),await this['wsService']['click'](_0x5db454,_0x509251,_0x37bbbc),{'success':!0x0,'message':'Click\x20completed\x20successfully\x20at\x20coordinates\x20('+_0x509251+',\x20'+_0x37bbbc+')\x20on\x20device\x20'+_0x5db454,'coordinates':{'x':_0x509251,'y':_0x37bbbc}});}catch(_0x22dbe4){return this[_0x24bea5(0x27d)]['error'](_0x24bea5(0xf4)+_0x22dbe4['message']),{'success':!0x1,'error':_0x22dbe4['message']};}}async['testSwipe'](_0x5045d3,_0x1f85ed,_0x2cd68c,_0x152912,_0x265a3a,_0x586c7c,_0x344773,_0x19f396){const _0xdf8167=_0x4bb23e;try{this[_0xdf8167(0x23e)](_0x5045d3);const _0x3920fe='PANDA'===_0x3e0a60[_0xdf8167(0x14f)]['boxType'],_0xe4e0ae='HC'===_0x3e0a60[_0xdf8167(0x14f)]['boxType'];if(_0x3920fe){if(!_0x265a3a)return{'success':!0x1,'error':'For\x20Panda\x20format:\x20type\x20is\x20required','example':'/api/bank/'+_0x5045d3+_0xdf8167(0x1f9)};if(!['0','1','2','4','5','6','7','8','9','10'][_0xdf8167(0xf0)](_0x265a3a))return{'success':!0x1,'error':'Invalid\x20type.\x20Type\x20must\x20be\x20one\x20of:\x200\x20(/press),\x201\x20(/lift),\x202\x20(/move),\x204\x20(/scroll\x20up),\x205\x20(/scroll\x20down),\x206\x20(/swipe\x20up),\x207\x20(/swipe\x20down),\x208\x20(/swipe\x20left),\x209\x20(/swipe\x20right),\x2010\x20(/click)','example':'/api/bank/'+_0x5045d3+'/test/swipe/{deviceId}?type=0'};if(!(['4','5','6','7','8','9']['includes'](_0x265a3a)||_0x2cd68c&&_0x152912))return{'success':!0x1,'error':'For\x20Panda\x20type\x20'+_0x265a3a+_0xdf8167(0xd1),'example':_0xdf8167(0x19d)+_0x5045d3+'/test/swipe/{deviceId}?x=50&y=30&type='+_0x265a3a};const _0x2b93e5={'type':_0x265a3a};if(_0x2cd68c&&_0x152912){const _0x57a038=parseFloat(_0x2cd68c),_0x16233d=parseFloat(_0x152912);if(isNaN(_0x57a038)||isNaN(_0x16233d))return{'success':!0x1,'error':_0xdf8167(0x21f),'example':'/api/bank/'+_0x5045d3+'/test/swipe/{deviceId}?x=50&y=30&type='+_0x265a3a};if(_0x57a038<0x0||_0x57a038>0x64||_0x16233d<0x0||_0x16233d>0x64)return{'success':!0x1,'error':'Invalid\x20coordinates.\x20x\x20and\x20y\x20must\x20be\x20between\x200\x20and\x20100\x20for\x20Panda','example':'/api/bank/'+_0x5045d3+'/test/swipe/{deviceId}?x=50&y=30&type='+_0x265a3a};_0x2b93e5['x']=_0x57a038['toString'](),_0x2b93e5['y']=_0x16233d['toString']();}return this['logger']['log']('Testing\x20Panda\x20swipe\x20on\x20device:\x20'+_0x1f85ed+_0xdf8167(0x251)+_0x265a3a+(_0x2cd68c&&_0x152912?_0xdf8167(0x23d)+_0x2cd68c+',\x20y='+_0x152912:'\x20(swipe\x20direction,\x20no\x20coordinates)')),await this[_0xdf8167(0xb6)]['swipe'](_0x1f85ed,_0x2b93e5),{'success':!0x0,'message':_0xdf8167(0x151)+_0x1f85ed,'coordinates':{'type':_0x265a3a,..._0x2cd68c&&_0x152912?{'x':_0x2cd68c,'y':_0x152912}:{}}};}if(_0xe4e0ae){if(!(_0x2cd68c&&_0x152912&&_0x586c7c&&_0x344773))return{'success':!0x1,'error':_0xdf8167(0x139),'example':'/api/bank/'+_0x5045d3+'/test/swipe/{deviceId}?x=0.2&y=0.5&endX=0.8&endY=0.5&duration=0.3'};const _0xfd8c9f=parseFloat(_0x2cd68c),_0x2e1233=parseFloat(_0x152912),_0x33027e=parseFloat(_0x586c7c),_0x801d5=parseFloat(_0x344773),_0x9cc6ce=_0x19f396?parseFloat(_0x19f396):0.2;return isNaN(_0xfd8c9f)||isNaN(_0x2e1233)||isNaN(_0x33027e)||isNaN(_0x801d5)?{'success':!0x1,'error':_0xdf8167(0x2a2),'example':'/api/bank/'+_0x5045d3+_0xdf8167(0x172)}:_0xfd8c9f<0x0||_0xfd8c9f>0x1||_0x2e1233<0x0||_0x2e1233>0x1||_0x33027e<0x0||_0x33027e>0x1||_0x801d5<0x0||_0x801d5>0x1?{'success':!0x1,'error':_0xdf8167(0x156),'example':'/api/bank/'+_0x5045d3+'/test/swipe/{deviceId}?x=0.2&y=0.5&endX=0.8&endY=0.5&duration=0.3'}:(this['logger']['log']('Testing\x20HC\x20swipe\x20from\x20('+_0xfd8c9f+',\x20'+_0x2e1233+')\x20to\x20('+_0x33027e+',\x20'+_0x801d5+')\x20on\x20device:\x20'+_0x1f85ed),await this[_0xdf8167(0xb6)]['swipe'](_0x1f85ed,{'x':_0xfd8c9f,'y':_0x2e1233,'endX':_0x33027e,'endY':_0x801d5,'duration':_0x9cc6ce}),{'success':!0x0,'message':'HC\x20swipe\x20completed\x20successfully\x20from\x20('+_0xfd8c9f+',\x20'+_0x2e1233+')\x20to\x20('+_0x33027e+',\x20'+_0x801d5+_0xdf8167(0x24f)+_0x1f85ed,'coordinates':{'start':{'x':_0xfd8c9f,'y':_0x2e1233},'end':{'x':_0x33027e,'y':_0x801d5},'duration':_0x9cc6ce}});}return{'success':!0x1,'error':'Invalid\x20box\x20type\x20configuration:\x20'+_0x3e0a60['config']['boxType']+'.\x20Must\x20be\x20\x27HC\x27\x20or\x20\x27PANDA\x27'};}catch(_0x1427ae){return this['logger']['error']('Error\x20testing\x20swipe:\x20'+_0x1427ae['message']),{'success':!0x1,'error':_0x1427ae['message']};}}async['testInputNumpadNumber'](_0x2231f8,_0x327ab5,_0x2f62d6){const _0x2f5eeb=_0x4bb23e;try{return this[_0x2f5eeb(0x23e)](_0x2231f8),_0x2f62d6&&0x0!==_0x2f62d6['trim']()['length']?/^\d+$/[_0x2f5eeb(0x189)](_0x2f62d6)?(this['logger']['log']('Testing\x20numpad\x20number\x20input\x20\x22'+_0x2f62d6+_0x2f5eeb(0x294)+_0x327ab5),await this['hcBoxService'][_0x2f5eeb(0xac)](_0x327ab5,_0x2f62d6),{'success':!0x0,'message':_0x2f5eeb(0x1ad)+_0x327ab5,'data':{'number':_0x2f62d6,'digits':_0x2f62d6['split']('')['map'](_0x5c0293=>parseInt(_0x5c0293))}}):{'success':!0x1,'error':'Number\x20must\x20contain\x20only\x20digits\x20(0-9)','example':'/api/bank/'+_0x2231f8+'/test/input-numpad/{deviceId}?number=123456'}:{'success':!0x1,'error':_0x2f5eeb(0x1c2),'example':_0x2f5eeb(0x19d)+_0x2231f8+'/test/input-numpad/{deviceId}?number=123456'};}catch(_0x55f6b0){return this[_0x2f5eeb(0x27d)]['error']('Error\x20testing\x20numpad\x20number\x20input:\x20'+_0x55f6b0['message']),{'success':!0x1,'error':_0x55f6b0[_0x2f5eeb(0x1dc)]};}}async['testInputText'](_0x1e1e2b,_0x5c200d,_0x1a8150){const _0x2c3161=_0x4bb23e;try{return this[_0x2c3161(0x23e)](_0x1e1e2b),_0x1a8150&&0x0!==_0x1a8150[_0x2c3161(0x2c2)]()[_0x2c3161(0x132)]?(this['logger']['log']('Testing\x20text\x20input\x20\x22'+_0x1a8150+_0x2c3161(0x294)+_0x5c200d),await this['hcBoxService']['inputText'](_0x5c200d,_0x1a8150),{'success':!0x0,'message':'Text\x20input\x20completed\x20successfully\x20on\x20device\x20'+_0x5c200d}):{'success':!0x1,'error':'Text\x20is\x20required\x20and\x20cannot\x20be\x20empty','example':'/api/bank/'+_0x1e1e2b+'/test/input-text/{deviceId}?text=abc123'};}catch(_0x5affde){return this['logger']['error'](_0x2c3161(0x1a9)+_0x5affde['message']),{'success':!0x1,'error':_0x5affde[_0x2c3161(0x1dc)]};}}async[_0x4bb23e(0x269)](_0x4fbef,_0x138468){const _0x287fcf=_0x4bb23e;try{return this[_0x287fcf(0x23e)](_0x4fbef),this['logger']['log']('Testing\x20press\x20return\x20key\x20on\x20device:\x20'+_0x138468),await this['wsService']['pressReturnKey'](_0x138468),{'success':!0x0,'message':'Return\x20key\x20pressed\x20successfully\x20on\x20device\x20'+_0x138468,'note':_0x287fcf(0x248)};}catch(_0x4c9fbe){return this[_0x287fcf(0x27d)][_0x287fcf(0xf2)](_0x287fcf(0x206)+_0x4c9fbe['message']),{'success':!0x1,'error':_0x4c9fbe['message']};}}};_0x36f888['BankController']=_0xcc2018,_0x10d5d5([(0x0,_0x19d59d['Get'])('devices'),(0x0,_0x3f2817[_0x4bb23e(0x120)])({'summary':'Get\x20list\x20of\x20available\x20devices'}),(0x0,_0x3f2817['ApiParam'])({'name':'bankCode','description':_0x4bb23e(0x13d)}),(0x0,_0x3f2817['ApiResponse'])({'status':0xc8,'description':'List\x20of\x20devices\x20retrieved\x20successfully'}),_0x4c8413(0x0,(0x0,_0x19d59d[_0x4bb23e(0x1c0)])('bankCode')),_0x10b784('design:type',Function),_0x10b784(_0x4bb23e(0x109),[String]),_0x10b784('design:returntype',Promise)],_0xcc2018['prototype'],'getDevices',null),_0x10d5d5([(0x0,_0x19d59d[_0x4bb23e(0x230)])('test/launch-app/:deviceId'),(0x0,_0x3f2817['ApiOperation'])({'summary':'Test\x20launching\x20bank\x20app\x20on\x20a\x20device'}),(0x0,_0x3f2817['ApiParam'])({'name':'bankCode','description':'Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)'}),(0x0,_0x3f2817[_0x4bb23e(0x2c9)])({'name':'deviceId','description':'Device\x20ID'}),(0x0,_0x3f2817['ApiResponse'])({'status':0xc8,'description':'App\x20launched\x20successfully'}),_0x4c8413(0x0,(0x0,_0x19d59d[_0x4bb23e(0x1c0)])(_0x4bb23e(0x200))),_0x4c8413(0x1,(0x0,_0x19d59d['Param'])('deviceId')),_0x10b784('design:type',Function),_0x10b784(_0x4bb23e(0x109),[String,String]),_0x10b784(_0x4bb23e(0xa2),Promise)],_0xcc2018['prototype'],'testLaunchApp',null),_0x10d5d5([(0x0,_0x19d59d['Post'])('test/capture-screen/:deviceId'),(0x0,_0x3f2817['ApiOperation'])({'summary':'Test\x20screen\x20capture\x20on\x20a\x20device'}),(0x0,_0x3f2817[_0x4bb23e(0x2c9)])({'name':'bankCode','description':_0x4bb23e(0x13d)}),(0x0,_0x3f2817['ApiParam'])({'name':'deviceId','description':'Device\x20ID'}),(0x0,_0x3f2817['ApiQuery'])({'name':'name','description':'Screen\x20capture\x20name\x20(optional)','required':!0x1}),(0x0,_0x3f2817[_0x4bb23e(0x1d7)])({'name':'quality','description':'Image\x20quality\x20(0-1,\x20default:\x200.5)','required':!0x1}),(0x0,_0x3f2817[_0x4bb23e(0xbe)])({'status':0xc8,'description':'Screen\x20captured\x20successfully'}),_0x4c8413(0x0,(0x0,_0x19d59d['Param'])('bankCode')),_0x4c8413(0x1,(0x0,_0x19d59d['Param'])(_0x4bb23e(0x16f))),_0x4c8413(0x2,(0x0,_0x19d59d['Query'])('name')),_0x4c8413(0x3,(0x0,_0x19d59d['Query'])('quality')),_0x10b784('design:type',Function),_0x10b784('design:paramtypes',[String,String,String,String]),_0x10b784('design:returntype',Promise)],_0xcc2018['prototype'],'testCaptureScreen',null),_0x10d5d5([(0x0,_0x19d59d['Post'])('test/click/:deviceId'),(0x0,_0x3f2817['ApiOperation'])({'summary':'Test\x20clicking\x20at\x20specific\x20coordinates\x20on\x20a\x20device'}),(0x0,_0x3f2817[_0x4bb23e(0x2c9)])({'name':_0x4bb23e(0x200),'description':_0x4bb23e(0x13d)}),(0x0,_0x3f2817['ApiParam'])({'name':_0x4bb23e(0x16f),'description':'Device\x20ID'}),(0x0,_0x3f2817['ApiQuery'])({'name':'x','description':_0x4bb23e(0x191),'required':!0x0}),(0x0,_0x3f2817['ApiQuery'])({'name':'y','description':'Y\x20coordinate\x20(Hc:\x200-1),\x20Panda:\x200-100','required':!0x0}),(0x0,_0x3f2817['ApiResponse'])({'status':0xc8,'description':_0x4bb23e(0x28b)}),_0x4c8413(0x0,(0x0,_0x19d59d['Param'])('bankCode')),_0x4c8413(0x1,(0x0,_0x19d59d[_0x4bb23e(0x1c0)])('deviceId')),_0x4c8413(0x2,(0x0,_0x19d59d['Query'])('x')),_0x4c8413(0x3,(0x0,_0x19d59d['Query'])('y')),_0x10b784('design:type',Function),_0x10b784('design:paramtypes',[String,String,String,String]),_0x10b784('design:returntype',Promise)],_0xcc2018['prototype'],'testClickAtCoordinates',null),_0x10d5d5([(0x0,_0x19d59d['Post'])('test/swipe/:deviceId'),(0x0,_0x3f2817['ApiOperation'])({'summary':'Test\x20swiping\x20on\x20a\x20device.\x20Format\x20is\x20determined\x20by\x20config.boxType\x20(HC\x20or\x20PANDA)'}),(0x0,_0x3f2817['ApiParam'])({'name':'bankCode','description':'Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)'}),(0x0,_0x3f2817[_0x4bb23e(0x2c9)])({'name':_0x4bb23e(0x16f),'description':'Device\x20ID'}),(0x0,_0x3f2817['ApiQuery'])({'name':'x','description':'X\x20coordinate\x20(HC:\x200-1,\x20Panda:\x200-100).\x20Required\x20for\x20HC\x20and\x20Panda\x20types\x200,1,2,10.\x20Optional\x20for\x20Panda\x20types\x204,5,6,7,8,9','required':!0x1}),(0x0,_0x3f2817['ApiQuery'])({'name':'y','description':'Y\x20coordinate\x20(HC:\x200-1,\x20Panda:\x200-100).\x20Required\x20for\x20HC\x20and\x20Panda\x20types\x200,1,2,10.\x20Optional\x20for\x20Panda\x20types\x204,5,6,7,8,9','required':!0x1}),(0x0,_0x3f2817['ApiQuery'])({'name':_0x4bb23e(0x1d1),'description':_0x4bb23e(0x26c),'required':!0x1}),(0x0,_0x3f2817['ApiQuery'])({'name':_0x4bb23e(0xfd),'description':'End\x20X\x20coordinate\x20for\x20HC\x20(required\x20for\x20HC:\x200-1)','required':!0x1}),(0x0,_0x3f2817['ApiQuery'])({'name':_0x4bb23e(0x257),'description':'End\x20Y\x20coordinate\x20for\x20HC\x20(required\x20for\x20HC:\x200-1)','required':!0x1}),(0x0,_0x3f2817[_0x4bb23e(0x1d7)])({'name':'duration','description':_0x4bb23e(0x1af),'required':!0x1}),(0x0,_0x3f2817['ApiResponse'])({'status':0xc8,'description':'Swipe\x20completed\x20successfully'}),_0x4c8413(0x0,(0x0,_0x19d59d[_0x4bb23e(0x1c0)])('bankCode')),_0x4c8413(0x1,(0x0,_0x19d59d['Param'])('deviceId')),_0x4c8413(0x2,(0x0,_0x19d59d['Query'])('x')),_0x4c8413(0x3,(0x0,_0x19d59d['Query'])('y')),_0x4c8413(0x4,(0x0,_0x19d59d[_0x4bb23e(0x183)])('type')),_0x4c8413(0x5,(0x0,_0x19d59d['Query'])('endX')),_0x4c8413(0x6,(0x0,_0x19d59d['Query'])('endY')),_0x4c8413(0x7,(0x0,_0x19d59d[_0x4bb23e(0x183)])(_0x4bb23e(0x207))),_0x10b784('design:type',Function),_0x10b784('design:paramtypes',[String,String,String,String,String,String,String,String]),_0x10b784('design:returntype',Promise)],_0xcc2018['prototype'],_0x4bb23e(0x93),null),_0x10d5d5([(0x0,_0x19d59d[_0x4bb23e(0x230)])('test/input-numpad/:deviceId'),(0x0,_0x3f2817['ApiOperation'])({'summary':_0x4bb23e(0x168)}),(0x0,_0x3f2817['ApiParam'])({'name':_0x4bb23e(0x200),'description':'Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)'}),(0x0,_0x3f2817['ApiParam'])({'name':'deviceId','description':'Device\x20ID'}),(0x0,_0x3f2817['ApiQuery'])({'name':'number','description':'Number\x20string\x20to\x20input\x20(e.g.,\x20\x22123\x22,\x20\x22456789\x22)','required':!0x0}),(0x0,_0x3f2817['ApiResponse'])({'status':0xc8,'description':'Numpad\x20number\x20input\x20completed\x20successfully'}),_0x4c8413(0x0,(0x0,_0x19d59d['Param'])('bankCode')),_0x4c8413(0x1,(0x0,_0x19d59d['Param'])(_0x4bb23e(0x16f))),_0x4c8413(0x2,(0x0,_0x19d59d['Query'])('number')),_0x10b784('design:type',Function),_0x10b784(_0x4bb23e(0x109),[String,String,String]),_0x10b784('design:returntype',Promise)],_0xcc2018['prototype'],'testInputNumpadNumber',null),_0x10d5d5([(0x0,_0x19d59d['Post'])('test/input-text/:deviceId'),(0x0,_0x3f2817['ApiOperation'])({'summary':'Test\x20inputting\x20text\x20using\x20keyboard\x20layout\x20on\x20a\x20device'}),(0x0,_0x3f2817['ApiParam'])({'name':'bankCode','description':'Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)'}),(0x0,_0x3f2817['ApiParam'])({'name':'deviceId','description':'Device\x20ID'}),(0x0,_0x3f2817['ApiQuery'])({'name':_0x4bb23e(0x295),'description':'Text\x20string\x20to\x20input\x20(e.g.,\x20\x22abc123\x22,\x20\x22test@email.com\x22)','required':!0x0}),(0x0,_0x3f2817[_0x4bb23e(0xbe)])({'status':0xc8,'description':'Text\x20input\x20completed\x20successfully'}),_0x4c8413(0x0,(0x0,_0x19d59d['Param'])(_0x4bb23e(0x200))),_0x4c8413(0x1,(0x0,_0x19d59d['Param'])('deviceId')),_0x4c8413(0x2,(0x0,_0x19d59d['Query'])(_0x4bb23e(0x295))),_0x10b784('design:type',Function),_0x10b784('design:paramtypes',[String,String,String]),_0x10b784('design:returntype',Promise)],_0xcc2018['prototype'],'testInputText',null),_0x10d5d5([(0x0,_0x19d59d['Post'])('test/press-return/:deviceId'),(0x0,_0x3f2817['ApiOperation'])({'summary':'Test\x20pressing\x20return\x20key\x20on\x20a\x20device'}),(0x0,_0x3f2817['ApiParam'])({'name':'bankCode','description':'Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)'}),(0x0,_0x3f2817['ApiParam'])({'name':'deviceId','description':'Device\x20ID'}),(0x0,_0x3f2817[_0x4bb23e(0xbe)])({'status':0xc8,'description':_0x4bb23e(0xbd)}),_0x4c8413(0x0,(0x0,_0x19d59d[_0x4bb23e(0x1c0)])('bankCode')),_0x4c8413(0x1,(0x0,_0x19d59d[_0x4bb23e(0x1c0)])(_0x4bb23e(0x16f))),_0x10b784('design:type',Function),_0x10b784(_0x4bb23e(0x109),[String,String]),_0x10b784('design:returntype',Promise)],_0xcc2018['prototype'],'testPressReturn',null),_0x36f888['BankController']=_0xcc2018=_0x10d5d5([(0x0,_0x3f2817['ApiTags'])(_0x4bb23e(0x138)),(0x0,_0x19d59d['Controller'])(_0x4bb23e(0x273)),_0x4c8413(0x2,(0x0,_0x19d59d['Inject'])(_0x5cdf4c[_0x4bb23e(0x253)])),_0x10b784('design:paramtypes',['function'==typeof(_0x2d20d7=void 0x0!==_0x5b39e7['BankService']&&_0x5b39e7[_0x4bb23e(0x26f)])?_0x2d20d7:Object,'function'==typeof(_0x2363a9=void 0x0!==_0x5587df[_0x4bb23e(0x1c4)]&&_0x5587df[_0x4bb23e(0x1c4)])?_0x2363a9:Object,_0x4bb23e(0x10a)==typeof(_0x3fd536=void 0x0!==_0x482284[_0x4bb23e(0xcc)]&&_0x482284['IWebSocketService'])?_0x3fd536:Object])],_0xcc2018);},function(_0x333705,_0x48a749,_0x1beede){const _0x27aafe=a0_0x14ea;var _0x538be9=this&&this['__decorate']||function(_0x4cb3dd,_0x40e711,_0x2df20c,_0x4a98f3){const _0x4b9e44=a0_0x14ea;var _0x5af362,_0x57a8bf=arguments[_0x4b9e44(0x132)],_0x407e40=_0x57a8bf<0x3?_0x40e711:null===_0x4a98f3?_0x4a98f3=Object[_0x4b9e44(0xfb)](_0x40e711,_0x2df20c):_0x4a98f3;if(_0x4b9e44(0x217)==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x407e40=Reflect[_0x4b9e44(0xcf)](_0x4cb3dd,_0x40e711,_0x2df20c,_0x4a98f3);else{for(var _0x23e2ab=_0x4cb3dd['length']-0x1;_0x23e2ab>=0x0;_0x23e2ab--)(_0x5af362=_0x4cb3dd[_0x23e2ab])&&(_0x407e40=(_0x57a8bf<0x3?_0x5af362(_0x407e40):_0x57a8bf>0x3?_0x5af362(_0x40e711,_0x2df20c,_0x407e40):_0x5af362(_0x40e711,_0x2df20c))||_0x407e40);}return _0x57a8bf>0x3&&_0x407e40&&Object['defineProperty'](_0x40e711,_0x2df20c,_0x407e40),_0x407e40;};Object['defineProperty'](_0x48a749,'__esModule',{'value':!0x0}),_0x48a749[_0x27aafe(0x24d)]=void 0x0;const _0x265598=_0x1beede(0x2),_0x184b92=_0x1beede(0x3a),_0x59e8be=_0x1beede(0x3c),_0x5e3215=_0x1beede(0x14),_0x55a1fe=_0x1beede(0xf);let _0x266b4b=class{};_0x48a749[_0x27aafe(0x24d)]=_0x266b4b,_0x48a749['WebSocketModule']=_0x266b4b=_0x538be9([(0x0,_0x265598['Global'])(),(0x0,_0x265598['Module'])({'providers':[{'provide':_0x5e3215['WEBSOCKET_SERVICE'],'useClass':'PANDA'===_0x55a1fe[_0x27aafe(0x14f)]['boxType']?_0x59e8be['PandaWebSocketService']:_0x184b92['HCWebSocketService']}],'exports':[_0x5e3215['WEBSOCKET_SERVICE']]})],_0x266b4b);},function(_0x3849f0,_0x51eec1,_0x54b6bd){const _0x2919eb=a0_0x14ea;var _0x2dbb6c=this&&this['__decorate']||function(_0x13946c,_0x37546f,_0x33d5b1,_0x5ae59c){const _0x549ba9=a0_0x14ea;var _0x2993eb,_0x42162d=arguments['length'],_0x30657f=_0x42162d<0x3?_0x37546f:null===_0x5ae59c?_0x5ae59c=Object[_0x549ba9(0xfb)](_0x37546f,_0x33d5b1):_0x5ae59c;if(_0x549ba9(0x217)==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x30657f=Reflect['decorate'](_0x13946c,_0x37546f,_0x33d5b1,_0x5ae59c);else{for(var _0x561cbf=_0x13946c[_0x549ba9(0x132)]-0x1;_0x561cbf>=0x0;_0x561cbf--)(_0x2993eb=_0x13946c[_0x561cbf])&&(_0x30657f=(_0x42162d<0x3?_0x2993eb(_0x30657f):_0x42162d>0x3?_0x2993eb(_0x37546f,_0x33d5b1,_0x30657f):_0x2993eb(_0x37546f,_0x33d5b1))||_0x30657f);}return _0x42162d>0x3&&_0x30657f&&Object['defineProperty'](_0x37546f,_0x33d5b1,_0x30657f),_0x30657f;},_0x21c510=this&&this[_0x2919eb(0x23c)]||function(_0x165575,_0x588ecd){const _0x32ae76=_0x2919eb;if(_0x32ae76(0x217)==typeof Reflect&&_0x32ae76(0x10a)==typeof Reflect[_0x32ae76(0x21e)])return Reflect['metadata'](_0x165575,_0x588ecd);};Object[_0x2919eb(0x176)](_0x51eec1,'__esModule',{'value':!0x0}),_0x51eec1['HCWebSocketService']=void 0x0;const _0x46cce8=_0x54b6bd(0x2),_0x370b43=_0x54b6bd(0x3b),_0x4610f1=_0x54b6bd(0x24),_0x406e50=_0x54b6bd(0x11),_0xfb8946=_0x54b6bd(0x2f);let _0x2c8a3a=class{constructor(){const _0x1097b6=_0x2919eb;this['logger']=new _0x46cce8['Logger']('HCWebSocketService'),this['ws']=null,this['reconnectAttempts']=0x0,this['maxReconnectAttempts']=0xa,this['reconnectDelay']=0x1388,this['requestQueue']=[],this[_0x1097b6(0x237)]=new Map(),this['isConnected']=!0x1,this['isProcessingRequest']=!0x1,this['wsUrl']='ws://127.0.0.1:26608';}async['onModuleInit'](){await this['connect']();}async[_0x2919eb(0xd6)](){const _0x3bea43=_0x2919eb;await this[_0x3bea43(0x241)]();}async['connect'](){return new Promise((_0x954187,_0x32810e)=>{const _0x5c66a9=a0_0x14ea;try{this['logger']['log']('Connecting\x20to\x20HC\x20BOX\x20WebSocket:\x20'+this[_0x5c66a9(0xbf)]),this['ws']=new _0x370b43(this['wsUrl']),this['ws']['on']('open',()=>{const _0x3aaff9=_0x5c66a9;this['logger'][_0x3aaff9(0x133)]('HC\x20BOX\x20WebSocket\x20connected'),this['isConnected']=!0x0,this['reconnectAttempts']=0x0,this['processRequestQueue'](),_0x954187();}),this['ws']['on']('message',_0x194672=>{const _0x49ef35=_0x5c66a9;try{const _0x4af665=JSON['parse'](_0x194672['toString']());this[_0x49ef35(0x288)](_0x4af665);}catch(_0x37e2b0){this['logger']['error']('Error\x20parsing\x20WebSocket\x20message:\x20'+_0x37e2b0['message']);}}),this['ws']['on']('error',_0x140f1b=>{const _0x4e468a=_0x5c66a9;this['logger'][_0x4e468a(0xf2)]('WebSocket\x20error:\x20'+_0x140f1b[_0x4e468a(0x1dc)]),this[_0x4e468a(0x2b7)]=!0x1,0x0===this[_0x4e468a(0x2c6)]&&_0x32810e(_0x140f1b);}),this['ws']['on']('close',()=>{const _0x49554d=_0x5c66a9;this['logger'][_0x49554d(0x26d)](_0x49554d(0x1b8)),this['isConnected']=!0x1,this['scheduleReconnect']();});}catch(_0x1cc8e6){this[_0x5c66a9(0x27d)]['error']('Error\x20creating\x20WebSocket\x20connection:\x20'+_0x1cc8e6['message']),_0x32810e(_0x1cc8e6);}});}['scheduleReconnect'](){const _0x5c7ebc=_0x2919eb;if(this[_0x5c7ebc(0x2c6)]>=this['maxReconnectAttempts'])return void this['logger']['error']('Max\x20reconnection\x20attempts\x20reached');this['reconnectAttempts']++;const _0x828a47=this[_0x5c7ebc(0x13b)]*this['reconnectAttempts'];this['logger']['log']('Scheduling\x20reconnect\x20attempt\x20'+this['reconnectAttempts']+'\x20in\x20'+_0x828a47+'ms'),setTimeout(()=>{this['connect']()['catch'](_0x25950d=>{const _0x224c34=a0_0x14ea;this['logger']['error']('Reconnection\x20failed:\x20'+_0x25950d[_0x224c34(0x1dc)]);});},_0x828a47);}async['disconnect'](){this['ws']&&(this['ws']['close'](),this['ws']=null,this['isConnected']=!0x1);}[_0x2919eb(0x288)](_0x5b27f4){const _0x54190e=_0x2919eb;if(this[_0x54190e(0x237)]['size']>0x0){const [_0xe7de70,_0x5329a7]=this[_0x54190e(0x237)][_0x54190e(0x220)]()['next']()[_0x54190e(0x214)];this['pendingRequests']['delete'](_0xe7de70),0xc8===_0x5b27f4['StatusCode']?_0x5329a7['resolve'](_0x5b27f4['result']):_0x5329a7['reject'](new Error('HC\x20BOX\x20error:\x20'+_0x5b27f4['StatusCode']));}else this['logger']['warn']('Received\x20response\x20but\x20no\x20pending\x20requests:\x20'+JSON['stringify'](_0x5b27f4));}async['processRequestQueue'](){const _0x376109=_0x2919eb;if(this[_0x376109(0xce)]||0x0===this['requestQueue']['length'])return;if(!this[_0x376109(0x2b7)]||!this['ws'])return;this[_0x376109(0xce)]=!0x0;const {request:_0x4a8566,resolve:_0x3b3722,reject:_0x5b7cfe,timeout:_0x19f027}=this[_0x376109(0x153)]['shift']();try{_0x3b3722(await this[_0x376109(0xca)](_0x4a8566,_0x19f027));}catch(_0x566873){_0x5b7cfe(_0x566873);}finally{this['isProcessingRequest']=!0x1,this[_0x376109(0x153)][_0x376109(0x132)]>0x0&&setImmediate(()=>this['processRequestQueue']());}}async[_0x2919eb(0xca)](_0x618f47,_0x44f50c=0x7530){return new Promise((_0x275f4c,_0x9c6672)=>{const _0x36adc7=a0_0x14ea,_0x181d11=Date['now']()['toString']()+Math[_0x36adc7(0x243)]()[_0x36adc7(0x2a9)](0x24)[_0x36adc7(0x14b)](0x2,0x9);this['pendingRequests']['set'](_0x181d11,{'resolve':_0x275f4c,'reject':_0x9c6672});const _0x50ec48=setTimeout(()=>{const _0x871143=_0x36adc7;this['pendingRequests'][_0x871143(0x141)](_0x181d11),_0x9c6672(new Error('WebSocket\x20request\x20timeout'));},_0x44f50c),_0xb6db75=_0x275f4c,_0x183f1a=_0x9c6672;_0x275f4c=_0x52954f=>{clearTimeout(_0x50ec48),_0xb6db75(_0x52954f);},_0x9c6672=_0x52fa22=>{clearTimeout(_0x50ec48),_0x183f1a(_0x52fa22);},this[_0x36adc7(0x237)]['set'](_0x181d11,{'resolve':_0x275f4c,'reject':_0x9c6672});try{this['ws']['send'](JSON['stringify'](_0x618f47));}catch(_0x3dbf37){this[_0x36adc7(0x237)]['delete'](_0x181d11),clearTimeout(_0x50ec48),_0x9c6672(_0x3dbf37);}});}async['sendRequest'](_0xd5e860,_0x245404=0x7530){return new Promise((_0x33e424,_0x319093)=>{this['requestQueue']['push']({'request':_0xd5e860,'resolve':_0x33e424,'reject':_0x319093,'timeout':_0x245404}),this['processRequestQueue']();});}async['listDevices'](){const _0x54cfbd=_0x2919eb,_0x2b7953=await this[_0x54cfbd(0x265)]({'action':'list'});return Array['isArray'](_0x2b7953)?_0x2b7953:[];}async['click'](_0x29295e,_0x48c306,_0xacf4c6,_0x3bc508=0.2){const _0x1c8f06=_0x2919eb,_0xf9e3f6=Array['isArray'](_0x29295e)?_0x29295e['join'](','):_0x29295e;return this[_0x1c8f06(0x265)]({'action':_0x1c8f06(0xa8),'comm':{'deviceIds':_0xf9e3f6,'x':_0x48c306,'y':_0xacf4c6,'duration':_0x3bc508}});}async[_0x2919eb(0x17f)](_0x202d2,_0x3777a9){const _0x3f3e89=_0x2919eb,_0x145d47=Array['isArray'](_0x202d2)?_0x202d2[_0x3f3e89(0x14e)](','):_0x202d2;return this['sendRequest']({'action':'swipe','comm':{'deviceIds':_0x145d47,..._0x3777a9}});}async['captureScreen'](_0x15abdd,_0x1e56c6){const _0x2d9195=_0x2919eb;return this['sendRequest']({'action':'screen','comm':{'deviceIds':_0x15abdd,...(0x0,_0xfb8946[_0x2d9195(0x181)])(_0x1e56c6,_0x2d9195(0x99)),'filePath':_0x1e56c6[_0x2d9195(0x99)]}});}async['home'](_0x40eacb){const _0x2237ac=_0x2919eb,_0x30ddb7=Array[_0x2237ac(0x201)](_0x40eacb)?_0x40eacb['join'](','):_0x40eacb;return this['sendRequest']({'action':_0x2237ac(0x1ba),'comm':{'deviceIds':_0x30ddb7}});}async['launchApp'](_0x4d977c,_0x2a6796){const _0x53da3f=_0x2919eb,_0x3aa85f=Array[_0x53da3f(0x201)](_0x4d977c)?_0x4d977c['join'](','):_0x4d977c;return this['sendRequest']({'action':'launchApp','comm':{'deviceIds':_0x3aa85f,'content':_0x2a6796}});}async[_0x2919eb(0x90)](_0x3f628b,_0x945d5){const _0x5bb37d=_0x2919eb,_0x40603a=Array[_0x5bb37d(0x201)](_0x3f628b)?_0x3f628b['join'](','):_0x3f628b;return this[_0x5bb37d(0x265)]({'action':'killApp','comm':{'deviceIds':_0x40603a,'content':_0x945d5}});}['isNumber'](_0x3ab4b3){return/^[0-9]$/['test'](_0x3ab4b3);}['isLetter'](_0x2427cc){const _0x379e7e=_0x2919eb;return/^[a-zA-Z]$/[_0x379e7e(0x189)](_0x2427cc);}['isSpecialCharInNumberMode'](_0x1f2412){return['@','!']['includes'](_0x1f2412);}async['switchKeyboardMode'](_0x4a3e7c){const _0xca2808=_0x2919eb,{x:_0x42cfef,y:_0x48e889}=_0x4610f1[_0xca2808(0xf3)]['KEYBOARD_SWITCH'];this['logger'][_0xca2808(0x133)]('Switching\x20keyboard\x20mode\x20on\x20device\x20'+_0x4a3e7c+'\x20at\x20coordinates\x20('+_0x42cfef+',\x20'+_0x48e889+')'),await this['click'](_0x4a3e7c,_0x42cfef,_0x48e889,0.2),await(0x0,_0x406e50['sleep'])(0x1f4),this[_0xca2808(0x27d)]['log']('Keyboard\x20mode\x20switched\x20successfully\x20on\x20device\x20'+_0x4a3e7c);}async['pressShiftKey'](_0x3163b8){const _0x569def=_0x2919eb,{x:_0x1d2add,y:_0x551234}=_0x4610f1[_0x569def(0xf3)]['SHIFT_KEY'];this[_0x569def(0x27d)]['debug'](_0x569def(0x1b2)+_0x3163b8+'\x20at\x20coordinates\x20('+_0x1d2add+',\x20'+_0x551234+')'),await this['click'](_0x3163b8,_0x1d2add,_0x551234,0.2),await(0x0,_0x406e50['sleep'])(0xc8),this['logger']['debug'](_0x569def(0x149)+_0x3163b8);}async['pressReturnKey'](_0x3f97f8){const _0x2ffe2c=_0x2919eb,{x:_0x434a71,y:_0x1b0359}=_0x4610f1['COMMON_COORDINATES'][_0x2ffe2c(0x1d5)];this['logger']['log']('Pressing\x20return\x20key\x20on\x20device\x20'+_0x3f97f8+'\x20at\x20coordinates\x20('+_0x434a71+',\x20'+_0x1b0359+')'),await this['click'](_0x3f97f8,_0x434a71,_0x1b0359,0.2),await(0x0,_0x406e50['sleep'])(0x1f4),this['logger'][_0x2ffe2c(0x133)]('Return\x20key\x20pressed\x20successfully\x20on\x20device\x20'+_0x3f97f8);}async['inputText'](_0x295020,_0x320010){const _0xbf6668=_0x2919eb;if(!_0x320010||0x0===_0x320010[_0xbf6668(0x132)])throw new Error('Password\x20cannot\x20be\x20empty');let _0x4a6fbc='letter';for(let _0x3173c8=0x0;_0x3173c8<_0x320010['length'];_0x3173c8++){const _0xbf0199=_0x320010[_0x3173c8],_0x421b28=_0xbf0199[_0xbf6668(0x249)](),_0x44ec55=_0xbf0199!==_0x421b28&&this['isLetter'](_0xbf0199),_0x53a752=this['isSpecialCharInNumberMode'](_0xbf0199)?_0xbf0199:_0x421b28,_0x106acb=_0x4610f1['KEYBOARD_LAYOUT'][_0x53a752];if(!_0x106acb){this[_0xbf6668(0x27d)][_0xbf6668(0x26d)]('Character\x20\x27'+_0xbf0199+'\x27\x20not\x20found\x20in\x20keyboard\x20layout.\x20Skipping...');continue;}let _0x321703=null;this['isNumber'](_0x421b28)?_0x321703=_0xbf6668(0x1b5):this['isLetter'](_0x421b28)?_0x321703='letter':this['isSpecialCharInNumberMode'](_0xbf0199)&&(_0x321703='number'),_0x321703&&_0x4a6fbc!==_0x321703&&(this['logger'][_0xbf6668(0x1e5)]('Switching\x20keyboard\x20to\x20'+_0x321703+'\x20mode\x20for\x20character\x20\x27'+_0xbf0199+'\x27'),await this['switchKeyboardMode'](_0x295020),_0x4a6fbc=_0x321703),_0x44ec55&&'letter'===_0x4a6fbc&&(this[_0xbf6668(0x27d)]['debug']('Pressing\x20shift\x20key\x20for\x20uppercase\x20letter\x20\x27'+_0xbf0199+'\x27'),await this['pressShiftKey'](_0x295020)),this['logger']['debug'](_0xbf6668(0xa5)+_0x53a752+'\x27'+(_0x44ec55?'\x20(uppercase)':'')+'\x20at\x20('+_0x106acb['x']+',\x20'+_0x106acb['y']+')'),await this['click'](_0x295020,_0x106acb['x'],_0x106acb['y'],0.15),await(0x0,_0x406e50['sleep'])(0xc8);}this[_0xbf6668(0x27d)]['log']('Text\x20input\x20completed\x20on\x20device\x20'+_0x295020);}async['inputNumpadNumber'](_0xeae33f,_0x4631f5){const _0x1c2e5f=_0x2919eb;if(!_0x4631f5||0x0===_0x4631f5[_0x1c2e5f(0x132)])throw new Error('value\x20cannot\x20be\x20empty');for(let _0x14e474=0x0;_0x14e474<_0x4631f5['length'];_0x14e474++){const _0x15f71b=_0x4631f5[_0x14e474],_0x458eb3=_0x4610f1[_0x1c2e5f(0x261)][_0x15f71b];await this['click'](_0xeae33f,_0x458eb3['x'],_0x458eb3['y'],0.15),this['logger'][_0x1c2e5f(0x1e5)]('Clicking\x20key\x20\x27'+_0x15f71b+'\x27\x20at\x20('+_0x458eb3['x']+',\x20'+_0x458eb3['y']+')'),await(0x0,_0x406e50['sleep'])(0xc8);}}async['transferFile'](_0xb65a31,_0x646ca6,_0x4b990c=0x1){return Promise['resolve'](null);}};_0x51eec1['HCWebSocketService']=_0x2c8a3a,_0x51eec1['HCWebSocketService']=_0x2c8a3a=_0x2dbb6c([(0x0,_0x46cce8[_0x2919eb(0x150)])(),_0x21c510('design:paramtypes',[])],_0x2c8a3a);},_0x546d2b=>{const _0x3be814=a0_0x14ea;_0x546d2b[_0x3be814(0x1f0)]=require('ws');},function(_0x2b6846,_0x42c85a,_0x1d157f){const _0x1e2433=a0_0x14ea;var _0x1c806a=this&&this['__decorate']||function(_0x23fdaa,_0x1e4563,_0x34c39e,_0x1308bc){const _0x56b93d=a0_0x14ea;var _0x1fa143,_0x22e020=arguments['length'],_0x1f6f9a=_0x22e020<0x3?_0x1e4563:null===_0x1308bc?_0x1308bc=Object['getOwnPropertyDescriptor'](_0x1e4563,_0x34c39e):_0x1308bc;if('object'==typeof Reflect&&_0x56b93d(0x10a)==typeof Reflect['decorate'])_0x1f6f9a=Reflect['decorate'](_0x23fdaa,_0x1e4563,_0x34c39e,_0x1308bc);else{for(var _0xdc00ec=_0x23fdaa['length']-0x1;_0xdc00ec>=0x0;_0xdc00ec--)(_0x1fa143=_0x23fdaa[_0xdc00ec])&&(_0x1f6f9a=(_0x22e020<0x3?_0x1fa143(_0x1f6f9a):_0x22e020>0x3?_0x1fa143(_0x1e4563,_0x34c39e,_0x1f6f9a):_0x1fa143(_0x1e4563,_0x34c39e))||_0x1f6f9a);}return _0x22e020>0x3&&_0x1f6f9a&&Object['defineProperty'](_0x1e4563,_0x34c39e,_0x1f6f9a),_0x1f6f9a;},_0xc5a7d7=this&&this[_0x1e2433(0x23c)]||function(_0x245715,_0x100ff8){const _0x4e1b34=_0x1e2433;if('object'==typeof Reflect&&_0x4e1b34(0x10a)==typeof Reflect[_0x4e1b34(0x21e)])return Reflect['metadata'](_0x245715,_0x100ff8);};Object[_0x1e2433(0x176)](_0x42c85a,_0x1e2433(0x22f),{'value':!0x0}),_0x42c85a[_0x1e2433(0xe0)]=void 0x0;const _0x29267f=_0x1d157f(0x2),_0xb9d1cc=_0x1d157f(0x3b),_0x51a329=_0x1d157f(0x2f),_0x4c619c=_0x1d157f(0x11),_0x458d62=_0x1d157f(0x24);let _0x2635d4=class{constructor(){const _0x4f0169=_0x1e2433;this['logger']=new _0x29267f[(_0x4f0169(0x108))]('PandaWebSocketService'),this['ws']=null,this['reconnectAttempts']=0x0,this['maxReconnectAttempts']=0xa,this['reconnectDelay']=0x1388,this[_0x4f0169(0x153)]=[],this['pendingRequests']=new Map(),this[_0x4f0169(0x2b7)]=!0x1,this['isProcessingRequest']=!0x1,this[_0x4f0169(0xbf)]='ws://127.0.0.1:33333';}async['onModuleInit'](){await this['connect']();}async['onModuleDestroy'](){await this['disconnect']();}async['connect'](){return new Promise((_0x3d135d,_0x47fb7c)=>{const _0x131f05=a0_0x14ea;try{this['logger'][_0x131f05(0x133)](_0x131f05(0x209)+this['wsUrl']),this['ws']=new _0xb9d1cc(this['wsUrl']),this['ws']['on']('open',()=>{const _0x137dab=_0x131f05;this['logger']['log']('Panda\x20BOX\x20WebSocket\x20connected'),this['isConnected']=!0x0,this[_0x137dab(0x2c6)]=0x0,this['processRequestQueue'](),_0x3d135d();}),this['ws']['on'](_0x131f05(0x1dc),_0x21f5e0=>{const _0x4b2c3a=_0x131f05;try{const _0x4361c1=_0x21f5e0['toString'](),_0x5146b7=JSON[_0x4b2c3a(0x14c)](_0x4361c1);this[_0x4b2c3a(0x288)](_0x5146b7);}catch(_0x1081a3){this[_0x4b2c3a(0x27d)]['error']('Error\x20parsing\x20WebSocket\x20message:\x20'+_0x1081a3['message'],_0x1081a3[_0x4b2c3a(0x2ad)]),this[_0x4b2c3a(0x27d)][_0x4b2c3a(0xf2)](_0x4b2c3a(0x20b)+_0x21f5e0[_0x4b2c3a(0x2a9)]());}}),this['ws']['on'](_0x131f05(0xf2),_0x5c71e6=>{const _0x2619a4=_0x131f05;this['logger'][_0x2619a4(0xf2)]('WebSocket\x20error:\x20'+_0x5c71e6[_0x2619a4(0x1dc)]),this['isConnected']=!0x1,0x0===this[_0x2619a4(0x2c6)]&&_0x47fb7c(_0x5c71e6);}),this['ws']['on']('close',()=>{const _0x50aa00=_0x131f05;this['logger']['warn']('Panda\x20BOX\x20WebSocket\x20closed'),this['isConnected']=!0x1,this[_0x50aa00(0x114)]();});}catch(_0x1675e1){this['logger']['error'](_0x131f05(0x1b1)+_0x1675e1['message']),_0x47fb7c(_0x1675e1);}});}['scheduleReconnect'](){const _0x57e227=_0x1e2433;if(this['reconnectAttempts']>=this[_0x57e227(0x2c8)])return void this['logger'][_0x57e227(0xf2)]('Max\x20reconnection\x20attempts\x20reached');this['reconnectAttempts']++;const _0x1db6af=this['reconnectDelay']*this['reconnectAttempts'];this['logger']['log']('Scheduling\x20reconnect\x20attempt\x20'+this[_0x57e227(0x2c6)]+'\x20in\x20'+_0x1db6af+'ms'),setTimeout(()=>{const _0x1ee68f=_0x57e227;this[_0x1ee68f(0x16e)]()['catch'](_0x5733e5=>{const _0x575b44=_0x1ee68f;this['logger'][_0x575b44(0xf2)](_0x575b44(0x2ba)+_0x5733e5[_0x575b44(0x1dc)]);});},_0x1db6af);}async['disconnect'](){const _0x6ae4ed=_0x1e2433;this['ws']&&(this['ws']['close'](),this['ws']=null,this[_0x6ae4ed(0x2b7)]=!0x1);}['handleMessage'](_0x7c3381){const _0x25a8a5=_0x1e2433;if(this[_0x25a8a5(0x237)]['size']>0x0){const [_0x26fbf1,_0x9179a]=this['pendingRequests']['entries']()[_0x25a8a5(0x1e3)]()['value'];if(this[_0x25a8a5(0x237)]['delete'](_0x26fbf1),0x2710===_0x7c3381['code'])_0x9179a['resolve'](_0x7c3381[_0x25a8a5(0x2a7)]);else{const _0x2e1813=_0x7c3381[_0x25a8a5(0x1dc)]||_0x25a8a5(0x128)+_0x7c3381['code'];_0x9179a['reject'](new Error(_0x2e1813));}}else{if(Array[_0x25a8a5(0x201)](_0x7c3381['data'])&&_0x7c3381['data']['length']>0x0&&void 0x0!==_0x7c3381['data'][0x0]?.['serial']&&0x2710===_0x7c3381[_0x25a8a5(0x1b4)]){const _0x22d9a8=_0x7c3381['data'];this['logger']['debug']('Received\x20unsolicited\x20device\x20list\x20update\x20(no\x20pending\x20requests):\x20'+_0x22d9a8['length']+_0x25a8a5(0x2c0));}else this['logger']['warn'](_0x25a8a5(0x161)+JSON['stringify'](_0x7c3381));}}async['processRequestQueue'](){const _0x1e0c41=_0x1e2433;if(this['isProcessingRequest']||0x0===this['requestQueue'][_0x1e0c41(0x132)])return;if(!this['isConnected']||!this['ws'])return;this[_0x1e0c41(0xce)]=!0x0;const {request:_0xe93631,resolve:_0x8d7779,reject:_0x1784da,timeout:_0x317d9e}=this['requestQueue']['shift']();try{_0x8d7779(await this['_sendRequestOnce'](_0xe93631,_0x317d9e));}catch(_0x28eace){_0x1784da(_0x28eace);}finally{this[_0x1e0c41(0xce)]=!0x1,this['requestQueue'][_0x1e0c41(0x132)]>0x0&&setImmediate(()=>this['processRequestQueue']());}}async[_0x1e2433(0xca)](_0x17d45a,_0x6ee73c=0x7530){return new Promise((_0x2431d1,_0x5be5df)=>{const _0x577062=a0_0x14ea,_0x52b5ee=Date[_0x577062(0x9b)]()[_0x577062(0x2a9)]()+Math['random']()[_0x577062(0x2a9)](0x24)['substr'](0x2,0x9);this['pendingRequests'][_0x577062(0x21c)](_0x52b5ee,{'resolve':_0x2431d1,'reject':_0x5be5df});const _0x2e2776=setTimeout(()=>{const _0x3431bd=_0x577062;this[_0x3431bd(0x237)]['delete'](_0x52b5ee),_0x5be5df(new Error('WebSocket\x20request\x20timeout'));},_0x6ee73c),_0x3e14b1=_0x2431d1,_0x54d8da=_0x5be5df;_0x2431d1=_0x359434=>{clearTimeout(_0x2e2776),_0x3e14b1(_0x359434);},_0x5be5df=_0x4932e6=>{clearTimeout(_0x2e2776),_0x54d8da(_0x4932e6);},this[_0x577062(0x237)][_0x577062(0x21c)](_0x52b5ee,{'resolve':_0x2431d1,'reject':_0x5be5df});try{const _0x37f1e7=JSON['stringify'](_0x17d45a);this['ws'][_0x577062(0xfc)](_0x37f1e7);}catch(_0x4cae6d){this['logger']['error']('Error\x20sending\x20WebSocket\x20request:\x20'+_0x4cae6d['message'],_0x4cae6d['stack']),this[_0x577062(0x237)]['delete'](_0x52b5ee),clearTimeout(_0x2e2776),_0x5be5df(_0x4cae6d);}});}async['sendRequest'](_0x472b37,_0x116e42=0x7530){return new Promise((_0xc058fe,_0x194f52)=>{this['requestQueue']['push']({'request':_0x472b37,'resolve':_0xc058fe,'reject':_0x194f52,'timeout':_0x116e42}),this['processRequestQueue']();});}async['listDevices'](){const _0x2de693=_0x1e2433,_0x2f00db=(await this['sendRequest']({'action':'list'}))[_0x2de693(0x146)](_0x403298=>({..._0x403298,'udid':_0x403298[_0x2de693(0x175)]}));return _0x2f00db['length']<=0x0&&this['logger']['error'](_0x2de693(0x246)),_0x2f00db;}async['click'](_0x115dea,_0x2c2ff2,_0x20ef24,_0x28f406=0.2){const _0xc32277=_0x1e2433;return this['sendRequest']({'action':_0xc32277(0x8d),'devices':Array['isArray'](_0x115dea)?_0x115dea['join'](','):_0x115dea,'data':{'type':'10','x':(0x0,_0x51a329['toString'])(_0x2c2ff2),'y':(0x0,_0x51a329[_0xc32277(0x2a9)])(_0x20ef24)}});}async['swipe'](_0x2095c8,_0x398e3c){const _0x2e40f3=_0x1e2433,_0x1d8d62=Array['isArray'](_0x2095c8)?_0x2095c8['join'](','):_0x2095c8;return this[_0x2e40f3(0x265)]({'action':'pointerEvent','devices':_0x1d8d62,'data':_0x398e3c});}async[_0x1e2433(0x23a)](_0xe1580f,_0x198f29){return this['sendRequest']({'action':'screenFile','devices':_0xe1580f,'data':{'savePath':_0x198f29['folderPath']}});}async['home'](_0x3f09a1){return this['sendRequest']({'action':'pushEvent','devices':_0x3f09a1,'data':{'type':'2'}});}async[_0x1e2433(0x27e)](_0x1b7fb9,_0x4de702){const _0x3ec2ec=_0x1e2433,_0x13fc1e=Array['isArray'](_0x1b7fb9)?_0x1b7fb9[_0x3ec2ec(0x14e)](','):_0x1b7fb9;return this[_0x3ec2ec(0x265)]({'action':_0x3ec2ec(0x224),'devices':_0x13fc1e,'data':{'app':_0x4de702}});}async['killApp'](_0xd36cbd,_0x36372e){const _0x4e8bb5=_0x1e2433,_0x433903=Array['isArray'](_0xd36cbd)?_0xd36cbd['join'](','):_0xd36cbd;return this[_0x4e8bb5(0x265)]({'action':'stopApp','devices':_0x433903,'data':{'app':_0x36372e}});}async[_0x1e2433(0x1da)](_0x3c5589){const _0x14f05b=_0x1e2433,{x:_0x1d4ba4,y:_0x366c1b}=_0x458d62['COMMON_COORDINATES'][_0x14f05b(0x2a6)];this['logger']['log'](_0x14f05b(0x238)+_0x3c5589+'\x20at\x20coordinates\x20('+_0x1d4ba4+',\x20'+_0x366c1b+')'),await this['click'](_0x3c5589,0x64*_0x1d4ba4,0x64*_0x366c1b,0.2),await(0x0,_0x4c619c['sleep'])(0x1f4),this['logger'][_0x14f05b(0x133)]('Keyboard\x20mode\x20switched\x20successfully\x20on\x20device\x20'+_0x3c5589);}async['pressShiftKey'](_0x18fca7){const _0x2a52a2=_0x1e2433,{x:_0x34eddf,y:_0x39ba6b}=_0x458d62[_0x2a52a2(0xf3)]['SHIFT_KEY'];this['logger']['debug']('Pressing\x20shift\x20key\x20on\x20device\x20'+_0x18fca7+'\x20at\x20coordinates\x20('+_0x34eddf+',\x20'+_0x39ba6b+')'),await this[_0x2a52a2(0xa8)](_0x18fca7,0x64*_0x34eddf,0x64*_0x39ba6b,0.2),await(0x0,_0x4c619c['sleep'])(0xc8),this['logger']['debug']('Shift\x20key\x20pressed\x20successfully\x20on\x20device\x20'+_0x18fca7);}async['pressReturnKey'](_0x252217){const _0x2a9202=_0x1e2433,{x:_0x4a2699,y:_0x4a2e79}=_0x458d62[_0x2a9202(0xf3)][_0x2a9202(0x1d5)];await this['click'](_0x252217,0x64*_0x4a2699,0x64*_0x4a2e79,0.2),await(0x0,_0x4c619c['sleep'])(0x1f4);}async['inputText'](_0x5b7190,_0x2894ff){const _0x2503bb=_0x1e2433,_0x20e06c=Array['isArray'](_0x5b7190)?_0x5b7190['join'](','):_0x5b7190;return this[_0x2503bb(0x265)]({'action':'inputText','devices':_0x20e06c,'data':{'content':_0x2894ff}});}async['inputNumpadNumber'](_0x2b9b05,_0x5ba407){const _0x8e7214=_0x1e2433;if(!_0x5ba407||0x0===_0x5ba407['length'])throw new Error('value\x20cannot\x20be\x20empty');for(let _0x3fccdb=0x0;_0x3fccdb<_0x5ba407['length'];_0x3fccdb++){const _0x264412=_0x5ba407[_0x3fccdb],_0x94ade5=_0x458d62['NUMPAD_LAYOUT'][_0x264412];await this['click'](_0x2b9b05,_0x94ade5['x'],_0x94ade5['y']),this['logger'][_0x8e7214(0x1e5)](_0x8e7214(0xa5)+_0x264412+'\x27\x20at\x20('+_0x94ade5['x']+',\x20'+_0x94ade5['y']+')'),await(0x0,_0x4c619c['sleep'])(0xc8);}}async[_0x1e2433(0x111)](_0x512435,_0x59d716,_0x329986=0x1){const _0x455759=_0x1e2433,_0x31fe8a=Array['isArray'](_0x512435)?_0x512435[_0x455759(0x14e)](','):_0x512435;return this['logger']['log']('Transferring\x20file\x20'+_0x59d716+_0x455759(0x279)+_0x31fe8a+'\x20with\x20fileType\x20'+_0x329986),this[_0x455759(0x265)]({'action':'uploadFile','devices':_0x31fe8a,'data':{'filePath':_0x59d716,'fileType':_0x329986}});}};_0x42c85a['PandaWebSocketService']=_0x2635d4,_0x42c85a['PandaWebSocketService']=_0x2635d4=_0x1c806a([(0x0,_0x29267f['Injectable'])(),_0xc5a7d7('design:paramtypes',[])],_0x2635d4);},function(_0x3f7432,_0xab1909,_0x4da0f7){const _0x448a27=a0_0x14ea;var _0x1c780b,_0x3c1db7,_0x1687bb,_0x1dbaf6=this&&this['__decorate']||function(_0x182a3b,_0x50aa3a,_0x16f8b3,_0x3483d2){const _0x130edd=a0_0x14ea;var _0x1e7b92,_0x400aba=arguments['length'],_0x7ebfcf=_0x400aba<0x3?_0x50aa3a:null===_0x3483d2?_0x3483d2=Object['getOwnPropertyDescriptor'](_0x50aa3a,_0x16f8b3):_0x3483d2;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x130edd(0xcf)])_0x7ebfcf=Reflect[_0x130edd(0xcf)](_0x182a3b,_0x50aa3a,_0x16f8b3,_0x3483d2);else{for(var _0x1c90fc=_0x182a3b['length']-0x1;_0x1c90fc>=0x0;_0x1c90fc--)(_0x1e7b92=_0x182a3b[_0x1c90fc])&&(_0x7ebfcf=(_0x400aba<0x3?_0x1e7b92(_0x7ebfcf):_0x400aba>0x3?_0x1e7b92(_0x50aa3a,_0x16f8b3,_0x7ebfcf):_0x1e7b92(_0x50aa3a,_0x16f8b3))||_0x7ebfcf);}return _0x400aba>0x3&&_0x7ebfcf&&Object[_0x130edd(0x176)](_0x50aa3a,_0x16f8b3,_0x7ebfcf),_0x7ebfcf;},_0x5786eb=this&&this['__metadata']||function(_0x3bec3c,_0x53558e){if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0x3bec3c,_0x53558e);};Object['defineProperty'](_0xab1909,'__esModule',{'value':!0x0}),_0xab1909['SessionRefreshScheduler']=void 0x0;const _0x583f98=_0x4da0f7(0x2),_0x4584fd=_0x4da0f7(0x7),_0x268806=_0x4da0f7(0x12),_0x40e952=_0x4da0f7(0x15),_0x58363a=_0x4da0f7(0x2a);let _0x3433c5=class{constructor(_0x34d453,_0x40060e,_0x2cd48d){this['bankService']=_0x34d453,this['deviceService']=_0x40060e,this['sessionManagement']=_0x2cd48d,this['logger']=new _0x583f98['Logger']('SessionRefreshScheduler');}async['refreshSessions'](){const _0xc57be9=a0_0x14ea;try{if('active'!==await this['deviceService']['getServiceStatus']())return;const _0x388757=(await this['deviceService']['listDevices']())['filter'](_0x1da2dd=>'active'===_0x1da2dd['status']&&_0x1da2dd['bankCode']);for(const _0x167193 of _0x388757){const _0x32786d=_0x167193['bankCode']['toUpperCase']();try{await this['bankService'][_0xc57be9(0xa9)](_0x167193['udid'],_0x32786d);}catch(_0x717caa){this[_0xc57be9(0x27d)]['error']('Error\x20refreshing\x20session\x20for\x20device\x20'+_0x167193['udid']+',\x20bank\x20'+_0x32786d+':\x20'+_0x717caa['message']);}}}catch(_0x21e6ea){this[_0xc57be9(0x27d)][_0xc57be9(0xf2)]('Error\x20in\x20session\x20refresh\x20scheduler:\x20'+_0x21e6ea['message']);}}};_0xab1909['SessionRefreshScheduler']=_0x3433c5,_0x1dbaf6([(0x0,_0x4584fd[_0x448a27(0x240)])(_0x4584fd['CronExpression']['EVERY_30_SECONDS']),_0x5786eb('design:type',Function),_0x5786eb('design:paramtypes',[]),_0x5786eb('design:returntype',Promise)],_0x3433c5[_0x448a27(0x97)],'refreshSessions',null),_0xab1909[_0x448a27(0x1a4)]=_0x3433c5=_0x1dbaf6([(0x0,_0x583f98['Injectable'])(),_0x5786eb('design:paramtypes',[_0x448a27(0x10a)==typeof(_0x1c780b=void 0x0!==_0x268806['BankService']&&_0x268806['BankService'])?_0x1c780b:Object,'function'==typeof(_0x3c1db7=void 0x0!==_0x40e952['DeviceService']&&_0x40e952['DeviceService'])?_0x3c1db7:Object,_0x448a27(0x10a)==typeof(_0x1687bb=void 0x0!==_0x58363a['SessionManagementService']&&_0x58363a['SessionManagementService'])?_0x1687bb:Object])],_0x3433c5);},function(_0x3d42b0,_0x1d8433,_0x18e7b5){const _0x92ad53=a0_0x14ea;var _0x55915b=this&&this['__decorate']||function(_0x24473,_0x47125a,_0x37b338,_0x2cad8a){var _0x424d96,_0x3392fc=arguments['length'],_0x1202fc=_0x3392fc<0x3?_0x47125a:null===_0x2cad8a?_0x2cad8a=Object['getOwnPropertyDescriptor'](_0x47125a,_0x37b338):_0x2cad8a;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x1202fc=Reflect['decorate'](_0x24473,_0x47125a,_0x37b338,_0x2cad8a);else{for(var _0xe2746b=_0x24473['length']-0x1;_0xe2746b>=0x0;_0xe2746b--)(_0x424d96=_0x24473[_0xe2746b])&&(_0x1202fc=(_0x3392fc<0x3?_0x424d96(_0x1202fc):_0x3392fc>0x3?_0x424d96(_0x47125a,_0x37b338,_0x1202fc):_0x424d96(_0x47125a,_0x37b338))||_0x1202fc);}return _0x3392fc>0x3&&_0x1202fc&&Object['defineProperty'](_0x47125a,_0x37b338,_0x1202fc),_0x1202fc;};Object[_0x92ad53(0x176)](_0x1d8433,'__esModule',{'value':!0x0}),_0x1d8433['OCRModule']=void 0x0;const _0x5395f8=_0x18e7b5(0x2),_0x502cea=_0x18e7b5(0x1d),_0x37f75d=_0x18e7b5(0x1f),_0x4482b2=_0x18e7b5(0x1c);let _0x51366d=class{};_0x1d8433[_0x92ad53(0x29a)]=_0x51366d,_0x1d8433['OCRModule']=_0x51366d=_0x55915b([(0x0,_0x5395f8['Module'])({'providers':[_0x502cea['OCRWorkerPoolService'],_0x37f75d['ImagePreprocessingService'],_0x4482b2['OCRService']],'exports':[_0x4482b2['OCRService'],_0x502cea[_0x92ad53(0xb5)],_0x37f75d[_0x92ad53(0xeb)]]})],_0x51366d);}],_0x227c7f={};function _0x186a50(_0x1b05c4){const _0x44f6b6=a0_0x14ea;var _0x5c03e4=_0x227c7f[_0x1b05c4];if(void 0x0!==_0x5c03e4)return _0x5c03e4['exports'];var _0x417bb7=_0x227c7f[_0x1b05c4]={'exports':{}};return _0x29d046[_0x1b05c4]['call'](_0x417bb7['exports'],_0x417bb7,_0x417bb7[_0x44f6b6(0x1f0)],_0x186a50),_0x417bb7['exports'];}var _0x63bf52={};((()=>{const _0x2e882d=a0_0x14ea;var _0x47a8e3=_0x63bf52;Object['defineProperty'](_0x47a8e3,_0x2e882d(0x22f),{'value':!0x0});const _0x1acc8d=_0x186a50(0x1),_0x220728=_0x186a50(0x2),_0x2d4e1b=_0x186a50(0x3),_0x232e54=_0x186a50(0x4),_0x2db5be=_0x186a50(0x5),_0x4d8036=_0x186a50(0xf);!(async function(){const _0x3e5dc7=_0x2e882d,_0x5984fb=await _0x1acc8d['NestFactory']['create'](_0x2db5be['AppModule']),_0x491e73=new _0x220728['Logger']('Bootstrap'),_0xa1d33a='production'===process[_0x3e5dc7(0x1bb)][_0x3e5dc7(0x233)]?(0x0,_0x232e54['join'])(__dirname,'views'):(0x0,_0x232e54['join'])(process[_0x3e5dc7(0x234)](),_0x3e5dc7(0x16b),'views');_0x5984fb['setBaseViewsDir'](_0xa1d33a),_0x5984fb['setViewEngine']('ejs'),_0x491e73['log']('Views\x20directory:\x20'+_0xa1d33a),_0x5984fb['useGlobalPipes'](new _0x220728['ValidationPipe']({'transform':!0x0,'whitelist':!0x0,'forbidNonWhitelisted':!0x0}));const _0x5f5c22=new _0x2d4e1b['DocumentBuilder']()['setTitle']('EzPay\x20Auto\x20API')['setDescription'](_0x3e5dc7(0x2b3))['setVersion'](_0x3e5dc7(0xee))[_0x3e5dc7(0x216)]('bank','Bank\x20operations')[_0x3e5dc7(0x216)]('withdrawal','Withdrawal\x20processing')['addTag'](_0x3e5dc7(0x126),'Device\x20management')['addTag']('hcbox','HC\x20Box\x20integration')[_0x3e5dc7(0x242)](),_0x28a315=_0x2d4e1b[_0x3e5dc7(0x208)][_0x3e5dc7(0x130)](_0x5984fb,_0x5f5c22);_0x2d4e1b['SwaggerModule']['setup'](_0x3e5dc7(0x148),_0x5984fb,_0x28a315);const _0x2c8b9a=process['env'][_0x3e5dc7(0x260)]||0xbba;_0x491e73['log']('\x20Swagger\x20documentation\x20available\x20at:\x20http://localhost:'+_0x2c8b9a+'/docs'),await _0x5984fb[_0x3e5dc7(0x2b9)](_0x2c8b9a),_0x491e73['log'](_0x3e5dc7(0x96)+_0x2c8b9a),_0x491e73['log'](_0x3e5dc7(0x118)+_0x4d8036[_0x3e5dc7(0x14f)]['boxType']+'\x20box'),_0x491e73['log']('\x20Device\x20management:\x20http://localhost:'+_0x2c8b9a);}());})());})()));function a0_0x14ea(_0xb706a2,_0x956526){_0xb706a2=_0xb706a2-0x8c;const _0x5c0186=a0_0x5c01();let _0x14ea22=_0x5c0186[_0xb706a2];return _0x14ea22;}function a0_0x5c01(){const _0x19e5b5=['existsSync','mtime','Numpad\x20number\x20input\x20completed\x20successfully\x20on\x20device\x20','Failed\x20to\x20create\x20worker\x20','Swipe\x20duration\x20for\x20HC\x20(default:\x200.2)','REDIS_SERVICE_STATUS_KEY','Error\x20creating\x20WebSocket\x20connection:\x20','Pressing\x20shift\x20key\x20on\x20device\x20','name','code','number','updateWithdrawalStatus','startProcessing','HC\x20BOX\x20WebSocket\x20closed','stringify','home','env','clickWithTransition','Get\x20withdrawal\x20queue\x20statistics','Xc\x20thc\x20giao\x20dch','clickAndWaitForScreen','Param','HcBoxModule','Number\x20is\x20required\x20and\x20cannot\x20be\x20empty','shift','HcBoxService','udid','OCR_ROI_BLOCK_Y','\x20(attempt\x20','apiKey','catch','rois','PGBANK','Error\x20executing\x20transfer\x20for\x20withdrawal\x20','lockedBy','REDIS_HOST','Xc\x20nhn\x20giao\x20dch','createQRCodeAndTransferTo','type','REDIS_PORT','\x20attempts).\x20Expected:\x20[','OCR_WHITELIST_SINGLE','RETURN_KEY','queue/stats','ApiQuery','unlink','expire','switchKeyboardMode','PgService','message','redis','bankService','extendLock','inUse','all','mkdir','next','\x20from\x20queue','debug','sleep','preprocess','DeviceController','isSessionValid','zadd','com.tpbank.mobilebanking','Device\x20','DeviceModule','REDIS_SESSION_PREFIX','availableAmount','exports','initializationPromise','Failed\x20to\x20reset\x20worker\x20parameters:\x20','\x20jobs\x20(','BankController','del','toUpperCase',']\x20QR\x20code\x20is\x20created\x20and\x20transferred\x20for\x20withdrawal\x20','deviceService','/test/swipe/{deviceId}?type=0','withCronLock','EzpayBeClientService','30605ikqqts','AGRIBANK','Available\x20Amount\x20is\x20required\x20when\x20status\x20is\x20active','redisService','bankCode','isArray','KIENLONGBANK','\x20is\x20already\x20being\x20processed\x20by\x20another\x20instance','WithdrawalModule','setex','Error\x20testing\x20press\x20return:\x20','duration','SwaggerModule','Connecting\x20to\x20Panda\x20BOX\x20WebSocket:\x20',',\x20expires\x20at:\x20','Raw\x20message\x20was:\x20','287yxTObp','5245023vCPdOy','1164SOdkxM','folderCreated','Error\x20logging\x20in\x20all\x20active\x20banks:\x20','MSB','AppModule','apiUrl','value','transferCode','addTag','object',']\x20-\x20Error\x20uploading\x20receipt\x20for\x20','maxWaitTime','full','acbService','set',',\x20Required:\x20','metadata','Invalid\x20coordinates.\x20x\x20and\x20y\x20must\x20be\x20numbers\x20between\x200\x20and\x20100\x20for\x20Panda','entries','delay','\x20after\x204\x20attempts.\x20Response:\x20','queue/start','startApp','WithdrawalJobManagerService','success','Assigned\x20device\x20','getLock','Failed\x20to\x20update\x20device\x20config','Manually\x20trigger\x20job\x20picking','Available\x20Amount\x20must\x20be\x20greater\x20than\x20or\x20equal\x20to\x200','Transfer\x20code\x20is\x20required\x20for\x20withdrawal\x20','Inject','BANK_SESSION_CONFIGS','__esModule','Post','getAvailableDevices','TRANSACTION_VERIFY','NODE_ENV','cwd','\x20OCR\x20workers...',')\x20on\x20device:\x20','pendingRequests','Switching\x20keyboard\x20mode\x20on\x20device\x20','withdrawalCode','captureScreen','Error\x20clicking\x20login\x20button\x20on\x20device\x20','__metadata',',\x20x=','getBankService','HttpException','Cron','disconnect','build','random','HOME_SCREEN','accountName','No\x20devices\x20found!','ocrService','This\x20key\x20can\x20dismiss\x20keyboard\x20or\x20submit/enter\x20depending\x20on\x20context','toLowerCase','min','Service\x20status\x20initialized\x20to:\x20inactive','PreprocessOptions','WebSocketModule',')...',')\x20on\x20device\x20','promoteDelayedJobsPeriodically','\x20with\x20type=','filter','WEBSOCKET_SERVICE','SCB','setServiceStatus','ms,\x20pollInterval:\x20','endY','waitingQueue','normalize','offset','IsNotEmpty','TECHCOMBANK','sessionManagement','Get','PG_ROI_EXPECTED','PORT','NUMPAD_LAYOUT','logging_in','com.techcombank.mobilebanking','baseTransactionFolderPath','sendRequest','ocrRecognize','getROIConfig','design:type','testPressReturn','tryAcquireFromPool','BAD_REQUEST','Panda\x20pointer\x20event\x20type:\x200=(press),\x201=(lift),\x202=(move),\x204=(scroll\x20up),\x205=(scroll\x20down),\x206=(swipe\x20up),\x207=(swipe\x20down),\x208=(swipe\x20left),\x209=(swipe\x20right),\x2010=(click).\x20Required\x20for\x20Panda\x20format.','warn','size','BankService','.\x20Response:\x20','rejectAllPending','hgetall','api/bank/:bankCode','Found\x20latest\x20bill\x20image:\x20','getDeviceConfig','password','clearSession','Manually\x20starting\x20job\x20processing...','\x20to\x20device(s)\x20','Queue\x20statistics',').\x20Matched\x20texts:\x20[','RedisService','logger','launchApp','Module','manualRetryCount','acquireWorker','inactive','httpService','waitForWorker','Terminating\x20','Successfully\x20processed\x20withdrawal:\x20','ocr','handleMessage','clickLoginButton','delayed','Click\x20completed\x20successfully','OCR\x20worker\x20pool\x20warmed\x20up\x20successfully\x20in\x20','ezpayBeClient','analyzedStatus','smartOTP','Worker\x20','Error\x20getting\x20available\x20devices:\x20','setParameters','deviceLock','\x22\x20on\x20device:\x20','text','errorType','acquireLock','10qGpbik','withdrawalQueue','OCRModule','Cannot\x20refresh\x20session\x20for\x20device\x20','forRoot','Job\x20picking\x20triggered','getDevices','executeTransferWithQRCode','api/devices/:deviceId/config','hasActiveDevice','Invalid\x20coordinates.\x20x,\x20y,\x20endX,\x20and\x20endY\x20must\x20be\x20numbers\x20between\x200\x20and\x201\x20for\x20HC','FIRST_IMAGE_BTN','%,\x20time:\x20','poolSize','KEYBOARD_SWITCH','data','setnx','toString','then','pickAndProcessJobs','ceil','stack','getServiceStatus','\x20on\x20assigned\x20device:\x20','withdrawalService','isInitialized','extract','Automated\x20withdrawal\x20processing\x20service\x20with\x20HC\x20BOX\x20integration','TPBANK','CLOSE_ALLOW_CONTACT_POPUP_BTN',').\x20Using\x20','isConnected',']\x20Screen\x20not\x20matched\x20yet\x20(attempt\x20','listen','Reconnection\x20failed:\x20','\x20attempts)','withdraw:','sessionTimeoutMs','Error\x20getting\x20device\x20config\x20for\x20','PVCOMBANK','\x20device(s)','ezpayBe','trim','uHqE5X9H0QEBsqlZpdTHG0fOyvmMtHjCGgsG4ouls3Gz9WvaWg4w9HV3sqETGWfE','pressReturnKey','\x20is\x20not\x20active.\x20Please\x20activate\x20the\x20device\x20first.','reconnectAttempts','\x20(must\x20be\x200-1)','maxReconnectAttempts','ApiParam','GPBANK','pointerEvent','REDIS_DEVICE_CONFIG_PREFIX','Clicking\x20password\x20field\x20on\x20device\x20','killApp','releaseWorker','No\x20receipt\x20path\x20provided\x20for\x20withdrawal\x20','testSwipe','ValidateIf',',\x20retrying...','\x20EzPay\x20Auto\x20is\x20running\x20on:\x20http://localhost:','prototype','__param','folderPath','queue/debug','now','Error\x20clicking\x20password\x20field\x20on\x20device\x20','getActiveCount','HttpStatus','stopService','workerPoolService','inputText','design:returntype','HSBC','535gIDGoy','Clicking\x20key\x20\x27','SmartOTP\x20not\x20configured\x20for\x20device\x20','baseTransactionExecutionFolder','click','refreshSessionIfNeeded','doWarmPool','LOGIN_BTN','inputNumpadNumber','DeviceLockService','loginTime','REDIS_PROCESSED_PREFIX','ABBANK','normalizeBankAccountName','CONTINUE_TRANSFER_BTN','PG_UI_COORDINATES','ScheduleModule','OCRWorkerPoolService','wsService','/4)','login','BullModule','matchedTexts','Failed\x20to\x20upload\x20bill\x20for\x20withdrawal\x20','Error\x20marking\x20withdrawal\x20','Return\x20key\x20pressed\x20successfully','ApiResponse','wsUrl','fastScreenOCR','host','test-screen-capture-','PERMANENT','markAsFailed','Chuyn\x20tin\x20thnh\x20cng',']\x20-\x20Get\x20Transaction\x20confirm\x20screen','not\x20set','Testing\x20','pgService','_sendRequestOnce','unknown','IWebSocketService','\x20on\x20device\x20','isProcessingRequest','decorate','Smart\x20OTP\x20is\x20required\x20when\x20status\x20is\x20active',':\x20x\x20and\x20y\x20are\x20required','Failed\x20to\x20acquire\x20lock\x20for\x20device\x20','redisClient','_id','\x20status\x20to\x20','onModuleDestroy','createTransactionFolder','png','Invalid\x20image\x20dimensions:\x20width\x20or\x20height\x20is\x200','AcbService','updateDeviceConfig','\x20is\x20being\x20processed\x20by\x20another\x20instance','ttl','LAUNCH_APP','Choose\x20wrong\x20image\x20qrcode','PandaWebSocketService','lanczos3','add','REDIS_DEVICE_CONFIG_SUFFIX',']\x20-\x20Get\x20back\x20to\x20home\x20screen','VPBANK','VRB','4MhzKqE','lang','crop',',\x20Retrying\x20in\x20','ImagePreprocessingService','registerBankService','WithdrawalJobManagerService\x20initialized,\x20waiting\x205\x20seconds\x20before\x20starting...','1.0','recognize','includes','width','error','COMMON_COORDINATES','Error\x20testing\x20click\x20at\x20coordinates:\x20','sadd','Password\x20not\x20configured\x20for\x20device\x20','LOGIN_BUTTON','folderCreationInProgress','response','Executing\x20transfer\x20for\x20withdrawal\x20','getOwnPropertyDescriptor','send','endX','login:','active','DeviceService','executeExternalTransfer','TRANSACTION_SUCCESS','KEYBOARD_LAYOUT','All\x20OCR\x20workers\x20terminated','SHINHANBANKVIETNAM','Error\x20setting\x20service\x20status:\x20','chuyn\x20tin\x20thnh\x20cng','Logger','design:paramtypes','function','isInitializing','Clicking\x20login\x20button\x20on\x20device\x20',',\x20bank\x20','getSessionTimeout','OCB','readdir','transferFile','\x20as\x20logging\x20in','Failed\x20to\x20refresh\x20session\x20for\x20device\x20','scheduleReconnect',',\x20Error:\x20','listDevices','WithdrawalService','\x20Withdrawal\x20processing\x20started\x20by\x20','Failed\x20to\x20launch\x20PGBank\x20app','isAcquiring','captureStackTrace',']\x20-\x20Get\x20Transaction\x20success\x20screen','Error\x20testing\x20','terminateAll','customROI','ApiOperation','ErrorType','Clicking\x20return\x20key\x20on\x20device\x20','append','HDBank','floor','device',']\x20Recorded\x20login\x20session\x20(bank:\x20','Panda\x20BOX\x20error:\x20','lockType','forwardRef','createWorker','12357117QPqfug','NAMABANK','HttpService','lastUsed','createDocument','MIN_DIMENSION','length','log','FORCE_LOGIN','Failed\x20to\x20release\x20transfer\x20lock\x20for\x20device\x20','REDIS_LOCK_PREFIX','accountNo','bank','For\x20HC\x20format:\x20x,\x20y,\x20endX,\x20and\x20endY\x20are\x20required','17652108norNkB','reconnectDelay','__decorate','Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)',']\x20No\x20screenshot\x20files\x20found\x20in\x20folder,\x20retrying...','BaseBankService','Queue','delete','getClient','Manually\x20triggering\x20job\x20picking...','Refreshing\x20session\x20for\x20device\x20','sourceAccountName','map','psm','docs','Shift\x20key\x20pressed\x20successfully\x20on\x20device\x20','ACB','substr','parse','patch','join','config','Injectable','Panda\x20swipe\x20completed\x20successfully\x20on\x20device\x20','processWithdrawal','requestQueue','IsString','ms.\x20Pool\x20size:\x20','Invalid\x20coordinates.\x20x,\x20y,\x20endX,\x20and\x20endY\x20must\x20be\x20between\x200\x20and\x201\x20for\x20HC','some','status','replace',']\x20-\x20Get\x20Verified\x20account\x20name\x20screen','Tesseract\x20worker\x20','Error\x20testing\x20screen\x20capture:\x20','Invalid\x20ROI\x20height:\x20','Image\x20too\x20small:\x20','VIETBANK','toFile','Received\x20response\x20but\x20no\x20pending\x20requests:\x20','LPBANK','processing','withdrawalId','):\x20','max','worker','Test\x20inputting\x20number\x20using\x20numpad\x20layout\x20on\x20a\x20device','ApiTags','Render','src','pid','hcBoxService','connect','deviceId','createBillFolder','getJobs','/test/swipe/{deviceId}?x=0.2&y=0.5&endX=0.8&endY=0.5&duration=0.3','OCRService','64816MonQvg','serial','defineProperty','confidence','Error\x20starting\x20service:\x20','Cleared\x20session\x20for\x20device\x20','BACK_TO_HOME','PANDA','ocrConfig',':meta','Invalid\x20ROI\x20x:\x20','swipe','getDevicesPage','omit','6888','Query','get',':config','Error\x20processing\x20withdrawal\x20','Max\x20retries\x20(3)\x20exceeded\x20for\x20withdrawal\x20','terminate','test','Transaction\x20verification\x20screen\x20not\x20found','WithdrawalProcessingError','pool','resize','Testing\x20screen\x20capture\x20on\x20device:\x20','push','singleLine','X\x20coordinate\x20(HC:\x200-1,\x20Panda:\x200-100)','scaleCoordinates','Scanning\x20folder\x20for\x20bill\x20image:\x20','refreshBeforeMs','Marked\x20withdrawal\x20','registerQueue','COMPLETED_TTL','height','grayscale','logTimingBreakdown','getBankCode','waiting','/api/bank/','Withdrawal\x20','screen','imagePreprocessingService','rawPath','NCB','releaseLock','SessionRefreshScheduler','14089559AvMhry','Dcsvnqvmn1','withdrawal','2404IgzXwh','Error\x20testing\x20text\x20input:\x20','Session\x20expired\x20or\x20missing\x20for\x20device\x20'];a0_0x5c01=function(){return _0x19e5b5;};return a0_0x5c01();}
//# sourceMappingURL=main.js.map
//# sourceMappingURL=main.js.map