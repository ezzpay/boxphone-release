function a0_0x4abd(_0x345481,_0x4336d0){_0x345481=_0x345481-0x1c6;const _0x163204=a0_0x1632();let _0x4abd8b=_0x163204[_0x345481];return _0x4abd8b;}function a0_0x1632(){const _0x961f9a=['\x20-\x20','withdrawal:processed:',']\x20Screen\x20not\x20detected\x20after\x20swipe\x20(attempt\x20','powershell\x20-NoProfile\x20-ExecutionPolicy\x20Bypass\x20-Command\x20\x22','/test/swipe/{deviceId}?x=0.2&y=0.5&endX=0.8&endY=0.5&duration=0.3','RedisLockService','inputSmartOTPFromConfig','\x20error:\x20',')\x20+\x20height(','cloneDeep','inputNumpadNumber','ms\x20>\x201000ms\x20(p95\x20target)','OCR_ROI_BLOCK_Y','257541dupyCq','\x20VND\x20(confidence:\x20',']\x20-\x20Get\x20Verified\x20account\x20name\x20screen','getDelayedCount','executeExternalTransfer','_id','status=','HOME_ICON','not\x20set','30496GRhHxx','forceKillWithPowerShell','decorate','danh\x20ba\x20th·ª•\x20h∆∞·ªüng','X√°c\x20th·ª±c\x20giao\x20d·ªãch','Password\x20not\x20configured\x20for\x20device\x20','reconnectDelay','X\x20coordinate','Telegram\x20API\x20error:\x20','toLocaleString','SWIPE_UP_SCREEN','WebSocket\x20error:\x20','createDocument','Error\x20picking\x20jobs:\x20','hint','\x20as\x20failed:\x20','Cleared\x20session\x20for\x20device\x20','HttpModule','completed','releaseLock','Error\x20sending\x20telegram\x20message','worker','withdrawalQueue','promoteDelayedJobs','name','onModuleDestroy','WithdrawalController','Panda\x20swipe\x20completed\x20successfully\x20on\x20device\x20','includes','zadd','extract','receipt','Start-Process\x20powershell\x20-ArgumentList\x20\x27-NoProfile\x27,\x27-ExecutionPolicy\x27,\x27Bypass\x27,\x27-Command\x27,\x22','SHB','getSupportedBanks','floor',']\x20Lock\x20was\x20already\x20released\x20or\x20changed\x20(expected\x20lockId:\x20','function','deviceService','ceil',']\x20Successfully\x20logged\x20in\x20to\x20','cleanupFolder','design:returntype','process\x20not\x20found','\x20-\x20device\x20is\x20locked','acbService','HDBANK','\x22\x20/FO\x20CSV\x20/NH','2246058nBkIoD','.env','REDIS_SESSION_PREFIX','Controller','redisService','ROI\x20extends\x20beyond\x20image:\x20x(','beneficiaryAccountNo','Withdrawal\x20not\x20pending\x20or\x20retry,\x20skipping\x20(','BankService','FIRST_IMAGE_BTN','0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\x20.-','DEFAULT_LOCK_TTL','sismember','stringify','Text\x20string\x20to\x20input\x20(e.g.,\x20\x22abc123\x22,\x20\x22test@email.com\x22)','api/devices/:deviceId/config','_debug','sourceAccountName','width','withdrawalCode','isArray','_sendRequestOnce','startTarget','\x20on\x20device\x20','Uploading\x20bill\x20for\x20withdrawal\x20','hgetall','withdrawal','build','Query','OCRModule','folderCreationInProgress','withdrawalService','Inject','Error\x20deducting\x20amount\x20for\x20device\x20','toFixed','handleJobFailure','Confirm\x20after\x20OTP\x20screen\x20not\x20found','Error\x20retrying\x20login\x20for\x20device\x20','reconnectAttempts','pushEvent','Error\x20logging\x20in\x20on\x20device\x20','reject','from','OCR_ROI_BLOCK_X','launchApp','OCR_POOL_SIZE','OCR_ROI_SINGLE_Y','setDescription','registerBankService','G888CWKP2Y06X','.\x20Payload:\x20','recognizeFromFile','deviceLock','clickPasswordField','VRB','Failed\x20to\x20click\x20image\x20library\x20button','recognize','deactive','restartPandaBoxPeriodically','ti·∫øt\x20ki·ªám','DeviceLockService','httpService',',\x20timeout:\x20','triggerPickJobs','registerQueue','clickAndWaitForScreen','metadata','ACB','.png','NODE_ENV','grayscale','getSession','confidence','createdAt','Registered\x20bank\x20service:\x20','TEMPORARY','\x20attempts).\x20Expected:\x20[','HC\x20BOX\x20WebSocket\x20connected','Swipe\x20duration\x20for\x20HC\x20(default:\x200.2)','logTimingBreakdown','baseUrl','BACABANK','decode=','transferFile','BIDV','https://api-hn.botpro.world/payment','processRequestQueue','markAsProcessing','matchedTexts','endY','Error\x20clicking\x20login\x20button\x20on\x20device\x20','resize','AppModule','PgService','redisLockService','NO_BILL_AFTER_OTP','random','catch','api/devices',']\x20Device\x20does\x20not\x20have\x20valid\x20session\x20for\x20bank\x20','WEBSOCKET_SERVICE','disableNotification','\x20as\x20processing','getHeaders','293148wVStFq','HttpException','VERIFY_ACCOUNT_NUMBER','ocrService','redisClient','getOwnPropertyDescriptor','pgService','ƒêƒÉng\x20nh·∫≠p',')\x20is\x20not\x20pending\x20or\x20retry,\x20skipping',']\x20-\x20Get\x20Transaction\x20success\x20screen','cwd','min','inactive','message','No\x20OCR\x20result\x20found\x20for\x20','get','sendRequest','IsString','Numpad\x20number\x20input\x20completed\x20successfully','2683592pLMOrw','SYSTEM_LOCK_PAUSE_PROCESSING','Test\x20ROI\x20detection\x20on\x20a\x20device','Invalid\x20coordinates.\x20x\x20and\x20y\x20must\x20be\x20numbers\x20between\x200\x20and\x20100\x20for\x20Panda','transferCode','isInitialized','ANALYZE_BILL_ROI',',\x20bank\x20','isRestartingBoxphone','VIB','startApp','stripBase64Prefix','Failed\x20to\x20login\x20','pointerEvent',',\x20w=','append','readdir','\x20available\x20devices.\x20Picking\x20','stack','Clicking\x20login\x20button\x20on\x20device\x20','Error\x20testing\x20text\x20input:\x20','Failed\x20to\x20update\x20device\x20config','isInitializing','cannot\x20find\x20a\x20process','CONTINUE_TRANSFER_BTN','Invalid\x20ROI\x20y:\x20','Injectable','No\x20active\x20devices\x20found\x20to\x20login','VIETABANK','detectScreenByHint','sort','Job\x20picking\x20triggered','HOME_SCREEN','map','device','max','sessionManagement','WebSocket\x20request\x20timeout','CIMB','tryAcquireFromPool','active','withdrawalId','log','switchKeyboardMode','PG_UI_COORDINATES','/4)','<b>Bank:</b>\x20','isRunning','Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)','Extracted\x20transaction\x20amount:\x20','Marked\x20withdrawal\x20','exports','PENDING','WebSocket\x20is\x20not\x20connected,\x20cannot\x20pick\x20jobs','BAD_REQUEST',',\x20y=','expire','Updating\x20withdrawal\x20','DeviceController','test/click/:deviceId','baseTransactionFolderPath','Automated\x20withdrawal\x20processing\x20service\x20with\x20HC\x20BOX\x20integration','OCR_ROI_SINGLE_WIDTH','Test\x20clicking\x20at\x20specific\x20coordinates\x20on\x20a\x20device','listDeviceConfigs','HD_SCREEN_OTP_HINT','restartApp','accountNo','Executing\x20VIETCOMBANK\x20transfer\x20for\x20withdrawal\x20','Vui\x20long\x20nhap\x20ma\x20PIN\x20HDBank\x20OTP','code','wsService','\x20(must\x20be\x200-1)','RETURN_KEY','\x20status\x20to\x20',']\x20Recorded\x20login\x20session\x20(bank:\x20','IWebSocketService','charWhitelist','full','PERMANENT','all','setViewEngine','Capturing\x20screen\x20on\x20device\x20','BACK_TO_HOME','testRoi','isProcessingRequest','endsWith','\x20was\x20locked\x20after\x20assignment,\x20skipping\x20job\x20','pressShiftKey','Process\x20not\x20found\x20(expected):\x20','Error\x20starting\x20service:\x20','CLICK','418618xIPuIs','poolSize','toLowerCase','chat_id','BankCodeWithdrawal','requestQueue','Error\x20testing\x20press\x20return:\x20','checkIfProcessed','updateWithdrawalStatus','set','Text\x20input\x20completed\x20on\x20device\x20','tasklist\x20/FI\x20\x22IMAGENAME\x20eq\x20','Giao\x20d·ªãch\x20th√†nh\x20c√¥ng','ms)','REDIS_SERVICE_STATUS_KEY','decodeImage','Device\x20','debug',',\x20Error:\x20','Return\x20key\x20pressed\x20successfully\x20on\x20device\x20','opts','open','REDIS_LOCK_PREFIX','logger','bankService','uploadReceipt','\x0a<b>Account:</b>\x20','startService','error','createTransactionFolder','Connecting\x20to\x20HC\x20BOX\x20WebSocket:\x20','Withdrawal','length','devices','VPBANK','ocr','createQRCodeAndTransferTo','\x20|\x20','.\x20Supported\x20banks:\x20','\x20already\x20processed\x20or\x20being\x20processed,\x20skipping','apiUrl','Bank\x20Code\x20is\x20required\x20when\x20status\x20is\x20active','getDevices','PG_ROI_EXPECTED','PreprocessOptions','7bxlEvj','isDestroyed','REDIS_HOST','waitForWorker','Completed\x20login\x20process\x20for\x20all\x20active\x20banks','lastUsed','Password\x20l√†\x20b·∫Øt\x20bu·ªôc\x20khi\x20status\x20l√†\x20active','trim','AcbService','Failed\x20to\x20release\x20transfer\x20lock\x20for\x20device\x20','duration','/docs','OCR_MAX_WIDTH_SINGLE','Screen\x20capture\x20name\x20(optional)','EZZPAY_KEY','.\x20Retrying\x20login...','port','smartOTP','Received\x20response\x20but\x20no\x20pending\x20requests:\x20','acquireLock','BILL_AREA','Unknown\x20Telegram\x20error','isNil','isAcquiring','/3\x20-\x20Could\x20not\x20find\x20screenshot\x20file\x20after\x20','isLocked','PROCESSING','WDA\x20','ezpayBe','getBankCode','udid','lastErrorType','Width','OCR_ROI_SINGLE_X','Bank\x20operations','EXIMBANK','FAILED','12jnfHcI','HttpStatus','ENTER_OTP','\x20waiting).','__param','data','EzpayBeClientService','MIN_DIMENSION','Failed\x20to\x20warm\x20up\x20worker\x20pool:\x20','Bootstrap','bankServices','IsNotEmpty','üöÄ\x20EzPay\x20Auto\x20is\x20running\x20on:\x20http://localhost:','Scheduling\x20reconnect\x20attempt\x20','UNKNOWN','PGBANK','preprocess','Base\x20folder\x20already\x20exists\x20(created\x20by\x20another\x20process):\x20','TelegramService','NCB','initializationPromise','Swipe\x20completed\x20successfully','For\x20Panda\x20type\x20','Connecting\x20to\x20Panda\x20BOX\x20WebSocket:\x20','resolve','BVBANK','BaseBankService','Param','parse_mode','COMPLETED_TTL','PVCOMBANK','delayed','‚úÖ\x20<b>Boxphone\x20software</b>\x0a\x0a<b>Kh·ªüi\x20ƒë·ªông\x20l·∫°i\x20th√†nh\x20c√¥ng:</b>\x20','requestFormWithRetry','description','Starting\x20withdrawal\x20job\x20processing...','ms,\x20Poll:\x20','Y\x20coordinate\x20(Hc:\x200-1),\x20Panda:\x200-100','Available\x20Amount\x20must\x20be\x20greater\x20than\x20or\x20equal\x20to\x200',',\x20retrying...','VCB_UI_COORDINATES','Successfully\x20processed\x20withdrawal:\x20','Module','VIETCOMBANK','Character\x20\x27','postprocess','/test/click/{deviceId}?x=0.5&y=0.55','VERIFY_ACCOUNT_NAME','scaleCoordinates','SELECT_IMAGE_QR_CODE_BTN','COMMON_COORDINATES','uHqE5X9H0QEBsqlZpdTHG0fOyvmMtHjCGgsG4ouls3Gz9WvaWg4w9HV3sqETGWfE','entries',']\x20Error\x20deleting\x20device\x20config:\x20','Transaction\x20verification\x20screen\x20not\x20found','WindowsAppGitBashService','üìä\x20Withdrawal\x20processing\x20started\x20by\x20','</b>\x0a\x0a','SYSTEM_LOCK_BOXPHONE','Transfer\x20is\x20paused\x20by\x20admin\x20temporarily!','workerPoolService','FORCE_LOGIN','allSettled','recognizeFromBuffer','maxWidth','join','logging_in','extractTransactionAmount',':config','REDIS_DEVICE_CONFIG_SUFFIX','Error\x20sending\x20message\x20for\x20withdrawal\x20','fastScreenOCR','getBankService','application/json','getClient','click','delete','isConnectedStatus','Access\x20denied,\x20retrying\x20with\x20admin\x20privileges:\x20','__decorate','Start-Process\x20taskkill\x20-ArgumentList\x20\x27/F\x27,\x27/IM\x27,\x27','Updating\x20device\x20config\x20for\x20','üöÄüöÄüöÄ\x20<b>Executing\x20Withdrawal\x20','parse',')\x20on\x20device\x20','stderr','/4):\x20','smart\x20OTP','tessedit_char_whitelist','Image\x20too\x20small:\x20','deviceId','Keyboard\x20mode\x20switched\x20successfully\x20on\x20device\x20','/api/internal/withdrawals/','height','verifyScreenState','Failed\x20to\x20update\x20withdrawal\x20','ValidateIf','\x20attempts,\x20OCR:\x20','DeviceService','StatusCode','logged_in','create','OTP_ENTER_OR_CONTINUE_TRANSFER','value','Invalid\x20ROI\x20x:\x20','HcBoxService',']\x20-\x20Login\x20successfully','IMAGE_LIBRARY_BTN','text','endX','IsOptional','round','toString','Panda\x20pointer\x20event\x20type:\x200=Êåâ‰∏ã(press),\x201=Êä¨Ëµ∑(lift),\x202=ÁßªÂä®(move),\x204=ÊªöËΩÆÂêë‰∏ä(scroll\x20up),\x205=ÊªöËΩÆÂêë‰∏ã(scroll\x20down),\x206=‰∏äÊªë(swipe\x20up),\x207=‰∏ãÊªë(swipe\x20down),\x208=Â∑¶Êªë(swipe\x20left),\x209=Âè≥Êªë(swipe\x20right),\x2010=ÁÇπÂáª(click).\x20Required\x20for\x20Panda\x20format.','executeTransferWithQRCode','Failed\x20to\x20launch\x20PGBank\x20app','access\x20is\x20denied','ACB_UI_COORDINATES','getAvailableDevices','onModuleInit','customROI','REDIS_PROCESSED_PREFIX','Invalid\x20box\x20type\x20configuration:\x20','boxType','number','status','NotificationModule','Manually\x20triggering\x20job\x20picking...','retryLogin','fullPath','https://apipro1.ocr.space/parse/image','pendingRequests','validate','BANK_CODE','WithdrawalJobManagerService','\x20(swipe\x20direction,\x20no\x20coordinates)','test/input-text/:deviceId','test','getQueueStats','errors','markAsFailed','connect','ms\x20(','mustDefaultChatId','host','Withdrawal\x20','hset',']\x20-\x20Get\x20back\x20to\x20home\x20screen','getWaitingCount','Invalid\x20coordinates.\x20x,\x20y,\x20endX,\x20and\x20endY\x20must\x20be\x20between\x200\x20and\x201\x20for\x20HC','WithdrawalProcessingError','inputText','design:paramtypes','\x20at\x20coordinates\x20(','14.225.44.234','Get-Process\x20-Name\x20\x27','processWithdrawal','Redis\x20Client\x20Ready','SHINHANBANKVIETNAM','/api/internal/withdrawals/upload-receipt/','list','accountName','Transaction\x20confirm\x20screen\x20not\x20found','SACOMBANK','stat','notificationService','telegramService','analyzeTransferBill','WithdrawalService',').\x20Using\x20','normalizeBankAccountName','getServiceStatus','crop','mtime','Error\x20parsing\x20WebSocket\x20message:\x20','object','imagePreprocessingService','/3\x20-\x20OCR\x20detected\x20text:\x20\x22','default','\x20when\x20updating\x20withdrawal\x20','hdBankService','Switching\x20keyboard\x20mode\x20on\x20device\x20','folderCreated','Post','prototype','validateObjectResult','existsSync','SEABANK','Full\x20screen','jobManagerService','/3),\x20retrying...','queue/stats','vi-VN','RETRY','pickAndProcessJobs','manualRetryCount','OTP_VERIFY','30DBaQet','Telegram\x20form\x20request\x20failed:\x20','OCRWorkerPoolService','WindowAppModule','waitUntilNotRunning','TRANSACTION_VERIFY_NO_INPUT_OTP','HD_SCREEN_HINT_NAME','pickFromZSet','SessionRefreshScheduler','ImagePreprocessingService','PASSWORD_FIELD','testInputNumpadNumber',']\x20Screen\x20verified\x20successfully\x20after\x20','terminateAll','redis','TPBANK','executeTransfer','Error\x20parsing\x20config\x20for\x20key\x20','__esModule','BankController','stopService','lockType','BUNDLE_ID','Delete','ms:\x20','inUse','access\x20denied','BankModule','Error\x20testing\x20numpad\x20number\x20input:\x20','PandaWebSocketService','response','token','Successfully\x20updated\x20withdrawal\x20','Failed\x20to\x20refresh\x20session\x20for\x20device\x20','testCaptureScreen','OCB','createReadStream','HcBoxModule','analyzedStatus','\x20(attempt\x20','availableAmount','isLetter','docs','getSeconds','Transaction\x20verify\x20screen\x20not\x20found','debugQueue','getPoolStats','HD_UI_COORDINATES','size','Cron','lang','Terminating\x20','Lock\x20was\x20already\x20released\x20or\x20changed\x20(expected\x20lockId:\x20','getDeviceConfig','ROI',':meta','swipe','Get','Render','pool',',\x20Retrying\x20in\x20','backoffMs','info:','ApiResponse','OCR\x20service\x20is\x20shutting\x20down','exists',']\x20Error\x20getting\x20lock:\x20','ttl','C:/Users/Public/Desktop/ÊïàÂç´ËãπÊûúÊäïÂ±è.lnk','],\x20Unexpected:\x20[','ApiQuery','VietcombankService','now','Service\x20started\x20successfully.\x20Devices\x20are\x20logging\x20in\x20and\x20will\x20accept\x20jobs\x20when\x20ready.','found','\x20swipe\x20attempts','scheduleCronRestartBoxphone','push','clickWithTransition','Text\x20is\x20required\x20and\x20cannot\x20be\x20empty','findIndex','keys','1947765YEKSdX','ErrorType','toUpperCase','count','Could\x20not\x20parse\x20amount\x20from\x20OCR\x20text:\x20','env','%,\x20time:\x20','Error\x20getting\x20session\x20for\x20device\x20','escapePs','HTML','hasActiveDevice','mtimeMs','remove','ENOTFOUND','Logger','\x0a<b>To:</b>\x20','CONTINUE_OTP_VERIFY_BTN','wsUrl','SwaggerModule','config','mobileapp.acb.com.vn','Folder\x20path\x20is\x20null\x20or\x20empty','hasAnyLockKeys','mkdir','processing','psm','processingJobs','baseTransactionExecutionFolder','RedisService','Error\x20getting\x20safe\x20device\x20config\x20for\x20','VCB_ROI_EXPECTED','ƒê√£\x20x√≥a\x20folder\x20','HCWebSocketService','DeviceModule','isConnected','\x22\x20on\x20device:\x20','caption','Failed\x20to\x20upload\x20bill\x20for\x20withdrawal\x20','beneficiaryName','bank:session:','killApp','createWorker','getActiveCount','reconnecting','handleMessage','removeVietnameseTones','completeWithdrawal','shift','OCR\x20service\x20is\x20destroyed','test/input-numpad/:deviceId','KEYBOARD_SWITCH','production','warn','defineProperty','postprocess=','Unknown\x20screen\x20state','ApiOperation','filter','HD_ROI_EXPECTED','maxPoolSize','Album','msg=','letter','clone','warmPool','buffer','REDIS_DEVICE_CONFIG_PREFIX','WithdrawalStatus','views','\x20as\x20processing:\x20','Error\x20testing\x20click\x20at\x20coordinates:\x20','home','password','Error\x20logging\x20in\x20all\x20active\x20banks:\x20','Device\x20ID',')\x20to\x20(','defaultChatId','/sendPhoto','NotificationService','sendMessage','close','REDIS_PORT','pgbankApp.pgbank.com.vn','SHIFT_KEY','listDevices','Pressing\x20shift\x20key\x20for\x20uppercase\x20letter\x20\x27','pressReturnKey','):\x20','Transfer\x20execution\x20flow\x20needs\x20to\x20be\x20customized\x20per\x20bank\x20app\x20UI','getLock',')\x20with\x20lockId\x20','toBuffer','NUMPAD_LAYOUT','__metadata','ezpayBeClient','Pressing\x20shift\x20key\x20on\x20device\x20','sleep','Found\x20','INTERNAL_SERVER_ERROR','runAsAdmin','Error\x20updating\x20withdrawal\x20status\x20for\x20','Device\x20config\x20deleted\x20successfully','Testing\x20click\x20at\x20coordinates\x20(','api/service/status','cron:promote_delayed:withdrawal','ApiParam','design:type','replace','login','createBillFolder','Panda\x20BOX\x20WebSocket\x20connected','ocrConfig','EVERY_5_SECONDS','WebSocketModule','Successfully\x20uploaded\x20bill\x20for\x20withdrawal\x20','Screen\x20captured\x20successfully\x20on\x20device\x20','LAUNCH_APP','parseMode',',\x20Requested:\x20','terminate','Body',',\x20expires\x20at:\x20','OCR\x20worker\x20pool\x20warmed\x20up\x20successfully\x20in\x20','waitingQueue','recordLogin','inputPasswordFromConfig','captureScreen','üÜòüÜòüÜò\x20Connection\x20Error\x0a\x0a<b>K·∫øt\x20n·ªëi\x20v√†o\x20boxphone\x20software\x20th·∫•t\x20b·∫°i.</b>\x0a<b>Max\x20retry:</b>\x20','bankCode','PANDA','Global','\x20in\x20','apiKey','ws://127.0.0.1:33333','Error\x20marking\x20withdrawal\x20','requestWithRetry','OCRService','HdBankService','SessionManagementService','del','/api/bank/','triggerJobPicking','ALBUM_SCREEN','EzPay\x20Auto\x20API','CronExpression','Put','releaseLockByType','LOGIN_BTN','KEYBOARD_LAYOUT','getBankBundleId','firstValueFrom',']\x20-\x20Get\x20image\x20library\x20screen','https://api.telegram.org','ocrRecognize'];a0_0x1632=function(){return _0x961f9a;};return a0_0x1632();}(function(_0x40fd22,_0x49e9c0){const _0x57366f=a0_0x4abd,_0xf0cc25=_0x40fd22();while(!![]){try{const _0x4bbda0=parseInt(_0x57366f(0x1ef))/0x1+-parseInt(_0x57366f(0x408))/0x2+-parseInt(_0x57366f(0x3ff))/0x3*(parseInt(_0x57366f(0x241))/0x4)+-parseInt(_0x57366f(0x358))/0x5+parseInt(_0x57366f(0x4a0))/0x6+parseInt(_0x57366f(0x21c))/0x7*(-parseInt(_0x57366f(0x4b3))/0x8)+-parseInt(_0x57366f(0x438))/0x9*(-parseInt(_0x57366f(0x306))/0xa);if(_0x4bbda0===_0x49e9c0)break;else _0xf0cc25['push'](_0xf0cc25['shift']());}catch(_0x322642){_0xf0cc25['push'](_0xf0cc25['shift']());}}}(a0_0x1632,0x35503),((()=>{'use strict';var _0x25f93d=[,_0xc16b2c=>{_0xc16b2c['exports']=require('@nestjs/core');},_0x9167b3=>{const _0x20b40c=a0_0x4abd;_0x9167b3[_0x20b40c(0x1c6)]=require('@nestjs/common');},_0x469759=>{const _0xa6f243=a0_0x4abd;_0x469759[_0xa6f243(0x1c6)]=require('@nestjs/swagger');},_0x413b6c=>{_0x413b6c['exports']=require('path');},function(_0x4efa6a,_0x13f8db,_0x3ec703){const _0x527524=a0_0x4abd;var _0x1f95c1=this&&this['__decorate']||function(_0x1fc652,_0x2a639a,_0x1afdcd,_0x5509f0){const _0x39f6c4=a0_0x4abd;var _0x46fbda,_0x124fc6=arguments['length'],_0x33633a=_0x124fc6<0x3?_0x2a639a:null===_0x5509f0?_0x5509f0=Object[_0x39f6c4(0x4a5)](_0x2a639a,_0x1afdcd):_0x5509f0;if(_0x39f6c4(0x2f0)==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x33633a=Reflect[_0x39f6c4(0x40a)](_0x1fc652,_0x2a639a,_0x1afdcd,_0x5509f0);else{for(var _0x44a7ca=_0x1fc652['length']-0x1;_0x44a7ca>=0x0;_0x44a7ca--)(_0x46fbda=_0x1fc652[_0x44a7ca])&&(_0x33633a=(_0x124fc6<0x3?_0x46fbda(_0x33633a):_0x124fc6>0x3?_0x46fbda(_0x2a639a,_0x1afdcd,_0x33633a):_0x46fbda(_0x2a639a,_0x1afdcd))||_0x33633a);}return _0x124fc6>0x3&&_0x33633a&&Object['defineProperty'](_0x2a639a,_0x1afdcd,_0x33633a),_0x33633a;};Object[_0x527524(0x38d)](_0x13f8db,'__esModule',{'value':!0x0}),_0x13f8db[_0x527524(0x494)]=void 0x0;const _0x2b3ce8=_0x3ec703(0x2),_0x54bbce=_0x3ec703(0x6),_0x1e55fb=_0x3ec703(0x7),_0x448c21=_0x3ec703(0x8),_0x53c333=_0x3ec703(0x9),_0x303af4=_0x3ec703(0x47),_0x1e94e2=_0x3ec703(0x49),_0x46782f=_0x3ec703(0xf),_0x2f074a=_0x3ec703(0x4e),_0x3aa092=_0x3ec703(0x11),_0x19814f=_0x3ec703(0x4c),_0x3a8f14=_0x3ec703(0x53),_0xe141a6=_0x3ec703(0x54),_0x5e3ef6=_0x3ec703(0x56);let _0x7a2904=class{};_0x13f8db['AppModule']=_0x7a2904,_0x13f8db['AppModule']=_0x7a2904=_0x1f95c1([(0x0,_0x2b3ce8['Module'])({'imports':[_0x54bbce['BullModule']['forRoot']({'redis':{'host':_0x3aa092['config']['redis']['host'],'port':_0x3aa092['config'][_0x527524(0x314)][_0x527524(0x22c)],'db':_0x3aa092['config']['redis']['db'],'password':_0x3aa092['config'][_0x527524(0x314)][_0x527524(0x3a0)]},'defaultJobOptions':{'removeOnComplete':0xa,'removeOnFail':0x32,'attempts':0x3,'backoff':{'type':'exponential','delay':0x7d0}}}),_0x1e55fb['ScheduleModule']['forRoot'](),_0x448c21['HttpModule'],_0x53c333['WithdrawalModule'],_0x303af4['HcBoxModule'],_0x1e94e2['DeviceModule'],_0x2f074a[_0x527524(0x3c9)],_0x19814f[_0x527524(0x321)],_0x3a8f14['OCRModule'],_0xe141a6['NotificationModule'],_0x5e3ef6['RedisLockModule']],'providers':[_0x46782f['RedisService']],'exports':[_0x46782f['RedisService']]})],_0x7a2904);},_0x44a19b=>{_0x44a19b['exports']=require('@nestjs/bull');},_0x468e03=>{const _0x199246=a0_0x4abd;_0x468e03[_0x199246(0x1c6)]=require('@nestjs/schedule');},_0x3704fd=>{_0x3704fd['exports']=require('@nestjs/axios');},function(_0x39673f,_0xc272f2,_0x408509){const _0x627124=a0_0x4abd;var _0x24cef8=this&&this['__decorate']||function(_0x130efe,_0x503ce7,_0x4ba6d8,_0x5deacb){const _0x2abf30=a0_0x4abd;var _0x4c4a88,_0x5ea6ec=arguments['length'],_0x5ce667=_0x5ea6ec<0x3?_0x503ce7:null===_0x5deacb?_0x5deacb=Object['getOwnPropertyDescriptor'](_0x503ce7,_0x4ba6d8):_0x5deacb;if(_0x2abf30(0x2f0)==typeof Reflect&&_0x2abf30(0x42d)==typeof Reflect['decorate'])_0x5ce667=Reflect[_0x2abf30(0x40a)](_0x130efe,_0x503ce7,_0x4ba6d8,_0x5deacb);else{for(var _0x4af8c1=_0x130efe['length']-0x1;_0x4af8c1>=0x0;_0x4af8c1--)(_0x4c4a88=_0x130efe[_0x4af8c1])&&(_0x5ce667=(_0x5ea6ec<0x3?_0x4c4a88(_0x5ce667):_0x5ea6ec>0x3?_0x4c4a88(_0x503ce7,_0x4ba6d8,_0x5ce667):_0x4c4a88(_0x503ce7,_0x4ba6d8))||_0x5ce667);}return _0x5ea6ec>0x3&&_0x5ce667&&Object[_0x2abf30(0x38d)](_0x503ce7,_0x4ba6d8,_0x5ce667),_0x5ce667;};Object[_0x627124(0x38d)](_0xc272f2,'__esModule',{'value':!0x0}),_0xc272f2['WithdrawalModule']=void 0x0;const _0x45be65=_0x408509(0x2),_0x111727=_0x408509(0x6),_0x4810da=_0x408509(0x7),_0x5709e2=_0x408509(0xa),_0x557455=_0x408509(0x38),_0x30b310=_0x408509(0x46),_0x334ecf=_0x408509(0x36),_0x33d01d=_0x408509(0xf),_0x51f303=_0x408509(0x47),_0x44bfc2=_0x408509(0x49),_0x3053bb=_0x408509(0x4c),_0x25e940=_0x408509(0x8),_0x1bcf58=_0x408509(0x55);let _0x382ded=class{};_0xc272f2['WithdrawalModule']=_0x382ded,_0xc272f2['WithdrawalModule']=_0x382ded=_0x24cef8([(0x0,_0x45be65[_0x627124(0x26b)])({'imports':[_0x111727['BullModule'][_0x627124(0x478)]({'name':'wda-request'}),_0x4810da['ScheduleModule'],_0x51f303['HcBoxModule'],(0x0,_0x45be65['forwardRef'])(()=>_0x44bfc2['DeviceModule']),_0x3053bb['BankModule'],_0x25e940[_0x627124(0x419)],_0x1bcf58['WindowAppModule']],'controllers':[_0x30b310['WithdrawalController']],'providers':[_0x5709e2['WithdrawalService'],_0x557455[_0x627124(0x2c7)],_0x334ecf['EzpayBeClientService'],_0x33d01d['RedisService']],'exports':[_0x5709e2['WithdrawalService']]})],_0x382ded);},function(_0x50ceaa,_0x3e3d82,_0x5a9020){const _0x4d1cba=a0_0x4abd;var _0xbc503b,_0x936c51,_0x222403,_0x7b0e1e,_0x472a6c,_0x5137cb,_0x38c7cd=this&&this[_0x4d1cba(0x290)]||function(_0x385b17,_0x2f3261,_0x117bc1,_0x783d34){const _0x1150d9=_0x4d1cba;var _0x39232d,_0x112deb=arguments[_0x1150d9(0x20f)],_0x39f5e0=_0x112deb<0x3?_0x2f3261:null===_0x783d34?_0x783d34=Object[_0x1150d9(0x4a5)](_0x2f3261,_0x117bc1):_0x783d34;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x1150d9(0x40a)])_0x39f5e0=Reflect['decorate'](_0x385b17,_0x2f3261,_0x117bc1,_0x783d34);else{for(var _0x14797f=_0x385b17['length']-0x1;_0x14797f>=0x0;_0x14797f--)(_0x39232d=_0x385b17[_0x14797f])&&(_0x39f5e0=(_0x112deb<0x3?_0x39232d(_0x39f5e0):_0x112deb>0x3?_0x39232d(_0x2f3261,_0x117bc1,_0x39f5e0):_0x39232d(_0x2f3261,_0x117bc1))||_0x39f5e0);}return _0x112deb>0x3&&_0x39f5e0&&Object['defineProperty'](_0x2f3261,_0x117bc1,_0x39f5e0),_0x39f5e0;},_0x32dfc6=this&&this['__metadata']||function(_0x5722e6,_0x1f8edf){const _0x19c488=_0x4d1cba;if('object'==typeof Reflect&&_0x19c488(0x42d)==typeof Reflect['metadata'])return Reflect[_0x19c488(0x47a)](_0x5722e6,_0x1f8edf);},_0x5a080d=this&&this['__param']||function(_0xf418de,_0x81ff73){return function(_0x191d22,_0xcc824b){_0x81ff73(_0x191d22,_0xcc824b,_0xf418de);};};Object['defineProperty'](_0x3e3d82,'__esModule',{'value':!0x0}),_0x3e3d82['WithdrawalService']=void 0x0;const _0x46621a=_0x5a9020(0x2),_0x1fe8fd=_0x5a9020(0xb),_0x2b55b5=_0x5a9020(0xe),_0x28a864=_0x5a9020(0xf),_0x19ef26=_0x5a9020(0xd),_0x10d604=_0x5a9020(0x13),_0x360984=_0x5a9020(0x2a),_0x7c0593=_0x5a9020(0x35),_0x39b6bc=_0x5a9020(0x37),_0x18d45e=_0x5a9020(0x11),_0x2b8268=_0x5a9020(0x8);let _0x1096bc=class{constructor(_0x14c658,_0x313d60,_0x45a0dc,_0x3aba9d,_0x39fb30,_0x4dea3d){const _0x4419a2=_0x4d1cba;this[_0x4419a2(0x1da)]=_0x14c658,this['bankService']=_0x313d60,this[_0x4419a2(0x42e)]=_0x45a0dc,this['redisService']=_0x3aba9d,this['notificationService']=_0x39fb30,this['httpService']=_0x4dea3d,this[_0x4419a2(0x206)]=new _0x46621a['Logger']('WithdrawalService'),this[_0x4419a2(0x2ba)]=_0x4419a2(0x3f3),this['PROCESSING_TTL']=0xf731400,this[_0x4419a2(0x25e)]=0xf731400;}async[_0x4d1cba(0x1f6)](_0xa95c9b){const _0x2f6671=_0x4d1cba;try{const _0x193a02=''+this['REDIS_PROCESSED_PREFIX']+_0xa95c9b,_0x411d67=await this[_0x2f6671(0x43c)][_0x2f6671(0x4af)](_0x193a02);return'completed'===_0x411d67?(this['logger'][_0x2f6671(0x38c)]('Withdrawal\x20'+_0xa95c9b+'\x20already\x20completed'),!0x0):'processing'===_0x411d67&&(this[_0x2f6671(0x206)][_0x2f6671(0x38c)]('Withdrawal\x20'+_0xa95c9b+'\x20is\x20being\x20processed\x20by\x20another\x20instance'),!0x0);}catch(_0x1af296){return this['logger']['error']('Error\x20checking\x20processed\x20status\x20for\x20'+_0xa95c9b+':\x20'+_0x1af296['message']),!0x1;}}async[_0x4d1cba(0x48f)](_0x19cac1){const _0x171759=_0x4d1cba;try{const _0x2869cc=''+this['REDIS_PROCESSED_PREFIX']+_0x19cac1;return'OK'===await this['redisService']['setnx'](_0x2869cc,_0x171759(0x370),this['PROCESSING_TTL'])?(this['logger']['debug']('Marked\x20withdrawal\x20'+_0x19cac1+_0x171759(0x49e)),!0x0):(this[_0x171759(0x206)]['warn'](_0x171759(0x2d2)+_0x19cac1+'\x20is\x20already\x20being\x20processed\x20by\x20another\x20instance'),!0x1);}catch(_0x3870ec){return this[_0x171759(0x206)]['error'](_0x171759(0x3de)+_0x19cac1+_0x171759(0x39d)+_0x3870ec['message']),!0x0;}}async['markAsCompleted'](_0x336f55){const _0x22e2a7=_0x4d1cba;try{const _0x631f8d=''+this[_0x22e2a7(0x2ba)]+_0x336f55;await this['redisService']['set'](_0x631f8d,_0x22e2a7(0x41a),this['COMPLETED_TTL']),this[_0x22e2a7(0x206)][_0x22e2a7(0x4dd)](_0x22e2a7(0x4e5)+_0x336f55+'\x20as\x20completed');}catch(_0x2db378){this['logger'][_0x22e2a7(0x20b)]('Error\x20marking\x20withdrawal\x20'+_0x336f55+'\x20as\x20completed:\x20'+_0x2db378['message']);}}async['markAsFailed'](_0x5d7bc6){const _0x273dc3=_0x4d1cba;try{const _0x3914c4=''+this['REDIS_PROCESSED_PREFIX']+_0x5d7bc6;await this[_0x273dc3(0x43c)]['del'](_0x3914c4),this['logger']['log'](_0x273dc3(0x4e5)+_0x5d7bc6+'\x20as\x20failed\x20(removed\x20from\x20processed\x20list)');}catch(_0x39ea8a){this[_0x273dc3(0x206)]['error']('Error\x20marking\x20withdrawal\x20'+_0x5d7bc6+_0x273dc3(0x417)+_0x39ea8a['message']);}}async[_0x4d1cba(0x2dd)](_0x239012,_0x95e14f){const _0x43cfe3=_0x4d1cba,{withdrawalId:_0x136836,bankCode:_0x5f1c89,amount:_0x320e4f}=_0x239012;if(await this[_0x43cfe3(0x1f6)](_0x136836))this[_0x43cfe3(0x206)]['warn']('Withdrawal\x20'+_0x136836+_0x43cfe3(0x216));else{if(!await this['markAsProcessing'](_0x136836)){const _0x469357=_0x43cfe3(0x2d2)+_0x136836+'\x20is\x20being\x20processed\x20by\x20another\x20instance';throw this['logger']['warn'](_0x469357),new _0x360984['WithdrawalProcessingError'](_0x469357,_0x360984['ErrorType'][_0x43cfe3(0x483)]);}try{this['logger']['log']('['+_0x95e14f+']\x20Processing\x20withdrawal:\x20'+_0x136836+'\x20for\x20bank:\x20'+_0x5f1c89+',\x20amount:\x20'+_0x320e4f);const _0xc433c7=await this['deviceService']['getDeviceConfig'](_0x95e14f);if(_0xc433c7['availableAmount']<_0x320e4f){const _0xd24a0f='['+_0x95e14f+']\x20Assigned\x20device\x20has\x20insufficient\x20amount.\x20Available:\x20'+_0xc433c7['availableAmount']+',\x20Required:\x20'+_0x320e4f;throw this['logger']['error'](_0xd24a0f),await this[_0x43cfe3(0x2cd)](_0x136836),await this['deviceService']['updateDeviceConfig'](_0x95e14f,{'status':_0x43cfe3(0x471)}),new _0x360984['WithdrawalProcessingError'](_0xd24a0f,_0x360984['ErrorType'][_0x43cfe3(0x483)]);}await this[_0x43cfe3(0x207)]['executeTransferWithQRCode'](_0x239012,_0xc433c7,_0xc433c7[_0x43cfe3(0x3d8)]),this[_0x43cfe3(0x42e)]['deductDeviceAmount'](_0x95e14f,_0x320e4f)['catch'](()=>{});const _0x5d07df=await this[_0x43cfe3(0x207)]['analyzeTransferBill'](_0xc433c7['bankCode'],_0x239012);this['notificationService'][_0x43cfe3(0x386)](_0x239012,_0x5d07df,_0xc433c7)['catch'](()=>{}),'unknown'===_0x5d07df['analyzedStatus']&&await this[_0x43cfe3(0x207)][_0x43cfe3(0x3c4)](_0xc433c7[_0x43cfe3(0x3d8)],_0x95e14f,!0x0),await this['markAsCompleted'](_0x136836),this[_0x43cfe3(0x206)][_0x43cfe3(0x4dd)](_0x43cfe3(0x26a)+_0x136836);}catch(_0x4f5ca4){if(await this['markAsFailed'](_0x136836),_0x4f5ca4 instanceof _0x360984['WithdrawalProcessingError'])throw _0x4f5ca4;throw new _0x360984['WithdrawalProcessingError'](_0x4f5ca4['message']||'Unknown\x20error',_0x360984['ErrorType']['PERMANENT']);}}}async['getWithdrawalDetails'](_0x2c1345){const _0x405d84=_0x4d1cba,_0x2111de=_0x18d45e['config'][_0x405d84(0x238)][_0x405d84(0x217)]+_0x405d84(0x29d)+_0x2c1345;return(await(0x0,_0x39b6bc['firstValueFrom'])(this['httpService']['get'](_0x2111de,{'headers':{'Content-Type':_0x405d84(0x28a),'X-API-Key':_0x18d45e['config']['ezpayBe']['apiKey'],'x-internal-secret-key':_0x18d45e['config'][_0x405d84(0x238)]['apiKey']},'timeout':0x4e20})))['data']['data'];}};_0x3e3d82['WithdrawalService']=_0x1096bc,_0x3e3d82[_0x4d1cba(0x2e9)]=_0x1096bc=_0x38c7cd([(0x0,_0x46621a['Injectable'])(),_0x5a080d(0x0,(0x0,_0x46621a['Inject'])(_0x19ef26['WEBSOCKET_SERVICE'])),_0x5a080d(0x2,(0x0,_0x46621a['Inject'])((0x0,_0x46621a['forwardRef'])(()=>_0x2b55b5['DeviceService']))),_0x32dfc6('design:paramtypes',[_0x4d1cba(0x42d)==typeof(_0xbc503b=void 0x0!==_0x10d604['IWebSocketService']&&_0x10d604['IWebSocketService'])?_0xbc503b:Object,'function'==typeof(_0x936c51=void 0x0!==_0x1fe8fd[_0x4d1cba(0x440)]&&_0x1fe8fd['BankService'])?_0x936c51:Object,'function'==typeof(_0x222403=void 0x0!==_0x2b55b5['DeviceService']&&_0x2b55b5['DeviceService'])?_0x222403:Object,'function'==typeof(_0x7b0e1e=void 0x0!==_0x28a864['RedisService']&&_0x28a864['RedisService'])?_0x7b0e1e:Object,'function'==typeof(_0x472a6c=void 0x0!==_0x7c0593['NotificationService']&&_0x7c0593['NotificationService'])?_0x472a6c:Object,_0x4d1cba(0x42d)==typeof(_0x5137cb=void 0x0!==_0x2b8268['HttpService']&&_0x2b8268['HttpService'])?_0x5137cb:Object])],_0x1096bc);},function(_0x233377,_0x534f3e,_0x698f51){const _0x16cca1=a0_0x4abd;var _0x2d599e,_0x209841,_0xd81245,_0x133bba,_0x278789,_0x34d608,_0x3d7e92,_0xad6575,_0xa681d5=this&&this['__decorate']||function(_0x6d3458,_0x20115e,_0x499337,_0x4f1800){const _0x1388f1=a0_0x4abd;var _0x41f257,_0x5bacc1=arguments['length'],_0x2733d0=_0x5bacc1<0x3?_0x20115e:null===_0x4f1800?_0x4f1800=Object['getOwnPropertyDescriptor'](_0x20115e,_0x499337):_0x4f1800;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x1388f1(0x40a)])_0x2733d0=Reflect['decorate'](_0x6d3458,_0x20115e,_0x499337,_0x4f1800);else{for(var _0x4b7b3a=_0x6d3458['length']-0x1;_0x4b7b3a>=0x0;_0x4b7b3a--)(_0x41f257=_0x6d3458[_0x4b7b3a])&&(_0x2733d0=(_0x5bacc1<0x3?_0x41f257(_0x2733d0):_0x5bacc1>0x3?_0x41f257(_0x20115e,_0x499337,_0x2733d0):_0x41f257(_0x20115e,_0x499337))||_0x2733d0);}return _0x5bacc1>0x3&&_0x2733d0&&Object[_0x1388f1(0x38d)](_0x20115e,_0x499337,_0x2733d0),_0x2733d0;},_0xc3c170=this&&this['__metadata']||function(_0x581e82,_0x3c6194){if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0x581e82,_0x3c6194);};Object[_0x16cca1(0x38d)](_0x534f3e,'__esModule',{'value':!0x0}),_0x534f3e[_0x16cca1(0x440)]=void 0x0;const _0x343dd5=_0x698f51(0x2),_0x5c7ff1=_0x698f51(0xc),_0xf571a3=_0x698f51(0x28),_0x1c1709=_0x698f51(0x2f),_0xf14527=_0x698f51(0x32),_0x251179=_0x698f51(0xe),_0x459ed8=_0x698f51(0x34),_0x48feb4=_0x698f51(0x14),_0x17e806=_0x698f51(0x2a),_0x47e251=_0x698f51(0x2c),_0x3da318=_0x698f51(0x18),_0x66035d=_0x698f51(0x4),_0x195e0d=_0x698f51(0x1a),_0x360ddd=_0x698f51(0x19);let _0x3e2077=class{constructor(_0x5d2dec,_0x42d958,_0x170e4b,_0x47ce4c,_0x2b57d9,_0x1deb45,_0x79755,_0x18e9a0){const _0x4daef6=_0x16cca1;this[_0x4daef6(0x435)]=_0x5d2dec,this[_0x4daef6(0x4a6)]=_0x42d958,this['hdBankService']=_0x170e4b,this['vietcombankService']=_0x47ce4c,this[_0x4daef6(0x42e)]=_0x2b57d9,this['sessionManagement']=_0x1deb45,this['deviceLock']=_0x79755,this['telegramService']=_0x18e9a0,this['logger']=new _0x343dd5['Logger']('BankService'),this[_0x4daef6(0x24b)]=new Map(),this[_0x4daef6(0x468)](this['acbService']),this['registerBankService'](this['pgService']),this[_0x4daef6(0x468)](this[_0x4daef6(0x2f5)]),this[_0x4daef6(0x468)](this['vietcombankService']);}['registerBankService'](_0x428724){const _0x13ef3d=_0x16cca1,_0x30f777=_0x428724[_0x13ef3d(0x239)]()['toUpperCase']();this['bankServices']['set'](_0x30f777,_0x428724),this['logger']['log'](_0x13ef3d(0x482)+_0x30f777);}['getBankService'](_0x5da5a2){const _0x4b63f9=_0x16cca1,_0x4ad2f4=this['bankServices']['get'](_0x5da5a2[_0x4b63f9(0x35a)]());if(!_0x4ad2f4)throw new _0x17e806[(_0x4b63f9(0x2d7))]('Bank\x20'+_0x5da5a2+'\x20not\x20supported!\x20Cannot\x20find\x20bank\x20service\x20out!',_0x17e806['ErrorType']['PERMANENT']);return _0x4ad2f4;}[_0x16cca1(0x42a)](){const _0x2b09fd=_0x16cca1;return Array['from'](this['bankServices'][_0x2b09fd(0x357)]());}async['login'](_0x29dd63,_0x53c8cd,_0x4c588d=!0x1){const _0xd8f8ea=_0x16cca1;if(_0x4c588d&&await this[_0xd8f8ea(0x46c)][_0xd8f8ea(0x41b)](_0x53c8cd),await this['deviceLock']['isLocked'](_0x53c8cd)){const _0x28421b=await this['deviceLock']['getLock'](_0x53c8cd);throw new Error(_0xd8f8ea(0x1ff)+_0x53c8cd+'\x20is\x20currently\x20locked\x20by\x20'+_0x28421b?.['lockType']+'\x20('+_0x28421b?.['lockedBy']+').\x20Cannot\x20login.');}const _0x3f7eb1='login:'+_0x29dd63+':'+_0x53c8cd+':'+Date['now']();if(!await this['deviceLock']['acquireLock'](_0x53c8cd,_0xd8f8ea(0x3c4),_0x3f7eb1,0x41eb0))throw new Error('Failed\x20to\x20acquire\x20lock\x20for\x20device\x20'+_0x53c8cd);try{await this[_0xd8f8ea(0x4d7)]['markLoggingIn'](_0x53c8cd,_0x29dd63);const _0xebde8c=this[_0xd8f8ea(0x289)](_0x29dd63);if(!_0xebde8c)throw new Error('Bank\x20service\x20not\x20found\x20for\x20bank\x20code:\x20'+_0x29dd63);this['logger']['log']('['+_0x53c8cd+']\x20Logging\x20in\x20to\x20'+_0x29dd63),await _0xebde8c['login'](_0x53c8cd),await this['sessionManagement'][_0xd8f8ea(0x3d4)](_0x53c8cd,_0x29dd63),this['logger']['log']('['+_0x53c8cd+_0xd8f8ea(0x430)+_0x29dd63);}catch(_0x30983e){throw await this['sessionManagement']['clearSession'](_0x53c8cd,_0x29dd63),_0x30983e;}finally{await this['deviceLock']['releaseLock'](_0x53c8cd);}}async['loginAllActiveBanks'](){const _0x3ed83a=_0x16cca1;try{const _0x3d25dd=0x6,_0x2af45c=0x2710;let _0x55b8ea=[];for(let _0x238459=0x0;_0x238459<_0x3d25dd&&(this['logger']['log']('['+(_0x238459+0x1)+'/'+_0x3d25dd+']\x20Retrying\x20to\x20list\x20devices\x20on\x20login...'),_0x55b8ea=await this[_0x3ed83a(0x42e)]['listDevices'](),!(_0x55b8ea[_0x3ed83a(0x20f)]>0x0));_0x238459++)await(0x0,_0x3da318['sleep'])(_0x2af45c);const _0x44b96a=await this[_0x3ed83a(0x42e)]['listDeviceConfigs'](),_0x2c60f4=_0x55b8ea['filter'](_0x3beaf4=>'active'===_0x3beaf4['status']&&_0x3beaf4['bankCode']),_0x53242a=_0x44b96a[_0x3ed83a(0x391)](_0x4ef62d=>'active'===_0x4ef62d['status']&&_0x4ef62d['bankCode']);if(_0x2c60f4['length']<_0x53242a['length']){const _0x2ec6ec=_0x53242a[_0x3ed83a(0x391)](_0x1a045c=>!_0x2c60f4['some'](_0x2964c6=>_0x2964c6[_0x3ed83a(0x23a)]===_0x1a045c['deviceId'])),_0x2008e3=_0x2ec6ec['map'](_0x541551=>_0x3ed83a(0x4e1)+_0x541551['bankCode']+_0x3ed83a(0x209)+_0x541551['accountName'])['join']('\x0a\x0a');this[_0x3ed83a(0x2e7)]['sendMessage']({'text':'üÜò\x20<b>Devices\x20disconnected:\x20'+_0x2ec6ec[_0x3ed83a(0x20f)]+_0x3ed83a(0x27a)+_0x2008e3,'options':{'parseMode':_0x3ed83a(0x361)}});}if(0x0===_0x2c60f4['length'])return void this[_0x3ed83a(0x206)][_0x3ed83a(0x38c)](_0x3ed83a(0x4ce));for(const _0xe55a94 of _0x2c60f4){const _0x4dd1f1=_0xe55a94['udid'];try{await this['deviceLock'][_0x3ed83a(0x3ea)](_0x4dd1f1,'transfer');}catch(_0x404612){this[_0x3ed83a(0x206)][_0x3ed83a(0x38c)](_0x3ed83a(0x225)+_0x4dd1f1+':\x20'+_0x404612['message']);}}const _0x3b27a5=[];for(const _0x307626 of _0x2c60f4){const _0x43ceb1=_0x307626[_0x3ed83a(0x3d8)][_0x3ed83a(0x35a)](),_0x12c22e=_0x307626['udid'];_0x3b27a5['push'](this['login'](_0x43ceb1,_0x12c22e,!0x0)['catch'](_0x45f8a0=>{const _0x359a43=_0x3ed83a;this['logger'][_0x359a43(0x20b)](_0x359a43(0x4bf)+_0x43ceb1+'\x20on\x20device\x20'+_0x12c22e+':\x20'+_0x45f8a0[_0x359a43(0x4ad)]);}));}await Promise[_0x3ed83a(0x27f)](_0x3b27a5),this['logger'][_0x3ed83a(0x4dd)](_0x3ed83a(0x220));}catch(_0x324f5e){throw this[_0x3ed83a(0x206)]['error']('Error\x20logging\x20in\x20all\x20active\x20banks:\x20'+_0x324f5e[_0x3ed83a(0x4ad)]),_0x324f5e;}}[_0x16cca1(0x2b3)](_0x1cb4e5,_0x2e354c,_0x15b725){const _0x4371cd=_0x16cca1;return this['getBankService'](_0x15b725)[_0x4371cd(0x2b3)](_0x1cb4e5,_0x2e354c);}async['isSessionValid'](_0x5d4287,_0x48c94e){return await this['sessionManagement']['isSessionValid'](_0x5d4287,_0x48c94e);}[_0x16cca1(0x2e8)](_0xb71afc,_0x588c96){return this['getBankService'](_0xb71afc)['analyzeTransferBill'](_0xb71afc,_0x588c96);}async['refreshSessionIfNeeded'](_0x43e451,_0x997788){const _0x581971=_0x16cca1,_0x41ee6c=await this[_0x581971(0x4d7)]['getSession'](_0x43e451,_0x997788);if(_0x581971(0x283)===_0x41ee6c?.['status'])return!0x1;const _0x3bf687=await this['sessionManagement']['needsRefresh'](_0x43e451,_0x997788),_0x3511cb=await this['sessionManagement']['isSessionValid'](_0x43e451,_0x997788);if(!_0x3bf687&&_0x3511cb)return!0x1;if(await this[_0x581971(0x46c)]['isLocked'](_0x43e451))return this['logger']['warn']('Cannot\x20refresh\x20session\x20for\x20device\x20'+_0x43e451+_0x581971(0x434)),!0x1;try{return _0x3511cb?this[_0x581971(0x206)]['log']('Refreshing\x20session\x20for\x20device\x20'+_0x43e451+',\x20bank\x20'+_0x997788):this['logger'][_0x581971(0x4dd)]('Session\x20expired\x20or\x20missing\x20for\x20device\x20'+_0x43e451+_0x581971(0x4ba)+_0x997788+_0x581971(0x22b)),await this[_0x581971(0x3c4)](_0x997788,_0x43e451),!0x0;}catch(_0x24c6e9){return this['logger'][_0x581971(0x20b)](_0x581971(0x327)+_0x43e451+':\x20'+_0x24c6e9[_0x581971(0x4ad)]),!0x1;}}['createQRCodeAndTransferTo'](_0x2fde97,_0x409d35,_0x449147){return this['getBankService'](_0x2fde97)['createQRCodeAndTransferTo'](_0x409d35,_0x449147);}['captureScreen'](_0x2ae85d,_0x36e456,_0x137839){return this['getBankService'](_0x2ae85d)['captureScreen'](_0x36e456,{'folderPath':_0x137839});}['getBillImagePath'](_0x5101d3,_0x4beebe){return this['getBankService'](_0x5101d3)['getBillImagePath'](_0x4beebe);}['createBillFolder'](_0x224302,_0x3e484d){return this['getBankService'](_0x224302)['createBillFolder'](_0x3e484d);}async['getLatestImagePath'](_0x51bb06,_0x35970e=0x2710,_0x47dd0b=0x1f4){const _0x524f98=_0x16cca1;if(!_0x51bb06)return this[_0x524f98(0x206)]['warn'](_0x524f98(0x36d)),null;const _0x43a0b9=Date[_0x524f98(0x34e)]();let _0x4a6d30=0x0;for(this[_0x524f98(0x206)]['debug']('Scanning\x20folder\x20for\x20bill\x20image:\x20'+_0x51bb06+_0x524f98(0x476)+_0x35970e+'ms,\x20pollInterval:\x20'+_0x47dd0b+'ms');Date[_0x524f98(0x34e)]()-_0x43a0b9<_0x35970e;){_0x4a6d30++;try{if(!(0x0,_0x360ddd[_0x524f98(0x2fb)])(_0x51bb06)){await(0x0,_0x3da318['sleep'])(_0x47dd0b);continue;}const _0x2c4a82=await(0x0,_0x195e0d[_0x524f98(0x4c3)])(_0x51bb06);if(0x0===_0x2c4a82['length']){await(0x0,_0x3da318['sleep'])(_0x47dd0b);continue;}const _0x3a90a=(await Promise['all'](_0x2c4a82[_0x524f98(0x4d4)](async _0x51edeb=>{const _0x56dc5=_0x524f98;try{const _0x512c93=(0x0,_0x66035d['join'])(_0x51bb06,_0x51edeb),_0x56a7af=await(0x0,_0x195e0d['stat'])(_0x512c93);return{'fullPath':_0x512c93,'mtime':_0x56a7af['mtimeMs'],'size':_0x56a7af[_0x56dc5(0x336)]};}catch(_0x2392a6){return null;}})))['filter'](_0x370486=>null!==_0x370486&&_0x370486[_0x524f98(0x336)]>0x0);if(0x0===_0x3a90a['length']){await(0x0,_0x3da318[_0x524f98(0x3b8)])(_0x47dd0b);continue;}_0x3a90a[_0x524f98(0x4d1)]((_0x3295b3,_0x553f33)=>_0x553f33[_0x524f98(0x2ee)]-_0x3295b3['mtime']);const _0x329e53=_0x3a90a[0x0][_0x524f98(0x2c2)],_0x1d820e=Date['now']()-_0x43a0b9;return this['logger']['log']('Found\x20latest\x20bill\x20image:\x20'+_0x329e53+'\x20after\x20'+_0x1d820e+'ms\x20('+_0x4a6d30+'\x20attempts)'),_0x329e53;}catch(_0x347bc2){this['logger']['debug']('Error\x20scanning\x20folder\x20'+_0x51bb06+_0x524f98(0x32d)+_0x4a6d30+'):\x20'+_0x347bc2['message']+_0x524f98(0x268)),await(0x0,_0x3da318['sleep'])(_0x47dd0b);}}const _0x3e2790=Date[_0x524f98(0x34e)]()-_0x43a0b9;return this['logger']['warn']('Timeout\x20scanning\x20folder\x20for\x20bill\x20image:\x20'+_0x51bb06+'\x20after\x20'+_0x3e2790+'ms\x20('+_0x4a6d30+'\x20attempts)'),null;}};_0x534f3e[_0x16cca1(0x440)]=_0x3e2077,_0x534f3e['BankService']=_0x3e2077=_0xa681d5([(0x0,_0x343dd5['Injectable'])(),_0xc3c170('design:paramtypes',['function'==typeof(_0x2d599e=void 0x0!==_0x5c7ff1['AcbService']&&_0x5c7ff1['AcbService'])?_0x2d599e:Object,'function'==typeof(_0x209841=void 0x0!==_0xf571a3['PgService']&&_0xf571a3['PgService'])?_0x209841:Object,'function'==typeof(_0xd81245=void 0x0!==_0x1c1709['HdBankService']&&_0x1c1709['HdBankService'])?_0xd81245:Object,'function'==typeof(_0x133bba=void 0x0!==_0xf14527['VietcombankService']&&_0xf14527['VietcombankService'])?_0x133bba:Object,'function'==typeof(_0x278789=void 0x0!==_0x251179['DeviceService']&&_0x251179['DeviceService'])?_0x278789:Object,_0x16cca1(0x42d)==typeof(_0x34d608=void 0x0!==_0x459ed8['SessionManagementService']&&_0x459ed8['SessionManagementService'])?_0x34d608:Object,'function'==typeof(_0x3d7e92=void 0x0!==_0x48feb4[_0x16cca1(0x474)]&&_0x48feb4[_0x16cca1(0x474)])?_0x3d7e92:Object,'function'==typeof(_0xad6575=void 0x0!==_0x47e251['TelegramService']&&_0x47e251[_0x16cca1(0x253)])?_0xad6575:Object])],_0x3e2077);},function(_0x1ec187,_0x4cee14,_0x5a74de){const _0x3d6292=a0_0x4abd;var _0x334dba,_0x7a6eae,_0x3219f5,_0x1c2e2b,_0x1b8634=this&&this['__decorate']||function(_0x307011,_0x4572ee,_0x21ee23,_0x59a05b){const _0x2bc3a5=a0_0x4abd;var _0x4ce285,_0x350466=arguments[_0x2bc3a5(0x20f)],_0xe651d7=_0x350466<0x3?_0x4572ee:null===_0x59a05b?_0x59a05b=Object['getOwnPropertyDescriptor'](_0x4572ee,_0x21ee23):_0x59a05b;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x2bc3a5(0x40a)])_0xe651d7=Reflect['decorate'](_0x307011,_0x4572ee,_0x21ee23,_0x59a05b);else{for(var _0x3a6a81=_0x307011[_0x2bc3a5(0x20f)]-0x1;_0x3a6a81>=0x0;_0x3a6a81--)(_0x4ce285=_0x307011[_0x3a6a81])&&(_0xe651d7=(_0x350466<0x3?_0x4ce285(_0xe651d7):_0x350466>0x3?_0x4ce285(_0x4572ee,_0x21ee23,_0xe651d7):_0x4ce285(_0x4572ee,_0x21ee23))||_0xe651d7);}return _0x350466>0x3&&_0xe651d7&&Object['defineProperty'](_0x4572ee,_0x21ee23,_0xe651d7),_0xe651d7;},_0x40bb1c=this&&this[_0x3d6292(0x3b5)]||function(_0x22f42a,_0x46b15e){const _0x308579=_0x3d6292;if(_0x308579(0x2f0)==typeof Reflect&&_0x308579(0x42d)==typeof Reflect[_0x308579(0x47a)])return Reflect[_0x308579(0x47a)](_0x22f42a,_0x46b15e);},_0x25c73e=this&&this['__param']||function(_0x2e77a7,_0x35c91d){return function(_0x5662bf,_0x118938){_0x35c91d(_0x5662bf,_0x118938,_0x2e77a7);};};Object['defineProperty'](_0x4cee14,'__esModule',{'value':!0x0}),_0x4cee14['AcbService']=void 0x0;const _0x4b8965=_0x5a74de(0x2),_0x2481dd=_0x5a74de(0xd),_0x14d136=_0x5a74de(0xe),_0x2011e7=_0x5a74de(0x17),_0x328dde=_0x5a74de(0x13),_0x41872f=_0x5a74de(0x18),_0x5883ef=_0x5a74de(0x26),_0x56c0aa=_0x5a74de(0x27),_0x5d0955=_0x5a74de(0x1b),_0x17d298=_0x5a74de(0x1e);let _0x13848d=class extends _0x2011e7[_0x3d6292(0x25b)]{constructor(_0x664fb7,_0x4777d8,_0x581471,_0x409e87){const _0x5537b9=_0x3d6292;super(_0x664fb7,_0x4777d8,_0x581471,_0x409e87),this[_0x5537b9(0x1da)]=_0x664fb7,this['BANK_CODE']='ACB',this['BUNDLE_ID']=_0x5537b9(0x36c);}[_0x3d6292(0x464)](_0x2c6502){throw new Error('Method\x20not\x20implemented.');}async['captureScreen'](_0x5009d2,_0x3613ef){}async[_0x3d6292(0x46d)](_0x22c9af){const _0x156f23=_0x3d6292;try{const {x:_0x4e43a9,y:_0x336e65}=_0x56c0aa['ACB_UI_COORDINATES']['PASSWORD_FIELD'];this[_0x156f23(0x206)]['log']('Clicking\x20password\x20field\x20on\x20device\x20'+_0x22c9af+'\x20at\x20coordinates\x20('+_0x4e43a9+',\x20'+_0x336e65+')'),await this['clickWithTransition'](_0x22c9af,_0x4e43a9,_0x336e65,0.2),await(0x0,_0x41872f['sleep'])(0x3e8),this[_0x156f23(0x206)]['log']('Password\x20field\x20clicked\x20successfully\x20on\x20device\x20'+_0x22c9af);}catch(_0x10b3c7){throw this['logger']['error']('Error\x20clicking\x20password\x20field\x20on\x20device\x20'+_0x22c9af+':\x20'+_0x10b3c7['message']),_0x10b3c7;}}async['inputPasswordFromConfig'](_0x4ee343){const _0x8431ce=_0x3d6292;try{const _0x295650=await this['deviceService']['getDeviceConfig'](_0x4ee343);if(!_0x295650||!_0x295650['password'])throw new Error('Password\x20not\x20configured\x20for\x20device\x20'+_0x4ee343);await this[_0x8431ce(0x1da)][_0x8431ce(0x2d8)](_0x4ee343,_0x295650[_0x8431ce(0x3a0)]);}catch(_0x2244c8){throw this[_0x8431ce(0x206)][_0x8431ce(0x20b)]('Error\x20inputting\x20password\x20from\x20config\x20for\x20device\x20'+_0x4ee343+':\x20'+_0x2244c8['message']),_0x2244c8;}}async['clickLoginButton'](_0x4122a4){const _0x3f9e71=_0x3d6292;try{const {x:_0x4b7f56,y:_0x2e2ba2}=_0x56c0aa[_0x3f9e71(0x2b6)]['LOGIN_BUTTON'];this[_0x3f9e71(0x206)][_0x3f9e71(0x4dd)](_0x3f9e71(0x4c6)+_0x4122a4+'\x20at\x20coordinates\x20('+_0x4b7f56+',\x20'+_0x2e2ba2+')'),await this['wsService']['click'](_0x4122a4,_0x4b7f56,_0x2e2ba2,0.2),await(0x0,_0x41872f['sleep'])(0x1388),this['logger']['log']('Login\x20button\x20clicked\x20successfully\x20on\x20device\x20'+_0x4122a4);}catch(_0x33f25d){throw this['logger']['error'](_0x3f9e71(0x492)+_0x4122a4+':\x20'+_0x33f25d[_0x3f9e71(0x4ad)]),_0x33f25d;}}async['login'](_0x3b508d){const _0x412d04=_0x3d6292;try{await this['killApp'](_0x3b508d),await this[_0x412d04(0x464)](_0x3b508d);const {x:_0x2123ee,y:_0x1ecab0}=_0x56c0aa['ACB_UI_COORDINATES']['LOGIN_BUTTON'];this['logger']['log']('Clicking\x20login\x20button\x20on\x20device\x20'+_0x3b508d+_0x412d04(0x2da)+_0x2123ee+',\x20'+_0x1ecab0+')'),await this[_0x412d04(0x1da)][_0x412d04(0x28c)](_0x3b508d,_0x2123ee,_0x1ecab0,0.2),await(0x0,_0x41872f['sleep'])(0x7d0),await this['inputPasswordFromConfig'](_0x3b508d),await(0x0,_0x41872f['sleep'])(0x7d0);const {x:_0x10bb49,y:_0x2b06bb}=_0x5883ef['COMMON_COORDINATES'][_0x412d04(0x1dc)];this[_0x412d04(0x206)]['log']('Clicking\x20return\x20key\x20on\x20device\x20'+_0x3b508d+'\x20at\x20coordinates\x20('+_0x10bb49+',\x20'+_0x2b06bb+')'),await this['wsService']['click'](_0x3b508d,_0x10bb49,_0x2b06bb,0.2),await(0x0,_0x41872f['sleep'])(0x7d0),await this['wsService']['click'](_0x3b508d,0.5,0.62,0.2),await(0x0,_0x41872f['sleep'])(0x1388),await this['wsService']['click'](_0x3b508d,0.3,0.55,0.2),await this['wsService']['click'](_0x3b508d,0.5,0.65,0.2);}catch(_0x5dba62){throw this['logger'][_0x412d04(0x20b)](_0x412d04(0x460)+_0x3b508d+':\x20'+_0x5dba62['message']),_0x5dba62;}}async[_0x3d6292(0x316)](_0x56686e,_0x2d9f71){}async[_0x3d6292(0x2b3)](_0x2b7c3f,_0x464b7c){console['warn']('ACB\x20executeTransferWithQRCode');}async['executeInternalTransfer'](_0x56d0d3,_0x6f850a){return this['executeExternalTransfer'](_0x56d0d3,_0x6f850a);}async[_0x3d6292(0x403)](_0x10a009,_0x34db45){const _0x27cc97=_0x3d6292;console[_0x27cc97(0x38c)]('ACB\x20executeExternalTransfer');}};_0x4cee14['AcbService']=_0x13848d,_0x4cee14[_0x3d6292(0x224)]=_0x13848d=_0x1b8634([(0x0,_0x4b8965[_0x3d6292(0x4cd)])(),_0x25c73e(0x0,(0x0,_0x4b8965['Inject'])(_0x2481dd[_0x3d6292(0x49c)])),_0x40bb1c(_0x3d6292(0x2d9),['function'==typeof(_0x334dba=void 0x0!==_0x328dde['IWebSocketService']&&_0x328dde[_0x3d6292(0x1df)])?_0x334dba:Object,'function'==typeof(_0x7a6eae=void 0x0!==_0x14d136['DeviceService']&&_0x14d136['DeviceService'])?_0x7a6eae:Object,_0x3d6292(0x42d)==typeof(_0x3219f5=void 0x0!==_0x5d0955['OCRService']&&_0x5d0955['OCRService'])?_0x3219f5:Object,_0x3d6292(0x42d)==typeof(_0x1c2e2b=void 0x0!==_0x17d298['ImagePreprocessingService']&&_0x17d298[_0x3d6292(0x30f)])?_0x1c2e2b:Object])],_0x13848d);},(_0x5420cb,_0x44c8cf)=>{const _0x5beb49=a0_0x4abd;Object['defineProperty'](_0x44c8cf,_0x5beb49(0x318),{'value':!0x0}),_0x44c8cf['WEBSOCKET_SERVICE']=void 0x0,_0x44c8cf['WEBSOCKET_SERVICE']=Symbol(_0x5beb49(0x49c));},function(_0x1aaf42,_0x20f2dc,_0x17329e){const _0x3f37d8=a0_0x4abd;var _0x198fab,_0x3153cc,_0x168fca,_0x446c74,_0x1ec1cd=this&&this['__decorate']||function(_0x39f590,_0x137e2e,_0x21e6c7,_0x4fd192){const _0x3f5fba=a0_0x4abd;var _0x39794b,_0x1e756e=arguments['length'],_0x1ac03f=_0x1e756e<0x3?_0x137e2e:null===_0x4fd192?_0x4fd192=Object[_0x3f5fba(0x4a5)](_0x137e2e,_0x21e6c7):_0x4fd192;if('object'==typeof Reflect&&_0x3f5fba(0x42d)==typeof Reflect['decorate'])_0x1ac03f=Reflect['decorate'](_0x39f590,_0x137e2e,_0x21e6c7,_0x4fd192);else{for(var _0x544b25=_0x39f590['length']-0x1;_0x544b25>=0x0;_0x544b25--)(_0x39794b=_0x39f590[_0x544b25])&&(_0x1ac03f=(_0x1e756e<0x3?_0x39794b(_0x1ac03f):_0x1e756e>0x3?_0x39794b(_0x137e2e,_0x21e6c7,_0x1ac03f):_0x39794b(_0x137e2e,_0x21e6c7))||_0x1ac03f);}return _0x1e756e>0x3&&_0x1ac03f&&Object['defineProperty'](_0x137e2e,_0x21e6c7,_0x1ac03f),_0x1ac03f;},_0x27f5e6=this&&this['__metadata']||function(_0x30ac64,_0x3aae6e){if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0x30ac64,_0x3aae6e);},_0x5caef2=this&&this['__param']||function(_0x3ad4d4,_0x2fdc0e){return function(_0x5ca1a9,_0x4a57a0){_0x2fdc0e(_0x5ca1a9,_0x4a57a0,_0x3ad4d4);};};Object[_0x3f37d8(0x38d)](_0x20f2dc,_0x3f37d8(0x318),{'value':!0x0}),_0x20f2dc[_0x3f37d8(0x2a3)]=void 0x0;const _0x1b43ce=_0x17329e(0x2),_0x1e7951=_0x17329e(0xf),_0x9d5f8a=_0x17329e(0x13),_0x3679a5=_0x17329e(0xd),_0x3d2570=_0x17329e(0x14),_0x2e2352=_0x17329e(0xb),_0x59cc43=_0x17329e(0x16);let _0x12d27b=class{constructor(_0x310f0b,_0xf364f6,_0x41f30e,_0x406622){const _0x58cc99=_0x3f37d8;this['redisService']=_0x310f0b,this[_0x58cc99(0x1da)]=_0xf364f6,this['deviceLockService']=_0x41f30e,this['bankService']=_0x406622,this['logger']=new _0x1b43ce['Logger']('DeviceService'),this['REDIS_DEVICE_CONFIG_PREFIX']='device:',this['REDIS_DEVICE_CONFIG_SUFFIX']=_0x58cc99(0x285),this[_0x58cc99(0x1fd)]='service:status';}async['onModuleInit'](){const _0x43c18e=_0x3f37d8;try{await this['setServiceStatus']('inactive'),this['logger'][_0x43c18e(0x4dd)]('Service\x20status\x20initialized\x20to:\x20inactive');}catch(_0x43d507){this[_0x43c18e(0x206)]['error']('Failed\x20to\x20initialize\x20service\x20status:\x20'+_0x43d507['message']);}}async[_0x3f37d8(0x1d3)](){const _0x51cb38=_0x3f37d8;try{const _0x38081e=this[_0x51cb38(0x39a)]+'*'+this['REDIS_DEVICE_CONFIG_SUFFIX'],_0x38bf2a=await this['redisService'][_0x51cb38(0x357)](_0x38081e);return 0x0===_0x38bf2a['length']?[]:(await Promise['all'](_0x38bf2a['map'](async _0xa3f425=>{const _0x3d2cde=_0x51cb38;try{const _0x4092b6=await this['redisService']['get'](_0xa3f425);return _0x4092b6?JSON['parse'](_0x4092b6):null;}catch(_0x44d2a5){return this[_0x3d2cde(0x206)]['error'](_0x3d2cde(0x317)+_0xa3f425+':\x20'+_0x44d2a5['message']),null;}})))['filter'](_0x4a960b=>!(0x0,_0x59cc43[_0x51cb38(0x232)])(_0x4a960b));}catch(_0x2fde27){return this['logger'][_0x51cb38(0x20b)]('Error\x20listing\x20device\x20configs:\x20'+_0x2fde27['message']),[];}}async[_0x3f37d8(0x3ac)](){const _0x1fad7e=_0x3f37d8;try{const _0x1d424c=await this[_0x1fad7e(0x1da)]['listDevices']();return await Promise[_0x1fad7e(0x1e3)](_0x1d424c['map'](async _0x29c813=>{const _0x45bc6f=_0x1fad7e,_0x27e819=await this['getDeviceConfig'](_0x29c813['udid']);return{..._0x29c813,'bankCode':_0x27e819?.[_0x45bc6f(0x3d8)]||'','availableAmount':_0x27e819?.['availableAmount']||0x0,'status':_0x27e819?.['status']||_0x45bc6f(0x471),'password':_0x27e819?.['password']||'','smartOTP':_0x27e819?.['smartOTP']||'','accountNo':_0x27e819?.['accountNo']||'','accountName':_0x27e819?.['accountName']||''};}));}catch(_0xb4d7fe){return this['logger']['error']('Error\x20listing\x20devices:\x20'+_0xb4d7fe['message']),[];}}async['getDeviceConfig'](_0x5cc334){const _0x65daac=_0x3f37d8;try{const _0x241f27=''+this['REDIS_DEVICE_CONFIG_PREFIX']+_0x5cc334+this['REDIS_DEVICE_CONFIG_SUFFIX'],_0x5301bd=await this[_0x65daac(0x43c)][_0x65daac(0x4af)](_0x241f27);return _0x5301bd?JSON[_0x65daac(0x294)](_0x5301bd):null;}catch(_0x5bcea1){return this['logger']['error']('Error\x20getting\x20device\x20config\x20for\x20'+_0x5cc334+':\x20'+_0x5bcea1['message']),null;}}async['getDeviceConfigSafe'](_0x2b8b5f){const _0x251b0f=_0x3f37d8;try{const _0x2f25f7=await this['getDeviceConfig'](_0x2b8b5f);return _0x2f25f7?{..._0x2f25f7,'password':_0x2f25f7['password']?'':void 0x0,'smartOTP':_0x2f25f7['smartOTP']?'':void 0x0}:null;}catch(_0x1d8ae6){return this['logger']['error'](_0x251b0f(0x375)+_0x2b8b5f+':\x20'+_0x1d8ae6[_0x251b0f(0x4ad)]),null;}}async['updateDeviceConfig'](_0x39829d,_0xeae832){const _0x4381ef=_0x3f37d8;try{const _0xc62cb=''+this[_0x4381ef(0x39a)]+_0x39829d+this[_0x4381ef(0x286)],_0x34fb81=await this['getDeviceConfig'](_0x39829d),_0x2ccb5d=_0x34fb81?.['password']||_0x34fb81?.[_0x4381ef(0x22d)],_0x53696a=_0x2ccb5d?_0x34fb81?.[_0x4381ef(0x3a0)]||'':void 0x0!==_0xeae832[_0x4381ef(0x3a0)]?_0xeae832['password']:'',_0x323623=_0x2ccb5d?_0x34fb81?.[_0x4381ef(0x22d)]||'':void 0x0!==_0xeae832[_0x4381ef(0x22d)]?_0xeae832['smartOTP']:'',_0x5b6e15={'deviceId':_0x39829d,'bankCode':void 0x0!==_0xeae832[_0x4381ef(0x3d8)]?_0xeae832[_0x4381ef(0x3d8)]:_0x34fb81?.['bankCode']||'','availableAmount':void 0x0!==_0xeae832['availableAmount']?_0xeae832[_0x4381ef(0x32e)]:_0x34fb81?.['availableAmount']||0x0,'status':void 0x0!==_0xeae832['status']?_0xeae832['status']:_0x34fb81?.['status']||_0x4381ef(0x471),'password':_0x53696a,'smartOTP':_0x323623,'accountNo':void 0x0!==_0xeae832['accountNo']?_0xeae832['accountNo']:_0x34fb81?.[_0x4381ef(0x1d6)]||'','accountName':void 0x0!==_0xeae832['accountName']?_0xeae832['accountName']:_0x34fb81?.['accountName']||''};return await this[_0x4381ef(0x43c)]['set'](_0xc62cb,JSON['stringify'](_0x5b6e15)),this['logger'][_0x4381ef(0x4dd)]('['+_0x39829d+']\x20Updated\x20device\x20config\x20(bankCode:\x20'+(_0x5b6e15['bankCode']||_0x4381ef(0x407))+'):\x20'+JSON['stringify']((0x0,_0x59cc43['omit'])(_0x5b6e15,['password','smartOTP']))),_0x5b6e15;}catch(_0x7d14c6){throw this[_0x4381ef(0x206)][_0x4381ef(0x20b)]('['+_0x39829d+']\x20Error\x20updating\x20device\x20config:\x20'+_0x7d14c6[_0x4381ef(0x4ad)]),_0x7d14c6;}}async['deleteDeviceConfig'](_0x5d46f2){const _0x4f6c9b=_0x3f37d8;try{const _0x476d44=''+this[_0x4f6c9b(0x39a)]+_0x5d46f2+this[_0x4f6c9b(0x286)];await this['redisService'][_0x4f6c9b(0x3e3)](_0x476d44),this[_0x4f6c9b(0x206)]['log']('['+_0x5d46f2+']\x20Deleted\x20device\x20config');}catch(_0x2e2d96){throw this['logger'][_0x4f6c9b(0x20b)]('['+_0x5d46f2+_0x4f6c9b(0x276)+_0x2e2d96['message']),_0x2e2d96;}}async['getServiceStatus'](){const _0x5c925a=_0x3f37d8;try{return await this['redisService']['get'](this[_0x5c925a(0x1fd)])||_0x5c925a(0x4ac);}catch(_0x4ace6e){return this['logger']['error']('Error\x20getting\x20service\x20status:\x20'+_0x4ace6e['message']),'inactive';}}async['setServiceStatus'](_0x89dda8){const _0x562896=_0x3f37d8;try{await this[_0x562896(0x43c)]['set'](this['REDIS_SERVICE_STATUS_KEY'],_0x89dda8),this['logger']['log']('Service\x20status\x20set\x20to:\x20'+_0x89dda8);}catch(_0x17517e){throw this['logger']['error']('Error\x20setting\x20service\x20status:\x20'+_0x17517e['message']),_0x17517e;}}async['startService'](){const _0x1984f3=_0x3f37d8;try{if(!await this['hasActiveDevice']())throw new _0x1b43ce['HttpException']({'success':!0x1,'error':'Vui\x20l√≤ng\x20active\x20bank\x20tr∆∞·ªõc\x20khi\x20start'},_0x1b43ce[_0x1984f3(0x242)]['BAD_REQUEST']);return this[_0x1984f3(0x207)]['loginAllActiveBanks']()['catch'](_0x4c41fb=>{const _0x49f995=_0x1984f3;this['logger'][_0x49f995(0x20b)]('Error\x20during\x20background\x20login\x20process:\x20'+_0x4c41fb['message']);}),await new Promise(_0x5dbeda=>setTimeout(_0x5dbeda,0x7d0)),await this['setServiceStatus']('active'),{'success':!0x0,'message':_0x1984f3(0x34f)};}catch(_0x1089b1){if(_0x1089b1 instanceof _0x1b43ce['HttpException'])throw _0x1089b1;throw this['logger'][_0x1984f3(0x20b)](_0x1984f3(0x1ed)+_0x1089b1['message'],_0x1089b1['stack']),new _0x1b43ce['HttpException']({'success':!0x1,'error':_0x1089b1['message']||'Failed\x20to\x20start\x20service'},_0x1b43ce['HttpStatus']['INTERNAL_SERVER_ERROR']);}}async['deductDeviceAmount'](_0x5b9906,_0x4f80a3){const _0x471deb=_0x3f37d8;try{const _0x2f18a=await this[_0x471deb(0x33b)](_0x5b9906);if(!_0x2f18a)return!0x1;const _0x2bd975=_0x2f18a['availableAmount']-_0x4f80a3;return _0x2bd975<0x0?(this['logger']['warn']('Insufficient\x20amount\x20for\x20device\x20'+_0x5b9906+'.\x20Available:\x20'+_0x2f18a['availableAmount']+_0x471deb(0x3ce)+_0x4f80a3),!0x1):(await this['updateDeviceConfig'](_0x5b9906,{'availableAmount':_0x2bd975}),!0x0);}catch(_0xc18cc4){return this[_0x471deb(0x206)][_0x471deb(0x20b)](_0x471deb(0x459)+_0x5b9906+':\x20'+_0xc18cc4['message']),!0x1;}}async[_0x3f37d8(0x362)](){const _0x33a8f9=_0x3f37d8;try{return(await this[_0x33a8f9(0x3ac)]())['some'](_0x38e189=>_0x33a8f9(0x4db)===_0x38e189['status']);}catch(_0x3f04a0){return this['logger']['error']('Error\x20checking\x20active\x20devices:\x20'+_0x3f04a0['message']),!0x1;}}async['getAvailableDevices'](){const _0x3f5ae2=_0x3f37d8;try{const _0x3949e0=await this['wsService'][_0x3f5ae2(0x3ac)](),_0x395f0f=[];for(const _0x69298c of _0x3949e0){const _0x4ead90=await this['getDeviceConfig'](_0x69298c['udid']);'active'===_0x4ead90?.[_0x3f5ae2(0x2be)]&&(await this['deviceLockService'][_0x3f5ae2(0x235)](_0x69298c[_0x3f5ae2(0x23a)])||(await this['bankService']['isSessionValid'](_0x69298c[_0x3f5ae2(0x23a)],_0x4ead90['bankCode'])?_0x395f0f['push'](_0x4ead90):this[_0x3f5ae2(0x206)]['error']('['+_0x69298c[_0x3f5ae2(0x23a)]+_0x3f5ae2(0x49b)+_0x4ead90['bankCode'])));}return _0x395f0f;}catch(_0x26e4ba){return this['logger']['error']('Error\x20getting\x20available\x20devices:\x20'+_0x26e4ba[_0x3f5ae2(0x4ad)]),[];}}};_0x20f2dc['DeviceService']=_0x12d27b,_0x20f2dc[_0x3f37d8(0x2a3)]=_0x12d27b=_0x1ec1cd([(0x0,_0x1b43ce['Injectable'])(),_0x5caef2(0x1,(0x0,_0x1b43ce['Inject'])(_0x3679a5['WEBSOCKET_SERVICE'])),_0x5caef2(0x3,(0x0,_0x1b43ce['Inject'])((0x0,_0x1b43ce['forwardRef'])(()=>_0x2e2352['BankService']))),_0x27f5e6('design:paramtypes',['function'==typeof(_0x198fab=void 0x0!==_0x1e7951['RedisService']&&_0x1e7951['RedisService'])?_0x198fab:Object,_0x3f37d8(0x42d)==typeof(_0x3153cc=void 0x0!==_0x9d5f8a['IWebSocketService']&&_0x9d5f8a['IWebSocketService'])?_0x3153cc:Object,_0x3f37d8(0x42d)==typeof(_0x168fca=void 0x0!==_0x3d2570['DeviceLockService']&&_0x3d2570['DeviceLockService'])?_0x168fca:Object,_0x3f37d8(0x42d)==typeof(_0x446c74=void 0x0!==_0x2e2352['BankService']&&_0x2e2352['BankService'])?_0x446c74:Object])],_0x12d27b);},function(_0x202276,_0x56338c,_0x4e5d60){const _0x418c05=a0_0x4abd;var _0x3d01eb=this&&this['__decorate']||function(_0x3b6c21,_0x578f78,_0x414329,_0x1bbd97){var _0x49bf05,_0x392c5=arguments['length'],_0x2a63d2=_0x392c5<0x3?_0x578f78:null===_0x1bbd97?_0x1bbd97=Object['getOwnPropertyDescriptor'](_0x578f78,_0x414329):_0x1bbd97;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x2a63d2=Reflect['decorate'](_0x3b6c21,_0x578f78,_0x414329,_0x1bbd97);else{for(var _0x297dfe=_0x3b6c21['length']-0x1;_0x297dfe>=0x0;_0x297dfe--)(_0x49bf05=_0x3b6c21[_0x297dfe])&&(_0x2a63d2=(_0x392c5<0x3?_0x49bf05(_0x2a63d2):_0x392c5>0x3?_0x49bf05(_0x578f78,_0x414329,_0x2a63d2):_0x49bf05(_0x578f78,_0x414329))||_0x2a63d2);}return _0x392c5>0x3&&_0x2a63d2&&Object['defineProperty'](_0x578f78,_0x414329,_0x2a63d2),_0x2a63d2;},_0x1a8016=this&&this['__metadata']||function(_0x2a1dba,_0xdb0a73){const _0x142a52=a0_0x4abd;if('object'==typeof Reflect&&_0x142a52(0x42d)==typeof Reflect['metadata'])return Reflect['metadata'](_0x2a1dba,_0xdb0a73);};Object['defineProperty'](_0x56338c,'__esModule',{'value':!0x0}),_0x56338c['RedisService']=void 0x0;const _0x4c9595=_0x4e5d60(0x2),_0x1089ca=_0x4e5d60(0x10),_0x39f5a5=_0x4e5d60(0x11);let _0x1cd386=class{constructor(){const _0x24a03e=a0_0x4abd;this[_0x24a03e(0x206)]=new _0x4c9595['Logger']('RedisService'),this['redisClient']=null;}async['getClient'](){const _0x23ce9c=a0_0x4abd;if(this['redisClient'])return this[_0x23ce9c(0x4a4)];const _0x2dfb9f=_0x39f5a5['config']['redis']['host']??'localhost',_0x1fb07c=_0x39f5a5['config']['redis']['port']??0x18eb,_0x1a42de=_0x39f5a5['config']['redis'][_0x23ce9c(0x3a0)]??void 0x0,_0x15bb1a=_0x39f5a5['config'][_0x23ce9c(0x314)]['db']??0x3;return this['redisClient']=new _0x1089ca[(_0x23ce9c(0x2f3))]({'host':_0x2dfb9f,'port':_0x1fb07c,'password':_0x1a42de,'db':_0x15bb1a,'enableReadyCheck':!0x1,'maxRetriesPerRequest':null,'lazyConnect':!0x0}),this['redisClient']['on'](_0x23ce9c(0x20b),_0x502f1b=>{const _0x1ab455=_0x23ce9c;this['logger'][_0x1ab455(0x20b)]('Redis\x20Client\x20Error',_0x502f1b['stack']||_0x502f1b['message']);}),this[_0x23ce9c(0x4a4)]['on']('connect',()=>{const _0x139154=_0x23ce9c;this[_0x139154(0x206)]['log']('Redis\x20Client\x20Connected');}),this['redisClient']['on']('ready',()=>{const _0x2d3991=_0x23ce9c;this[_0x2d3991(0x206)]['log'](_0x2d3991(0x2de));}),this[_0x23ce9c(0x4a4)]['on']('close',()=>{this['logger']['warn']('Redis\x20Client\x20Connection\x20Closed');}),this[_0x23ce9c(0x4a4)]['on'](_0x23ce9c(0x383),()=>{this['logger']['log']('Redis\x20Client\x20Reconnecting...');}),await this['redisClient']['connect'](),this['redisClient'];}async['disconnect'](){const _0x2b3ff3=a0_0x4abd;this['redisClient']&&(await this[_0x2b3ff3(0x4a4)]['disconnect'](),this['redisClient']=null,this['logger'][_0x2b3ff3(0x4dd)]('Redis\x20Client\x20Disconnected'));}async['onModuleDestroy'](){await this['disconnect']();}async[_0x418c05(0x4af)](_0x47996a){const _0x4358d1=_0x418c05;return(await this['getClient']())[_0x4358d1(0x4af)](_0x47996a);}async['set'](_0x5b7196,_0x198454,_0x4eff79){const _0x2af89b=await this['getClient']();if(_0x4eff79){const _0x418124=Math['ceil'](_0x4eff79/0x3e8);return _0x2af89b['setex'](_0x5b7196,_0x418124,_0x198454);}return _0x2af89b['set'](_0x5b7196,_0x198454);}async['setex'](_0xcf9f53,_0x49cf4c,_0x4e73f4){const _0x18386e=await this['getClient'](),_0x225e4d=Math['ceil'](_0x49cf4c/0x3e8);return _0x18386e['setex'](_0xcf9f53,_0x225e4d,_0x4e73f4);}async['del'](_0x37b7f8){const _0x5c3c84=_0x418c05;return(await this[_0x5c3c84(0x28b)]())['del'](_0x37b7f8);}async[_0x418c05(0x347)](_0x5313c5){return(await this['getClient']())['exists'](_0x5313c5);}async[_0x418c05(0x425)](_0x822b89,_0x3c5f43,_0x16d052){const _0x5dcba3=_0x418c05;return(await this[_0x5dcba3(0x28b)]())['zadd'](_0x822b89,_0x3c5f43,_0x16d052);}async['zrange'](_0x249f61,_0x32b66c,_0x38f852){return(await this['getClient']())['zrange'](_0x249f61,_0x32b66c,_0x38f852);}async['zrangebyscore'](_0x428714,_0x2ee3ca,_0x40fd32,_0x327b47){const _0x30e323=_0x418c05,_0xf170ea=await this['getClient']();return _0x327b47?_0xf170ea['zrangebyscore'](_0x428714,_0x2ee3ca,_0x40fd32,'LIMIT',_0x327b47['offset'],_0x327b47[_0x30e323(0x35b)]):_0xf170ea['zrangebyscore'](_0x428714,_0x2ee3ca,_0x40fd32);}async['zrem'](_0x471aaa,..._0x12fc70){const _0x40dd8c=_0x418c05;return(await this[_0x40dd8c(0x28b)]())['zrem'](_0x471aaa,..._0x12fc70);}async['sadd'](_0x5078b8,..._0x26da44){const _0x2c4b83=_0x418c05;return(await this[_0x2c4b83(0x28b)]())['sadd'](_0x5078b8,..._0x26da44);}async[_0x418c05(0x444)](_0x5747bf,_0x2d63f9){const _0x11ac60=_0x418c05;return(await this[_0x11ac60(0x28b)]())['sismember'](_0x5747bf,_0x2d63f9);}async['hset'](_0x2792b9,_0x2c48ea,_0x4edb36){const _0x15e032=_0x418c05;return(await this[_0x15e032(0x28b)]())[_0x15e032(0x2d3)](_0x2792b9,_0x2c48ea,_0x4edb36);}async['hget'](_0x126b55,_0xc13b0f){return(await this['getClient']())['hget'](_0x126b55,_0xc13b0f);}async['hgetall'](_0xbe0e90){const _0x46b09c=_0x418c05;return(await this['getClient']())[_0x46b09c(0x451)](_0xbe0e90);}async[_0x418c05(0x1cb)](_0x5b6a87,_0xde477f){return(await this['getClient']())['expire'](_0x5b6a87,_0xde477f);}async['keys'](_0x28a7a0){const _0x399995=_0x418c05,_0x506cac=await this['getClient'](),_0x4827de=[];let _0x497892='0';do{const _0x444c13=await _0x506cac['scan'](_0x497892,'MATCH',_0x28a7a0,'COUNT',0x64);_0x497892=_0x444c13[0x0],_0x4827de[_0x399995(0x353)](..._0x444c13[0x1]);}while('0'!==_0x497892);return _0x4827de;}async['setnx'](_0x98223d,_0x2f44f8,_0x13024e){const _0x1f905a=_0x418c05,_0x5e0053=await this['getClient']();if(_0x13024e){const _0x41e52a=Math['ceil'](_0x13024e/0x3e8);return await _0x5e0053[_0x1f905a(0x1f8)](_0x98223d,_0x2f44f8,'EX',_0x41e52a,'NX');}return await _0x5e0053['set'](_0x98223d,_0x2f44f8,'NX');}async['pickFromZSet'](_0x12ccf5,_0x1bb876=0x1){const _0xb2e964=_0x418c05,_0xd7b80d=await this[_0xb2e964(0x28b)](),_0x3caf8f=await _0xd7b80d['zrange'](_0x12ccf5,0x0,_0x1bb876-0x1,'WITHSCORES');if(!_0x3caf8f||0x0===_0x3caf8f[_0xb2e964(0x20f)])return[];const _0x18c935=[];for(let _0x1ce11a=0x0;_0x1ce11a<_0x3caf8f['length'];_0x1ce11a+=0x2)_0x18c935['push']({'jobId':_0x3caf8f[_0x1ce11a],'score':_0x3caf8f[_0x1ce11a+0x1]});return _0x18c935;}};_0x56338c['RedisService']=_0x1cd386,_0x56338c[_0x418c05(0x374)]=_0x1cd386=_0x3d01eb([(0x0,_0x4c9595['Injectable'])(),_0x1a8016('design:paramtypes',[])],_0x1cd386);},_0x5afcac=>{_0x5afcac['exports']=require('ioredis');},(_0x55e850,_0x48609c,_0x3c3a8a)=>{const _0x11d4ea=a0_0x4abd;Object['defineProperty'](_0x48609c,'__esModule',{'value':!0x0}),_0x48609c[_0x11d4ea(0x36b)]=void 0x0;const _0x409dd0=_0x3c3a8a(0x12),_0x30f8e7=_0x3c3a8a(0x4);(0x0,_0x409dd0['config'])({'path':(0x0,_0x30f8e7['join'])(process[_0x11d4ea(0x4aa)](),_0x11d4ea(0x439))}),_0x48609c[_0x11d4ea(0x36b)]={'NODE_ENV':process[_0x11d4ea(0x35d)][_0x11d4ea(0x47d)]||'production','boxType':'PANDA','redis':{'host':process['env'][_0x11d4ea(0x21e)]??_0x11d4ea(0x2db),'port':parseInt(process['env'][_0x11d4ea(0x3a9)]??'6888'),'db':0x3,'password':process['env']['REDIS_PWD']??'Dcsvnqvmn1'},'ezpayBe':{'apiUrl':process['env']['EZZPAY_BE']??_0x11d4ea(0x48d),'apiKey':process['env'][_0x11d4ea(0x22a)]??'uHqE5X9H0QEBsqlZpdTHG0fOyvmMtHjCGgsG4ouls3Gz9WvaWg4w9HV3sqETGWfE'},'ocr':{'poolSize':parseInt(process['env'][_0x11d4ea(0x465)]||'4',0xa),'lang':process['env']['OCR_LANG']||'vie','rois':{'singleLine':{'crop':{'x':parseFloat(process['env'][_0x11d4ea(0x23d)]||'0'),'y':parseFloat(process['env'][_0x11d4ea(0x466)]||'0'),'width':parseFloat(process['env'][_0x11d4ea(0x1d1)]||'1'),'height':parseFloat(process['env']['OCR_ROI_SINGLE_HEIGHT']||'1')},'psm':parseInt(process['env']['OCR_PSM_SINGLE']||'7',0xa),'charWhitelist':process['env']['OCR_WHITELIST_SINGLE']||_0x11d4ea(0x442),'maxWidth':parseInt(process['env'][_0x11d4ea(0x228)]||'800',0xa)},'block':{'crop':{'x':parseFloat(process['env'][_0x11d4ea(0x463)]||'0'),'y':parseFloat(process['env'][_0x11d4ea(0x3fe)]||'0'),'width':parseFloat(process['env']['OCR_ROI_BLOCK_WIDTH']||'1'),'height':parseFloat(process['env']['OCR_ROI_BLOCK_HEIGHT']||'1')},'psm':parseInt(process['env']['OCR_PSM_BLOCK']||'6',0xa),'charWhitelist':process[_0x11d4ea(0x35d)]['OCR_WHITELIST_BLOCK']||void 0x0,'maxWidth':parseInt(process['env']['OCR_MAX_WIDTH_BLOCK']||'1200',0xa)},'full':{'crop':{'x':0x0,'y':0x0,'width':0x1,'height':0x1},'psm':parseInt(process['env']['OCR_PSM_FULL']||'6',0xa),'charWhitelist':void 0x0,'maxWidth':parseInt(process[_0x11d4ea(0x35d)]['OCR_MAX_WIDTH_FULL']||'1200',0xa)}}},'spaceocr':{'datacenterPrimary':_0x11d4ea(0x2c3),'datacenterSecond':'https://apipro2.ocr.space/parse/image','key':_0x11d4ea(0x469),'keyFree':'K82766678488957'}};},_0x2871fa=>{_0x2871fa['exports']=require('dotenv');},(_0x5435b7,_0x5898a9)=>{const _0x340eae=a0_0x4abd;Object['defineProperty'](_0x5898a9,_0x340eae(0x318),{'value':!0x0});},function(_0x5a2937,_0x5e0b15,_0x20a437){const _0xc5d4b8=a0_0x4abd;var _0x57965e,_0x14ed8e=this&&this[_0xc5d4b8(0x290)]||function(_0x2d102a,_0x507e81,_0x3d8812,_0x588b4f){const _0x5f1a95=_0xc5d4b8;var _0x4eb0be,_0x3e512f=arguments[_0x5f1a95(0x20f)],_0x58ffb0=_0x3e512f<0x3?_0x507e81:null===_0x588b4f?_0x588b4f=Object[_0x5f1a95(0x4a5)](_0x507e81,_0x3d8812):_0x588b4f;if('object'==typeof Reflect&&_0x5f1a95(0x42d)==typeof Reflect['decorate'])_0x58ffb0=Reflect['decorate'](_0x2d102a,_0x507e81,_0x3d8812,_0x588b4f);else{for(var _0xb614ed=_0x2d102a['length']-0x1;_0xb614ed>=0x0;_0xb614ed--)(_0x4eb0be=_0x2d102a[_0xb614ed])&&(_0x58ffb0=(_0x3e512f<0x3?_0x4eb0be(_0x58ffb0):_0x3e512f>0x3?_0x4eb0be(_0x507e81,_0x3d8812,_0x58ffb0):_0x4eb0be(_0x507e81,_0x3d8812))||_0x58ffb0);}return _0x3e512f>0x3&&_0x58ffb0&&Object['defineProperty'](_0x507e81,_0x3d8812,_0x58ffb0),_0x58ffb0;},_0xef4732=this&&this['__metadata']||function(_0x78a297,_0x1d5822){const _0x1510ec=_0xc5d4b8;if(_0x1510ec(0x2f0)==typeof Reflect&&'function'==typeof Reflect[_0x1510ec(0x47a)])return Reflect[_0x1510ec(0x47a)](_0x78a297,_0x1d5822);};Object['defineProperty'](_0x5e0b15,'__esModule',{'value':!0x0}),_0x5e0b15[_0xc5d4b8(0x474)]=void 0x0;const _0x38924e=_0x20a437(0x2),_0x2719d3=_0x20a437(0xf),_0x316bff=_0x20a437(0x15);let _0xfcc9a6=class{constructor(_0x2cf1b8){const _0x270e1e=_0xc5d4b8;this['redisService']=_0x2cf1b8,this['logger']=new _0x38924e[(_0x270e1e(0x366))]('DeviceLockService'),this['REDIS_LOCK_PREFIX']='device:lock:',this['DEFAULT_LOCK_TTL']=0x927c0;}async['acquireLock'](_0x808c8a,_0x53e5cf,_0x912ab,_0x120c34=this['DEFAULT_LOCK_TTL']){const _0x48c50c=_0xc5d4b8;try{const _0xb0f9be=''+this[_0x48c50c(0x205)]+_0x808c8a,_0x1a47f6=''+this[_0x48c50c(0x205)]+_0x808c8a+':meta',_0x412f32=(0x0,_0x316bff['randomUUID'])(),_0x258533=Math[_0x48c50c(0x42f)](_0x120c34/0x3e8),_0x382b8a=await this['redisService']['getClient']();if('OK'===await _0x382b8a[_0x48c50c(0x1f8)](_0xb0f9be,_0x412f32,'EX',_0x258533,'NX')){const _0x11e9b9={'deviceId':_0x808c8a,'lockType':_0x53e5cf,'lockedAt':Date[_0x48c50c(0x34e)](),'lockedBy':_0x912ab,'ttl':_0x120c34};return await this[_0x48c50c(0x43c)]['setex'](_0x1a47f6,_0x258533,JSON[_0x48c50c(0x445)](_0x11e9b9)),this['logger'][_0x48c50c(0x4dd)]('['+_0x808c8a+']\x20Acquired\x20'+_0x53e5cf+'\x20lock\x20('+_0x912ab+_0x48c50c(0x3b2)+_0x412f32),!0x0;}return this['logger']['warn']('['+_0x808c8a+']\x20Device\x20is\x20already\x20locked,\x20cannot\x20acquire\x20lock'),!0x1;}catch(_0x30ef6e){return this[_0x48c50c(0x206)]['error']('['+_0x808c8a+']\x20Error\x20acquiring\x20lock:\x20'+_0x30ef6e['message']),!0x1;}}async['releaseLock'](_0x147488){const _0x30be9b=_0xc5d4b8;try{const _0x444451=''+this['REDIS_LOCK_PREFIX']+_0x147488,_0x5c1ab4=''+this['REDIS_LOCK_PREFIX']+_0x147488+':meta',_0x460be2=await this['redisService']['getClient'](),_0x41d39c=await _0x460be2['get'](_0x444451);if(!_0x41d39c)return await this['redisService']['del'](_0x5c1ab4),void this['logger'][_0x30be9b(0x200)]('['+_0x147488+']\x20Device\x20is\x20not\x20locked,\x20nothing\x20to\x20release');0x1===await _0x460be2['eval']('\x0aif\x20redis.call(\x22GET\x22,\x20KEYS[1])\x20==\x20ARGV[1]\x20then\x0a\x20\x20redis.call(\x22DEL\x22,\x20KEYS[2])\x0a\x20\x20return\x20redis.call(\x22DEL\x22,\x20KEYS[1])\x0aelse\x0a\x20\x20return\x200\x0aend\x0a',0x2,_0x444451,_0x5c1ab4,_0x41d39c)?this[_0x30be9b(0x206)]['log']('['+_0x147488+']\x20Released\x20lock\x20(lockId:\x20'+_0x41d39c+')'):this['logger']['warn']('['+_0x147488+_0x30be9b(0x42c)+_0x41d39c+')');}catch(_0x2551c3){this['logger'][_0x30be9b(0x20b)]('['+_0x147488+']\x20Error\x20releasing\x20lock:\x20'+_0x2551c3[_0x30be9b(0x4ad)],_0x2551c3['stack']);}}async['getLock'](_0x5876ed){const _0x2010d8=_0xc5d4b8;try{const _0x304b87=''+this[_0x2010d8(0x205)]+_0x5876ed,_0x541d8f=await this['redisService']['get'](_0x304b87);if(!_0x541d8f)return null;const _0x1ec7b8=''+this['REDIS_LOCK_PREFIX']+_0x5876ed+':meta',_0x44fadf=await this['redisService']['get'](_0x1ec7b8);return _0x44fadf?{...JSON['parse'](_0x44fadf),'lockId':_0x541d8f}:{'deviceId':_0x5876ed,'lockType':'transfer','lockedAt':Date['now'](),'lockedBy':'unknown','ttl':this['DEFAULT_LOCK_TTL'],'lockId':_0x541d8f};}catch(_0x531704){return this['logger']['error']('['+_0x5876ed+_0x2010d8(0x348)+_0x531704[_0x2010d8(0x4ad)]),null;}}async[_0xc5d4b8(0x235)](_0x432d47,_0x1f9a6e){const _0x2b5ed6=_0xc5d4b8;try{const _0x294f3e=''+this['REDIS_LOCK_PREFIX']+_0x432d47;if(!await this['redisService'][_0x2b5ed6(0x347)](_0x294f3e))return!0x1;const _0x21a601=await this['getLock'](_0x432d47);return!(!_0x21a601||_0x1f9a6e&&_0x21a601['lockType']===_0x1f9a6e);}catch(_0x2ced2f){return this[_0x2b5ed6(0x206)]['error']('['+_0x432d47+']\x20Error\x20checking\x20lock\x20status:\x20'+_0x2ced2f['message']),!0x1;}}async['extendLock'](_0x4c782b,_0x2ca445){const _0x2cc256=_0xc5d4b8;try{if(!await this[_0x2cc256(0x3b1)](_0x4c782b))return!0x1;const _0x2883b9=''+this['REDIS_LOCK_PREFIX']+_0x4c782b,_0x54d4a5=''+this['REDIS_LOCK_PREFIX']+_0x4c782b+':meta',_0x4bf5f1=await this[_0x2cc256(0x43c)]['getClient'](),_0x548c3b=await _0x4bf5f1[_0x2cc256(0x349)](_0x2883b9);if(_0x548c3b<=0x0)return!0x1;const _0x45aa8f=Math['ceil']((0x3e8*_0x548c3b+_0x2ca445)/0x3e8);return 0x1===await _0x4bf5f1['expire'](_0x2883b9,_0x45aa8f)&&(await this[_0x2cc256(0x43c)]['expire'](_0x54d4a5,_0x45aa8f),this[_0x2cc256(0x206)]['log']('['+_0x4c782b+']\x20Extended\x20lock\x20by\x20'+_0x2ca445+'ms'),!0x0);}catch(_0x57c1ee){return this['logger']['error']('['+_0x4c782b+']\x20Error\x20extending\x20lock:\x20'+_0x57c1ee['message']),!0x1;}}async['releaseLockByType'](_0x14414c,_0x4e2cc4){const _0x336b2f=_0xc5d4b8;try{const _0x5625d5=await this['getLock'](_0x14414c);if(!_0x5625d5)return!0x1;if(_0x5625d5[_0x336b2f(0x31b)]!==_0x4e2cc4)return!0x1;const _0x30e62e=''+this[_0x336b2f(0x205)]+_0x14414c,_0x1a1aca=''+this['REDIS_LOCK_PREFIX']+_0x14414c+':meta';return await this[_0x336b2f(0x43c)]['del'](_0x30e62e),await this['redisService']['del'](_0x1a1aca),this['logger']['log']('['+_0x14414c+']\x20Force\x20released\x20'+_0x4e2cc4+'\x20lock'),!0x0;}catch(_0x3c7968){return this['logger'][_0x336b2f(0x20b)]('['+_0x14414c+']\x20Error\x20releasing\x20'+_0x4e2cc4+'\x20lock:\x20'+_0x3c7968['message']),!0x1;}}async[_0xc5d4b8(0x36e)](){const _0x5bc2da=_0xc5d4b8;try{const _0x236567=this[_0x5bc2da(0x205)]+'*';return(await this[_0x5bc2da(0x43c)]['keys'](_0x236567))['filter'](_0xf06ef2=>!_0xf06ef2[_0x5bc2da(0x1e9)](_0x5bc2da(0x33d)))['length'];}catch(_0x237de0){return this['logger']['error']('Error\x20getting\x20all\x20lock\x20keys:\x20'+_0x237de0['message']),0x0;}}};_0x5e0b15['DeviceLockService']=_0xfcc9a6,_0x5e0b15[_0xc5d4b8(0x474)]=_0xfcc9a6=_0x14ed8e([(0x0,_0x38924e['Injectable'])(),_0xef4732('design:paramtypes',['function'==typeof(_0x57965e=void 0x0!==_0x2719d3['RedisService']&&_0x2719d3['RedisService'])?_0x57965e:Object])],_0xfcc9a6);},_0x539b6d=>{const _0x134c28=a0_0x4abd;_0x539b6d[_0x134c28(0x1c6)]=require('crypto');},_0x15bc7e=>{_0x15bc7e['exports']=require('lodash');},function(_0x4e264a,_0x1ccb7e,_0x2eb3bf){const _0x4f9eba=a0_0x4abd;var _0x43291a,_0x1693fd,_0x191857,_0x741a82,_0x91810d,_0x24a4bf=this&&this['__decorate']||function(_0x291bef,_0x49765a,_0x49c9b2,_0x3cdd1f){const _0x4f5b31=a0_0x4abd;var _0x344560,_0xb32467=arguments['length'],_0x27079c=_0xb32467<0x3?_0x49765a:null===_0x3cdd1f?_0x3cdd1f=Object['getOwnPropertyDescriptor'](_0x49765a,_0x49c9b2):_0x3cdd1f;if('object'==typeof Reflect&&_0x4f5b31(0x42d)==typeof Reflect['decorate'])_0x27079c=Reflect['decorate'](_0x291bef,_0x49765a,_0x49c9b2,_0x3cdd1f);else{for(var _0x353e78=_0x291bef['length']-0x1;_0x353e78>=0x0;_0x353e78--)(_0x344560=_0x291bef[_0x353e78])&&(_0x27079c=(_0xb32467<0x3?_0x344560(_0x27079c):_0xb32467>0x3?_0x344560(_0x49765a,_0x49c9b2,_0x27079c):_0x344560(_0x49765a,_0x49c9b2))||_0x27079c);}return _0xb32467>0x3&&_0x27079c&&Object[_0x4f5b31(0x38d)](_0x49765a,_0x49c9b2,_0x27079c),_0x27079c;},_0x27c556=this&&this[_0x4f9eba(0x3b5)]||function(_0x1c019c,_0x4927b0){const _0x544af9=_0x4f9eba;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x544af9(0x47a)])return Reflect[_0x544af9(0x47a)](_0x1c019c,_0x4927b0);},_0x48fa54=this&&this[_0x4f9eba(0x245)]||function(_0x5b4894,_0x329361){return function(_0x2c2a1c,_0x536c7b){_0x329361(_0x2c2a1c,_0x536c7b,_0x5b4894);};};Object['defineProperty'](_0x1ccb7e,'__esModule',{'value':!0x0}),_0x1ccb7e[_0x4f9eba(0x25b)]=void 0x0;const _0xbdea22=_0x2eb3bf(0x2),_0x116869=_0x2eb3bf(0xe),_0x18c59c=_0x2eb3bf(0x13),_0xd256f3=_0x2eb3bf(0xd),_0xe0c5b7=_0x2eb3bf(0x18),_0x1f3c0e=_0x2eb3bf(0x19),_0xe137e5=_0x2eb3bf(0x1a),_0xb158f6=_0x2eb3bf(0x4),_0x5d2df2=_0x2eb3bf(0x1b),_0x4836e5=_0x2eb3bf(0x1e),_0x4152d6=_0x2eb3bf(0x21),_0x20c43d=_0x2eb3bf(0x22),_0x4c243c=_0x2eb3bf(0x20);let _0x29194=_0x43291a=class{constructor(_0x4a31c7,_0x480886,_0x1f9f30,_0x32c3ed){const _0x4a8ea7=_0x4f9eba;this[_0x4a8ea7(0x1da)]=_0x4a31c7,this['deviceService']=_0x480886,this[_0x4a8ea7(0x4a3)]=_0x1f9f30,this['imagePreprocessingService']=_0x32c3ed,this[_0x4a8ea7(0x1cf)]='C:/EasyData',this['baseTransactionExecutionFolder']='C:/EasyTrx',this['cleanupFolder']=async(_0x4abcd9,_0x3a3d70)=>{const _0x1dfe52=_0x4a8ea7;if((0x0,_0x1f3c0e[_0x1dfe52(0x2fb)])(_0x4abcd9))try{await(0x0,_0xe137e5['rm'])(_0x4abcd9,{'recursive':!0x0,'force':!0x0});}catch(_0x58f8ef){this[_0x1dfe52(0x206)]['debug']('['+_0x3a3d70+']\x20Failed\x20to\x20cleanup\x20folder:\x20'+_0x58f8ef['message']);}},this['logger']=new _0xbdea22[(_0x4a8ea7(0x366))]('BaseBankService'),_0x43291a['createTransactionFolder'](this['baseTransactionFolderPath'],this[_0x4a8ea7(0x206)]),_0x43291a[_0x4a8ea7(0x20c)](this['baseTransactionExecutionFolder'],this['logger']);}static['createTransactionFolder'](_0x5c10ab,_0x34aecf){const _0xcdfdd=_0x4f9eba;if(!_0x43291a['folderCreated']){if(_0x43291a['folderCreationInProgress']){let _0x42d6ca=0x0;const _0x425f42=0xa;for(;_0x43291a['folderCreationInProgress']&&_0x42d6ca<_0x425f42;){_0x42d6ca++;const _0x2ebdde=Date['now']();for(;Date['now']()-_0x2ebdde<0xa;);}if(_0x43291a['folderCreated']||(0x0,_0x1f3c0e[_0xcdfdd(0x2fb)])(_0x5c10ab))return void(_0x43291a['folderCreated']=!0x0);}try{_0x43291a[_0xcdfdd(0x456)]=!0x0,(0x0,_0x1f3c0e['existsSync'])(_0x5c10ab)?_0x34aecf[_0xcdfdd(0x200)]('Base\x20folder\x20already\x20exists:\x20'+_0x5c10ab):((0x0,_0x1f3c0e['mkdirSync'])(_0x5c10ab,{'recursive':!0x0}),_0x34aecf['log']('Created\x20base\x20folder:\x20'+_0x5c10ab)),_0x43291a[_0xcdfdd(0x2f7)]=!0x0;}catch(_0x5be358){'EEXIST'!==_0x5be358[_0xcdfdd(0x1d9)]?_0x34aecf['error']('Failed\x20to\x20create\x20base\x20folder\x20'+_0x5c10ab+':\x20'+_0x5be358[_0xcdfdd(0x4ad)]):(_0x43291a[_0xcdfdd(0x2f7)]=!0x0,_0x34aecf[_0xcdfdd(0x200)](_0xcdfdd(0x252)+_0x5c10ab));}finally{_0x43291a['folderCreationInProgress']=!0x1;}}}[_0x4f9eba(0x239)](){return this['BANK_CODE'];}async['killApp'](_0x28b536){const _0x4f31e6=_0x4f9eba;this['logger']['log']('['+_0x28b536+']\x20Killing\x20'+this[_0x4f31e6(0x2c6)]+'\x20app'),await this['wsService']['killApp'](_0x28b536,this['BUNDLE_ID']);}async['clickWithTransition'](_0x2aef1a,_0xca85d0,_0x11fb2c,_0x590371,_0x16494a=''){const _0x4d12b8=_0x4f9eba;await this['wsService'][_0x4d12b8(0x28c)](_0x2aef1a,_0xca85d0,_0x11fb2c,0.2),_0x16494a&&this['logger']['log'](_0x16494a),await(0x0,_0xe0c5b7['sleep'])(_0x590371);}async['verifyScreenState'](_0xfdf879,_0x541da9){const _0x2edcd7=_0x4f9eba,{expectedTexts:_0x2d10f3=[],unexpectedTexts:_0x2e20bd=[],timeout:_0x2908a5=0x7530,pollInterval:_0x4ca755=0x1f4,roi:_0x4b55d7,fieldType:_0x4b8043='full',preprocess:_0x25d811}=_0x541da9,_0x54aa05=Date['now']();let _0x3c5269=0x0;const _0xd68ba3=(0x0,_0xb158f6['join'])(this['baseTransactionExecutionFolder'],'scan_'+_0xfdf879),_0x425c7f=_0x4b55d7?'ROI:\x20x='+_0x4b55d7['x']+',\x20y='+_0x4b55d7['y']+',\x20w='+_0x4b55d7[_0x2edcd7(0x44a)]+',\x20h='+_0x4b55d7['height']:_0x2edcd7(0x2fd);this['logger'][_0x2edcd7(0x200)]('['+_0xfdf879+']\x20Starting\x20screen\x20verification.\x20Expected:\x20['+_0x2d10f3['join'](',\x20')+_0x2edcd7(0x34b)+_0x2e20bd['join'](',\x20')+'],\x20'+_0x425c7f+',\x20Timeout:\x20'+_0x2908a5+'ms,\x20Poll:\x20'+_0x4ca755+'ms');try{for(await this['cleanupFolder'](_0xd68ba3,_0xfdf879),await(0x0,_0xe137e5['mkdir'])(_0xd68ba3,{'recursive':!0x0});Date[_0x2edcd7(0x34e)]()-_0x54aa05<_0x2908a5;){_0x3c5269++;let _0x15dd2f=null;try{const _0x267e18=Date[_0x2edcd7(0x34e)]();await this['wsService']['captureScreen'](_0xfdf879,{'folderPath':_0xd68ba3});let _0x41e71a=null;const _0x1093fa=0x5;let _0x1883d8=0x0;for(;_0x1883d8<_0x1093fa&&!_0x41e71a;){_0x1883d8++,await(0x0,_0xe0c5b7[_0x2edcd7(0x3b8)])(0x1f4);try{if(!(0x0,_0x1f3c0e['existsSync'])(_0xd68ba3))continue;const _0x461187=(await(0x0,_0xe137e5['readdir'])(_0xd68ba3))['filter'](_0x45c9ef=>_0x45c9ef[_0x2edcd7(0x1e9)]('.png'));if(0x0===_0x461187['length'])continue;let _0x1e905a=0x0;Date['now']();for(const _0x4d471f of _0x461187){const _0x564646=(0x0,_0xb158f6['join'])(_0xd68ba3,_0x4d471f);try{const _0x4807ab=await(0x0,_0xe137e5[_0x2edcd7(0x2e5)])(_0x564646);if(0x0===_0x4807ab['size'])continue;_0x4807ab[_0x2edcd7(0x363)]>=_0x267e18-0x7d0&&_0x4807ab[_0x2edcd7(0x363)]>_0x1e905a&&(_0x1e905a=_0x4807ab['mtimeMs'],_0x41e71a=_0x564646);}catch(_0x34e76a){continue;}}}catch(_0x281ed8){continue;}}if(!_0x41e71a){this['logger'][_0x2edcd7(0x200)]('['+_0xfdf879+']\x20No\x20screenshot\x20files\x20found\x20in\x20folder\x20after\x20'+_0x1883d8+'\x20attempts,\x20retrying\x20capture...'),await(0x0,_0xe0c5b7['sleep'])(_0x4ca755);continue;}_0x15dd2f=_0x41e71a;const _0x997941=[..._0x2d10f3,..._0x2e20bd],_0x12461c=await this['ocrService']['fastScreenOCR'](_0x15dd2f,_0x997941,{'fieldType':_0x4b55d7?'singleLine':_0x4b8043,'customROI':_0x4b55d7,'preprocess':_0x25d811});if(!_0x12461c||!_0x12461c['found']){await(0x0,_0xe0c5b7[_0x2edcd7(0x3b8)])(_0x4ca755);continue;}const _0x51d5e8=0x0===_0x2d10f3['length']||_0x2d10f3['some'](_0xa27b9e=>_0x12461c['matchedTexts'][_0x2edcd7(0x424)](_0xa27b9e)),_0x21e3d2=_0x2e20bd['some'](_0x2b4bc2=>_0x12461c['matchedTexts']['includes'](_0x2b4bc2));if(_0x51d5e8&&!_0x21e3d2){await this[_0x2edcd7(0x431)](_0xd68ba3,_0xfdf879);const _0x30cd6d=Date['now']()-_0x54aa05,_0x2294a8=_0x12461c['result']?.['processingTime']||0x0,_0x15ce71=_0x4b55d7?'\x20(ROI:\x20'+_0x4b55d7['x']+','+_0x4b55d7['y']+'\x20'+_0x4b55d7['width']+'x'+_0x4b55d7['height']+')':'';return this[_0x2edcd7(0x206)]['log']('['+_0xfdf879+_0x2edcd7(0x312)+_0x30cd6d+'ms\x20('+_0x3c5269+_0x2edcd7(0x2a2)+_0x2294a8+'ms)'+_0x15ce71+'.\x20Matched:\x20['+_0x12461c[_0x2edcd7(0x490)]['join'](',\x20')+']'),!0x0;}if(_0x3c5269%0x5==0x0&&this['logger']['debug']('['+_0xfdf879+']\x20Screen\x20not\x20matched\x20yet\x20(attempt\x20'+_0x3c5269+').\x20Matched\x20texts:\x20['+_0x12461c['matchedTexts']['join'](',\x20')+'],\x20Expected:\x20['+_0x2d10f3['join'](',\x20')+']'),_0x15dd2f)try{await(0x0,_0xe137e5['unlink'])(_0x15dd2f);}catch{}await(0x0,_0xe0c5b7['sleep'])(_0x4ca755);}catch(_0x46fb2d){this[_0x2edcd7(0x206)]['debug']('['+_0xfdf879+']\x20Error\x20verifying\x20screen\x20(attempt\x20'+_0x3c5269+'):\x20'+_0x46fb2d['message']+',\x20retrying...'),await(0x0,_0xe0c5b7['sleep'])(_0x4ca755);}}await this[_0x2edcd7(0x431)](_0xd68ba3,_0xfdf879);const _0x2ab180=Date['now']()-_0x54aa05;return this['logger']['warn']('['+_0xfdf879+']\x20Screen\x20verification\x20timeout\x20after\x20'+_0x2ab180+'ms\x20('+_0x3c5269+_0x2edcd7(0x484)+_0x2d10f3[_0x2edcd7(0x282)](',\x20')+']'),!0x1;}catch(_0x5a0914){throw await this[_0x2edcd7(0x431)](_0xd68ba3,_0xfdf879),_0x5a0914;}}async['getLatestImagePath'](_0x5b6d4a,_0x11bcd7=0x2710,_0x467e1c=0x1f4){const _0x207bb4=_0x4f9eba;if(!_0x5b6d4a)return this['logger'][_0x207bb4(0x38c)]('Folder\x20path\x20is\x20null\x20or\x20empty'),null;const _0xd74bfd=Date['now']();let _0x38ddce=0x0;for(this['logger'][_0x207bb4(0x200)]('Scanning\x20folder\x20for\x20bill\x20image:\x20'+_0x5b6d4a+',\x20timeout:\x20'+_0x11bcd7+'ms,\x20pollInterval:\x20'+_0x467e1c+'ms');Date[_0x207bb4(0x34e)]()-_0xd74bfd<_0x11bcd7;){_0x38ddce++;try{if(!(0x0,_0x1f3c0e[_0x207bb4(0x2fb)])(_0x5b6d4a)){await(0x0,_0xe0c5b7['sleep'])(_0x467e1c);continue;}const _0x95d9db=await(0x0,_0xe137e5['readdir'])(_0x5b6d4a);if(0x0===_0x95d9db['length']){await(0x0,_0xe0c5b7['sleep'])(_0x467e1c);continue;}const _0x1f14db=(await Promise['all'](_0x95d9db[_0x207bb4(0x4d4)](async _0x5bf391=>{const _0x5b87ad=_0x207bb4;try{const _0x29d721=(0x0,_0xb158f6[_0x5b87ad(0x282)])(_0x5b6d4a,_0x5bf391),_0x4001d6=await(0x0,_0xe137e5['stat'])(_0x29d721);return{'fullPath':_0x29d721,'mtime':_0x4001d6['mtimeMs'],'size':_0x4001d6[_0x5b87ad(0x336)]};}catch(_0x38e061){return null;}})))['filter'](_0x4c76f0=>null!==_0x4c76f0&&_0x4c76f0[_0x207bb4(0x336)]>0x0);if(0x0===_0x1f14db['length']){await(0x0,_0xe0c5b7['sleep'])(_0x467e1c);continue;}_0x1f14db['sort']((_0x50dc14,_0x3b9f46)=>_0x3b9f46['mtime']-_0x50dc14[_0x207bb4(0x2ee)]);const _0x1b03b0=_0x1f14db[0x0][_0x207bb4(0x2c2)],_0x5add73=Date['now']()-_0xd74bfd;return this[_0x207bb4(0x206)]['log']('Found\x20latest\x20bill\x20image:\x20'+_0x1b03b0+'\x20after\x20'+_0x5add73+_0x207bb4(0x2cf)+_0x38ddce+'\x20attempts)'),_0x1b03b0;}catch(_0x3a7328){this['logger'][_0x207bb4(0x200)]('Error\x20scanning\x20folder\x20'+_0x5b6d4a+_0x207bb4(0x32d)+_0x38ddce+_0x207bb4(0x3af)+_0x3a7328[_0x207bb4(0x4ad)]+',\x20retrying...'),await(0x0,_0xe0c5b7['sleep'])(_0x467e1c);}}const _0x3e1a25=Date['now']()-_0xd74bfd;return this[_0x207bb4(0x206)]['warn']('Timeout\x20scanning\x20folder\x20for\x20bill\x20image:\x20'+_0x5b6d4a+'\x20after\x20'+_0x3e1a25+'ms\x20('+_0x38ddce+'\x20attempts)'),null;}async['detectScreenByHint'](_0x12908d,_0x414d33,_0x4bf87f){const _0x22d424=_0x4f9eba,_0x3fb57f=(0x0,_0xb158f6['join'])(this['baseTransactionExecutionFolder'],'scan_'+_0x12908d),_0xb39932=_0x414d33['map'](_0x4a1bfa=>({'name':_0x4a1bfa[_0x22d424(0x420)],'hint':(0x0,_0x4c243c['removeVietnameseTones'])(_0x4a1bfa['hint'])})),_0x25465e=Date['now']();let _0x39553e=0x0;const {roi:_0x8f38f8,timeout:_0x3ec8c2,pollInterval:_0x1a0c71}=_0x4bf87f,_0x381f8f=_0x8f38f8?'ROI:\x20x='+_0x8f38f8['x']+',\x20y='+_0x8f38f8['y']+_0x22d424(0x4c1)+_0x8f38f8[_0x22d424(0x44a)]+',\x20h='+_0x8f38f8['height']:_0x22d424(0x2fd);this['logger']['debug']('['+_0x12908d+']\x20Start\x20detecting\x20screen.\x20Screen:\x20['+_0x414d33['map'](_0x52ff34=>_0x52ff34['name'])['join']('\x20or\x20')+'],\x20'+_0x381f8f+',\x20Timeout:\x20'+_0x3ec8c2+_0x22d424(0x265)+_0x1a0c71+'ms');try{for(await this['cleanupFolder'](_0x3fb57f,_0x12908d),await(0x0,_0xe137e5['mkdir'])(_0x3fb57f,{'recursive':!0x0});Date[_0x22d424(0x34e)]()-_0x25465e<_0x3ec8c2;){_0x39553e++;let _0x53123c=null;try{const _0x3fe0a1=Date[_0x22d424(0x34e)]();await this['wsService'][_0x22d424(0x3d6)](_0x12908d,{'folderPath':_0x3fb57f});let _0x2194f7=null;const _0x41249c=0x5;let _0x860a84=0x0;for(;_0x860a84<_0x41249c&&!_0x2194f7;){_0x860a84++,await(0x0,_0xe0c5b7['sleep'])(0x1f4);try{if(!(0x0,_0x1f3c0e['existsSync'])(_0x3fb57f))continue;const _0x4b18fe=(await(0x0,_0xe137e5['readdir'])(_0x3fb57f))['filter'](_0x47d017=>_0x47d017['endsWith']('.png'));if(0x0===_0x4b18fe['length'])continue;let _0x12b4a5=0x0;for(const _0x3c4af9 of _0x4b18fe){const _0x3ab269=(0x0,_0xb158f6['join'])(_0x3fb57f,_0x3c4af9);try{const _0x42179b=await(0x0,_0xe137e5[_0x22d424(0x2e5)])(_0x3ab269);if(0x0===_0x42179b['size'])continue;_0x42179b[_0x22d424(0x363)]>=_0x3fe0a1-0x7d0&&_0x42179b['mtimeMs']>_0x12b4a5&&(_0x12b4a5=_0x42179b['mtimeMs'],_0x2194f7=_0x3ab269);}catch(_0x3c0cef){continue;}}}catch(_0x49c476){continue;}}if(!_0x2194f7){await(0x0,_0xe0c5b7['sleep'])(_0x1a0c71);continue;}const _0x39a4b9=await(0x0,_0xe137e5['readFile'])(_0x2194f7),_0x3dae26=await this['imagePreprocessingService'][_0x22d424(0x251)](_0x39a4b9,_0x4bf87f['roi']?_0x4bf87f['roi']:{'x':0x0,'y':0x0,'width':0x1,'height':0x1},void 0x0,_0x4bf87f['preprocess']),_0x22a5e3=await this[_0x22d424(0x4a3)]['recognizeFromBuffer'](_0x3dae26['buffer']);if(!_0x22a5e3['text']){await(0x0,_0xe0c5b7['sleep'])(_0x1a0c71);continue;}const _0x4352d4=(0x0,_0x4c243c['removeVietnameseTones'])(_0x22a5e3['text']),_0x484f01=_0xb39932['find'](_0x506dae=>_0x4352d4['includes'](_0x506dae[_0x22d424(0x416)]));if(!_0x484f01){await(0x0,_0xe0c5b7['sleep'])(_0x1a0c71);continue;}if(_0x53123c)try{await(0x0,_0xe137e5['unlink'])(_0x53123c);}catch{}return _0x484f01;}catch(_0x10bc98){this[_0x22d424(0x206)]['debug']('['+_0x12908d+']\x20Error\x20verifying\x20screen\x20(attempt\x20'+_0x39553e+'):\x20'+_0x10bc98[_0x22d424(0x4ad)]+',\x20retrying...'),await(0x0,_0xe0c5b7['sleep'])(_0x1a0c71);}}await this[_0x22d424(0x431)](_0x3fb57f,_0x12908d);const _0x4c4c02=Date['now']()-_0x25465e;return this[_0x22d424(0x206)][_0x22d424(0x38c)]('['+_0x12908d+']\x20Screen\x20verification\x20timeout\x20after\x20'+_0x4c4c02+'ms\x20('+_0x39553e+'\x20attempts).\x20Expected:\x20Find\x20['+_0x414d33['join']('\x20or\x20')+'],'),null;}catch(_0xebdad8){throw await this['cleanupFolder'](_0x3fb57f,_0x12908d),_0xebdad8;}}async[_0x4f9eba(0x479)](_0x5f401a,_0x450e39,_0x221887,_0x3fc6d4,_0x4cd461){const _0x18c21a=_0x4f9eba;return await this[_0x18c21a(0x1da)]['click'](_0x5f401a,_0x450e39,_0x221887,0.2),_0x4cd461&&this['logger']['log'](_0x4cd461),await this['verifyScreenState'](_0x5f401a,_0x3fc6d4);}async['swipeAndWaitForScreen'](_0x316e1d,_0x59555f,_0x48c3bf,_0x2648ae){const _0x27207f=_0x4f9eba;for(let _0x40f2dc=0x1;_0x40f2dc<=0x3;_0x40f2dc++){if(await this['wsService'][_0x27207f(0x33e)](_0x316e1d,_0x59555f),await(0x0,_0xe0c5b7['sleep'])(0x320),_0x2648ae&&0x1===_0x40f2dc&&this['logger']['log'](_0x2648ae),await this['verifyScreenState'](_0x316e1d,{..._0x48c3bf,'timeout':0xbb8}))return _0x40f2dc>0x1&&this['logger']['log']('['+_0x316e1d+']\x20Screen\x20verified\x20after\x20'+_0x40f2dc+_0x27207f(0x351)),!0x0;try{const _0x30c099=(0x0,_0xb158f6[_0x27207f(0x282)])(this[_0x27207f(0x373)],'scan_'+_0x316e1d+_0x27207f(0x448));if((0x0,_0x1f3c0e['existsSync'])(_0x30c099))try{await(0x0,_0xe137e5['rm'])(_0x30c099,{'recursive':!0x0,'force':!0x0});}catch{}await(0x0,_0xe137e5[_0x27207f(0x36f)])(_0x30c099,{'recursive':!0x0});const _0x4eb936=Date['now']();await this['wsService'][_0x27207f(0x3d6)](_0x316e1d,{'folderPath':_0x30c099});let _0x47d9fa=null;const _0x14276e=0x5;let _0x2064b3=0x0;for(;_0x2064b3<_0x14276e&&!_0x47d9fa;){_0x2064b3++,await(0x0,_0xe0c5b7['sleep'])(0x1f4);try{if(!(0x0,_0x1f3c0e['existsSync'])(_0x30c099))continue;const _0x2fe46a=(await(0x0,_0xe137e5['readdir'])(_0x30c099))['filter'](_0x5c4343=>_0x5c4343['endsWith'](_0x27207f(0x47c)));if(0x0===_0x2fe46a['length'])continue;let _0x3bb143=0x0;for(const _0x5a5154 of _0x2fe46a){const _0x103934=(0x0,_0xb158f6[_0x27207f(0x282)])(_0x30c099,_0x5a5154);try{const _0x155f0d=await(0x0,_0xe137e5[_0x27207f(0x2e5)])(_0x103934);_0x155f0d['size']>0x0&&_0x155f0d['mtimeMs']>=_0x4eb936-0x7d0&&_0x155f0d['mtimeMs']>_0x3bb143&&(_0x3bb143=_0x155f0d['mtimeMs'],_0x47d9fa=_0x103934);}catch{}}}catch{}}if(_0x47d9fa){const {expectedTexts:_0x3d530f=[],unexpectedTexts:_0x3cb134=[],roi:_0x10f17f,fieldType:_0xc59a3d='full',preprocess:_0x18cc27}=_0x48c3bf,_0xf9b281=[..._0x3d530f,..._0x3cb134];let _0x4b577b='',_0x5b75f3=[];if(_0xf9b281[_0x27207f(0x20f)]>0x0){const _0x1da984=await this['ocrService']['fastScreenOCR'](_0x47d9fa,_0xf9b281,{'fieldType':_0x10f17f?'singleLine':_0xc59a3d,'customROI':_0x10f17f,'preprocess':_0x18cc27});_0x4b577b=_0x1da984?.['result']?.['text']||'',_0x5b75f3=_0x1da984?.['matchedTexts']||[];}else{const _0x3516c3=await this[_0x27207f(0x4a3)]['recognizeFromFile'](_0x47d9fa,{'fieldType':_0x10f17f?'singleLine':_0xc59a3d,'customROI':_0x10f17f,'preprocess':_0x18cc27});_0x4b577b=_0x3516c3?.['text']||'';}const _0x54cf58=_0x10f17f?'\x20ROI:\x20('+_0x10f17f['x']+','+_0x10f17f['y']+'\x20'+_0x10f17f[_0x27207f(0x44a)]+'x'+_0x10f17f['height']+')':'';_0x4b577b?this['logger'][_0x27207f(0x38c)]('['+_0x316e1d+']\x20Swipe\x20attempt\x20'+_0x40f2dc+_0x27207f(0x2f2)+_0x4b577b+'\x22'+(_0x5b75f3['length']>0x0?'\x20|\x20Matched\x20texts:\x20['+_0x5b75f3['join'](',\x20')+']':'')+('\x20|\x20Expected:\x20['+(_0x3d530f['join'](',\x20')||'none')+']'+_0x54cf58)):this['logger']['warn']('['+_0x316e1d+']\x20Swipe\x20attempt\x20'+_0x40f2dc+'/3\x20-\x20OCR\x20found\x20no\x20text'+_0x54cf58);}else this['logger']['warn']('['+_0x316e1d+']\x20Swipe\x20attempt\x20'+_0x40f2dc+_0x27207f(0x234)+_0x2064b3+'\x20attempts');try{await(0x0,_0xe137e5['rm'])(_0x30c099,{'recursive':!0x0,'force':!0x0});}catch{}}catch(_0x48e547){this['logger']['debug']('['+_0x316e1d+']\x20Failed\x20to\x20debug\x20OCR:\x20'+_0x48e547['message']);}_0x40f2dc<0x3&&this['logger'][_0x27207f(0x200)]('['+_0x316e1d+_0x27207f(0x3f4)+_0x40f2dc+_0x27207f(0x2ff));}return this['logger'][_0x27207f(0x38c)]('['+_0x316e1d+']\x20Failed\x20to\x20detect\x20screen\x20after\x203\x20swipe\x20attempts'),!0x1;}async['createBillFolder'](_0xe0a8e0){const _0x265965=(0x0,_0xb158f6['resolve'])(this['baseTransactionFolderPath'],_0xe0a8e0);await(0x0,_0xe137e5['mkdir'])(_0x265965,{'recursive':!0x0});}async['captureScreen'](_0x411c8e,_0x3770ab){const _0xd7b573=_0x4f9eba;this['logger']['log'](_0xd7b573(0x1e5)+_0x411c8e+'\x20with\x20folderPath:\x20'+_0x3770ab['folderPath']);const _0x1e502a=(0x0,_0xb158f6[_0xd7b573(0x259)])(this['baseTransactionFolderPath'],_0x3770ab['folderPath']);await this[_0xd7b573(0x1da)][_0xd7b573(0x3d6)](_0x411c8e,{..._0x3770ab,'folderPath':_0x1e502a}),await(0x0,_0xe0c5b7['sleep'])(0x1f4);}async['getBillImagePath'](_0x48d8d5,_0x5a1c53=0x2710,_0x5bb79d=0x1f4){const _0x59f83f=_0x4f9eba;if(!_0x48d8d5)return this['logger'][_0x59f83f(0x38c)](_0x59f83f(0x36d)),null;const _0x45c32b=(0x0,_0xb158f6[_0x59f83f(0x282)])(this['baseTransactionFolderPath'],_0x48d8d5),_0x172e03=Date[_0x59f83f(0x34e)]();let _0x5ac006=0x0;for(this['logger']['debug']('Scanning\x20folder\x20for\x20bill\x20image:\x20'+_0x48d8d5+',\x20timeout:\x20'+_0x5a1c53+'ms,\x20pollInterval:\x20'+_0x5bb79d+'ms');Date['now']()-_0x172e03<_0x5a1c53;){_0x5ac006++;try{if(!(0x0,_0x1f3c0e['existsSync'])(_0x45c32b)){await(0x0,_0xe0c5b7['sleep'])(_0x5bb79d);continue;}const _0x2eff92=await(0x0,_0xe137e5[_0x59f83f(0x4c3)])(_0x45c32b);if(0x0===_0x2eff92['length']){await(0x0,_0xe0c5b7[_0x59f83f(0x3b8)])(_0x5bb79d);continue;}const _0x5609c0=(await Promise[_0x59f83f(0x1e3)](_0x2eff92['map'](async _0x24d55c=>{const _0x595f22=_0x59f83f;try{const _0x1b7a82=(0x0,_0xb158f6[_0x595f22(0x282)])(_0x45c32b,_0x24d55c),_0x148dc4=await(0x0,_0xe137e5['stat'])(_0x1b7a82);return{'fullPath':_0x1b7a82,'mtime':_0x148dc4['mtimeMs'],'size':_0x148dc4[_0x595f22(0x336)]};}catch(_0x5a5c58){return null;}})))['filter'](_0x5326e1=>null!==_0x5326e1&&_0x5326e1['size']>0x0);if(0x0===_0x5609c0['length']){await(0x0,_0xe0c5b7['sleep'])(_0x5bb79d);continue;}_0x5609c0['sort']((_0x245009,_0x42ffa2)=>_0x42ffa2['mtime']-_0x245009['mtime']);const _0x27f47d=_0x5609c0[0x0][_0x59f83f(0x2c2)],_0x56ab6c=Date[_0x59f83f(0x34e)]()-_0x172e03;return this['logger']['log']('Found\x20latest\x20bill\x20image:\x20'+_0x27f47d+'\x20after\x20'+_0x56ab6c+'ms\x20('+_0x5ac006+'\x20attempts)'),_0x27f47d;}catch(_0x4ff459){this['logger']['debug']('Error\x20scanning\x20folder\x20'+_0x48d8d5+'\x20(attempt\x20'+_0x5ac006+'):\x20'+_0x4ff459['message']+',\x20retrying...'),await(0x0,_0xe0c5b7['sleep'])(_0x5bb79d);}}const _0xede1a0=Date[_0x59f83f(0x34e)]()-_0x172e03;return this[_0x59f83f(0x206)]['warn']('Timeout\x20scanning\x20folder\x20for\x20bill\x20image:\x20'+_0x48d8d5+'\x20after\x20'+_0xede1a0+_0x59f83f(0x2cf)+_0x5ac006+'\x20attempts)'),null;}async['analyzeTransferBill'](_0x262bcf,_0x2ab5a5){const _0x367a90=_0x4f9eba,{ROI:_0x80aadb,expectedTexts:_0x293a0c}=_0x20c43d['ANALYZE_BILL_ROI'][_0x262bcf],_0x513f1e=await this['getBillImagePath'](_0x2ab5a5['withdrawalCode']);try{if(!_0x513f1e)return this['logger']['warn']('No\x20bill\x20image\x20path\x20'+_0x2ab5a5[_0x367a90(0x44b)]),{'rawPath':null,'analyzedStatus':'na'};const _0x1e5e72=await this['ocrService'][_0x367a90(0x288)](_0x513f1e,_0x293a0c,{'fieldType':'singleLine','customROI':_0x80aadb,'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}});return _0x1e5e72[_0x367a90(0x350)]?{'rawPath':_0x513f1e,'analyzedStatus':_0x1e5e72['found']?'success':'unknown'}:(this['logger']['warn'](_0x367a90(0x4ae)+_0x2ab5a5[_0x367a90(0x44b)]),{'rawPath':_0x513f1e,'analyzedStatus':'na'});}catch(_0x3bb2d1){return this[_0x367a90(0x206)][_0x367a90(0x20b)]('Error\x20analyzing\x20transfer\x20bill:\x20'+_0x3bb2d1['message']),{'rawPath':_0x513f1e,'analyzedStatus':'na'};}}async['createQRCodeAndTransferTo'](_0x4e2395,_0xe1313b){const _0x48a6c2=_0x4f9eba,_0x5e46c8=(0x0,_0xb158f6['join'])(this['baseTransactionExecutionFolder'],'qrcode');await(0x0,_0xe137e5[_0x48a6c2(0x36f)])(_0x5e46c8,{'recursive':!0x0});const _0x2d0970='qr_'+_0xe1313b[_0x48a6c2(0x44b)]+'.png',_0x29f85c=(0x0,_0xb158f6['join'])(_0x5e46c8,_0x2d0970);await(0x0,_0x4152d6['toFile'])(_0x29f85c,_0xe1313b['transferCode'],{'type':'png','width':0xe4,'margin':0x2}),await(0x0,_0xe0c5b7['sleep'])(0x1f4),await this[_0x48a6c2(0x1da)][_0x48a6c2(0x48b)](_0x4e2395,_0x29f85c,0x1),await(0x0,_0xe0c5b7['sleep'])(0x1f4),this['logger']['log']('['+_0x4e2395+']\x20QR\x20code\x20is\x20created\x20and\x20transferred\x20for\x20withdrawal\x20'+_0xe1313b[_0x48a6c2(0x4dc)]);}};_0x1ccb7e['BaseBankService']=_0x29194,_0x29194['folderCreationInProgress']=!0x1,_0x29194['folderCreated']=!0x1,_0x1ccb7e['BaseBankService']=_0x29194=_0x43291a=_0x24a4bf([(0x0,_0xbdea22['Injectable'])(),_0x48fa54(0x0,(0x0,_0xbdea22['Inject'])(_0xd256f3['WEBSOCKET_SERVICE'])),_0x27c556(_0x4f9eba(0x2d9),[_0x4f9eba(0x42d)==typeof(_0x1693fd=void 0x0!==_0x18c59c['IWebSocketService']&&_0x18c59c['IWebSocketService'])?_0x1693fd:Object,_0x4f9eba(0x42d)==typeof(_0x191857=void 0x0!==_0x116869['DeviceService']&&_0x116869[_0x4f9eba(0x2a3)])?_0x191857:Object,'function'==typeof(_0x741a82=void 0x0!==_0x5d2df2[_0x4f9eba(0x3e0)]&&_0x5d2df2[_0x4f9eba(0x3e0)])?_0x741a82:Object,'function'==typeof(_0x91810d=void 0x0!==_0x4836e5[_0x4f9eba(0x30f)]&&_0x4836e5['ImagePreprocessingService'])?_0x91810d:Object])],_0x29194);},(_0x532c90,_0x5d6f9b)=>{const _0x1ff715=a0_0x4abd;Object['defineProperty'](_0x5d6f9b,'__esModule',{'value':!0x0}),_0x5d6f9b[_0x1ff715(0x3b8)]=void 0x0,_0x5d6f9b['sleep']=_0x298774=>new Promise(_0x2176b3=>setTimeout(_0x2176b3,_0x298774));},_0x459eb5=>{_0x459eb5['exports']=require('fs');},_0x1dabae=>{const _0x97fe50=a0_0x4abd;_0x1dabae[_0x97fe50(0x1c6)]=require('fs/promises');},function(_0x236343,_0x3a1e6b,_0xddc7b2){const _0x5d963a=a0_0x4abd;var _0x5a683e,_0x3a4556,_0x4e5827,_0x5e407f=this&&this['__decorate']||function(_0x89a8a,_0xa79352,_0x549681,_0x865a94){const _0x4b6e48=a0_0x4abd;var _0x520943,_0x1dfab4=arguments['length'],_0x5ba8e8=_0x1dfab4<0x3?_0xa79352:null===_0x865a94?_0x865a94=Object['getOwnPropertyDescriptor'](_0xa79352,_0x549681):_0x865a94;if('object'==typeof Reflect&&_0x4b6e48(0x42d)==typeof Reflect['decorate'])_0x5ba8e8=Reflect[_0x4b6e48(0x40a)](_0x89a8a,_0xa79352,_0x549681,_0x865a94);else{for(var _0x22da16=_0x89a8a['length']-0x1;_0x22da16>=0x0;_0x22da16--)(_0x520943=_0x89a8a[_0x22da16])&&(_0x5ba8e8=(_0x1dfab4<0x3?_0x520943(_0x5ba8e8):_0x1dfab4>0x3?_0x520943(_0xa79352,_0x549681,_0x5ba8e8):_0x520943(_0xa79352,_0x549681))||_0x5ba8e8);}return _0x1dfab4>0x3&&_0x5ba8e8&&Object['defineProperty'](_0xa79352,_0x549681,_0x5ba8e8),_0x5ba8e8;},_0x17149d=this&&this['__metadata']||function(_0x5c3516,_0x511a14){const _0x5511c2=a0_0x4abd;if('object'==typeof Reflect&&_0x5511c2(0x42d)==typeof Reflect[_0x5511c2(0x47a)])return Reflect[_0x5511c2(0x47a)](_0x5c3516,_0x511a14);};Object[_0x5d963a(0x38d)](_0x3a1e6b,'__esModule',{'value':!0x0}),_0x3a1e6b['OCRService']=_0x3a1e6b['PreprocessOptions']=_0x3a1e6b['ROI']=void 0x0;const _0x377db5=_0xddc7b2(0x2),_0x14843f=_0xddc7b2(0x1a),_0xaef647=_0xddc7b2(0x1c),_0xa37c52=_0xddc7b2(0x1e),_0x55edf5=_0xddc7b2(0x20),_0x5ba418=_0xddc7b2(0x11);var _0x5a2c01=_0xddc7b2(0x1e);Object[_0x5d963a(0x38d)](_0x3a1e6b,_0x5d963a(0x33c),{'enumerable':!0x0,'get':function(){const _0x271114=_0x5d963a;return _0x5a2c01[_0x271114(0x33c)];}}),Object['defineProperty'](_0x3a1e6b,_0x5d963a(0x21b),{'enumerable':!0x0,'get':function(){const _0x4e5d14=_0x5d963a;return _0x5a2c01[_0x4e5d14(0x21b)];}});const _0x3353e0={'crop':{'x':0x0,'y':0x0,'width':0x1,'height':0x1},'psm':0x6,'charWhitelist':void 0x0,'maxWidth':0x4b0};let _0x7f934b=_0x5a683e=class{constructor(_0x5a626a,_0xc00a3a){const _0x3e9360=_0x5d963a;this['workerPoolService']=_0x5a626a,this[_0x3e9360(0x2f1)]=_0xc00a3a,this['logger']=new _0x377db5['Logger'](_0x5a683e[_0x3e9360(0x420)]),this['ocrConfig']={'poolSize':_0x5ba418['config']['ocr']['poolSize'],'lang':_0x5ba418['config'][_0x3e9360(0x212)][_0x3e9360(0x338)],'rois':{'full':_0x3353e0,'singleLine':{..._0x3353e0,'psm':0x7},'block':{..._0x3353e0,'psm':0x6}}};}['validateROI'](_0x4357e3){const _0x547e4a=_0x5d963a;return{'x':Math[_0x547e4a(0x4d6)](0x0,Math['min'](0x1,_0x4357e3['x']||0x0)),'y':Math['max'](0x0,Math['min'](0x1,_0x4357e3['y']||0x0)),'width':Math['max'](0.01,Math['min'](0x1,_0x4357e3[_0x547e4a(0x44a)]||0x1)),'height':Math['max'](0.01,Math[_0x547e4a(0x4ab)](0x1,_0x4357e3['height']||0x1))};}['getROIConfig'](_0x1aa0fd){const _0x480858=_0x5d963a,_0x16058b=this['ocrConfig']['rois']?.[_0x1aa0fd]||this[_0x480858(0x3c7)]['rois']?.[_0x480858(0x1e1)]||_0x3353e0;return{'crop':_0x16058b['crop']||_0x3353e0[_0x480858(0x2ed)],'psm':_0x16058b[_0x480858(0x371)]??_0x3353e0[_0x480858(0x371)],'charWhitelist':_0x16058b['charWhitelist'],'maxWidth':_0x16058b[_0x480858(0x281)]??_0x3353e0['maxWidth']};}async['recognizeFromFile'](_0x45edb0,_0x314548={}){const _0xda6363=_0x5d963a,_0x516da5=Date['now'](),_0x4f5708={'decodeImage':0x0,'preprocess':0x0,'ocrRecognize':0x0,'postprocess':0x0};try{const _0x21764c=Date[_0xda6363(0x34e)](),_0x38c856=await(0x0,_0x14843f['readFile'])(_0x45edb0);_0x4f5708['decodeImage']=Date[_0xda6363(0x34e)]()-_0x21764c;const _0x525180=_0x314548['fieldType']||'full',_0x2699be=this['getROIConfig'](_0x525180),_0x2fdd82=this['validateROI'](_0x314548['customROI']||_0x2699be[_0xda6363(0x2ed)]),_0x3c39cd=Date['now'](),_0x5c4df8=await this['imagePreprocessingService']['preprocess'](_0x38c856,_0x2fdd82,_0x2699be[_0xda6363(0x281)],_0x314548[_0xda6363(0x251)]);_0x4f5708[_0xda6363(0x251)]=Date[_0xda6363(0x34e)]()-_0x3c39cd;const _0x1c6088=Date['now'](),_0x1ff7d5=await this['workerPoolService']['recognize'](_0x5c4df8['buffer'],{'psm':_0x2699be[_0xda6363(0x371)],'charWhitelist':_0x2699be[_0xda6363(0x1e0)]});_0x4f5708['ocrRecognize']=Date[_0xda6363(0x34e)]()-_0x1c6088;const _0x548610=Date['now'](),_0x1f51e9=this['postprocessText'](_0x1ff7d5[_0xda6363(0x2ad)]);_0x4f5708['postprocess']=Date[_0xda6363(0x34e)]()-_0x548610;const _0x4f2bed=Date['now']()-_0x516da5;return this[_0xda6363(0x487)](_0x45edb0,_0x525180,_0x4f2bed,_0x4f5708,_0x1ff7d5['confidence']),{'text':_0x1f51e9,'confidence':_0x1ff7d5['confidence'],'processingTime':_0x4f2bed,'timingBreakdown':_0x4f5708};}catch(_0x4390ed){return this[_0xda6363(0x206)]['error']('OCR\x20error\x20for\x20'+_0x45edb0+':\x20'+_0x4390ed['message'],_0x4390ed['stack']),null;}}async['recognizeFromBuffer'](_0x13cba9,_0xc08f85={}){const _0x28018f=_0x5d963a,_0x1c62fe=Date['now'](),_0x33f80e={'decodeImage':0x0,'preprocess':0x0,'ocrRecognize':0x0,'postprocess':0x0};try{_0x33f80e['decodeImage']=0x0;const _0x49fb98=_0xc08f85['fieldType']||'full',_0x57163a=this['getROIConfig'](_0x49fb98),_0x3f5e74=this['validateROI'](_0xc08f85['customROI']||_0x57163a[_0x28018f(0x2ed)]),_0x23ee23=Date['now'](),_0x572795=await this['imagePreprocessingService'][_0x28018f(0x251)](_0x13cba9,_0x3f5e74,_0x57163a['maxWidth'],_0xc08f85['preprocess']);_0x33f80e['preprocess']=Date[_0x28018f(0x34e)]()-_0x23ee23;const _0x2a07c3=Date['now'](),_0x55cbf8=await this[_0x28018f(0x27d)][_0x28018f(0x470)](_0x572795[_0x28018f(0x399)],{'psm':_0x57163a['psm'],'charWhitelist':_0x57163a['charWhitelist']});_0x33f80e[_0x28018f(0x3f1)]=Date['now']()-_0x2a07c3;const _0x40e5a7=Date[_0x28018f(0x34e)](),_0x1b3a82=this['postprocessText'](_0x55cbf8['text']);_0x33f80e['postprocess']=Date[_0x28018f(0x34e)]()-_0x40e5a7;const _0x1d6a39=Date['now']()-_0x1c62fe;return this['logTimingBreakdown'](_0x28018f(0x399),_0x49fb98,_0x1d6a39,_0x33f80e,_0x55cbf8['confidence']),{'text':_0x1b3a82,'confidence':_0x55cbf8[_0x28018f(0x480)],'processingTime':_0x1d6a39,'timingBreakdown':_0x33f80e};}catch(_0x5a6c3b){return this['logger']['error']('OCR\x20error\x20from\x20buffer:\x20'+_0x5a6c3b[_0x28018f(0x4ad)],_0x5a6c3b['stack']),null;}}async['fastScreenOCR'](_0x23adf0,_0xe1d907,_0x457eac={}){const _0x4102f1=_0x5d963a,_0x4353b7=await this['recognizeFromFile'](_0x23adf0,{'fieldType':_0x457eac['fieldType']||'full','customROI':_0x457eac[_0x4102f1(0x2b9)],'preprocess':_0x457eac['preprocess']});if(!_0x4353b7||!_0x4353b7['text'])return{'found':!0x1,'matchedTexts':[],'result':_0x4353b7};const _0x42a808=(0x0,_0x55edf5[_0x4102f1(0x2eb)])(_0x4353b7['text']),_0x5bbe3c=_0xe1d907['filter'](_0x1f5c6b=>_0x42a808[_0x4102f1(0x424)]((0x0,_0x55edf5[_0x4102f1(0x2eb)])(_0x1f5c6b)));return{'found':_0x5bbe3c['length']>0x0,'matchedTexts':_0x5bbe3c,'result':_0x4353b7};}['postprocessText'](_0x4e2bd9){return _0x4e2bd9['trim']()['replace'](/\s+/g,'\x20')['replace'](/\n{3,}/g,'\x0a\x0a');}[_0x5d963a(0x487)](_0x414932,_0x43fc6f,_0x33eb8f,_0x363cf0,_0x5a8474){const _0x4eb4df=_0x5d963a;[_0x4eb4df(0x48a)+_0x363cf0[_0x4eb4df(0x1fe)]+'ms','preprocess='+_0x363cf0['preprocess']+'ms','ocr='+_0x363cf0['ocrRecognize']+'ms',_0x4eb4df(0x38e)+_0x363cf0[_0x4eb4df(0x26e)]+'ms']['join']('\x20|\x20'),_0x33eb8f>0x3e8&&this['logger'][_0x4eb4df(0x38c)]('‚ö†Ô∏è\x20OCR\x20latency\x20exceeded\x20target:\x20'+_0x33eb8f+_0x4eb4df(0x3fd));}};_0x3a1e6b['OCRService']=_0x7f934b,_0x3a1e6b[_0x5d963a(0x3e0)]=_0x7f934b=_0x5a683e=_0x5e407f([(0x0,_0x377db5['Injectable'])(),_0x17149d('design:paramtypes',[_0x5d963a(0x42d)==typeof(_0x3a4556=void 0x0!==_0xaef647[_0x5d963a(0x308)]&&_0xaef647['OCRWorkerPoolService'])?_0x3a4556:Object,_0x5d963a(0x42d)==typeof(_0x4e5827=void 0x0!==_0xa37c52['ImagePreprocessingService']&&_0xa37c52['ImagePreprocessingService'])?_0x4e5827:Object])],_0x7f934b);},function(_0x43c243,_0x665136,_0x4a9d70){const _0x27442b=a0_0x4abd;var _0x4a59c7=this&&this['__decorate']||function(_0x1fdf5d,_0xe2536f,_0x31ba2f,_0x5dd2cb){const _0x509ba4=a0_0x4abd;var _0x3dc958,_0x13dd40=arguments['length'],_0x34aca9=_0x13dd40<0x3?_0xe2536f:null===_0x5dd2cb?_0x5dd2cb=Object[_0x509ba4(0x4a5)](_0xe2536f,_0x31ba2f):_0x5dd2cb;if(_0x509ba4(0x2f0)==typeof Reflect&&_0x509ba4(0x42d)==typeof Reflect['decorate'])_0x34aca9=Reflect['decorate'](_0x1fdf5d,_0xe2536f,_0x31ba2f,_0x5dd2cb);else{for(var _0x21d627=_0x1fdf5d[_0x509ba4(0x20f)]-0x1;_0x21d627>=0x0;_0x21d627--)(_0x3dc958=_0x1fdf5d[_0x21d627])&&(_0x34aca9=(_0x13dd40<0x3?_0x3dc958(_0x34aca9):_0x13dd40>0x3?_0x3dc958(_0xe2536f,_0x31ba2f,_0x34aca9):_0x3dc958(_0xe2536f,_0x31ba2f))||_0x34aca9);}return _0x13dd40>0x3&&_0x34aca9&&Object['defineProperty'](_0xe2536f,_0x31ba2f,_0x34aca9),_0x34aca9;},_0x3c3aff=this&&this['__metadata']||function(_0x3e0bf7,_0x37f2b3){const _0x1fdb28=a0_0x4abd;if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect[_0x1fdb28(0x47a)](_0x3e0bf7,_0x37f2b3);};Object[_0x27442b(0x38d)](_0x665136,'__esModule',{'value':!0x0}),_0x665136['OCRWorkerPoolService']=void 0x0;const _0x186bfb=_0x4a9d70(0x2),_0x5cb755=_0x4a9d70(0x1d),_0x24cb6f=_0x4a9d70(0x11);let _0x1907b1=class{constructor(){const _0x592165=_0x27442b;this['logger']=new _0x186bfb['Logger'](_0x592165(0x308)),this['pool']=[],this[_0x592165(0x3d3)]=[],this['maxWaitTime']=0x1388,this['maxPoolSize']=0xa,this['isInitializing']=!0x1,this[_0x592165(0x21d)]=!0x1,this['isAcquiring']=!0x1,this['initializationPromise']=null,this[_0x592165(0x1f0)]=Math[_0x592165(0x4d6)](0x1,Math['min'](_0x24cb6f['config']['ocr']['poolSize'],this[_0x592165(0x393)])),this['lang']=_0x24cb6f['config'][_0x592165(0x212)]['lang'],_0x24cb6f['config']['ocr']['poolSize']>this[_0x592165(0x393)]&&this['logger']['warn']('OCR_POOL_SIZE\x20('+_0x24cb6f['config']['ocr'][_0x592165(0x1f0)]+')\x20exceeds\x20maximum\x20('+this['maxPoolSize']+_0x592165(0x2ea)+this[_0x592165(0x393)]+'.');}async['onModuleInit'](){const _0x5a2d26=_0x27442b;await this[_0x5a2d26(0x398)]();}async['onModuleDestroy'](){const _0x41daa3=_0x27442b;this['isDestroyed']=!0x0,this['rejectAllPending'](new Error(_0x41daa3(0x346))),await this['terminateAll']();}async['warmPool'](){const _0x3ff959=_0x27442b;if(this['isInitializing'])return this['initializationPromise']||Promise[_0x3ff959(0x259)]();this['isInitializing']=!0x0,this['initializationPromise']=this['doWarmPool']();try{await this['initializationPromise'];}finally{this[_0x3ff959(0x4c9)]=!0x1;}}async['doWarmPool'](){const _0x39f35a=_0x27442b,_0x13fcfc=Date[_0x39f35a(0x34e)]();this['logger'][_0x39f35a(0x4dd)]('Warming\x20up\x20OCR\x20worker\x20pool\x20(size:\x20'+this['poolSize']+',\x20lang:\x20'+this['lang']+')...');const _0x1c8a00=Array['from']({'length':this[_0x39f35a(0x1f0)]},(_0x194b9f,_0x550f97)=>this[_0x39f35a(0x381)](_0x550f97));try{await Promise['all'](_0x1c8a00);const _0x2e1e3c=Date[_0x39f35a(0x34e)]()-_0x13fcfc;this['logger'][_0x39f35a(0x4dd)](_0x39f35a(0x3d2)+_0x2e1e3c+'ms.\x20Pool\x20size:\x20'+this['pool']['length']);}catch(_0x247822){throw this['logger'][_0x39f35a(0x20b)](_0x39f35a(0x249)+_0x247822['message'],_0x247822['stack']),await this[_0x39f35a(0x313)](),_0x247822;}}async[_0x27442b(0x381)](_0x4ef337){const _0x3dfd02=_0x27442b;try{const _0x4e384a=await _0x5cb755[_0x3dfd02(0x381)](this['lang'],0x1,{'logger':_0x272341=>{const _0x1cae42=_0x3dfd02;'error'===_0x272341[_0x1cae42(0x2be)]&&this['logger'][_0x1cae42(0x20b)]('Tesseract\x20worker\x20'+_0x4ef337+'\x20error:\x20'+_0x272341[_0x1cae42(0x4ad)]);}});this['pool']['push']({'id':_0x4ef337,'worker':_0x4e384a,'inUse':!0x1,'lastUsed':Date['now']()}),this['logger']['debug']('Worker\x20'+_0x4ef337+'\x20created\x20successfully');}catch(_0x2a2b4e){throw this['logger']['error']('Failed\x20to\x20create\x20worker\x20'+_0x4ef337+':\x20'+_0x2a2b4e['message']),_0x2a2b4e;}}async['acquireWorker'](){const _0x256ef8=_0x27442b;if(this['isDestroyed'])throw new Error(_0x256ef8(0x388));return this['isInitializing']&&this[_0x256ef8(0x255)]&&await this[_0x256ef8(0x255)],this[_0x256ef8(0x4da)]()||this[_0x256ef8(0x21f)]();}['tryAcquireFromPool'](){const _0x97219f=_0x27442b;if(this[_0x97219f(0x233)])return null;this['isAcquiring']=!0x0;try{for(const _0x5eb7e8 of this['pool'])if(!_0x5eb7e8['inUse'])return _0x5eb7e8['inUse']=!0x0,_0x5eb7e8['lastUsed']=Date[_0x97219f(0x34e)](),_0x5eb7e8;return null;}finally{this['isAcquiring']=!0x1;}}['waitForWorker'](){return new Promise((_0x12c7c1,_0x1680e9)=>{const _0x31cda1=setTimeout(()=>{const _0x20ccd5=a0_0x4abd,_0x38ee09=this['waitingQueue'][_0x20ccd5(0x356)](_0x522300=>_0x522300[_0x20ccd5(0x259)]===_0x12c7c1);-0x1!==_0x38ee09&&this['waitingQueue']['splice'](_0x38ee09,0x1),this['logger'][_0x20ccd5(0x38c)]('Timeout\x20waiting\x20for\x20worker,\x20creating\x20temporary\x20worker'),this['createTemporaryWorker']()['then'](_0x12c7c1)[_0x20ccd5(0x499)](_0x1680e9);},this['maxWaitTime']);this['waitingQueue']['push']({'resolve':_0x12c7c1,'reject':_0x1680e9,'timeout':_0x31cda1});});}async['createTemporaryWorker'](){return{'id':-0x1,'worker':await _0x5cb755['createWorker'](this['lang'],0x1,{'logger':()=>{}}),'inUse':!0x0,'lastUsed':Date['now']()};}['releaseWorker'](_0x5f3df8){const _0x55272d=_0x27442b;if(this['waitingQueue']['length']>0x0){const _0x543c9c=this['waitingQueue']['shift']();clearTimeout(_0x543c9c['timeout']),_0x5f3df8[_0x55272d(0x221)]=Date['now'](),_0x543c9c['resolve'](_0x5f3df8);}else _0x5f3df8[_0x55272d(0x31f)]=!0x1,_0x5f3df8[_0x55272d(0x221)]=Date[_0x55272d(0x34e)]();}['rejectAllPending'](_0x3f10ba){const _0x5ad6ba=_0x27442b;for(;this['waitingQueue'][_0x5ad6ba(0x20f)]>0x0;){const _0x94e952=this['waitingQueue']['shift']();clearTimeout(_0x94e952['timeout']),_0x94e952[_0x5ad6ba(0x461)](_0x3f10ba);}}async['recognize'](_0x516717,_0x30a317={}){const _0x1317de=_0x27442b,_0x310598=await this['acquireWorker'](),_0x97dcab=_0x310598['id']<0x0,{psm:_0x25f444,charWhitelist:_0x1dc941}=_0x30a317,_0x26fd28=void 0x0!==_0x25f444||!!_0x1dc941;try{const _0x561739={};void 0x0!==_0x25f444&&(_0x561739['tessedit_pageseg_mode']=_0x25f444),_0x1dc941&&(_0x561739[_0x1317de(0x299)]=_0x1dc941),Object['keys'](_0x561739)['length']>0x0&&await _0x310598['worker']['setParameters'](_0x561739);const {data:_0x35005f}=await _0x310598['worker']['recognize'](_0x516717);return{'text':_0x35005f['text'],'confidence':_0x35005f['confidence']};}finally{if(_0x97dcab)try{await _0x310598['worker'][_0x1317de(0x3cf)]();}catch(_0x3f18d1){this['logger']['warn']('Failed\x20to\x20terminate\x20temporary\x20worker:\x20'+_0x3f18d1[_0x1317de(0x4ad)]);}else{if(_0x26fd28)try{await _0x310598[_0x1317de(0x41d)]['setParameters']({'tessedit_pageseg_mode':0x6,'tessedit_char_whitelist':''});}catch(_0x3ead4c){this[_0x1317de(0x206)]['warn']('Failed\x20to\x20reset\x20worker\x20parameters:\x20'+_0x3ead4c['message']);}this['releaseWorker'](_0x310598);}}}[_0x27442b(0x334)](){const _0x17d515=_0x27442b;return{'total':this[_0x17d515(0x341)]['length'],'inUse':this['pool'][_0x17d515(0x391)](_0x3bf66d=>_0x3bf66d['inUse'])['length'],'waiting':this['waitingQueue']['length']};}async['terminateAll'](){const _0x49e959=_0x27442b;if(0x0===this['pool'][_0x49e959(0x20f)])return;this[_0x49e959(0x206)]['log'](_0x49e959(0x339)+this['pool']['length']+'\x20OCR\x20workers...');const _0x1f4557=this['pool']['map'](_0x34210e=>_0x34210e[_0x49e959(0x41d)]['terminate']()['then'](()=>{this['logger']['debug']('Worker\x20'+_0x34210e['id']+'\x20terminated');})['catch'](_0x498881=>{this['logger']['error']('Error\x20terminating\x20worker\x20'+_0x34210e['id']+':\x20'+_0x498881['message']);}));await Promise['all'](_0x1f4557),this[_0x49e959(0x341)]['length']=0x0,this['logger']['log']('All\x20OCR\x20workers\x20terminated');}};_0x665136['OCRWorkerPoolService']=_0x1907b1,_0x665136[_0x27442b(0x308)]=_0x1907b1=_0x4a59c7([(0x0,_0x186bfb['Injectable'])(),_0x3c3aff('design:paramtypes',[])],_0x1907b1);},_0x4b8952=>{_0x4b8952['exports']=require('tesseract.js');},function(_0xd84bcd,_0xe72193,_0x5ec3f6){const _0x429ae2=a0_0x4abd;var _0x332976=this&&this['__decorate']||function(_0x5dfb65,_0xaa5744,_0x1f9868,_0x4bc8b5){const _0x36082f=a0_0x4abd;var _0x59e10c,_0xeee2d3=arguments['length'],_0x516413=_0xeee2d3<0x3?_0xaa5744:null===_0x4bc8b5?_0x4bc8b5=Object[_0x36082f(0x4a5)](_0xaa5744,_0x1f9868):_0x4bc8b5;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x516413=Reflect['decorate'](_0x5dfb65,_0xaa5744,_0x1f9868,_0x4bc8b5);else{for(var _0x18b010=_0x5dfb65['length']-0x1;_0x18b010>=0x0;_0x18b010--)(_0x59e10c=_0x5dfb65[_0x18b010])&&(_0x516413=(_0xeee2d3<0x3?_0x59e10c(_0x516413):_0xeee2d3>0x3?_0x59e10c(_0xaa5744,_0x1f9868,_0x516413):_0x59e10c(_0xaa5744,_0x1f9868))||_0x516413);}return _0xeee2d3>0x3&&_0x516413&&Object['defineProperty'](_0xaa5744,_0x1f9868,_0x516413),_0x516413;};Object['defineProperty'](_0xe72193,'__esModule',{'value':!0x0}),_0xe72193[_0x429ae2(0x30f)]=void 0x0;const _0x3a3f2a=_0x5ec3f6(0x2),_0x37e419=_0x5ec3f6(0x1f);let _0x3cbc8f=class{constructor(){this['logger']=new _0x3a3f2a['Logger']('ImagePreprocessingService'),this['MIN_DIMENSION']=0xa;}['validateROI'](_0x30183a){const _0x267b32=_0x429ae2;if(_0x30183a['x']<0x0||_0x30183a['x']>0x1)throw new Error(_0x267b32(0x2a9)+_0x30183a['x']+'\x20(must\x20be\x200-1)');if(_0x30183a['y']<0x0||_0x30183a['y']>0x1)throw new Error(_0x267b32(0x4cc)+_0x30183a['y']+_0x267b32(0x1db));if(_0x30183a['width']<=0x0||_0x30183a['width']>0x1)throw new Error('Invalid\x20ROI\x20width:\x20'+_0x30183a['width']+'\x20(must\x20be\x200-1)');if(_0x30183a['height']<=0x0||_0x30183a['height']>0x1)throw new Error('Invalid\x20ROI\x20height:\x20'+_0x30183a['height']+_0x267b32(0x1db));if(_0x30183a['x']+_0x30183a['width']>1.001)throw new Error(_0x267b32(0x43d)+_0x30183a['x']+')\x20+\x20width('+_0x30183a['width']+')\x20>\x201');if(_0x30183a['y']+_0x30183a[_0x267b32(0x29e)]>1.001)throw new Error('ROI\x20extends\x20beyond\x20image:\x20y('+_0x30183a['y']+_0x267b32(0x3fa)+_0x30183a[_0x267b32(0x29e)]+')\x20>\x201');}async[_0x429ae2(0x251)](_0x57744b,_0x3b20b2,_0x1f4287,_0x16e831={}){const _0x51644f=_0x429ae2;try{this['validateROI'](_0x3b20b2);const _0x51a374=_0x37e419(_0x57744b),_0x3f0999=await _0x51a374[_0x51644f(0x47a)](),_0x4e4a54=_0x3f0999['width']||0x0,_0x1f3477=_0x3f0999['height']||0x0;if(0x0===_0x4e4a54||0x0===_0x1f3477)throw new Error('Invalid\x20image\x20dimensions:\x20width\x20or\x20height\x20is\x200');if(_0x4e4a54<this[_0x51644f(0x248)]||_0x1f3477<this['MIN_DIMENSION'])throw new Error(_0x51644f(0x29a)+_0x4e4a54+'x'+_0x1f3477+'\x20(min:\x20'+this['MIN_DIMENSION']+'x'+this[_0x51644f(0x248)]+')');const _0x383fea=Math['floor'](_0x3b20b2['x']*_0x4e4a54),_0x48ae21=Math['floor'](_0x3b20b2['y']*_0x1f3477),_0x22e491=Math['floor'](_0x3b20b2[_0x51644f(0x44a)]*_0x4e4a54),_0x51313d=Math['floor'](_0x3b20b2['height']*_0x1f3477),_0x2dc79e=Math['max'](0x0,Math['min'](_0x383fea,_0x4e4a54-0x1)),_0x544cb3=Math['max'](0x0,Math['min'](_0x48ae21,_0x1f3477-0x1)),_0x3d7cff=Math[_0x51644f(0x4d6)](this['MIN_DIMENSION'],Math['min'](_0x22e491,_0x4e4a54-_0x2dc79e)),_0x21cd8c=Math['max'](this['MIN_DIMENSION'],Math['min'](_0x51313d,_0x1f3477-_0x544cb3));let _0xdea9d1=_0x51a374[_0x51644f(0x397)]()[_0x51644f(0x426)]({'left':_0x2dc79e,'top':_0x544cb3,'width':_0x3d7cff,'height':_0x21cd8c}),_0x192287=_0x3d7cff,_0x4e396d=_0x21cd8c,_0x517609=0x1;return _0x1f4287&&_0x3d7cff>_0x1f4287&&(_0x517609=_0x1f4287/_0x3d7cff,_0x192287=_0x1f4287,_0x4e396d=Math['max'](this['MIN_DIMENSION'],Math[_0x51644f(0x42b)](_0x21cd8c*_0x517609)),_0xdea9d1=_0xdea9d1[_0x51644f(0x493)](_0x192287,_0x4e396d,{'kernel':_0x37e419['kernel']['lanczos3'],'withoutEnlargement':!0x0})),_0x16e831['grayscale']&&(_0xdea9d1=_0xdea9d1[_0x51644f(0x47e)]()),_0x16e831['enhanceContrast']&&(_0xdea9d1=_0xdea9d1['normalize']()),{'buffer':await _0xdea9d1['png']()[_0x51644f(0x3b3)](),'metadata':{'originalWidth':_0x4e4a54,'originalHeight':_0x1f3477,'processedWidth':_0x192287,'processedHeight':_0x4e396d,'scaleFactor':_0x517609}};}catch(_0xbf9b68){throw this['logger']['error']('Image\x20preprocessing\x20error:\x20'+_0xbf9b68['message'],_0xbf9b68['stack']),_0xbf9b68;}}};_0xe72193[_0x429ae2(0x30f)]=_0x3cbc8f,_0xe72193[_0x429ae2(0x30f)]=_0x3cbc8f=_0x332976([(0x0,_0x3a3f2a['Injectable'])()],_0x3cbc8f);},_0x3c1aa5=>{_0x3c1aa5['exports']=require('sharp');},(_0x49fe2f,_0xefb659)=>{const _0x371e7b=a0_0x4abd;Object['defineProperty'](_0xefb659,'__esModule',{'value':!0x0}),_0xefb659['normalizeBankAccountName']=_0xefb659['removeVietnameseTones']=void 0x0,_0xefb659['removeVietnameseTones']=_0xf8280c=>_0xf8280c?_0xf8280c['normalize']('NFD')['replace'](/[\u0300-\u036f]/g,'')['replace'](/ƒë/g,'d')['replace'](/ƒê/g,'D'):'',_0xefb659['normalizeBankAccountName']=_0x18f4f2=>_0x18f4f2?(0x0,_0xefb659[_0x371e7b(0x385)])(_0x18f4f2)['trim']()[_0x371e7b(0x3c3)](/ /g,'')['toLocaleUpperCase']():'';},_0x4a8139=>{const _0x12ffea=a0_0x4abd;_0x4a8139[_0x12ffea(0x1c6)]=require('qrcode');},(_0x55f4fb,_0x4ff624,_0x51bb7b)=>{const _0x5cfc4d=a0_0x4abd;Object['defineProperty'](_0x4ff624,'__esModule',{'value':!0x0}),_0x4ff624['ANALYZE_BILL_ROI']=void 0x0;const _0x7b8a97=_0x51bb7b(0x23),_0xae3f97=_0x51bb7b(0x24),_0x1e56c5=_0x51bb7b(0x25);_0x4ff624[_0x5cfc4d(0x4b9)]={'PGBANK':{'ROI':_0xae3f97[_0x5cfc4d(0x21a)]['TRANSACTION_SUCCESS'],'expectedTexts':['chuy·ªÉn\x20ti·ªÅn\x20th√†nh\x20c√¥ng']},'HDBANK':{'ROI':_0x7b8a97['HD_ROI_EXPECTED'][_0x5cfc4d(0x230)],'expectedTexts':['K·∫øt\x20qu·∫£\x20giao\x20d·ªãch']},'VIETCOMBANK':{'ROI':_0x1e56c5['VCB_ROI_EXPECTED']['TRANSACTION_SUCCESS'],'expectedTexts':[_0x5cfc4d(0x1fb)]}};},(_0x12cd91,_0x4f6bbe)=>{Object['defineProperty'](_0x4f6bbe,'__esModule',{'value':!0x0}),_0x4f6bbe['HD_ROI_EXPECTED']=void 0x0,_0x4f6bbe['HD_ROI_EXPECTED']={'LAUNCH_APP':{'x':0.1,'y':0.54,'width':0.7,'height':0.1},'VERIFY_ACCOUNT_NUMBER':{'x':0.05,'y':0.4,'width':0.9,'height':0.2},'VERIFY_ACCOUNT_NAME':{'x':0.05,'y':0.6,'width':0.8,'height':0.2},'OTP_ENTER':{'x':0.1,'y':0.25,'width':0.8,'height':0.1},'TRANSACTION_VERIFY':{'x':0.1,'y':0.5,'width':0.4,'height':0.1},'TRANSACTION_SUCCESS':{'x':0.2,'y':0.3,'width':0.6,'height':0.1},'BILL_AREA':{'x':0.085,'y':0.025,'width':0.6,'height':0.075},'HOME_SCREEN':{'x':0.02,'y':0.7,'width':0.98,'height':0.3},'ALBUM_SCREEN':{'x':0.18,'y':0.02,'width':0.8,'height':0.085},'SWIPE_UP_SCREEN':{'x':0.01,'y':0.5,'width':0.5,'height':0.1},'WARNING_TRANSACTION':{'x':0.14,'y':0.39,'width':0.72,'height':0.2},'OTP_ENTER_OR_CONTINUE_TRANSFER':{'x':0.03,'y':0.1,'width':0.95,'height':0.5},'CONFIRM_AFTER_OTP':{'x':0.03,'y':0.5,'width':0.95,'height':0.2},'BOTTOM_BILL':{'x':0.03,'y':0.8,'width':0.9,'height':0.1}};},(_0x22cb2d,_0x1869ac)=>{const _0x4eede7=a0_0x4abd;Object['defineProperty'](_0x1869ac,_0x4eede7(0x318),{'value':!0x0}),_0x1869ac[_0x4eede7(0x21a)]=void 0x0,_0x1869ac[_0x4eede7(0x21a)]={'LAUNCH_APP':{'x':0.04,'y':0.53,'width':0.73,'height':0.078},'VERIFY_ACCOUNT_NAME':{'x':0.04,'y':0.45,'width':0.81,'height':0.18},'TRANSACTION_CONFIRM':{'x':0.085,'y':0.023,'width':0.8,'height':0.08},'TRANSACTION_VERIFY':{'x':0.085,'y':0.023,'width':0.8,'height':0.08},'TRANSACTION_SUCCESS':{'x':0.06,'y':0.212,'width':0.88,'height':0.1},'HOME_SCREEN':{'x':0.02,'y':0.7,'width':0.98,'height':0.3}};},(_0x3d752a,_0x2293a0)=>{const _0x33fb4e=a0_0x4abd;Object[_0x33fb4e(0x38d)](_0x2293a0,'__esModule',{'value':!0x0}),_0x2293a0['VCB_ROI_EXPECTED']=void 0x0,_0x2293a0['VCB_ROI_EXPECTED']={'LAUNCH_APP':{'x':0.3,'y':0.5,'width':0.4,'height':0.1},'VERIFY_ACCOUNT_NUMBER':{'x':0.05,'y':0.45,'width':0.9,'height':0.2},'VERIFY_ACCOUNT_NAME':{'x':0.05,'y':0.55,'width':0.8,'height':0.1},'OTP_ENTER':{'x':0.1,'y':0.5,'width':0.4,'height':0.1},'OTP_VERIFY':{'x':0.1,'y':0.4,'width':0.5,'height':0.1},'TRANSACTION_VERIFY':{'x':0.5,'y':0.1,'width':0.4,'height':0.1},'TRANSACTION_SUCCESS':{'x':0.2,'y':0.2,'width':0.6,'height':0.1},'HOME_SCREEN':{'x':0.02,'y':0.55,'width':0.5,'height':0.1},'ALBUM_SCREEN':{'x':0.02,'y':0.02,'width':0.98,'height':0.2}};},(_0x3a7ca8,_0x49fa55,_0x28e0c9)=>{const _0x18a308=a0_0x4abd;Object['defineProperty'](_0x49fa55,'__esModule',{'value':!0x0}),_0x49fa55['NUMPAD_LAYOUT']=_0x49fa55['KEYBOARD_LAYOUT']=_0x49fa55['COMMON_COORDINATES']=_0x49fa55['scaleCoordinates']=void 0x0;const _0x222ada=_0x28e0c9(0x11);_0x49fa55['scaleCoordinates']=(_0x1b67ad,_0x336a4c=0x64)=>Object['fromEntries'](Object['entries'](_0x1b67ad)['map'](([_0x1d465b,_0x338c37])=>[_0x1d465b,{'x':Math[_0x18a308(0x2b0)](_0x338c37['x']*_0x336a4c),'y':Math['round'](_0x338c37['y']*_0x336a4c)}]));const _0x5a0850={0x0:{'x':0.55,'y':0.95},0x1:{'x':0.25,'y':0.7},0x2:{'x':0.55,'y':0.7},0x3:{'x':0.85,'y':0.7},0x4:{'x':0.25,'y':0.8},0x5:{'x':0.55,'y':0.8},0x6:{'x':0.85,'y':0.8},0x7:{'x':0.25,'y':0.9},0x8:{'x':0.55,'y':0.9},0x9:{'x':0.85,'y':0.9}},_0x3627fb={'KEYBOARD_SWITCH':{'x':0.05,'y':0.95},'SHIFT_KEY':{'x':0.05,'y':0.88},'RETURN_KEY':{'x':0.95,'y':0.95}},_0x204162=(0x0,_0x49fa55['scaleCoordinates'])(_0x3627fb),_0x580467=(0x0,_0x49fa55['scaleCoordinates'])(_0x5a0850);_0x49fa55['COMMON_COORDINATES']=_0x18a308(0x3d9)===_0x222ada[_0x18a308(0x36b)]['boxType']?_0x204162:_0x3627fb,_0x49fa55['KEYBOARD_LAYOUT']={0x0:{'x':0.95,'y':0.68},0x1:{'x':0.05,'y':0.68},0x2:{'x':0.15,'y':0.68},0x3:{'x':0.25,'y':0.68},0x4:{'x':0.35,'y':0.68},0x5:{'x':0.45,'y':0.68},0x6:{'x':0.55,'y':0.68},0x7:{'x':0.65,'y':0.68},0x8:{'x':0.75,'y':0.68},0x9:{'x':0.85,'y':0.68},'@':{'x':0.85,'y':0.78},'!':{'x':0.65,'y':0.88},'a':{'x':0.1,'y':0.78},'b':{'x':0.6,'y':0.88},'c':{'x':0.4,'y':0.88},'d':{'x':0.3,'y':0.78},'e':{'x':0.25,'y':0.68},'f':{'x':0.4,'y':0.78},'g':{'x':0.5,'y':0.78},'h':{'x':0.6,'y':0.78},'i':{'x':0.75,'y':0.68},'j':{'x':0.7,'y':0.78},'k':{'x':0.8,'y':0.78},'l':{'x':0.9,'y':0.78},'m':{'x':0.8,'y':0.88},'n':{'x':0.7,'y':0.88},'o':{'x':0.85,'y':0.68},'p':{'x':0.95,'y':0.68},'q':{'x':0.05,'y':0.68},'r':{'x':0.35,'y':0.68},'s':{'x':0.2,'y':0.78},'t':{'x':0.45,'y':0.68},'u':{'x':0.65,'y':0.68},'v':{'x':0.5,'y':0.88},'w':{'x':0.15,'y':0.68},'x':{'x':0.3,'y':0.88},'y':{'x':0.55,'y':0.68},'z':{'x':0.2,'y':0.88},'\x20':{'x':0.55,'y':0.95}},_0x49fa55[_0x18a308(0x3b4)]='PANDA'===_0x222ada['config'][_0x18a308(0x2bc)]?_0x580467:_0x5a0850;},(_0x124630,_0x5035bf,_0x5a8afd)=>{const _0x195d6e=a0_0x4abd;Object['defineProperty'](_0x5035bf,'__esModule',{'value':!0x0}),_0x5035bf['ACB_UI_COORDINATES']=void 0x0;const _0x3dc134=_0x5a8afd(0x11),_0x38b9b6={'LOGIN_BUTTON':{'x':0.5,'y':0.8},'LOGIN_BUTTON_API':{'x':0.5,'y':0.62},'PASSWORD_FIELD':{'x':0.5,'y':0.45}},_0x11828f=(0x0,_0x5a8afd(0x26)['scaleCoordinates'])(_0x38b9b6);_0x5035bf['ACB_UI_COORDINATES']='PANDA'===_0x3dc134['config'][_0x195d6e(0x2bc)]?_0x11828f:_0x38b9b6;},function(_0x41565c,_0x315063,_0x73996a){const _0x2bab26=a0_0x4abd;var _0x2a7949,_0x2f0c70,_0x4cc7e9,_0x340593,_0x5a6674,_0x2661b6=this&&this['__decorate']||function(_0x33c52d,_0x97e80,_0xd78900,_0x2933d5){const _0x16ca57=a0_0x4abd;var _0x320bd9,_0xc940e5=arguments[_0x16ca57(0x20f)],_0x2ace30=_0xc940e5<0x3?_0x97e80:null===_0x2933d5?_0x2933d5=Object['getOwnPropertyDescriptor'](_0x97e80,_0xd78900):_0x2933d5;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x2ace30=Reflect['decorate'](_0x33c52d,_0x97e80,_0xd78900,_0x2933d5);else{for(var _0x2a6ef2=_0x33c52d['length']-0x1;_0x2a6ef2>=0x0;_0x2a6ef2--)(_0x320bd9=_0x33c52d[_0x2a6ef2])&&(_0x2ace30=(_0xc940e5<0x3?_0x320bd9(_0x2ace30):_0xc940e5>0x3?_0x320bd9(_0x97e80,_0xd78900,_0x2ace30):_0x320bd9(_0x97e80,_0xd78900))||_0x2ace30);}return _0xc940e5>0x3&&_0x2ace30&&Object[_0x16ca57(0x38d)](_0x97e80,_0xd78900,_0x2ace30),_0x2ace30;},_0x4873d4=this&&this['__metadata']||function(_0x580ce0,_0x4af6a1){const _0x20adb0=a0_0x4abd;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x20adb0(0x47a)])return Reflect[_0x20adb0(0x47a)](_0x580ce0,_0x4af6a1);},_0x53a50f=this&&this['__param']||function(_0x2b0936,_0xc2e280){return function(_0x450fc7,_0x531163){_0xc2e280(_0x450fc7,_0x531163,_0x2b0936);};};Object[_0x2bab26(0x38d)](_0x315063,_0x2bab26(0x318),{'value':!0x0}),_0x315063[_0x2bab26(0x495)]=void 0x0;const _0x50533e=_0x73996a(0x2),_0x47d085=_0x73996a(0xe),_0x33b1d4=_0x73996a(0x17),_0x4d8f00=_0x73996a(0x13),_0x3e2143=_0x73996a(0xd),_0x409abc=_0x73996a(0x18),_0x2cba7b=_0x73996a(0x29),_0x366671=_0x73996a(0x1b),_0x1b9412=_0x73996a(0x2a),_0x1a26c5=_0x73996a(0x24),_0x13eef3=_0x73996a(0x2b),_0xd63d06=_0x73996a(0x2c),_0x5a3e37=_0x73996a(0x1e);let _0x21c958=class extends _0x33b1d4['BaseBankService']{constructor(_0x5d4969,_0x1c0cef,_0x252386,_0x3ec3f7,_0x868196){const _0x1219aa=_0x2bab26;super(_0x5d4969,_0x1c0cef,_0x252386,_0x3ec3f7),this['wsService']=_0x5d4969,this[_0x1219aa(0x2e7)]=_0x868196,this[_0x1219aa(0x2c6)]='PGBANK',this['BUNDLE_ID']=_0x1219aa(0x3aa);}async['inputPasswordFromConfig'](_0x303358){const _0x4435f8=_0x2bab26,_0x4c4d68=await this['deviceService']['getDeviceConfig'](_0x303358);if(!_0x4c4d68||!_0x4c4d68[_0x4435f8(0x3a0)])throw new Error('Password\x20not\x20configured\x20for\x20device\x20'+_0x303358);await this[_0x4435f8(0x354)](_0x303358,_0x2cba7b['PG_UI_COORDINATES']['PASSWORD_FIELD']['x'],_0x2cba7b[_0x4435f8(0x4df)]['PASSWORD_FIELD']['y'],0x5dc),await this['wsService']['inputText'](_0x303358,_0x4c4d68['password']),await(0x0,_0x409abc['sleep'])(0x3e8),await this['wsService']['pressReturnKey'](_0x303358);}async['inputSmartOTPFromConfig'](_0x36d06f,_0x10c1ab=0x3){const _0x28a83e=_0x2bab26,_0x1fb1bd=await this[_0x28a83e(0x42e)]['getDeviceConfig'](_0x36d06f);if(!_0x1fb1bd||!_0x1fb1bd['smartOTP'])throw new Error('SmartOTP\x20not\x20configured\x20for\x20device\x20'+_0x36d06f);await(0x0,_0x409abc[_0x28a83e(0x3b8)])(0x7d0),await this['wsService'][_0x28a83e(0x2d8)](_0x36d06f,_0x1fb1bd['smartOTP']);}async['launchApp'](_0x398f30){const _0x2cd661=_0x2bab26;if(await this['wsService']['launchApp'](_0x398f30,this['BUNDLE_ID']),!await this[_0x2cd661(0x29f)](_0x398f30,{'expectedTexts':[_0x2cd661(0x4a7)],'timeout':0x2710,'pollInterval':0x1f4,'roi':_0x1a26c5['PG_ROI_EXPECTED'][_0x2cd661(0x3cc)],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new _0x1b9412['WithdrawalProcessingError'](_0x2cd661(0x2b4),_0x1b9412['ErrorType'][_0x2cd661(0x27e)]);this['logger'][_0x2cd661(0x4dd)]('['+_0x398f30+']\x20-\x20Get\x20login\x20app\x20screen');}async['login'](_0x2fe584){const _0x2cbfee=_0x2bab26;if(await this['killApp'](_0x2fe584),await(0x0,_0x409abc['sleep'])(0x3e8),await this['launchApp'](_0x2fe584),await(0x0,_0x409abc['sleep'])(0x3e8),await this['inputPasswordFromConfig'](_0x2fe584),!await this['clickAndWaitForScreen'](_0x2fe584,_0x2cba7b[_0x2cbfee(0x4df)]['LOGIN_BTN']['x'],_0x2cba7b[_0x2cbfee(0x4df)][_0x2cbfee(0x3eb)]['y'],{'expectedTexts':['t√†i\x20kho·∫£n','chuy·ªÉn\x20ti·ªÅn',_0x2cbfee(0x473)],'timeout':0x4e20,'pollInterval':0x1f4,'roi':_0x1a26c5['PG_ROI_EXPECTED']['HOME_SCREEN']}))throw this[_0x2cbfee(0x2e7)]['sendMessage']({'text':'‚ùå\x20Login\x20Error\x0a\x0a<b>Device:</b>\x20'+_0x2fe584+'\x0a<b>Error:</b>\x20Kh√¥ng\x20th·ªÉ\x20ƒëƒÉng\x20nh·∫≠p\x20v√†o\x20app\x20PGBank.','options':{'parseMode':_0x2cbfee(0x361)}}),new _0x1b9412['WithdrawalProcessingError']('Failed\x20to\x20login\x20to\x20PGBank',_0x1b9412['ErrorType']['FORCE_LOGIN']);this[_0x2cbfee(0x206)][_0x2cbfee(0x4dd)]('['+_0x2fe584+']\x20-\x20Login\x20successfully');}async['executeTransferWithQRCode'](_0x3e5921,_0x35b09d){const _0x5573f0=_0x2bab26;this['logger']['log']('Executing\x20PG\x20transfer\x20for\x20withdrawal\x20'+_0x3e5921['withdrawalId']+'\x20on\x20device\x20'+_0x35b09d['deviceId']),await this['clickWithTransition'](_0x35b09d['deviceId'],_0x2cba7b['PG_UI_COORDINATES']['QR_CODE_BTN']['x'],_0x2cba7b['PG_UI_COORDINATES']['QR_CODE_BTN']['y'],0x1388),await this['clickWithTransition'](_0x35b09d['deviceId'],_0x2cba7b[_0x5573f0(0x4df)][_0x5573f0(0x2ac)]['x'],_0x2cba7b['PG_UI_COORDINATES']['IMAGE_LIBRARY_BTN']['y'],0xbb8),await this[_0x5573f0(0x354)](_0x35b09d['deviceId'],_0x2cba7b['PG_UI_COORDINATES']['FIRST_IMAGE_BTN']['x'],_0x2cba7b['PG_UI_COORDINATES']['FIRST_IMAGE_BTN']['y'],0x7d0);let _0x4a0f1f=!0x1;if(_0x4a0f1f=_0x3e5921['bankCode']===_0x13eef3[_0x5573f0(0x1f3)]['PGBANK']?await this['clickAndWaitForScreen'](_0x35b09d[_0x5573f0(0x29b)],_0x2cba7b['PG_UI_COORDINATES'][_0x5573f0(0x272)]['x'],_0x2cba7b[_0x5573f0(0x4df)]['SELECT_IMAGE_QR_CODE_BTN']['y'],{'expectedTexts':[_0x3e5921[_0x5573f0(0x37e)]],'timeout':0x4e20,'pollInterval':0x1f4,'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}):await this['clickAndWaitForScreen'](_0x35b09d['deviceId'],_0x2cba7b[_0x5573f0(0x4df)][_0x5573f0(0x272)]['x'],_0x2cba7b['PG_UI_COORDINATES']['SELECT_IMAGE_QR_CODE_BTN']['y'],{'expectedTexts':[_0x3e5921[_0x5573f0(0x37e)]],'timeout':0x4e20,'pollInterval':0x1f4,'roi':_0x1a26c5['PG_ROI_EXPECTED'][_0x5573f0(0x270)],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}),!_0x4a0f1f)throw new _0x1b9412[(_0x5573f0(0x2d7))]('Choose\x20wrong\x20image\x20qrcode',_0x1b9412[_0x5573f0(0x359)]['FORCE_LOGIN']);if(this['logger']['log']('['+_0x35b09d[_0x5573f0(0x2e2)]+']\x20-\x20Get\x20Verified\x20account\x20name\x20screen'),!await this['clickAndWaitForScreen'](_0x35b09d['deviceId'],_0x2cba7b['PG_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['x'],_0x2cba7b['PG_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['y'],{'expectedTexts':['X√°c\x20nh·∫≠n\x20giao\x20d·ªãch'],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x1a26c5['PG_ROI_EXPECTED']['TRANSACTION_CONFIRM'],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new _0x1b9412[(_0x5573f0(0x2d7))](_0x5573f0(0x2e3),_0x1b9412['ErrorType']['FORCE_LOGIN']);if(this['logger'][_0x5573f0(0x4dd)]('['+_0x35b09d[_0x5573f0(0x2e2)]+']\x20-\x20Get\x20Transaction\x20confirm\x20screen'),!await this['clickAndWaitForScreen'](_0x35b09d['deviceId'],_0x2cba7b[_0x5573f0(0x4df)]['CONTINUE_TRANSFER_BTN']['x'],_0x2cba7b['PG_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['y'],{'expectedTexts':[_0x5573f0(0x40c)],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x1a26c5['PG_ROI_EXPECTED']['TRANSACTION_VERIFY'],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new _0x1b9412[(_0x5573f0(0x2d7))]('Transaction\x20verification\x20screen\x20not\x20found',_0x1b9412['ErrorType']['FORCE_LOGIN']);if(this['logger']['log']('['+_0x35b09d['accountName']+']\x20-\x20Get\x20Transaction\x20verification\x20screen'),await this['inputSmartOTPFromConfig'](_0x35b09d[_0x5573f0(0x29b)]),!await this['verifyScreenState'](_0x35b09d['deviceId'],{'expectedTexts':['Chuy·ªÉn\x20ti·ªÅn\x20th√†nh\x20c√¥ng'],'timeout':0xea60,'pollInterval':0x1f4,'roi':_0x1a26c5['PG_ROI_EXPECTED']['TRANSACTION_SUCCESS'],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new _0x1b9412['WithdrawalProcessingError']('Transaction\x20success\x20screen\x20not\x20found',_0x1b9412[_0x5573f0(0x359)]['NO_BILL_AFTER_OTP']);this[_0x5573f0(0x206)]['log']('['+_0x35b09d['accountName']+']\x20-\x20Get\x20Transaction\x20success\x20screen'),await(0x0,_0x409abc[_0x5573f0(0x3b8)])(0x1f4),await this['captureScreen'](_0x35b09d['deviceId'],{'folderPath':_0x3e5921['withdrawalCode']}),await this['clickWithTransition'](_0x35b09d['deviceId'],_0x2cba7b[_0x5573f0(0x4df)]['BACK_TO_HOME']['x'],_0x2cba7b[_0x5573f0(0x4df)][_0x5573f0(0x1e6)]['y'],0x1388,'['+_0x35b09d['accountName']+']\x20-\x20Get\x20back\x20to\x20home\x20screen');}async['extractTransactionAmount'](_0x452560){const _0x441c57=_0x2bab26;try{const _0x4486b2=await this['ocrService']['recognizeFromFile'](_0x452560,{'fieldType':'singleLine','customROI':{'x':0.05,'y':0.75,'width':0.9,'height':0.12},'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}});if(!_0x4486b2)return this['logger']['warn']('Failed\x20to\x20extract\x20transaction\x20amount\x20from\x20ROI'),null;const _0x51b685=_0x4486b2['text']['replace'](/[^\d.,]/g,'')['replace'](/,/g,''),_0x4e190f=parseFloat(_0x51b685);return isNaN(_0x4e190f)?(this['logger']['warn'](_0x441c57(0x35c)+_0x4486b2['text']),null):(this['logger']['log']('Extracted\x20transaction\x20amount:\x20'+_0x4e190f['toLocaleString']('vi-VN')+'\x20VND\x20(confidence:\x20'+_0x4486b2['confidence'][_0x441c57(0x45a)](0x2)+'%,\x20time:\x20'+_0x4486b2['processingTime']+_0x441c57(0x1fc)),_0x4e190f);}catch(_0x4673df){return this['logger'][_0x441c57(0x20b)]('Error\x20extracting\x20transaction\x20amount:\x20'+_0x4673df['message'],_0x4673df['stack']),null;}}async['onModuleInit'](){}['onModuleDestroy'](){}};_0x315063[_0x2bab26(0x495)]=_0x21c958,_0x315063['PgService']=_0x21c958=_0x2661b6([(0x0,_0x50533e['Injectable'])(),_0x53a50f(0x0,(0x0,_0x50533e['Inject'])(_0x3e2143['WEBSOCKET_SERVICE'])),_0x4873d4(_0x2bab26(0x2d9),['function'==typeof(_0x2a7949=void 0x0!==_0x4d8f00['IWebSocketService']&&_0x4d8f00[_0x2bab26(0x1df)])?_0x2a7949:Object,'function'==typeof(_0x2f0c70=void 0x0!==_0x47d085['DeviceService']&&_0x47d085['DeviceService'])?_0x2f0c70:Object,'function'==typeof(_0x4cc7e9=void 0x0!==_0x366671['OCRService']&&_0x366671['OCRService'])?_0x4cc7e9:Object,_0x2bab26(0x42d)==typeof(_0x340593=void 0x0!==_0x5a3e37['ImagePreprocessingService']&&_0x5a3e37['ImagePreprocessingService'])?_0x340593:Object,'function'==typeof(_0x5a6674=void 0x0!==_0xd63d06['TelegramService']&&_0xd63d06['TelegramService'])?_0x5a6674:Object])],_0x21c958);},(_0x4bdfe7,_0x3fe810,_0x180c7b)=>{const _0x167eb3=a0_0x4abd;Object[_0x167eb3(0x38d)](_0x3fe810,_0x167eb3(0x318),{'value':!0x0}),_0x3fe810['PG_UI_COORDINATES']=void 0x0;const _0x109554=_0x180c7b(0x11),_0x2ff6fe={'LOGIN_BTN':{'x':0.5,'y':0.6},'PASSWORD_FIELD':{'x':0.5,'y':0.435},'TRANSFER_BTN':{'x':0.7,'y':0.7},'TRANSFER_INTERNAL_BTN':{'x':0.2,'y':0.2},'TRANSFER_EXTERNAL_BTN':{'x':0.4,'y':0.2},'CLOSE_ALLOW_CONTACT_POPUP_BTN':{'x':0.3,'y':0.6},'ACCOUNT_NUMBER_INPUT':{'x':0.4,'y':0.43},'SELECT_BANK_BTN':{'x':0.4,'y':0.47},'SEARCH_BANK_BTN':{'x':0.4,'y':0.48},'INTERNAL_AMOUNT_INPUT':{'x':0.5,'y':0.6},'HIDE_NUMPAD_BTN':{'x':0.05,'y':0.4},'CONTINUE_TRANSFER_BTN':{'x':0.5,'y':0.9},'BANK_SEARCH_BTN':{'x':0.4,'y':0.45},'BANK_SEARCH_INPUT':{'x':0.4,'y':0.45},'EXTERNAL_AMOUNT_INPUT':{'x':0.3,'y':0.37},'BACK_TO_HOME':{'x':0.2,'y':0.9},'QR_CODE_BTN':{'x':0.2,'y':0.9},'IMAGE_LIBRARY_BTN':{'x':0.8,'y':0.9},'FIRST_IMAGE_BTN':{'x':0.3,'y':0.3},'SELECT_IMAGE_QR_CODE_BTN':{'x':0.95,'y':0.95},'HOME_ICON_HEADER':{'x':0.95,'y':0.05}},_0x42c720=(0x0,_0x180c7b(0x26)[_0x167eb3(0x271)])(_0x2ff6fe);_0x3fe810['PG_UI_COORDINATES']=_0x167eb3(0x3d9)===_0x109554['config'][_0x167eb3(0x2bc)]?_0x42c720:_0x2ff6fe;},(_0x5fdd55,_0x628c68)=>{const _0x1074e5=a0_0x4abd;var _0x36295e;Object['defineProperty'](_0x628c68,_0x1074e5(0x318),{'value':!0x0}),_0x628c68['WithdrawalProcessingError']=_0x628c68[_0x1074e5(0x359)]=void 0x0,function(_0x3e6c7c){const _0x43ff68=_0x1074e5;_0x3e6c7c['TEMPORARY']=_0x43ff68(0x483),_0x3e6c7c['PERMANENT']=_0x43ff68(0x1e2),_0x3e6c7c[_0x43ff68(0x27e)]='FORCE_LOGIN',_0x3e6c7c[_0x43ff68(0x497)]='NO_BILL_AFTER_OTP';}(_0x36295e||(_0x628c68['ErrorType']=_0x36295e={}));class _0x2a3f32 extends Error{constructor(_0x15dec1,_0x17a159){const _0x1fc178=_0x1074e5;super(_0x15dec1),this['errorType']=_0x17a159,this[_0x1fc178(0x420)]='WithdrawalProcessingError',Error['captureStackTrace'](this,this['constructor']);}}_0x628c68['WithdrawalProcessingError']=_0x2a3f32;},(_0xb0b19d,_0x12b630)=>{const _0x1c8e4b=a0_0x4abd;var _0x2dc819;Object['defineProperty'](_0x12b630,_0x1c8e4b(0x318),{'value':!0x0}),_0x12b630['BankCodeWithdrawal']=void 0x0,function(_0x4f7831){const _0x4d3db7=_0x1c8e4b;_0x4f7831['VIETCOMBANK']=_0x4d3db7(0x26c),_0x4f7831['AGRIBANK']='AGRIBANK',_0x4f7831[_0x4d3db7(0x48c)]=_0x4d3db7(0x48c),_0x4f7831['SACOMBANK']=_0x4d3db7(0x2e4),_0x4f7831['TECHCOMBANK']='TECHCOMBANK',_0x4f7831['TPBANK']='TPBANK',_0x4f7831['HDBank']='HDBank',_0x4f7831[_0x4d3db7(0x211)]=_0x4d3db7(0x211),_0x4f7831['MBBANK']='MBBANK',_0x4f7831['MSB']='MSB',_0x4f7831['LPBANK']='LPBANK',_0x4f7831['ACB']='ACB',_0x4f7831['ABBANK']='ABBANK',_0x4f7831[_0x4d3db7(0x254)]=_0x4d3db7(0x254),_0x4f7831['EXIMBANK']=_0x4d3db7(0x23f),_0x4f7831[_0x4d3db7(0x2fc)]='SEABANK',_0x4f7831['SCB']='SCB',_0x4f7831['PVCOMBANK']=_0x4d3db7(0x25f),_0x4f7831['KIENLONGBANK']='KIENLONGBANK',_0x4f7831[_0x4d3db7(0x25a)]='BVBANK',_0x4f7831['VIETINBANK']='VIETINBANK',_0x4f7831['OCB']=_0x4d3db7(0x329),_0x4f7831['VIETBANK']='VIETBANK',_0x4f7831[_0x4d3db7(0x429)]=_0x4d3db7(0x429),_0x4f7831['NAMABANK']='NAMABANK',_0x4f7831[_0x4d3db7(0x2df)]=_0x4d3db7(0x2df),_0x4f7831[_0x4d3db7(0x4d9)]='CIMB',_0x4f7831['SAIGONBANK']='SAIGONBANK',_0x4f7831[_0x4d3db7(0x489)]='BACABANK',_0x4f7831['VIETABANK']=_0x4d3db7(0x4cf),_0x4f7831['GPBANK']='GPBANK',_0x4f7831['HSBC']='HSBC',_0x4f7831[_0x4d3db7(0x46e)]='VRB',_0x4f7831[_0x4d3db7(0x4bc)]='VIB',_0x4f7831['PGBANK']='PGBANK';}(_0x2dc819||(_0x12b630[_0x1c8e4b(0x1f3)]=_0x2dc819={}));},function(_0x435ad9,_0x5e35aa,_0x4f4dcc){const _0x2a975f=a0_0x4abd;var _0x241e46,_0x36ea1b=this&&this['__decorate']||function(_0x1b1bcc,_0x4e9d78,_0x34e8e5,_0x226e6c){const _0x47ee0d=a0_0x4abd;var _0x125fca,_0x335263=arguments['length'],_0x62f3a3=_0x335263<0x3?_0x4e9d78:null===_0x226e6c?_0x226e6c=Object['getOwnPropertyDescriptor'](_0x4e9d78,_0x34e8e5):_0x226e6c;if(_0x47ee0d(0x2f0)==typeof Reflect&&'function'==typeof Reflect[_0x47ee0d(0x40a)])_0x62f3a3=Reflect[_0x47ee0d(0x40a)](_0x1b1bcc,_0x4e9d78,_0x34e8e5,_0x226e6c);else{for(var _0x6c74d9=_0x1b1bcc['length']-0x1;_0x6c74d9>=0x0;_0x6c74d9--)(_0x125fca=_0x1b1bcc[_0x6c74d9])&&(_0x62f3a3=(_0x335263<0x3?_0x125fca(_0x62f3a3):_0x335263>0x3?_0x125fca(_0x4e9d78,_0x34e8e5,_0x62f3a3):_0x125fca(_0x4e9d78,_0x34e8e5))||_0x62f3a3);}return _0x335263>0x3&&_0x62f3a3&&Object[_0x47ee0d(0x38d)](_0x4e9d78,_0x34e8e5,_0x62f3a3),_0x62f3a3;},_0x442e4c=this&&this[_0x2a975f(0x3b5)]||function(_0x16b733,_0x3a6bb0){const _0x3faa95=_0x2a975f;if(_0x3faa95(0x2f0)==typeof Reflect&&'function'==typeof Reflect[_0x3faa95(0x47a)])return Reflect['metadata'](_0x16b733,_0x3a6bb0);};Object[_0x2a975f(0x38d)](_0x5e35aa,'__esModule',{'value':!0x0}),_0x5e35aa['TelegramService']=void 0x0;const _0x60634e=_0x4f4dcc(0x18),_0x17d282=_0x4f4dcc(0x2),_0x219c3b=_0x4f4dcc(0x2d),_0x4b0265=_0x4f4dcc(0x2e),_0x48284c=_0x4f4dcc(0x19);let _0x5b9d53=_0x241e46=class{constructor(){const _0x31aded=_0x2a975f;this[_0x31aded(0x206)]=new _0x17d282['Logger'](_0x241e46['name']),this['token']='8514906447:AAGFB2Fsl21IeF1tJvt8y6UsuoyNCIVcwCE',this[_0x31aded(0x3a4)]='-5288197652',this[_0x31aded(0x488)]=_0x31aded(0x3f0),this['http']=_0x219c3b[_0x31aded(0x2f3)][_0x31aded(0x2a6)]({'baseURL':this['baseUrl']+'/bot'+this[_0x31aded(0x325)],'timeout':0x3a98});}async['sendMessage'](_0x41dd51){const _0x3985e6=_0x2a975f,{text:_0x2669e1,chatId:_0x20bd93,options:_0x2d1de9={}}=_0x41dd51,_0x38144e=_0x20bd93??this['mustDefaultChatId']();this['requestWithRetry']('/sendMessage',{'chat_id':_0x38144e,'text':_0x2669e1,'parse_mode':_0x2d1de9[_0x3985e6(0x3cd)]??_0x3985e6(0x361),'disable_web_page_preview':_0x2d1de9['disableWebPagePreview']??!0x1,'disable_notification':_0x2d1de9['disableNotification']??!0x1,'reply_to_message_id':_0x2d1de9['replyToMessageId']??void 0x0})['catch'](_0x1ee14c=>{const _0x30d5ae=_0x3985e6;this['logger'][_0x30d5ae(0x20b)](_0x30d5ae(0x41c),_0x1ee14c[_0x30d5ae(0x4c5)]);});}async['sendPhotoByUrl'](_0x23405c,_0x3bc9b6=this['mustDefaultChatId'](),_0x220d61={}){const _0x513a4c=_0x2a975f;await this['requestWithRetry'](_0x513a4c(0x3a5),{'chat_id':_0x3bc9b6,'photo':_0x23405c,'caption':_0x220d61[_0x513a4c(0x37c)],'parse_mode':_0x220d61[_0x513a4c(0x3cd)],'disable_notification':_0x220d61['disableNotification']});}async['sendPhotoByFile'](_0x57d50f,_0x30f840=this[_0x2a975f(0x2d0)](),_0xdd2860={}){const _0x548b4a=_0x2a975f;try{const _0x4217f7=(0x0,_0x48284c[_0x548b4a(0x32a)])(_0x57d50f),_0x120104=new _0x4b0265['default']();_0x120104['append'](_0x548b4a(0x1f2),String(_0x30f840)),_0x120104['append']('photo',_0x4217f7),_0xdd2860['caption']&&_0x120104[_0x548b4a(0x4c2)](_0x548b4a(0x37c),_0xdd2860['caption']),_0xdd2860['parseMode']&&_0x120104['append'](_0x548b4a(0x25d),_0xdd2860['parseMode']),void 0x0!==_0xdd2860['disableNotification']&&_0x120104['append']('disable_notification',String(_0xdd2860['disableNotification'])),await this['requestFormWithRetry'](_0x548b4a(0x3a5),_0x120104);}catch(_0xa765bc){this[_0x548b4a(0x206)]['error']('Error\x20sending\x20photo\x20by\x20file:\x20'+_0xa765bc['message']);}}async['sendPhotoByBuffer'](_0x4f2aa2,_0x24762b='image.png',_0x154307='image/png',_0x1ad808=this['mustDefaultChatId'](),_0x54d0ef={}){const _0x444dd5=_0x2a975f,_0x4f9387=new _0x4b0265[(_0x444dd5(0x2f3))]();_0x4f9387['append']('chat_id',String(_0x1ad808)),_0x4f9387['append']('photo',_0x4f2aa2,{'filename':_0x24762b,'contentType':_0x154307}),_0x54d0ef['caption']&&_0x4f9387[_0x444dd5(0x4c2)]('caption',_0x54d0ef[_0x444dd5(0x37c)]),_0x54d0ef['parseMode']&&_0x4f9387['append']('parse_mode',_0x54d0ef['parseMode']),void 0x0!==_0x54d0ef[_0x444dd5(0x49d)]&&_0x4f9387['append']('disable_notification',String(_0x54d0ef['disableNotification'])),this['requestFormWithRetry'](_0x444dd5(0x3a5),_0x4f9387)[_0x444dd5(0x499)](_0xc49f3f=>{const _0x29b83d=_0x444dd5;this['logger'][_0x29b83d(0x20b)]('Error\x20sending\x20telegram\x20photo',_0xc49f3f[_0x29b83d(0x4c5)]);});}async['sendPhotoByBase64'](_0x3147a9,_0x21f548='image.png',_0x5aeaa1='image/png',_0xa35c93=this['mustDefaultChatId'](),_0x4ed81c={}){const _0x151e30=_0x2a975f,_0x4ab8e3=this[_0x151e30(0x4be)](_0x3147a9),_0x5e5e74=Buffer[_0x151e30(0x462)](_0x4ab8e3,'base64');await this['sendPhotoByBuffer'](_0x5e5e74,_0x21f548,_0x5aeaa1,_0xa35c93,_0x4ed81c);}[_0x2a975f(0x2d0)](){const _0x50078f=_0x2a975f;if(!this[_0x50078f(0x3a4)])throw new Error('TELEGRAM_DEFAULT_CHAT_ID\x20is\x20missing\x20and\x20no\x20chatId\x20was\x20provided.');return this['defaultChatId'];}['stripBase64Prefix'](_0x5aa521){const _0x413c0a=_0x5aa521['indexOf']('base64,');return _0x413c0a>=0x0?_0x5aa521['slice'](_0x413c0a+0x7):_0x5aa521;}async[_0x2a975f(0x3df)](_0x49ba46,_0x46185b,_0x11e3d1=0x2){const _0x556e1f=_0x2a975f;try{const _0x58f87e=await this['http']['post'](_0x49ba46,_0x46185b);if(!_0x58f87e['data']?.['ok']){const _0x189839=_0x58f87e['data']?.['description']??_0x556e1f(0x231);throw new Error(_0x556e1f(0x410)+_0x189839);}}catch(_0x2b3e0e){if(_0x11e3d1>0x0&&this['isRetryable'](_0x2b3e0e)){const _0x5cbf19=this['backoffMs'](_0x11e3d1);return this['logger']['warn']('Telegram\x20request\x20failed,\x20retrying\x20in\x20'+_0x5cbf19+'ms:\x20'+this['safeErr'](_0x2b3e0e)),await(0x0,_0x60634e['sleep'])(_0x5cbf19),this['requestWithRetry'](_0x49ba46,_0x46185b,_0x11e3d1-0x1);}throw this['logger']['error']('Telegram\x20request\x20failed:\x20'+this['safeErr'](_0x2b3e0e)),_0x2b3e0e;}}async['requestFormWithRetry'](_0x5d4125,_0x4fcfa3,_0x284674=0x2){const _0xc497c0=_0x2a975f;try{const _0x47d318=await this['http']['post'](_0x5d4125,_0x4fcfa3,{'headers':_0x4fcfa3['getHeaders'](),'maxBodyLength':0x1/0x0,'maxContentLength':0x1/0x0});if(!_0x47d318[_0xc497c0(0x246)]?.['ok']){const _0x6ddd16=_0x47d318['data']?.[_0xc497c0(0x263)]??'Unknown\x20Telegram\x20error';throw new Error(_0xc497c0(0x410)+_0x6ddd16);}}catch(_0x36bd79){if(_0x284674>0x0&&this['isRetryable'](_0x36bd79)){const _0x23f86b=this[_0xc497c0(0x343)](_0x284674);return this['logger']['warn']('Telegram\x20form\x20request\x20failed,\x20retrying\x20in\x20'+_0x23f86b+_0xc497c0(0x31e)+this['safeErr'](_0x36bd79)),await(0x0,_0x60634e['sleep'])(_0x23f86b),this[_0xc497c0(0x262)](_0x5d4125,_0x4fcfa3,_0x284674-0x1);}this[_0xc497c0(0x206)]['error'](_0xc497c0(0x307)+this['safeErr'](_0x36bd79));}}['isRetryable'](_0x14f49f){const _0x5e95f8=_0x2a975f,_0x124cdc=_0x14f49f?.['code'],_0x10ec75=_0x14f49f?.['response']?.['status'];return'ECONNABORTED'===_0x124cdc||_0x10ec75>=0x1f4&&_0x10ec75<=0x257||!(_0x10ec75||_0x5e95f8(0x365)!==_0x124cdc&&'ECONNRESET'!==_0x124cdc&&'EAI_AGAIN'!==_0x124cdc);}[_0x2a975f(0x343)](_0x35914b){return 0x190*(0x2-_0x35914b+0x1);}['safeErr'](_0x502a71){const _0x163de6=_0x2a975f,_0x595fb5=_0x502a71?.[_0x163de6(0x324)]?.['status'],_0x4c3dc3=_0x502a71?.['response']?.['data']?.['description'],_0x2bb609=_0x502a71?.[_0x163de6(0x4ad)];return[_0x595fb5?_0x163de6(0x405)+_0x595fb5:'',_0x4c3dc3?'desc='+_0x4c3dc3:'',_0x2bb609?_0x163de6(0x395)+_0x2bb609:'']['filter'](Boolean)['join'](_0x163de6(0x214));}};_0x5e35aa['TelegramService']=_0x5b9d53,_0x5e35aa['TelegramService']=_0x5b9d53=_0x241e46=_0x36ea1b([(0x0,_0x17d282['Injectable'])(),_0x442e4c(_0x2a975f(0x2d9),[])],_0x5b9d53);},_0x2976ec=>{_0x2976ec['exports']=require('axios');},_0x491399=>{_0x491399['exports']=require('form-data');},function(_0x385fd3,_0x858fe9,_0x6953a3){const _0x2b07c8=a0_0x4abd;var _0x68a081,_0x478385,_0x31d3b2,_0x4c664c,_0x57fea7=this&&this[_0x2b07c8(0x290)]||function(_0x2610a0,_0xc5ca15,_0x24fab0,_0x232f5c){const _0x32fca2=_0x2b07c8;var _0x1b34ef,_0x1bd98e=arguments[_0x32fca2(0x20f)],_0x4a042b=_0x1bd98e<0x3?_0xc5ca15:null===_0x232f5c?_0x232f5c=Object['getOwnPropertyDescriptor'](_0xc5ca15,_0x24fab0):_0x232f5c;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x32fca2(0x40a)])_0x4a042b=Reflect[_0x32fca2(0x40a)](_0x2610a0,_0xc5ca15,_0x24fab0,_0x232f5c);else{for(var _0x5c5a94=_0x2610a0['length']-0x1;_0x5c5a94>=0x0;_0x5c5a94--)(_0x1b34ef=_0x2610a0[_0x5c5a94])&&(_0x4a042b=(_0x1bd98e<0x3?_0x1b34ef(_0x4a042b):_0x1bd98e>0x3?_0x1b34ef(_0xc5ca15,_0x24fab0,_0x4a042b):_0x1b34ef(_0xc5ca15,_0x24fab0))||_0x4a042b);}return _0x1bd98e>0x3&&_0x4a042b&&Object['defineProperty'](_0xc5ca15,_0x24fab0,_0x4a042b),_0x4a042b;},_0x19faac=this&&this['__metadata']||function(_0xf7bf5b,_0x380019){if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0xf7bf5b,_0x380019);},_0x55cfab=this&&this['__param']||function(_0x379247,_0x5957b3){return function(_0x9d78d6,_0x294d9b){_0x5957b3(_0x9d78d6,_0x294d9b,_0x379247);};};Object['defineProperty'](_0x858fe9,_0x2b07c8(0x318),{'value':!0x0}),_0x858fe9['HdBankService']=void 0x0;const _0x46fc98=_0x6953a3(0xd),_0x36533c=_0x6953a3(0x13),_0x1da711=_0x6953a3(0x18),_0x44aaa8=_0x6953a3(0x2),_0x2a54f5=_0x6953a3(0xe),_0x5c382a=_0x6953a3(0x17),_0x1daf5d=_0x6953a3(0x1b),_0x3d2889=_0x6953a3(0x2a),_0x88c3e9=_0x6953a3(0x2b),_0x37e78a=_0x6953a3(0x30),_0x444896=_0x6953a3(0x23),_0x45903d=_0x6953a3(0x31),_0xe436b3=_0x6953a3(0x1e);let _0x1f732a=class extends _0x5c382a['BaseBankService']{constructor(_0x29ec6f,_0x5456ae,_0x9ec964,_0x2346d8){const _0x5b9e8a=_0x2b07c8;super(_0x29ec6f,_0x5456ae,_0x9ec964,_0x2346d8),this[_0x5b9e8a(0x1da)]=_0x29ec6f,this['BANK_CODE']=_0x5b9e8a(0x436),this['BUNDLE_ID']='com.vnpay.HDBank';}async[_0x2b07c8(0x3d5)](_0xb64b90){const _0x185e25=_0x2b07c8,_0x5ce01c=await this['deviceService']['getDeviceConfig'](_0xb64b90);if(!_0x5ce01c||!_0x5ce01c['password'])throw new Error('Password\x20not\x20configured\x20for\x20device\x20'+_0xb64b90);await this[_0x185e25(0x354)](_0xb64b90,_0x37e78a['HD_UI_COORDINATES']['PASSWORD_FIELD']['x'],_0x37e78a['HD_UI_COORDINATES']['PASSWORD_FIELD']['y'],0x5dc),await this[_0x185e25(0x1da)]['inputText'](_0xb64b90,_0x5ce01c['password']),await(0x0,_0x1da711['sleep'])(0x3e8);}async['inputSmartOTPFromConfig'](_0x3f114b,_0x469968=0x3){const _0x24c642=_0x2b07c8,_0x50a111=await this['deviceService'][_0x24c642(0x33b)](_0x3f114b);if(!_0x50a111||!_0x50a111['smartOTP'])throw new Error('SmartOTP\x20not\x20configured\x20for\x20device\x20'+_0x3f114b);await(0x0,_0x1da711['sleep'])(0x1f4),await this['wsService'][_0x24c642(0x2d8)](_0x3f114b,_0x50a111['smartOTP']);}async['launchApp'](_0x20a7a2){const _0x3a740e=_0x2b07c8;if(await this[_0x3a740e(0x1da)]['launchApp'](_0x20a7a2,this['BUNDLE_ID']),!await this['verifyScreenState'](_0x20a7a2,{'expectedTexts':['ƒêƒÉng\x20nh·∫≠p'],'timeout':0x2710,'pollInterval':0x1f4,'roi':_0x444896['HD_ROI_EXPECTED']['LAUNCH_APP'],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new _0x3d2889['WithdrawalProcessingError']('Failed\x20to\x20launch\x20PGBank\x20app',_0x3d2889['ErrorType']['FORCE_LOGIN']);this['logger']['log']('['+_0x20a7a2+']\x20-\x20Get\x20login\x20app\x20screen');}async['login'](_0x2f7e75){const _0x2b0228=_0x2b07c8;if(await this[_0x2b0228(0x380)](_0x2f7e75),await(0x0,_0x1da711['sleep'])(0x7d0),await this[_0x2b0228(0x464)](_0x2f7e75),await this['inputPasswordFromConfig'](_0x2f7e75),!await this['clickAndWaitForScreen'](_0x2f7e75,_0x37e78a['HD_UI_COORDINATES']['LOGIN_BTN']['x'],_0x37e78a[_0x2b0228(0x335)]['LOGIN_BTN']['y'],{'expectedTexts':['t√†i\x20kho·∫£n','chuy·ªÉn\x20kho·∫£n'],'timeout':0x4e20,'pollInterval':0x1f4,'roi':_0x444896[_0x2b0228(0x392)][_0x2b0228(0x4d3)]}))throw new _0x3d2889['WithdrawalProcessingError']('Failed\x20to\x20login\x20to\x20PGBank',_0x3d2889['ErrorType'][_0x2b0228(0x27e)]);this['logger'][_0x2b0228(0x4dd)]('['+_0x2f7e75+_0x2b0228(0x2ab));}async['executeTransferWithQRCode'](_0x3b324c,_0x27aaed){const _0x4a9e24=_0x2b07c8;if(this[_0x4a9e24(0x206)]['log']('Executing\x20HDBank\x20transfer\x20for\x20withdrawal\x20'+_0x3b324c['withdrawalId']+'\x20on\x20device\x20'+_0x27aaed[_0x4a9e24(0x29b)]),await this['clickWithTransition'](_0x27aaed[_0x4a9e24(0x29b)],_0x37e78a['HD_UI_COORDINATES']['QR_CODE_BTN']['x'],_0x37e78a[_0x4a9e24(0x335)]['QR_CODE_BTN']['y'],0xbb8),await(0x0,_0x1da711['sleep'])(0x7d0),!await this['clickAndWaitForScreen'](_0x27aaed[_0x4a9e24(0x29b)],_0x37e78a['HD_UI_COORDINATES']['IMAGE_LIBRARY_BTN']['x'],_0x37e78a['HD_UI_COORDINATES']['IMAGE_LIBRARY_BTN']['y'],{'expectedTexts':['·∫¢nh'],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x444896['HD_ROI_EXPECTED'][_0x4a9e24(0x3e6)]}))throw new _0x3d2889[(_0x4a9e24(0x2d7))]('Failed\x20to\x20click\x20image\x20library\x20button',_0x3d2889[_0x4a9e24(0x359)][_0x4a9e24(0x27e)]);this[_0x4a9e24(0x206)]['log']('['+_0x27aaed['accountName']+_0x4a9e24(0x3ef)),await this['clickWithTransition'](_0x27aaed['deviceId'],_0x37e78a[_0x4a9e24(0x335)]['FIRST_IMAGE_BTN']['x'],_0x37e78a['HD_UI_COORDINATES']['FIRST_IMAGE_BTN']['y'],0x7d0);let _0x14b1b0=!0x1;if(_0x14b1b0=_0x3b324c[_0x4a9e24(0x3d8)]===_0x88c3e9[_0x4a9e24(0x1f3)]['HDBank']?await this['clickAndWaitForScreen'](_0x27aaed['deviceId'],_0x37e78a['HD_UI_COORDINATES']['SELECT_IMAGE_QR_CODE_BTN']['x'],_0x37e78a['HD_UI_COORDINATES']['SELECT_IMAGE_QR_CODE_BTN']['y'],{'expectedTexts':[_0x3b324c['beneficiaryAccountNo']],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x444896[_0x4a9e24(0x392)][_0x4a9e24(0x4a2)]}):await this[_0x4a9e24(0x479)](_0x27aaed['deviceId'],_0x37e78a['HD_UI_COORDINATES']['SELECT_IMAGE_QR_CODE_BTN']['x'],_0x37e78a['HD_UI_COORDINATES'][_0x4a9e24(0x272)]['y'],{'expectedTexts':[_0x3b324c['beneficiaryName']],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x444896[_0x4a9e24(0x392)]['VERIFY_ACCOUNT_NAME']}),!_0x14b1b0)throw await this['clickWithTransition'](_0x27aaed['deviceId'],_0x37e78a['HD_UI_COORDINATES']['HOME_ICON']['x'],_0x37e78a['HD_UI_COORDINATES'][_0x4a9e24(0x406)]['y'],0x7d0),new _0x3d2889['WithdrawalProcessingError']('Choose\x20wrong\x20image\x20qrcode',_0x3d2889['ErrorType']['TEMPORARY']);if(this[_0x4a9e24(0x206)]['log']('['+_0x27aaed['accountName']+_0x4a9e24(0x401)),await(0x0,_0x1da711['sleep'])(0x1f4),!await this['swipeAndWaitForScreen'](_0x27aaed['deviceId'],{'type':_0x45903d['PandaSwipeTypeEnum']['SWIPE_UP']},{'expectedTexts':[_0x4a9e24(0x40b)],'timeout':0x2710,'pollInterval':0x1f4,'roi':_0x444896[_0x4a9e24(0x392)][_0x4a9e24(0x412)],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new _0x3d2889[(_0x4a9e24(0x2d7))]('Swipe\x20up\x20failed',_0x3d2889['ErrorType'][_0x4a9e24(0x27e)]);this['logger'][_0x4a9e24(0x4dd)]('['+_0x27aaed['accountName']+']\x20-\x20Get\x20Swipe\x20up\x20screen'),await this[_0x4a9e24(0x354)](_0x27aaed[_0x4a9e24(0x29b)],_0x37e78a[_0x4a9e24(0x335)]['CONTINUE_TRANSFER_BTN']['x'],_0x37e78a['HD_UI_COORDINATES'][_0x4a9e24(0x4cb)]['y'],0x1f4);const _0x49ca83=await this[_0x4a9e24(0x4d0)](_0x27aaed['deviceId'],_0x37e78a[_0x4a9e24(0x1d4)],{'timeout':0x4e20,'pollInterval':0x1f4,'roi':_0x444896['HD_ROI_EXPECTED'][_0x4a9e24(0x2a7)],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}});if(!_0x49ca83)throw new _0x3d2889['WithdrawalProcessingError']('Couldn\x27t\x20get\x20HD\x20Screen\x20state\x20not\x20found',_0x3d2889['ErrorType']['FORCE_LOGIN']);switch(await(0x0,_0x1da711['sleep'])(0x3e8),_0x49ca83['name']){case _0x37e78a['HD_SCREEN_HINT_NAME'][_0x4a9e24(0x243)]:if(await this['inputSmartOTPFromConfig'](_0x27aaed['deviceId']),await(0x0,_0x1da711['sleep'])(0x3e8),!await this['verifyScreenState'](_0x27aaed['deviceId'],{'expectedTexts':['OTP\x20s·∫Ω\x20t·ª±\x20ƒë·ªông\x20l√†m\x20m·ªõi'],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x444896['HD_ROI_EXPECTED']['CONFIRM_AFTER_OTP'],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new _0x3d2889['WithdrawalProcessingError'](_0x4a9e24(0x45c),_0x3d2889['ErrorType']['FORCE_LOGIN']);this['logger']['log']('['+_0x27aaed[_0x4a9e24(0x2e2)]+']\x20-\x20Get\x20Confirm\x20after\x20OTP\x20screen');break;case _0x37e78a['HD_SCREEN_HINT_NAME']['TRANSACTION_VERIFY_NO_INPUT_OTP']:break;default:throw new _0x3d2889['WithdrawalProcessingError'](_0x4a9e24(0x38f),_0x3d2889['ErrorType'][_0x4a9e24(0x27e)]);}if(!await this['clickAndWaitForScreen'](_0x27aaed['deviceId'],_0x37e78a[_0x4a9e24(0x335)]['CONTINUE_TRANSFER_BTN']['x'],_0x37e78a['HD_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['y'],{'expectedTexts':['GIAO\x20D·ªäCH\x20TH√ÄNH\x20C√îNG'],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x444896['HD_ROI_EXPECTED']['TRANSACTION_SUCCESS'],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new _0x3d2889[(_0x4a9e24(0x2d7))](_0x4a9e24(0x332),_0x3d2889['ErrorType']['NO_BILL_AFTER_OTP']);this[_0x4a9e24(0x206)]['log']('['+_0x27aaed['accountName']+']\x20-\x20Get\x20Transaction\x20verify\x20screen'),await(0x0,_0x1da711['sleep'])(0x3e8),await this['wsService'][_0x4a9e24(0x33e)](_0x27aaed['deviceId'],{'type':_0x45903d['PandaSwipeTypeEnum']['SCROLL_DOWN']}),await(0x0,_0x1da711['sleep'])(0x3e8),await this[_0x4a9e24(0x3d6)](_0x27aaed[_0x4a9e24(0x29b)],{'folderPath':_0x3b324c['withdrawalCode']}),await(0x0,_0x1da711['sleep'])(0x7d0);}async['extractTransactionAmount'](_0x38da25){const _0x300c0a=_0x2b07c8;try{const _0x4aa460=await this['ocrService'][_0x300c0a(0x46b)](_0x38da25,{'fieldType':'singleLine','customROI':{'x':0.05,'y':0.75,'width':0.9,'height':0.12},'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}});if(!_0x4aa460)return this[_0x300c0a(0x206)]['warn']('Failed\x20to\x20extract\x20transaction\x20amount\x20from\x20ROI'),null;const _0xb8f897=_0x4aa460['text']['replace'](/[^\d.,]/g,'')['replace'](/,/g,''),_0x29432f=parseFloat(_0xb8f897);return isNaN(_0x29432f)?(this[_0x300c0a(0x206)][_0x300c0a(0x38c)]('Could\x20not\x20parse\x20amount\x20from\x20OCR\x20text:\x20'+_0x4aa460['text']),null):(this['logger']['log'](_0x300c0a(0x4e4)+_0x29432f[_0x300c0a(0x411)]('vi-VN')+_0x300c0a(0x400)+_0x4aa460['confidence']['toFixed'](0x2)+_0x300c0a(0x35e)+_0x4aa460['processingTime']+_0x300c0a(0x1fc)),_0x29432f);}catch(_0x5958de){return this['logger']['error']('Error\x20extracting\x20transaction\x20amount:\x20'+_0x5958de['message'],_0x5958de['stack']),null;}}async['onModuleInit'](){}[_0x2b07c8(0x421)](){}};_0x858fe9['HdBankService']=_0x1f732a,_0x858fe9[_0x2b07c8(0x3e1)]=_0x1f732a=_0x57fea7([(0x0,_0x44aaa8['Injectable'])(),_0x55cfab(0x0,(0x0,_0x44aaa8[_0x2b07c8(0x458)])(_0x46fc98[_0x2b07c8(0x49c)])),_0x19faac('design:paramtypes',['function'==typeof(_0x68a081=void 0x0!==_0x36533c[_0x2b07c8(0x1df)]&&_0x36533c['IWebSocketService'])?_0x68a081:Object,_0x2b07c8(0x42d)==typeof(_0x478385=void 0x0!==_0x2a54f5['DeviceService']&&_0x2a54f5['DeviceService'])?_0x478385:Object,_0x2b07c8(0x42d)==typeof(_0x31d3b2=void 0x0!==_0x1daf5d[_0x2b07c8(0x3e0)]&&_0x1daf5d['OCRService'])?_0x31d3b2:Object,'function'==typeof(_0x4c664c=void 0x0!==_0xe436b3['ImagePreprocessingService']&&_0xe436b3[_0x2b07c8(0x30f)])?_0x4c664c:Object])],_0x1f732a);},(_0x111dbf,_0x317ed9,_0x4b0ab5)=>{const _0xd671ae=a0_0x4abd;Object['defineProperty'](_0x317ed9,'__esModule',{'value':!0x0}),_0x317ed9['HD_SCREEN_OTP_HINT']=_0x317ed9['HD_SCREEN_HINT_NAME']=_0x317ed9['HD_UI_COORDINATES']=void 0x0;const _0x4e30af=_0x4b0ab5(0x11),_0x1cc295={'LOGIN_BTN':{'x':0.5,'y':0.6},'PASSWORD_FIELD':{'x':0.5,'y':0.5},'TRANSFER_BTN':{'x':0.7,'y':0.7},'TRANSFER_INTERNAL_BTN':{'x':0.2,'y':0.2},'TRANSFER_EXTERNAL_BTN':{'x':0.4,'y':0.2},'CLOSE_ALLOW_CONTACT_POPUP_BTN':{'x':0.3,'y':0.6},'ACCOUNT_NUMBER_INPUT':{'x':0.4,'y':0.43},'SELECT_BANK_BTN':{'x':0.4,'y':0.47},'SEARCH_BANK_BTN':{'x':0.4,'y':0.48},'INTERNAL_AMOUNT_INPUT':{'x':0.5,'y':0.6},'HIDE_NUMPAD_BTN':{'x':0.05,'y':0.4},'CONTINUE_TRANSFER_BTN':{'x':0.5,'y':0.85},'BANK_SEARCH_BTN':{'x':0.4,'y':0.45},'BANK_SEARCH_INPUT':{'x':0.4,'y':0.45},'EXTERNAL_AMOUNT_INPUT':{'x':0.3,'y':0.37},'BACK_TO_HOME':{'x':0.2,'y':0.98},'QR_CODE_BTN':{'x':0.5,'y':0.95},'IMAGE_LIBRARY_BTN':{'x':0.5,'y':0.85},'FIRST_IMAGE_BTN':{'x':0.3,'y':0.3},'SELECT_IMAGE_QR_CODE_BTN':{'x':0.95,'y':0.95},'HOME_ICON':{'x':0.11,'y':0.94},'CLOSE_WARNING_TRANSACTION_POPUP':{'x':0.73,'y':0.62}},_0x13cedc=(0x0,_0x4b0ab5(0x26)['scaleCoordinates'])(_0x1cc295);_0x317ed9['HD_UI_COORDINATES']='PANDA'===_0x4e30af['config']['boxType']?_0x13cedc:_0x1cc295,_0x317ed9['HD_SCREEN_HINT_NAME']={'ENTER_OTP':'ENTER_OTP','TRANSACTION_VERIFY_NO_INPUT_OTP':'TRANSACTION_VERIFY_NO_INPUT_OTP'},_0x317ed9['HD_SCREEN_OTP_HINT']=[{'name':_0x317ed9[_0xd671ae(0x30c)][_0xd671ae(0x243)],'hint':_0xd671ae(0x1d8)},{'name':_0x317ed9[_0xd671ae(0x30c)][_0xd671ae(0x30b)],'hint':'Mat\x20khau\x20giao\x20dich\x20OTP\x20se\x20tu\x20dong\x20lam\x20moi'}];},(_0xc93aaf,_0x46c383)=>{const _0x3a742a=a0_0x4abd;var _0x5dc1d5;Object['defineProperty'](_0x46c383,_0x3a742a(0x318),{'value':!0x0}),_0x46c383['PandaSwipeTypeEnum']=void 0x0,function(_0x3428a1){const _0x5a6181=_0x3a742a;_0x3428a1['SCROLL_UP']='4',_0x3428a1['SCROLL_DOWN']='5',_0x3428a1['SWIPE_UP']='6',_0x3428a1['SWIPE_DOWN']='7',_0x3428a1['SWIPE_LEFT']='8',_0x3428a1['SWIPE_RIGHT']='9',_0x3428a1[_0x5a6181(0x1ee)]='0';}(_0x5dc1d5||(_0x46c383['PandaSwipeTypeEnum']=_0x5dc1d5={}));},function(_0x4c8aca,_0x3a6f22,_0x1705de){const _0x1ae2d1=a0_0x4abd;var _0x18204e,_0x5a9da9,_0x16578b,_0x3634c4,_0x34be18=this&&this[_0x1ae2d1(0x290)]||function(_0x7916cf,_0x282216,_0x1d1a9b,_0x158402){const _0x14d2d3=_0x1ae2d1;var _0x3e9800,_0x444b24=arguments['length'],_0x3cd818=_0x444b24<0x3?_0x282216:null===_0x158402?_0x158402=Object['getOwnPropertyDescriptor'](_0x282216,_0x1d1a9b):_0x158402;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x14d2d3(0x40a)])_0x3cd818=Reflect['decorate'](_0x7916cf,_0x282216,_0x1d1a9b,_0x158402);else{for(var _0x573539=_0x7916cf['length']-0x1;_0x573539>=0x0;_0x573539--)(_0x3e9800=_0x7916cf[_0x573539])&&(_0x3cd818=(_0x444b24<0x3?_0x3e9800(_0x3cd818):_0x444b24>0x3?_0x3e9800(_0x282216,_0x1d1a9b,_0x3cd818):_0x3e9800(_0x282216,_0x1d1a9b))||_0x3cd818);}return _0x444b24>0x3&&_0x3cd818&&Object['defineProperty'](_0x282216,_0x1d1a9b,_0x3cd818),_0x3cd818;},_0x1abaf0=this&&this['__metadata']||function(_0x31d54c,_0xa4cea6){const _0x3aa128=_0x1ae2d1;if('object'==typeof Reflect&&_0x3aa128(0x42d)==typeof Reflect['metadata'])return Reflect['metadata'](_0x31d54c,_0xa4cea6);},_0x1cd74c=this&&this['__param']||function(_0x34864c,_0x59de17){return function(_0x177260,_0x5c6679){_0x59de17(_0x177260,_0x5c6679,_0x34864c);};};Object[_0x1ae2d1(0x38d)](_0x3a6f22,'__esModule',{'value':!0x0}),_0x3a6f22[_0x1ae2d1(0x34d)]=void 0x0;const _0x1bccae=_0x1705de(0xd),_0x1674c9=_0x1705de(0x13),_0xba31b9=_0x1705de(0x18),_0x4e8e21=_0x1705de(0x2),_0x1dfb1a=_0x1705de(0xe),_0x2d1c2c=_0x1705de(0x17),_0x2c7715=_0x1705de(0x1b),_0x39f872=_0x1705de(0x2a),_0x4f96a3=_0x1705de(0x25),_0x5a7f1f=_0x1705de(0x33),_0x1be6f4=_0x1705de(0x1e);let _0x152d8e=class extends _0x2d1c2c[_0x1ae2d1(0x25b)]{constructor(_0x12f996,_0x3eaea9,_0x588e96,_0x45753f){const _0x3d36a1=_0x1ae2d1;super(_0x12f996,_0x3eaea9,_0x588e96,_0x45753f),this['wsService']=_0x12f996,this[_0x3d36a1(0x2c6)]=_0x3d36a1(0x26c),this[_0x3d36a1(0x31c)]='com.vcb.VCB';}async[_0x1ae2d1(0x3d5)](_0x491aed){const _0x53ef81=_0x1ae2d1,_0x25fe44=await this['deviceService']['getDeviceConfig'](_0x491aed);if(!_0x25fe44||!_0x25fe44[_0x53ef81(0x3a0)])throw new Error(_0x53ef81(0x40d)+_0x491aed);await this[_0x53ef81(0x354)](_0x491aed,_0x5a7f1f[_0x53ef81(0x269)][_0x53ef81(0x310)]['x'],_0x5a7f1f['VCB_UI_COORDINATES']['PASSWORD_FIELD']['y'],0x5dc),await this['wsService']['inputText'](_0x491aed,_0x25fe44['password']),await(0x0,_0xba31b9[_0x53ef81(0x3b8)])(0x3e8),await this['wsService']['pressReturnKey'](_0x491aed),await(0x0,_0xba31b9['sleep'])(0x1f4);}async[_0x1ae2d1(0x3f8)](_0x2a905f,_0x4b3151=0x3){const _0x2d29b5=_0x1ae2d1,_0xbedc76=await this[_0x2d29b5(0x42e)][_0x2d29b5(0x33b)](_0x2a905f);if(!_0xbedc76||!_0xbedc76['smartOTP'])throw new Error('SmartOTP\x20not\x20configured\x20for\x20device\x20'+_0x2a905f);await(0x0,_0xba31b9[_0x2d29b5(0x3b8)])(0x1f4),await this['wsService']['inputText'](_0x2a905f,_0xbedc76[_0x2d29b5(0x22d)]);}async['launchApp'](_0x4203bd){const _0x5e574c=_0x1ae2d1;if(await this[_0x5e574c(0x1da)]['launchApp'](_0x4203bd,this['BUNDLE_ID']),!await this['verifyScreenState'](_0x4203bd,{'expectedTexts':['ƒêƒÉng\x20nh·∫≠p'],'timeout':0x2710,'pollInterval':0x1f4,'roi':_0x4f96a3['VCB_ROI_EXPECTED'][_0x5e574c(0x3cc)],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new _0x39f872['WithdrawalProcessingError']('Failed\x20to\x20launch\x20VIETCOMBANK\x20app',_0x39f872[_0x5e574c(0x359)]['FORCE_LOGIN']);this['logger'][_0x5e574c(0x4dd)]('['+_0x4203bd+']\x20-\x20Get\x20login\x20app\x20screen');}async['login'](_0x5c63b9){const _0x2b35c3=_0x1ae2d1;if(await this['killApp'](_0x5c63b9),await(0x0,_0xba31b9['sleep'])(0x7d0),await this['launchApp'](_0x5c63b9),await this['verifyScreenState'](_0x5c63b9,{'expectedTexts':['ƒêƒÉng\x20nh·∫≠p'],'timeout':0x4e20,'pollInterval':0x1f4,'roi':_0x4f96a3['VCB_ROI_EXPECTED']['LAUNCH_APP']}),await this['inputPasswordFromConfig'](_0x5c63b9),!await this[_0x2b35c3(0x479)](_0x5c63b9,_0x5a7f1f['VCB_UI_COORDINATES'][_0x2b35c3(0x3eb)]['x'],_0x5a7f1f['VCB_UI_COORDINATES']['LOGIN_BTN']['y'],{'expectedTexts':['Ch·ª©c\x20nƒÉng\x20∆∞a\x20th√≠ch'],'timeout':0x4e20,'pollInterval':0x1f4,'roi':_0x4f96a3['VCB_ROI_EXPECTED'][_0x2b35c3(0x4d3)]}))throw new _0x39f872['WithdrawalProcessingError']('Failed\x20to\x20login\x20to\x20VIETCOMBANK',_0x39f872[_0x2b35c3(0x359)]['FORCE_LOGIN']);this['logger']['log']('['+_0x5c63b9+']\x20-\x20Login\x20successfully');}async['executeTransferWithQRCode'](_0x27fd3e,_0x32f248){const _0x1a59b4=_0x1ae2d1;if(this[_0x1a59b4(0x206)]['log'](_0x1a59b4(0x1d7)+_0x27fd3e['withdrawalId']+_0x1a59b4(0x44f)+_0x32f248['deviceId']),await this['clickWithTransition'](_0x32f248['deviceId'],_0x5a7f1f['VCB_UI_COORDINATES']['QR_CODE_BTN']['x'],_0x5a7f1f[_0x1a59b4(0x269)]['QR_CODE_BTN']['y'],0xbb8),await(0x0,_0xba31b9['sleep'])(0x7d0),!await this['clickAndWaitForScreen'](_0x32f248['deviceId'],_0x5a7f1f['VCB_UI_COORDINATES']['IMAGE_LIBRARY_BTN']['x'],_0x5a7f1f['VCB_UI_COORDINATES']['IMAGE_LIBRARY_BTN']['y'],{'expectedTexts':['·∫¢nh',_0x1a59b4(0x394)],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x4f96a3['VCB_ROI_EXPECTED']['ALBUM_SCREEN']}))throw new _0x39f872['WithdrawalProcessingError'](_0x1a59b4(0x46f),_0x39f872[_0x1a59b4(0x359)][_0x1a59b4(0x27e)]);if(this['logger']['log']('['+_0x32f248['accountName']+']\x20-\x20Get\x20image\x20library\x20screen'),!await this['clickAndWaitForScreen'](_0x32f248['deviceId'],_0x5a7f1f['VCB_UI_COORDINATES'][_0x1a59b4(0x441)]['x'],_0x5a7f1f['VCB_UI_COORDINATES']['FIRST_IMAGE_BTN']['y'],{'expectedTexts':[_0x27fd3e['beneficiaryName']],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x4f96a3['VCB_ROI_EXPECTED'][_0x1a59b4(0x270)]}))throw await this[_0x1a59b4(0x354)](_0x32f248['deviceId'],_0x5a7f1f['VCB_UI_COORDINATES'][_0x1a59b4(0x406)]['x'],_0x5a7f1f['VCB_UI_COORDINATES'][_0x1a59b4(0x406)]['y'],0x7d0),new _0x39f872['WithdrawalProcessingError']('Choose\x20wrong\x20image\x20qrcode',_0x39f872['ErrorType']['TEMPORARY']);if(this['logger'][_0x1a59b4(0x4dd)]('['+_0x32f248[_0x1a59b4(0x2e2)]+']\x20-\x20Get\x20Verified\x20account\x20name\x20screen'),!await this['clickAndWaitForScreen'](_0x32f248['deviceId'],_0x5a7f1f[_0x1a59b4(0x269)]['CONTINUE_TRANSFER_BTN']['x'],_0x5a7f1f[_0x1a59b4(0x269)]['CONTINUE_TRANSFER_BTN']['y'],{'expectedTexts':['ki·ªÉm\x20tra\x20v√†\x20x√°c\x20nh·∫≠n'],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x4f96a3['VCB_ROI_EXPECTED']['TRANSACTION_VERIFY']}))throw new _0x39f872['WithdrawalProcessingError'](_0x1a59b4(0x277),_0x39f872[_0x1a59b4(0x359)]['FORCE_LOGIN']);if(this[_0x1a59b4(0x206)][_0x1a59b4(0x4dd)]('['+_0x32f248['accountName']+']\x20-\x20Get\x20Transaction\x20verification\x20screen'),!await this['clickAndWaitForScreen'](_0x32f248['deviceId'],_0x5a7f1f[_0x1a59b4(0x269)]['CONTINUE_TRANSFER_BTN']['x'],_0x5a7f1f['VCB_UI_COORDINATES']['CONTINUE_TRANSFER_BTN']['y'],{'expectedTexts':[_0x1a59b4(0x298)],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x4f96a3['VCB_ROI_EXPECTED']['OTP_ENTER']}))throw new _0x39f872['WithdrawalProcessingError'](_0x1a59b4(0x332),_0x39f872['ErrorType']['FORCE_LOGIN']);if(this[_0x1a59b4(0x206)]['log']('['+_0x32f248[_0x1a59b4(0x2e2)]+']\x20-\x20Get\x20Transaction\x20verify\x20screen'),await this['inputSmartOTPFromConfig'](_0x32f248[_0x1a59b4(0x29b)]),await(0x0,_0xba31b9['sleep'])(0x1f4),!await this['clickAndWaitForScreen'](_0x32f248[_0x1a59b4(0x29b)],_0x5a7f1f['VCB_UI_COORDINATES']['OTP_ENTER_TRANSFER_BTN']['x'],_0x5a7f1f['VCB_UI_COORDINATES']['OTP_ENTER_TRANSFER_BTN']['y'],{'expectedTexts':['M√£\x20x√°c\x20th·ª±c\x20giao\x20d·ªãch'],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x4f96a3[_0x1a59b4(0x376)][_0x1a59b4(0x305)]}))throw new _0x39f872['WithdrawalProcessingError']('Transaction\x20verify\x20screen\x20not\x20found',_0x39f872[_0x1a59b4(0x359)]['NO_BILL_AFTER_OTP']);if(this['logger'][_0x1a59b4(0x4dd)]('['+_0x32f248[_0x1a59b4(0x2e2)]+']\x20-\x20Get\x20Transaction\x20verify\x20screen'),!await this['clickAndWaitForScreen'](_0x32f248['deviceId'],_0x5a7f1f['VCB_UI_COORDINATES']['CONTINUE_OTP_VERIFY_BTN']['x'],_0x5a7f1f['VCB_UI_COORDINATES'][_0x1a59b4(0x368)]['y'],{'expectedTexts':[_0x1a59b4(0x1fb)],'timeout':0x7530,'pollInterval':0x1f4,'roi':_0x4f96a3['VCB_ROI_EXPECTED']['TRANSACTION_SUCCESS'],'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}}))throw new _0x39f872['WithdrawalProcessingError']('Transaction\x20success\x20screen\x20not\x20found',_0x39f872[_0x1a59b4(0x359)][_0x1a59b4(0x497)]);this['logger']['log']('['+_0x32f248[_0x1a59b4(0x2e2)]+_0x1a59b4(0x4a9)),await(0x0,_0xba31b9['sleep'])(0x1f4),await this['captureScreen'](_0x32f248['deviceId'],{'folderPath':_0x27fd3e['withdrawalCode']}),await this['clickWithTransition'](_0x32f248[_0x1a59b4(0x29b)],_0x5a7f1f['VCB_UI_COORDINATES']['HOME_ICON']['x'],_0x5a7f1f[_0x1a59b4(0x269)][_0x1a59b4(0x406)]['y'],0x1388,'['+_0x32f248[_0x1a59b4(0x2e2)]+_0x1a59b4(0x2d4));}async[_0x1ae2d1(0x284)](_0x2e4ea8){const _0x106d04=_0x1ae2d1;try{const _0x164d29=await this[_0x106d04(0x4a3)]['recognizeFromFile'](_0x2e4ea8,{'fieldType':'singleLine','customROI':{'x':0.05,'y':0.75,'width':0.9,'height':0.12},'preprocess':{'grayscale':!0x0,'enhanceContrast':!0x0}});if(!_0x164d29)return this[_0x106d04(0x206)]['warn']('Failed\x20to\x20extract\x20transaction\x20amount\x20from\x20ROI'),null;const _0x3730ff=_0x164d29['text'][_0x106d04(0x3c3)](/[^\d.,]/g,'')['replace'](/,/g,''),_0x4fd374=parseFloat(_0x3730ff);return isNaN(_0x4fd374)?(this[_0x106d04(0x206)]['warn'](_0x106d04(0x35c)+_0x164d29[_0x106d04(0x2ad)]),null):(this[_0x106d04(0x206)]['log']('Extracted\x20transaction\x20amount:\x20'+_0x4fd374['toLocaleString']('vi-VN')+_0x106d04(0x400)+_0x164d29[_0x106d04(0x480)]['toFixed'](0x2)+'%,\x20time:\x20'+_0x164d29['processingTime']+_0x106d04(0x1fc)),_0x4fd374);}catch(_0x1cee04){return this['logger']['error']('Error\x20extracting\x20transaction\x20amount:\x20'+_0x1cee04[_0x106d04(0x4ad)],_0x1cee04['stack']),null;}}async[_0x1ae2d1(0x2b8)](){}['onModuleDestroy'](){}};_0x3a6f22['VietcombankService']=_0x152d8e,_0x3a6f22['VietcombankService']=_0x152d8e=_0x34be18([(0x0,_0x4e8e21[_0x1ae2d1(0x4cd)])(),_0x1cd74c(0x0,(0x0,_0x4e8e21[_0x1ae2d1(0x458)])(_0x1bccae['WEBSOCKET_SERVICE'])),_0x1abaf0(_0x1ae2d1(0x2d9),['function'==typeof(_0x18204e=void 0x0!==_0x1674c9[_0x1ae2d1(0x1df)]&&_0x1674c9[_0x1ae2d1(0x1df)])?_0x18204e:Object,'function'==typeof(_0x5a9da9=void 0x0!==_0x1dfb1a['DeviceService']&&_0x1dfb1a[_0x1ae2d1(0x2a3)])?_0x5a9da9:Object,'function'==typeof(_0x16578b=void 0x0!==_0x2c7715['OCRService']&&_0x2c7715[_0x1ae2d1(0x3e0)])?_0x16578b:Object,_0x1ae2d1(0x42d)==typeof(_0x3634c4=void 0x0!==_0x1be6f4['ImagePreprocessingService']&&_0x1be6f4['ImagePreprocessingService'])?_0x3634c4:Object])],_0x152d8e);},(_0x1df549,_0x308367,_0x1ea466)=>{const _0x3f2598=a0_0x4abd;Object[_0x3f2598(0x38d)](_0x308367,'__esModule',{'value':!0x0}),_0x308367[_0x3f2598(0x269)]=void 0x0;const _0x2e4d23=_0x1ea466(0x11),_0x5cecef={'LOGIN_BTN':{'x':0.5,'y':0.55},'PASSWORD_FIELD':{'x':0.5,'y':0.45},'TRANSFER_BTN':{'x':0.7,'y':0.7},'TRANSFER_INTERNAL_BTN':{'x':0.2,'y':0.2},'TRANSFER_EXTERNAL_BTN':{'x':0.4,'y':0.2},'CLOSE_ALLOW_CONTACT_POPUP_BTN':{'x':0.3,'y':0.6},'ACCOUNT_NUMBER_INPUT':{'x':0.4,'y':0.43},'SELECT_BANK_BTN':{'x':0.4,'y':0.47},'SEARCH_BANK_BTN':{'x':0.4,'y':0.48},'INTERNAL_AMOUNT_INPUT':{'x':0.5,'y':0.6},'HIDE_NUMPAD_BTN':{'x':0.05,'y':0.4},'CONTINUE_TRANSFER_BTN':{'x':0.6,'y':0.92},'CONTINUE_OTP_VERIFY_BTN':{'x':0.5,'y':0.68},'OTP_ENTER_TRANSFER_BTN':{'x':0.5,'y':0.62},'BANK_SEARCH_BTN':{'x':0.4,'y':0.45},'BANK_SEARCH_INPUT':{'x':0.4,'y':0.45},'EXTERNAL_AMOUNT_INPUT':{'x':0.3,'y':0.37},'BACK_TO_HOME':{'x':0.2,'y':0.9},'QR_CODE_BTN':{'x':0.4,'y':0.92},'IMAGE_LIBRARY_BTN':{'x':0.4,'y':0.92},'FIRST_IMAGE_BTN':{'x':0.3,'y':0.3},'SELECT_IMAGE_QR_CODE_BTN':{'x':0.95,'y':0.95},'HOME_ICON':{'x':0.93,'y':0.07}},_0x57284d=(0x0,_0x1ea466(0x26)['scaleCoordinates'])(_0x5cecef);_0x308367[_0x3f2598(0x269)]='PANDA'===_0x2e4d23['config']['boxType']?_0x57284d:_0x5cecef;},function(_0x2e25b9,_0x2f0506,_0x38a8ab){const _0x47cf6f=a0_0x4abd;var _0x33ad1b,_0x1af344=this&&this['__decorate']||function(_0x1ae5da,_0x5ee5c2,_0x18b9e9,_0x26bf7d){const _0xead79c=a0_0x4abd;var _0x178a97,_0x3801bc=arguments['length'],_0x11561f=_0x3801bc<0x3?_0x5ee5c2:null===_0x26bf7d?_0x26bf7d=Object[_0xead79c(0x4a5)](_0x5ee5c2,_0x18b9e9):_0x26bf7d;if('object'==typeof Reflect&&'function'==typeof Reflect[_0xead79c(0x40a)])_0x11561f=Reflect['decorate'](_0x1ae5da,_0x5ee5c2,_0x18b9e9,_0x26bf7d);else{for(var _0x10cf58=_0x1ae5da['length']-0x1;_0x10cf58>=0x0;_0x10cf58--)(_0x178a97=_0x1ae5da[_0x10cf58])&&(_0x11561f=(_0x3801bc<0x3?_0x178a97(_0x11561f):_0x3801bc>0x3?_0x178a97(_0x5ee5c2,_0x18b9e9,_0x11561f):_0x178a97(_0x5ee5c2,_0x18b9e9))||_0x11561f);}return _0x3801bc>0x3&&_0x11561f&&Object['defineProperty'](_0x5ee5c2,_0x18b9e9,_0x11561f),_0x11561f;},_0x32aa08=this&&this['__metadata']||function(_0x47a70d,_0x207658){const _0x2ac6dd=a0_0x4abd;if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect[_0x2ac6dd(0x47a)](_0x47a70d,_0x207658);};Object['defineProperty'](_0x2f0506,'__esModule',{'value':!0x0}),_0x2f0506['SessionManagementService']=void 0x0;const _0x52228d=_0x38a8ab(0x2),_0x2f0519=_0x38a8ab(0xf);let _0x30582c=class{constructor(_0x200e45){const _0x403dc3=a0_0x4abd;this['redisService']=_0x200e45,this['logger']=new _0x52228d[(_0x403dc3(0x366))]('SessionManagementService'),this['REDIS_SESSION_PREFIX']=_0x403dc3(0x37f),this['BANK_SESSION_CONFIGS']=new Map([['ACB',{'bankCode':'ACB','sessionTimeoutMs':0xdbba0,'refreshBeforeMs':0xea60}],[_0x403dc3(0x250),{'bankCode':_0x403dc3(0x250),'sessionTimeoutMs':0x41eb0,'refreshBeforeMs':0x7530}],[_0x403dc3(0x436),{'bankCode':'HDBANK','sessionTimeoutMs':0x41eb0,'refreshBeforeMs':0x7530}]]);}['getSessionTimeout'](_0x4e039f){const _0x12a1d3=this['BANK_SESSION_CONFIGS']['get'](_0x4e039f['toUpperCase']());return _0x12a1d3?.['sessionTimeoutMs']||0x41eb0;}['getRefreshBeforeTime'](_0x30d55f){const _0x41717a=a0_0x4abd,_0x598c9a=this['BANK_SESSION_CONFIGS'][_0x41717a(0x4af)](_0x30d55f['toUpperCase']());return _0x598c9a?.['refreshBeforeMs']||0x7530;}async['recordLogin'](_0x2f6bfd,_0xd28ca5){const _0x4d54f0=a0_0x4abd,_0x581db4=this['getSessionTimeout'](_0xd28ca5),_0x20f4e4=Date['now']()+_0x581db4,_0x3b0b45={'deviceId':_0x2f6bfd,'bankCode':_0xd28ca5['toUpperCase'](),'loginTime':Date[_0x4d54f0(0x34e)](),'expiresAt':_0x20f4e4,'status':_0x4d54f0(0x2a5)},_0x3c0669=''+this['REDIS_SESSION_PREFIX']+_0x2f6bfd+':'+_0xd28ca5['toUpperCase']();await this['redisService'][_0x4d54f0(0x1f8)](_0x3c0669,JSON['stringify'](_0x3b0b45),_0x581db4),this['logger']['log']('['+_0x2f6bfd+_0x4d54f0(0x1de)+_0xd28ca5+_0x4d54f0(0x3d1)+new Date(_0x20f4e4)['toISOString']()+')');}async['markLoggingIn'](_0x4a6210,_0x483661){const _0x39c63e=a0_0x4abd,_0x34ef34=''+this['REDIS_SESSION_PREFIX']+_0x4a6210+':'+_0x483661[_0x39c63e(0x35a)](),_0x503786=await this[_0x39c63e(0x47f)](_0x4a6210,_0x483661),_0x555468={'deviceId':_0x4a6210,'bankCode':_0x483661[_0x39c63e(0x35a)](),'loginTime':_0x503786?.['loginTime']||Date[_0x39c63e(0x34e)](),'expiresAt':_0x503786?.['expiresAt']||Date[_0x39c63e(0x34e)]()+this['getSessionTimeout'](_0x483661),'status':'logging_in'};await this[_0x39c63e(0x43c)]['set'](_0x34ef34,JSON['stringify'](_0x555468),0x493e0),this['logger']['log']('Marked\x20device\x20'+_0x4a6210+_0x39c63e(0x4ba)+_0x483661+'\x20as\x20logging\x20in');}async[_0x47cf6f(0x47f)](_0x362d4c,_0x2acd6b){const _0x216262=_0x47cf6f;try{const _0x4a89b9=''+this[_0x216262(0x43a)]+_0x362d4c+':'+_0x2acd6b[_0x216262(0x35a)](),_0x5b92ac=await this['redisService']['get'](_0x4a89b9);return _0x5b92ac?JSON['parse'](_0x5b92ac):null;}catch(_0x8c8836){return this[_0x216262(0x206)][_0x216262(0x20b)](_0x216262(0x35f)+_0x362d4c+',\x20bank\x20'+_0x2acd6b+':\x20'+_0x8c8836['message']),null;}}async['isSessionValid'](_0x29f62e,_0xd8004d){const _0x20b720=_0x47cf6f,_0x51e122=await this[_0x20b720(0x47f)](_0x29f62e,_0xd8004d);return!(!_0x51e122||_0x51e122['expiresAt']<Date['now']()||'logging_in'===_0x51e122['status']||'logged_in'!==_0x51e122['status']);}async['needsRefresh'](_0x904c5c,_0x4e4a2f){const _0x320956=_0x47cf6f,_0x4ff63a=await this['getSession'](_0x904c5c,_0x4e4a2f);if(!_0x4ff63a||'logged_in'!==_0x4ff63a['status'])return!0x1;const _0x269253=this['getRefreshBeforeTime'](_0x4e4a2f);return _0x4ff63a['expiresAt']-Date[_0x320956(0x34e)]()<=_0x269253;}async['clearSession'](_0x1f6b93,_0x10ce17){const _0x17a991=_0x47cf6f,_0x157ce9=''+this['REDIS_SESSION_PREFIX']+_0x1f6b93+':'+_0x10ce17[_0x17a991(0x35a)]();await this[_0x17a991(0x43c)]['del'](_0x157ce9),this['logger'][_0x17a991(0x4dd)](_0x17a991(0x418)+_0x1f6b93+',\x20bank\x20'+_0x10ce17);}};_0x2f0506[_0x47cf6f(0x3e2)]=_0x30582c,_0x2f0506['SessionManagementService']=_0x30582c=_0x1af344([(0x0,_0x52228d['Injectable'])(),_0x32aa08(_0x47cf6f(0x2d9),[_0x47cf6f(0x42d)==typeof(_0x33ad1b=void 0x0!==_0x2f0519['RedisService']&&_0x2f0519[_0x47cf6f(0x374)])?_0x33ad1b:Object])],_0x30582c);},function(_0x4b1a7d,_0x975406,_0x67a178){const _0x4c0b33=a0_0x4abd;var _0x59642c,_0x52b7f6=this&&this['__decorate']||function(_0x419a56,_0x3dd13c,_0xa9eb63,_0x45b8ec){const _0x3274fc=a0_0x4abd;var _0xdc8aba,_0x77a585=arguments[_0x3274fc(0x20f)],_0xc5acf=_0x77a585<0x3?_0x3dd13c:null===_0x45b8ec?_0x45b8ec=Object['getOwnPropertyDescriptor'](_0x3dd13c,_0xa9eb63):_0x45b8ec;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0xc5acf=Reflect['decorate'](_0x419a56,_0x3dd13c,_0xa9eb63,_0x45b8ec);else{for(var _0x43a701=_0x419a56['length']-0x1;_0x43a701>=0x0;_0x43a701--)(_0xdc8aba=_0x419a56[_0x43a701])&&(_0xc5acf=(_0x77a585<0x3?_0xdc8aba(_0xc5acf):_0x77a585>0x3?_0xdc8aba(_0x3dd13c,_0xa9eb63,_0xc5acf):_0xdc8aba(_0x3dd13c,_0xa9eb63))||_0xc5acf);}return _0x77a585>0x3&&_0xc5acf&&Object['defineProperty'](_0x3dd13c,_0xa9eb63,_0xc5acf),_0xc5acf;},_0x2c2ed9=this&&this['__metadata']||function(_0x386f39,_0x40a183){const _0x242f86=a0_0x4abd;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x242f86(0x47a)])return Reflect[_0x242f86(0x47a)](_0x386f39,_0x40a183);};Object['defineProperty'](_0x975406,'__esModule',{'value':!0x0}),_0x975406['NotificationService']=void 0x0;const _0x250564=_0x67a178(0x2),_0x310dee=_0x67a178(0x36);let _0x7eb20c=class{constructor(_0x7f5251){const _0x121b7b=a0_0x4abd;this[_0x121b7b(0x3b6)]=_0x7f5251,this['logger']=new _0x250564['Logger']('NotificationService');}async[_0x4c0b33(0x386)](_0x2569af,_0x1d9220,_0x5841d9){const _0x44cb77=_0x4c0b33;this['ezpayBeClient']['completeWithdrawal'](_0x2569af['_id'],{'analyzedStatus':_0x1d9220['analyzedStatus'],'sourceAccountNo':_0x5841d9['accountNo'],'sourceBankCode':_0x5841d9['bankCode'],'sourceAccountName':_0x5841d9['accountName']})[_0x44cb77(0x499)](_0x37262d=>{this['logger']['error']('['+_0x2569af['withdrawalCode']+']\x20-\x20Error\x20updating\x20withdrawal\x20status\x20for\x20'+_0x2569af['_id']+'\x20-\x20'+_0x37262d['stack']);}),this['ezpayBeClient'][_0x44cb77(0x208)](_0x2569af['_id'],_0x1d9220['rawPath'])['catch'](_0x599091=>{const _0x1e3db7=_0x44cb77;this[_0x1e3db7(0x206)]['error']('['+_0x2569af['withdrawalCode']+']\x20-\x20Error\x20uploading\x20receipt\x20for\x20'+_0x2569af['_id']+_0x1e3db7(0x3f2)+_0x599091['stack']);});}['updateWithdrawalStatus'](_0x43fc3f,_0x4984c6){return this['ezpayBeClient']['updateWithdrawalStatus'](_0x43fc3f,_0x4984c6);}['uploadReceipt'](_0x43ca49,_0x5f23e6){return this['ezpayBeClient']['uploadReceipt'](_0x43ca49,_0x5f23e6);}};_0x975406[_0x4c0b33(0x3a6)]=_0x7eb20c,_0x975406['NotificationService']=_0x7eb20c=_0x52b7f6([(0x0,_0x250564[_0x4c0b33(0x4cd)])(),_0x2c2ed9('design:paramtypes',['function'==typeof(_0x59642c=void 0x0!==_0x310dee[_0x4c0b33(0x247)]&&_0x310dee['EzpayBeClientService'])?_0x59642c:Object])],_0x7eb20c);},function(_0xffc29,_0x288932,_0x3de0a4){const _0x49a27d=a0_0x4abd;var _0x30459f,_0x15de74=this&&this['__decorate']||function(_0x52c752,_0x2c1b83,_0x396ef4,_0x5e105c){const _0x9c5ed6=a0_0x4abd;var _0x298510,_0x34d61b=arguments['length'],_0x496416=_0x34d61b<0x3?_0x2c1b83:null===_0x5e105c?_0x5e105c=Object['getOwnPropertyDescriptor'](_0x2c1b83,_0x396ef4):_0x5e105c;if(_0x9c5ed6(0x2f0)==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x496416=Reflect['decorate'](_0x52c752,_0x2c1b83,_0x396ef4,_0x5e105c);else{for(var _0x108036=_0x52c752['length']-0x1;_0x108036>=0x0;_0x108036--)(_0x298510=_0x52c752[_0x108036])&&(_0x496416=(_0x34d61b<0x3?_0x298510(_0x496416):_0x34d61b>0x3?_0x298510(_0x2c1b83,_0x396ef4,_0x496416):_0x298510(_0x2c1b83,_0x396ef4))||_0x496416);}return _0x34d61b>0x3&&_0x496416&&Object[_0x9c5ed6(0x38d)](_0x2c1b83,_0x396ef4,_0x496416),_0x496416;},_0x34aa02=this&&this['__metadata']||function(_0x488845,_0x55160f){const _0x5ba35e=a0_0x4abd;if(_0x5ba35e(0x2f0)==typeof Reflect&&'function'==typeof Reflect[_0x5ba35e(0x47a)])return Reflect['metadata'](_0x488845,_0x55160f);};Object['defineProperty'](_0x288932,'__esModule',{'value':!0x0}),_0x288932['EzpayBeClientService']=void 0x0;const _0x281941=_0x3de0a4(0x2),_0xbae1a0=_0x3de0a4(0x8),_0x9c97f6=_0x3de0a4(0x37),_0x9234f8=_0x3de0a4(0x2e),_0x1ddfce=_0x3de0a4(0x19),_0x41c6ae=_0x3de0a4(0x11),_0x16c291=_0x3de0a4(0x18);let _0x425ab8=class{constructor(_0x45edf1){const _0x4366ed=a0_0x4abd;this[_0x4366ed(0x475)]=_0x45edf1,this['logger']=new _0x281941[(_0x4366ed(0x366))](_0x4366ed(0x247)),this['apiUrl']=_0x41c6ae['config'][_0x4366ed(0x238)]['apiUrl']??'http://localhost:3001',this['apiKey']=_0x41c6ae['config']['ezpayBe'][_0x4366ed(0x3dc)]??'';}async[_0x49a27d(0x386)](_0x216a52,_0x22bba4){const _0x332f20=_0x49a27d;for(let _0x576237=0x0;_0x576237<=0x3;_0x576237++)try{const _0x28d9a1=this[_0x332f20(0x217)]+'/api/internal/withdrawals/complete/'+_0x216a52;this['logger'][_0x332f20(0x4dd)](_0x332f20(0x1cc)+_0x216a52+_0x332f20(0x1dd)+_0x22bba4[_0x332f20(0x32c)]+'\x20(attempt\x20'+(_0x576237+0x1)+_0x332f20(0x4e0));const _0x4cc25f={'analyzedStatus':_0x22bba4['analyzedStatus'],'sourceBankCode':_0x22bba4['sourceBankCode'],'sourceAccountNo':_0x22bba4['sourceAccountNo'],'sourceAccountName':_0x22bba4[_0x332f20(0x449)]},_0x398ffd=await(0x0,_0x9c97f6['firstValueFrom'])(this['httpService']['patch'](_0x28d9a1,_0x4cc25f,{'headers':{'Content-Type':'application/json','X-API-Key':this['apiKey'],'x-internal-secret-key':_0x332f20(0x274)},'timeout':0x4e20}));if(0xc8===_0x398ffd['status']||0xcc===_0x398ffd['status'])return void this['logger'][_0x332f20(0x4dd)](_0x332f20(0x326)+_0x216a52+'\x20status\x20to\x20'+_0x22bba4[_0x332f20(0x32c)]);this['logger']['warn']('Unexpected\x20status\x20code\x20'+_0x398ffd['status']+_0x332f20(0x2f4)+_0x216a52);}catch(_0x3b5932){const _0x38d170=_0x3b5932,_0x271db4=_0x38d170['response']?.['data'],_0x168462=_0x38d170['message'];if(_0x576237<0x3){const _0x38f3af=0x7d0*Math['pow'](0x2,_0x576237);this[_0x332f20(0x206)]['warn']('Failed\x20to\x20update\x20withdrawal\x20'+_0x216a52+'\x20(attempt\x20'+(_0x576237+0x1)+_0x332f20(0x297)+_0x168462+_0x332f20(0x46a)+JSON['stringify'](_0x271db4)+',\x20Retrying\x20in\x20'+_0x38f3af+'ms'),await(0x0,_0x16c291['sleep'])(_0x38f3af);}else this['logger']['error'](_0x332f20(0x2a0)+_0x216a52+'\x20after\x204\x20attempts.\x20Payload:\x20'+JSON['stringify'](_0x271db4)+_0x332f20(0x201)+_0x168462);}}async[_0x49a27d(0x208)](_0x1aa770,_0x3860d8){const _0xb0779a=_0x49a27d;for(let _0x3dbb24=0x0;_0x3dbb24<=0x3;_0x3dbb24++)try{const _0xb4407=this['apiUrl']+_0xb0779a(0x2e0)+_0x1aa770;if(this['logger']['log'](_0xb0779a(0x450)+_0x1aa770+_0xb0779a(0x32d)+(_0x3dbb24+0x1)+'/4)'),!_0x3860d8)return void this[_0xb0779a(0x206)]['warn']('No\x20receipt\x20path\x20provided\x20for\x20withdrawal\x20'+_0x1aa770);const _0x458d45=new _0x9234f8();_0x458d45['append'](_0xb0779a(0x427),(0x0,_0x1ddfce['createReadStream'])(_0x3860d8));const _0x48cb26=await(0x0,_0x9c97f6['firstValueFrom'])(this['httpService']['patch'](_0xb4407,_0x458d45,{'headers':{..._0x458d45[_0xb0779a(0x49f)](),'X-API-Key':this['apiKey'],'x-internal-secret-key':'uHqE5X9H0QEBsqlZpdTHG0fOyvmMtHjCGgsG4ouls3Gz9WvaWg4w9HV3sqETGWfE'},'timeout':0x4e20}));if(0xc8===_0x48cb26['status']||0xcc===_0x48cb26['status'])return void this['logger']['log'](_0xb0779a(0x3ca)+_0x1aa770);this['logger']['warn']('Unexpected\x20status\x20code\x20'+_0x48cb26[_0xb0779a(0x2be)]+'\x20when\x20uploading\x20bill\x20for\x20withdrawal\x20'+_0x1aa770);}catch(_0x3e65a1){const _0x1e9ec2=_0x3e65a1,_0x3fbdbe=_0x1e9ec2['response']?.['data'],_0x2fcb2f=_0x1e9ec2['message'];if(_0x3dbb24<0x3){const _0x325d56=0x7d0*Math['pow'](0x2,_0x3dbb24);this['logger']['warn']('Failed\x20to\x20upload\x20bill\x20for\x20withdrawal\x20'+_0x1aa770+'\x20(attempt\x20'+(_0x3dbb24+0x1)+_0xb0779a(0x297)+_0x2fcb2f+'.\x20Response:\x20'+JSON['stringify'](_0x3fbdbe)+_0xb0779a(0x342)+_0x325d56+'ms'),await(0x0,_0x16c291['sleep'])(_0x325d56);}else this['logger']['error'](_0xb0779a(0x37d)+_0x1aa770+'\x20after\x204\x20attempts.\x20Response:\x20'+JSON[_0xb0779a(0x445)](_0x3fbdbe)+_0xb0779a(0x201)+_0x2fcb2f);}}async[_0x49a27d(0x1f7)](_0x1c2423,_0x566339){const _0x5dacd9=_0x49a27d;this['logger']['log'](_0x5dacd9(0x1cc)+_0x1c2423+_0x5dacd9(0x1dd)+_0x566339);const _0x20f2aa=this[_0x5dacd9(0x217)]+'/api/internal/withdrawals/status/'+_0x1c2423;await(0x0,_0x9c97f6[_0x5dacd9(0x3ee)])(this[_0x5dacd9(0x475)]['patch'](_0x20f2aa,{'status':_0x566339},{'headers':{'x-internal-secret-key':_0x5dacd9(0x274)}}));}};_0x288932['EzpayBeClientService']=_0x425ab8,_0x288932[_0x49a27d(0x247)]=_0x425ab8=_0x15de74([(0x0,_0x281941[_0x49a27d(0x4cd)])(),_0x34aa02(_0x49a27d(0x2d9),['function'==typeof(_0x30459f=void 0x0!==_0xbae1a0['HttpService']&&_0xbae1a0['HttpService'])?_0x30459f:Object])],_0x425ab8);},_0x43bc0c=>{const _0x35bece=a0_0x4abd;_0x43bc0c[_0x35bece(0x1c6)]=require('rxjs');},function(_0x52cc75,_0x1e8f6a,_0x30255f){const _0x4bab78=a0_0x4abd;var _0x65d69d,_0x11d14e,_0x1e58f5,_0x342a61,_0x15b6ba,_0x22bbab,_0x45c826,_0x31b24a,_0xb63fd4,_0x28f32a,_0x51267a,_0x4f1852=this&&this['__decorate']||function(_0x5d4374,_0x1b6fe7,_0x134484,_0x324b15){const _0x3f6623=a0_0x4abd;var _0x12c98b,_0x4b5a26=arguments['length'],_0x2a9b60=_0x4b5a26<0x3?_0x1b6fe7:null===_0x324b15?_0x324b15=Object['getOwnPropertyDescriptor'](_0x1b6fe7,_0x134484):_0x324b15;if(_0x3f6623(0x2f0)==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x2a9b60=Reflect['decorate'](_0x5d4374,_0x1b6fe7,_0x134484,_0x324b15);else{for(var _0x575d54=_0x5d4374[_0x3f6623(0x20f)]-0x1;_0x575d54>=0x0;_0x575d54--)(_0x12c98b=_0x5d4374[_0x575d54])&&(_0x2a9b60=(_0x4b5a26<0x3?_0x12c98b(_0x2a9b60):_0x4b5a26>0x3?_0x12c98b(_0x1b6fe7,_0x134484,_0x2a9b60):_0x12c98b(_0x1b6fe7,_0x134484))||_0x2a9b60);}return _0x4b5a26>0x3&&_0x2a9b60&&Object['defineProperty'](_0x1b6fe7,_0x134484,_0x2a9b60),_0x2a9b60;},_0x2de580=this&&this['__metadata']||function(_0x4b85bb,_0x297515){const _0x460957=a0_0x4abd;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x460957(0x47a)])return Reflect['metadata'](_0x4b85bb,_0x297515);},_0x3670fe=this&&this['__param']||function(_0x3c2953,_0x15c950){return function(_0x122aad,_0x2213bc){_0x15c950(_0x122aad,_0x2213bc,_0x3c2953);};};Object['defineProperty'](_0x1e8f6a,_0x4bab78(0x318),{'value':!0x0}),_0x1e8f6a['WithdrawalJobManagerService']=void 0x0;const _0x5936a0=_0x30255f(0x2),_0xa2a3e1=_0x30255f(0x7),_0x5d5e19=_0x30255f(0x6),_0x39b418=_0x30255f(0x39),_0x465218=_0x30255f(0xa),_0x69a7fe=_0x30255f(0xe),_0x238b80=_0x30255f(0x14),_0x2c27e5=_0x30255f(0xd),_0x219b5f=_0x30255f(0x13),_0x7b52dd=_0x30255f(0x3a),_0x55f85b=_0x30255f(0x2a),_0x1e8f3c=_0x30255f(0x16),_0x12cd02=_0x30255f(0x3c),_0x54f12e=_0x30255f(0xb),_0x3acc7c=_0x30255f(0x35),_0xe87cde=_0x30255f(0x3d),_0x492100=_0x30255f(0x3e),_0x4573b0=_0x30255f(0x41),_0x549c53=_0x30255f(0x42),_0x5af168=_0x30255f(0x2c),_0xcb3b6b=_0x30255f(0x18),_0x12fb53=_0x30255f(0x43),_0x40c467=_0x30255f(0xf),_0x4219f6=_0x30255f(0x45),_0x296121=_0x30255f(0x11);let _0x58bbd6=class{constructor(_0x13ce48,_0x22c788,_0x5e194a,_0x90f424,_0x560711,_0x4c2aa5,_0x4ff23e,_0x102b93,_0x26d506,_0x3f30d1,_0x581076){const _0x47745f=_0x4bab78;this['withdrawalQueue']=_0x13ce48,this[_0x47745f(0x457)]=_0x22c788,this['deviceService']=_0x5e194a,this['deviceLockService']=_0x90f424,this[_0x47745f(0x1da)]=_0x560711,this['bankService']=_0x4c2aa5,this['notificationService']=_0x4ff23e,this['windowsAppGitBashService']=_0x102b93,this['redisLockService']=_0x26d506,this[_0x47745f(0x2e7)]=_0x3f30d1,this['redisService']=_0x581076,this['logger']=new _0x5936a0['Logger']('WithdrawalJobManagerService'),this['processingJobs']=new Set(),this[_0x47745f(0x4b8)]=!0x1,this['isRestartingBoxphone']=!0x1,this['cronRestartBoxphoneEnabled']=!0x1;}async[_0x4bab78(0x2b8)](){const _0x1223db=_0x4bab78;this[_0x1223db(0x206)][_0x1223db(0x4dd)]('WithdrawalJobManagerService\x20initialized,\x20waiting\x205\x20seconds\x20before\x20starting...'),this['initializeJobProcessing'](),this[_0x1223db(0x352)]();}async['initializeJobProcessing'](){setTimeout(async()=>{const _0x57d6b3=a0_0x4abd;this['isInitialized']||(this[_0x57d6b3(0x206)]['log'](_0x57d6b3(0x264)),await this['pickAndProcessJobs'](),this['isInitialized']=!0x0);},0x1388);}[_0x4bab78(0x352)](){const _0x210b88=_0x4bab78,_0x4f5bf9=new Date(),_0x5edbc1=0x3e8*(0x3c-_0x4f5bf9[_0x210b88(0x331)]())-_0x4f5bf9['getMilliseconds']();setTimeout(()=>{this['cronRestartBoxphoneEnabled']=!0x0;},_0x5edbc1);}async['restartBoxphone'](){const _0x94fea4=_0x4bab78;if(!await this['deviceLockService']['hasAnyLockKeys']()){const _0x2c86e6='development'===_0x296121['config']['NODE_ENV']?'üöÄüöÄüöÄ\x20<b>Boxphone\x20software(local\x20dev)...</b>':'üöÄüöÄüöÄ\x20<b>Boxphone\x20software...</b>';this['telegramService']['sendMessage']({'text':_0x2c86e6+('\x0a\x0a<b>Kh·ªüi\x20ƒë·ªông\x20l·∫°i:</b>\x20'+new Date()['toLocaleString'](_0x94fea4(0x301),{'timeZone':'Asia/Ho_Chi_Minh'})+'\x0a<b>D·ª±\x20ki·∫øn:</b>\x203\x20ph√∫t.'),'options':{'parseMode':_0x94fea4(0x361)}}),await this['windowsAppGitBashService']['restartApp']({'processName':'xiaowei_iphone.exe','exePath':_0x94fea4(0x34a),'runAsAdmin':!0x0,'killAsAdmin':!0x0}),this['telegramService'][_0x94fea4(0x3a7)]({'text':_0x94fea4(0x261)+new Date()['toLocaleString']('vi-VN',{'timeZone':'Asia/Ho_Chi_Minh'})+'\x0aLogin\x20t·∫•t\x20c·∫£\x20thi·∫øt\x20b·ªã\x20sau\x201\x20ph√∫t:','options':{'parseMode':_0x94fea4(0x361)}});try{await(0x0,_0xcb3b6b[_0x94fea4(0x3b8)])(0x1388),await this['bankService']['loginAllActiveBanks']();}catch(_0x41e155){this['logger']['error'](_0x94fea4(0x3a1)+_0x41e155['stack']);}finally{await(0x0,_0xcb3b6b[_0x94fea4(0x3b8)])(0x3e8),await this[_0x94fea4(0x496)][_0x94fea4(0x41b)](_0x549c53[_0x94fea4(0x27b)]);}}}async['pickAndProcessJobs'](_0x12e20b){const _0x2a6b4b=_0x4bab78;try{if(await this['redisLockService']['getLock'](_0x549c53[_0x2a6b4b(0x27b)])){if(this['isRestartingBoxphone'])return;return this[_0x2a6b4b(0x4bb)]=!0x0,await this['restartBoxphone'](),void(this['isRestartingBoxphone']=!0x1);}if(!this['wsService']['isConnectedStatus']())return void this[_0x2a6b4b(0x206)][_0x2a6b4b(0x20b)](_0x2a6b4b(0x1c8));const _0x43bd1a=await this['deviceService']['getServiceStatus']();if(_0x2a6b4b(0x4db)!==_0x43bd1a)return void this[_0x2a6b4b(0x206)]['debug']('Service\x20is\x20'+_0x43bd1a+',\x20cannot\x20pick\x20jobs');const _0x144371=await this['deviceService'][_0x2a6b4b(0x2b7)](),_0x43a68c=_0x144371[_0x2a6b4b(0x20f)];if(_0x43a68c<=0x0)return;const _0x10f3f6=_0x12e20b?Math['min'](_0x12e20b,_0x43a68c):_0x43a68c,_0x1d6308=await this['redisService'][_0x2a6b4b(0x30d)](_0x4219f6['JOB_PRIORITY_KEY'],_0x10f3f6);if(0x0===_0x1d6308['length'])return;this['logger']['log'](_0x2a6b4b(0x3b9)+_0x144371[_0x2a6b4b(0x20f)]+_0x2a6b4b(0x4c4)+_0x1d6308['length']+'\x20jobs\x20('+(_0x1d6308||[])['length']+_0x2a6b4b(0x244));for(let _0x121ab8=0x0;_0x121ab8<_0x1d6308[_0x2a6b4b(0x20f)];_0x121ab8++){const _0x4b7b90=_0x1d6308[_0x121ab8]['jobId'],_0x594499=await this[_0x2a6b4b(0x41e)]['getJob'](_0x4b7b90),_0x5de6e2=_0x144371[_0x121ab8];if(this[_0x2a6b4b(0x372)]['has'](_0x594499['id']))continue;const _0x42d8d6='withdraw:'+_0x594499[_0x2a6b4b(0x246)][_0x2a6b4b(0x4dc)]+':'+_0x5de6e2[_0x2a6b4b(0x29b)];await this['deviceLockService']['acquireLock'](_0x5de6e2[_0x2a6b4b(0x29b)],'transfer',_0x42d8d6,0x35e80)?this['processJob'](_0x594499,_0x5de6e2)['catch'](_0x4a9adc=>{const _0x58611f=_0x2a6b4b;this[_0x58611f(0x206)][_0x58611f(0x20b)]('Error\x20processing\x20job\x20'+_0x594499['id']+':\x20'+_0x4a9adc['message'],_0x4a9adc['stack']);})['finally'](()=>{this['deviceLockService']['releaseLock'](_0x5de6e2['deviceId'])['catch'](()=>{});}):this['logger']['warn']('Device\x20'+_0x5de6e2['deviceId']+_0x2a6b4b(0x1ea)+_0x594499['id']);}}catch(_0x40c041){this[_0x2a6b4b(0x206)]['error'](_0x2a6b4b(0x415)+_0x40c041['message'],_0x40c041['stack']);}}async['processJob'](_0x177113,_0x4b0f03){const _0xea063e=_0x4bab78;let _0x20a192;try{_0x20a192=(0x0,_0x1e8f3c[_0xea063e(0x3fb)])(_0x177113['data']),await _0x177113[_0xea063e(0x364)]();const _0x5569c3=await(0x0,_0x12fb53['validateObjectResult'])(_0x7b52dd['Withdrawal'],_0x20a192);if(!_0x5569c3['ok'])throw new _0x55f85b['WithdrawalProcessingError']('Invalid\x20withdrawal:\x20missing\x20'+_0x5569c3[_0xea063e(0x2cc)][_0xea063e(0x4d4)](_0x4cfa7f=>_0x4cfa7f['property'])['join'](',\x20'),_0x55f85b[_0xea063e(0x359)]['PERMANENT']);this['telegramService']['sendMessage']({'text':_0xea063e(0x293)+_0x20a192['withdrawalId']+'...</b>\x0a\x0a<b>Withdrawal\x20Code:</b>\x20'+_0x20a192[_0xea063e(0x44b)]+'\x0a<b>From:</b>\x20'+_0x4b0f03['bankCode']+'\x20-\x20'+_0x4b0f03[_0xea063e(0x2e2)]+_0xea063e(0x367)+_0x20a192[_0xea063e(0x43e)]+_0xea063e(0x3f2)+_0x20a192['beneficiaryName']+'\x0a<b>Amount:</b>\x20'+_0x20a192['amount']+'\x0a<b>Description:</b>\x20'+_0x20a192[_0xea063e(0x263)],'options':{'parseMode':'HTML'}})[_0xea063e(0x499)](_0x492d85=>{const _0x37fccc=_0xea063e;this[_0x37fccc(0x206)]['error'](_0x37fccc(0x287)+_0x20a192['withdrawalId']+':\x20'+_0x492d85['message'],_0x492d85['stack']);});const {_id:_0x3b8105,withdrawalId:_0x478384}=_0x20a192;this['logger']['log']('Successfully\x20picked\x20and\x20removed\x20withdrawal\x20'+_0x478384+'\x20from\x20queue'),this['processingJobs']['add'](_0x177113['id']);const _0x2eaa07=await this['withdrawalService']['getWithdrawalDetails'](_0x3b8105);if(![_0xe87cde['WithdrawalStatus']['PENDING'],_0xe87cde[_0xea063e(0x39b)][_0xea063e(0x302)]][_0xea063e(0x424)](_0x2eaa07[_0xea063e(0x2be)]))throw this['logger']['warn'](_0xea063e(0x237)+_0x478384+'\x20('+_0x2eaa07['status']+_0xea063e(0x4a8)),new _0x55f85b['WithdrawalProcessingError'](_0xea063e(0x43f)+_0x2eaa07['status']+')',_0x55f85b['ErrorType'][_0xea063e(0x1e2)]);this['notificationService']['updateWithdrawalStatus'](_0x3b8105,_0xe87cde[_0xea063e(0x39b)][_0xea063e(0x236)])['catch'](_0x33cd75=>{const _0x19e587=_0xea063e;this[_0x19e587(0x206)][_0x19e587(0x20b)](_0x19e587(0x3bc)+_0x478384+':\x20'+_0x33cd75['message'],_0x33cd75[_0x19e587(0x4c5)]);}),await this['bankService'][_0xea063e(0x213)](_0x4b0f03['bankCode'],_0x4b0f03['deviceId'],_0x20a192),await this['bankService'][_0xea063e(0x3c5)](_0x4b0f03[_0xea063e(0x3d8)],_0x20a192[_0xea063e(0x44b)]),await this[_0xea063e(0x457)][_0xea063e(0x2dd)](_0x20a192,_0x4b0f03['deviceId']);}catch(_0x39b969){let _0xab3e09;_0x39b969 instanceof _0x55f85b[_0xea063e(0x2d7)]&&(_0xab3e09=_0x39b969['errorType'],this[_0xea063e(0x206)]['error']('Error\x20processing\x20'+_0x20a192['withdrawalId']+':\x20'+_0xab3e09+'-'+_0x39b969[_0xea063e(0x4ad)],_0x39b969['stack']),await this['handleJobFailure'](_0x4b0f03,_0x20a192,_0x39b969['message'],_0xab3e09));}finally{this['processingJobs'][_0xea063e(0x28d)](_0x177113['id']);}}async[_0x4bab78(0x45b)](_0x2a9f04,_0x196a3b,_0x44d885,_0x1bf23e=_0x55f85b['ErrorType'][_0x4bab78(0x1e2)]){const _0x533d04=_0x4bab78,_0x80a0c3=_0x196a3b['manualRetryCount']??0x1;switch(_0x1bf23e){case _0x55f85b['ErrorType'][_0x533d04(0x1e2)]:return void this['notificationService'][_0x533d04(0x1f7)](_0x196a3b[_0x533d04(0x404)],_0xe87cde[_0x533d04(0x39b)]['FAILED'])['catch'](_0x55cda3=>{const _0x2c19ab=_0x533d04;this['logger']['error']('Error\x20updating\x20withdrawal\x20status\x20for\x20'+_0x196a3b['withdrawalId']+':\x20'+_0x55cda3[_0x2c19ab(0x4ad)],_0x55cda3[_0x2c19ab(0x4c5)]);});case _0x55f85b['ErrorType']['NO_BILL_AFTER_OTP']:await this['bankService']['captureScreen'](_0x2a9f04[_0x533d04(0x3d8)],_0x2a9f04['deviceId'],_0x196a3b[_0x533d04(0x44b)]);const _0x2e28ec=await this['bankService']['getBillImagePath'](_0x2a9f04['bankCode'],_0x196a3b[_0x533d04(0x44b)]);return _0x2e28ec&&(this[_0x533d04(0x206)]['log']('Uploading\x20receipt\x20for\x20withdrawal\x20'+_0x196a3b['withdrawalCode']+'\x20-\x20'+_0x2e28ec),await this['notificationService']['uploadReceipt'](_0x196a3b['_id'],_0x2e28ec)),await this[_0x533d04(0x2e6)]['updateWithdrawalStatus'](_0x196a3b['_id'],_0xe87cde['WithdrawalStatus'][_0x533d04(0x24f)]),void await this['bankService']['login'](_0x2a9f04['bankCode'],_0x2a9f04['deviceId'],!0x0);case _0x55f85b['ErrorType']['FORCE_LOGIN']:await this['bankService']['login'](_0x2a9f04['bankCode'],_0x2a9f04['deviceId'],!0x0);default:this['logger']['warn']('Added\x20'+_0x196a3b['withdrawalId']+'\x20to\x20queue\x20for\x20retrying.\x20('+_0x80a0c3+'/2)Reason:\x20'+_0x44d885+'.\x20Error\x20Type:\x20'+_0x1bf23e+'.'),_0x80a0c3<0x2?(await this[_0x533d04(0x41e)]['add']('process-withdrawal-request',{..._0x196a3b,'manualRetryCount':_0x80a0c3+0x1,'lastErrorType':_0x1bf23e,'lastErrorReason':_0x44d885},{'attempts':0x0,'removeOnComplete':!0x1,'removeOnFail':!0x1,'jobId':'withdrawal-request-'+_0x196a3b['withdrawalId'],'priority':0x1,'delay':0x7530}),this['notificationService']['updateWithdrawalStatus'](_0x196a3b[_0x533d04(0x404)],_0xe87cde[_0x533d04(0x39b)]['RETRY'])['catch'](_0x57f363=>{const _0x442fea=_0x533d04;this['logger'][_0x442fea(0x20b)]('Error\x20updating\x20withdrawal\x20status\x20for\x20'+_0x196a3b[_0x442fea(0x4dc)]+':\x20'+_0x57f363['message'],_0x57f363['stack']);})):(this[_0x533d04(0x206)][_0x533d04(0x38c)]('Max\x20retries\x20(2)\x20exceeded\x20for\x20withdrawal\x20'+_0x196a3b['withdrawalId']+':\x20'+_0x1bf23e+_0x533d04(0x3f9)+_0x44d885),this[_0x533d04(0x2e6)]['updateWithdrawalStatus'](_0x196a3b[_0x533d04(0x404)],_0xe87cde[_0x533d04(0x39b)]['FAILED'])['catch'](_0x5b3f79=>{const _0x1cd58d=_0x533d04;this[_0x1cd58d(0x206)]['error'](_0x1cd58d(0x3bc)+_0x196a3b['withdrawalId']+':\x20'+_0x5b3f79['message'],_0x5b3f79['stack']);}));}}async[_0x4bab78(0x41f)](){const _0x5c0f22=_0x4bab78;return(0x0,_0x12cd02['withCronLock'])(_0x5c0f22(0x3c0),0x1388,async()=>{const _0x30a0b6=_0x5c0f22,_0x2794f5=Date[_0x30a0b6(0x34e)](),_0x4cd62c=await this[_0x30a0b6(0x41e)]['getJobs'](['delayed'],0x0,0x63);if(!_0x4cd62c['length'])return;let _0x3261b3=0x0;for(const _0xcabbd of _0x4cd62c){const _0x1dcd1a='number'==typeof _0xcabbd['opts']?.['delay']?_0xcabbd['opts']['delay']:0x0;if((_0x30a0b6(0x2bd)==typeof _0xcabbd['timestamp']?_0xcabbd['timestamp']:0x0)+_0x1dcd1a<=_0x2794f5)try{await _0xcabbd['promote'](),_0x3261b3++;}catch(_0xa8b4ce){this['logger'][_0x30a0b6(0x200)]('Promote\x20skipped\x20for\x20job\x20'+_0xcabbd['id']+':\x20'+String(_0xa8b4ce));}}_0x3261b3>0x0&&this['logger']['log']('Promoted\x20'+_0x3261b3+'\x20delayed\x20jobs\x20to\x20waiting');});}async[_0x4bab78(0x477)](_0x435e39=0x1){const _0x318bce=_0x4bab78;await this[_0x318bce(0x303)](_0x435e39);}async[_0x4bab78(0x2cb)](){const _0x793ac9=_0x4bab78,[_0x224ea5,_0x4620c3,_0x4dcdb7,_0x44c39c,_0x538469,_0x5a5681,_0x2e04aa]=await Promise['all']([this['withdrawalQueue'][_0x793ac9(0x2d5)](),this[_0x793ac9(0x41e)][_0x793ac9(0x402)](),this['withdrawalQueue'][_0x793ac9(0x382)](),this['withdrawalQueue']['getCompletedCount'](),this[_0x793ac9(0x41e)]['getFailedCount'](),this['deviceService']['getAvailableDevices'](),this[_0x793ac9(0x42e)][_0x793ac9(0x2ec)]()]);return{'serviceStatus':_0x2e04aa,'activeDevices':_0x5a5681[_0x793ac9(0x20f)],'processingJobs':this[_0x793ac9(0x372)][_0x793ac9(0x336)],'isInitialized':this['isInitialized'],'queue':{'waiting':_0x224ea5,'delayed':_0x4620c3,'active':_0x4dcdb7,'completed':_0x44c39c,'failed':_0x538469,'total':_0x224ea5+_0x4620c3+_0x4dcdb7}};}async['debugQueue'](){const _0xfd08a3=_0x4bab78,_0x4a3950=await this['getQueueStats'](),[_0x2a0d90,_0x58035f]=await Promise['all']([this['withdrawalQueue']['getJobs'](['waiting'],0x0,0x9),this['withdrawalQueue']['getJobs']([_0xfd08a3(0x260)],0x0,0x9)]);return{..._0x4a3950,'sampleWaitingJobs':_0x2a0d90['map'](_0xa6dab6=>({'id':_0xa6dab6['id'],'data':_0xa6dab6['data'],'opts':_0xa6dab6[_0xfd08a3(0x203)],'manualRetryCount':_0xa6dab6[_0xfd08a3(0x246)]['manualRetryCount']})),'sampleDelayedJobs':_0x58035f['map'](_0x3626e3=>({'id':_0x3626e3['id'],'data':_0x3626e3['data'],'opts':_0x3626e3[_0xfd08a3(0x203)],'manualRetryCount':_0x3626e3['data']['manualRetryCount']}))};}async['periodicJobPicking'](){const _0x235574=_0x4bab78;await this['redisLockService']['isLocked'](_0x549c53[_0x235574(0x4b4)])?this['logger']['warn'](_0x235574(0x27c)):await this['pickAndProcessJobs']();}async['promoteDelayedJobsPeriodically'](){const _0x2e7a45=_0x4bab78;await this[_0x2e7a45(0x41f)]();}async[_0x4bab78(0x472)](){const _0x2ec685=_0x4bab78,_0x51abca=await this[_0x2ec685(0x42e)]['getServiceStatus']();this['cronRestartBoxphoneEnabled']&&_0x2ec685(0x4db)===_0x51abca&&await this[_0x2ec685(0x496)]['acquireLock'](_0x549c53['SYSTEM_LOCK_BOXPHONE'],0x2bf20);}};_0x1e8f6a['WithdrawalJobManagerService']=_0x58bbd6,_0x4f1852([(0x0,_0xa2a3e1['Cron'])(_0xa2a3e1[_0x4bab78(0x3e8)][_0x4bab78(0x3c8)]),_0x2de580('design:type',Function),_0x2de580(_0x4bab78(0x2d9),[]),_0x2de580(_0x4bab78(0x432),Promise)],_0x58bbd6['prototype'],'periodicJobPicking',null),_0x4f1852([(0x0,_0xa2a3e1['Cron'])(_0xa2a3e1['CronExpression']['EVERY_5_SECONDS']),_0x2de580('design:type',Function),_0x2de580('design:paramtypes',[]),_0x2de580('design:returntype',Promise)],_0x58bbd6['prototype'],'promoteDelayedJobsPeriodically',null),_0x4f1852([(0x0,_0xa2a3e1[_0x4bab78(0x337)])('0\x20*/59\x20*\x20*\x20*\x20*'),_0x2de580('design:type',Function),_0x2de580(_0x4bab78(0x2d9),[]),_0x2de580(_0x4bab78(0x432),Promise)],_0x58bbd6['prototype'],'restartPandaBoxPeriodically',null),_0x1e8f6a[_0x4bab78(0x2c7)]=_0x58bbd6=_0x4f1852([(0x0,_0x5936a0['Injectable'])(),_0x3670fe(0x0,(0x0,_0x5d5e19['InjectQueue'])('wda-request')),_0x3670fe(0x4,(0x0,_0x5936a0[_0x4bab78(0x458)])(_0x2c27e5['WEBSOCKET_SERVICE'])),_0x2de580(_0x4bab78(0x2d9),['function'==typeof(_0x65d69d=void 0x0!==_0x39b418['Queue']&&_0x39b418['Queue'])?_0x65d69d:Object,'function'==typeof(_0x11d14e=void 0x0!==_0x465218['WithdrawalService']&&_0x465218[_0x4bab78(0x2e9)])?_0x11d14e:Object,'function'==typeof(_0x1e58f5=void 0x0!==_0x69a7fe[_0x4bab78(0x2a3)]&&_0x69a7fe['DeviceService'])?_0x1e58f5:Object,'function'==typeof(_0x342a61=void 0x0!==_0x238b80['DeviceLockService']&&_0x238b80['DeviceLockService'])?_0x342a61:Object,_0x4bab78(0x42d)==typeof(_0x15b6ba=void 0x0!==_0x219b5f[_0x4bab78(0x1df)]&&_0x219b5f['IWebSocketService'])?_0x15b6ba:Object,'function'==typeof(_0x22bbab=void 0x0!==_0x54f12e['BankService']&&_0x54f12e['BankService'])?_0x22bbab:Object,'function'==typeof(_0x45c826=void 0x0!==_0x3acc7c['NotificationService']&&_0x3acc7c['NotificationService'])?_0x45c826:Object,'function'==typeof(_0x31b24a=void 0x0!==_0x492100['WindowsAppGitBashService']&&_0x492100['WindowsAppGitBashService'])?_0x31b24a:Object,'function'==typeof(_0xb63fd4=void 0x0!==_0x4573b0['RedisLockService']&&_0x4573b0['RedisLockService'])?_0xb63fd4:Object,'function'==typeof(_0x28f32a=void 0x0!==_0x5af168['TelegramService']&&_0x5af168[_0x4bab78(0x253)])?_0x28f32a:Object,'function'==typeof(_0x51267a=void 0x0!==_0x40c467['RedisService']&&_0x40c467['RedisService'])?_0x51267a:Object])],_0x58bbd6);},_0x23cd96=>{_0x23cd96['exports']=require('bull');},function(_0x5b206b,_0x416562,_0x1e742a){const _0x4d48e8=a0_0x4abd;var _0x25e4e6,_0x1b1a1c=this&&this[_0x4d48e8(0x290)]||function(_0x21587d,_0x22c46c,_0x25a736,_0x1a2283){const _0x1f038b=_0x4d48e8;var _0x120ef5,_0x453c07=arguments['length'],_0x28af85=_0x453c07<0x3?_0x22c46c:null===_0x1a2283?_0x1a2283=Object['getOwnPropertyDescriptor'](_0x22c46c,_0x25a736):_0x1a2283;if(_0x1f038b(0x2f0)==typeof Reflect&&_0x1f038b(0x42d)==typeof Reflect['decorate'])_0x28af85=Reflect['decorate'](_0x21587d,_0x22c46c,_0x25a736,_0x1a2283);else{for(var _0x53f5b8=_0x21587d[_0x1f038b(0x20f)]-0x1;_0x53f5b8>=0x0;_0x53f5b8--)(_0x120ef5=_0x21587d[_0x53f5b8])&&(_0x28af85=(_0x453c07<0x3?_0x120ef5(_0x28af85):_0x453c07>0x3?_0x120ef5(_0x22c46c,_0x25a736,_0x28af85):_0x120ef5(_0x22c46c,_0x25a736))||_0x28af85);}return _0x453c07>0x3&&_0x28af85&&Object['defineProperty'](_0x22c46c,_0x25a736,_0x28af85),_0x28af85;},_0x3341dd=this&&this['__metadata']||function(_0x445af2,_0x164d53){if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0x445af2,_0x164d53);};Object['defineProperty'](_0x416562,'__esModule',{'value':!0x0}),_0x416562[_0x4d48e8(0x20e)]=void 0x0;const _0x1ff3b8=_0x1e742a(0x2a),_0x5941f8=_0x1e742a(0x3b);class _0x39a04f{}_0x416562['Withdrawal']=_0x39a04f,_0x1b1a1c([(0x0,_0x5941f8['IsNotEmpty'])(),_0x3341dd('design:type',String)],_0x39a04f['prototype'],'_id',void 0x0),_0x1b1a1c([(0x0,_0x5941f8[_0x4d48e8(0x24c)])(),_0x3341dd(_0x4d48e8(0x3c2),String)],_0x39a04f['prototype'],'withdrawalId',void 0x0),_0x1b1a1c([(0x0,_0x5941f8['IsNotEmpty'])(),_0x3341dd(_0x4d48e8(0x3c2),String)],_0x39a04f['prototype'],'withdrawalCode',void 0x0),_0x1b1a1c([(0x0,_0x5941f8['IsNotEmpty'])(),_0x3341dd(_0x4d48e8(0x3c2),String)],_0x39a04f['prototype'],'bankCode',void 0x0),_0x1b1a1c([(0x0,_0x5941f8[_0x4d48e8(0x24c)])(),_0x3341dd('design:type',String)],_0x39a04f['prototype'],'beneficiaryAccountNo',void 0x0),_0x1b1a1c([(0x0,_0x5941f8['IsNotEmpty'])(),_0x3341dd('design:type',String)],_0x39a04f[_0x4d48e8(0x2f9)],'beneficiaryName',void 0x0),_0x1b1a1c([(0x0,_0x5941f8['IsNotEmpty'])(),_0x3341dd('design:type',Number)],_0x39a04f['prototype'],'amount',void 0x0),_0x1b1a1c([(0x0,_0x5941f8['IsNotEmpty'])(),_0x3341dd('design:type',String)],_0x39a04f['prototype'],_0x4d48e8(0x4b7),void 0x0),_0x1b1a1c([(0x0,_0x5941f8['IsNotEmpty'])(),_0x3341dd(_0x4d48e8(0x3c2),String)],_0x39a04f['prototype'],_0x4d48e8(0x2be),void 0x0),_0x1b1a1c([(0x0,_0x5941f8[_0x4d48e8(0x24c)])(),_0x3341dd('design:type',String)],_0x39a04f['prototype'],'description',void 0x0),_0x1b1a1c([(0x0,_0x5941f8['IsNotEmpty'])(),_0x3341dd('design:type',String)],_0x39a04f['prototype'],_0x4d48e8(0x481),void 0x0),_0x1b1a1c([(0x0,_0x5941f8[_0x4d48e8(0x2af)])(),_0x3341dd(_0x4d48e8(0x3c2),Number)],_0x39a04f['prototype'],_0x4d48e8(0x304),void 0x0),_0x1b1a1c([(0x0,_0x5941f8['IsOptional'])(),_0x3341dd('design:type','function'==typeof(_0x25e4e6=void 0x0!==_0x1ff3b8['ErrorType']&&_0x1ff3b8['ErrorType'])?_0x25e4e6:Object)],_0x39a04f['prototype'],_0x4d48e8(0x23b),void 0x0),_0x1b1a1c([(0x0,_0x5941f8['IsOptional'])(),_0x3341dd(_0x4d48e8(0x3c2),String)],_0x39a04f['prototype'],'lastErrorReason',void 0x0);},_0xf6cebf=>{_0xf6cebf['exports']=require('class-validator');},(_0x24b6d2,_0xf2f42e,_0x1d7115)=>{const _0x7ba9c1=a0_0x4abd;Object['defineProperty'](_0xf2f42e,'__esModule',{'value':!0x0}),_0xf2f42e['withCronLock']=void 0x0;const _0x4e0af0=_0x1d7115(0x10),_0x223134=_0x1d7115(0x11),_0x44b2eb=new _0x4e0af0['default']({'host':_0x223134['config']['redis'][_0x7ba9c1(0x2d1)],'port':_0x223134['config']['redis'][_0x7ba9c1(0x22c)],'password':_0x223134[_0x7ba9c1(0x36b)][_0x7ba9c1(0x314)]['password'],'db':_0x223134['config']['redis']['db']});_0xf2f42e['withCronLock']=async(_0x4aa8a7,_0x178741,_0x27fefd)=>{const _0x1814df=process['pid']+':'+Date['now']();if(await _0x44b2eb['set'](_0x4aa8a7,_0x1814df,'PX',_0x178741,'NX'))try{await _0x27fefd();}finally{const _0x23d58e='\x0a\x20\x20\x20\x20\x20\x20if\x20redis.call(\x22GET\x22,\x20KEYS[1])\x20==\x20ARGV[1]\x20then\x0a\x20\x20\x20\x20\x20\x20\x20\x20return\x20redis.call(\x22DEL\x22,\x20KEYS[1])\x0a\x20\x20\x20\x20\x20\x20end\x0a\x20\x20\x20\x20\x20\x20return\x200\x0a\x20\x20\x20\x20';await _0x44b2eb['eval'](_0x23d58e,0x1,_0x4aa8a7,_0x1814df);}};},(_0x1e6c6e,_0x1ad759)=>{const _0x2b8677=a0_0x4abd;var _0x2d0010;Object[_0x2b8677(0x38d)](_0x1ad759,'__esModule',{'value':!0x0}),_0x1ad759['WithdrawalStatus']=void 0x0,function(_0x57d335){const _0x1003e2=_0x2b8677;_0x57d335['PENDING']=_0x1003e2(0x1c7),_0x57d335[_0x1003e2(0x240)]='FAILED',_0x57d335['PROCESSING']='PROCESSING',_0x57d335[_0x1003e2(0x302)]='RETRY',_0x57d335['COMPLETED']='COMPLETED',_0x57d335['UNKNOWN']='UNKNOWN',_0x57d335['NA']='NA';}(_0x2d0010||(_0x1ad759['WithdrawalStatus']=_0x2d0010={}));},function(_0x5cc50d,_0x4494b4,_0x47ea0a){const _0x2889ad=a0_0x4abd;var _0x4709a7,_0x3cfe95=this&&this['__decorate']||function(_0x1e5371,_0x3c29aa,_0x326917,_0x284d0c){const _0xc765ae=a0_0x4abd;var _0x5e14f9,_0x30d1dc=arguments['length'],_0x26c6ce=_0x30d1dc<0x3?_0x3c29aa:null===_0x284d0c?_0x284d0c=Object[_0xc765ae(0x4a5)](_0x3c29aa,_0x326917):_0x284d0c;if(_0xc765ae(0x2f0)==typeof Reflect&&_0xc765ae(0x42d)==typeof Reflect[_0xc765ae(0x40a)])_0x26c6ce=Reflect['decorate'](_0x1e5371,_0x3c29aa,_0x326917,_0x284d0c);else{for(var _0x328c13=_0x1e5371['length']-0x1;_0x328c13>=0x0;_0x328c13--)(_0x5e14f9=_0x1e5371[_0x328c13])&&(_0x26c6ce=(_0x30d1dc<0x3?_0x5e14f9(_0x26c6ce):_0x30d1dc>0x3?_0x5e14f9(_0x3c29aa,_0x326917,_0x26c6ce):_0x5e14f9(_0x3c29aa,_0x326917))||_0x26c6ce);}return _0x30d1dc>0x3&&_0x26c6ce&&Object['defineProperty'](_0x3c29aa,_0x326917,_0x26c6ce),_0x26c6ce;};Object['defineProperty'](_0x4494b4,'__esModule',{'value':!0x0}),_0x4494b4['WindowsAppGitBashService']=void 0x0;const _0x15b36f=_0x47ea0a(0x2),_0xe0b0b=_0x47ea0a(0x3f),_0xd0e391=_0x47ea0a(0x40),_0x589389=_0x47ea0a(0x18),_0x24515e=(0x0,_0xd0e391['promisify'])(_0xe0b0b['exec']);let _0xac8c8d=_0x4709a7=class{constructor(){const _0x26a3e1=a0_0x4abd;this[_0x26a3e1(0x206)]=new _0x15b36f['Logger'](_0x4709a7['name']);}async[_0x2889ad(0x1d5)](_0x51a6f6){const _0x548df1=_0x2889ad,{processName:_0x2cb3e3,exePath:_0x41fb7a,startTarget:_0x54c1a6,gracefulWaitMs:_0x5d2f1e=0x4b0,forceKillWaitMs:_0x7fc5f0=0x1f4,startDelayMs:_0xa3acf2=0x12c,runAsAdmin:_0x21d237=!0x1,killAsAdmin:_0x3a3a67=!0x1}=_0x51a6f6;try{if(await this['closeMainWindow'](_0x2cb3e3)[_0x548df1(0x499)](()=>{}),await(0x0,_0x589389['sleep'])(_0x5d2f1e),await this['forceKill'](_0x2cb3e3,_0x3a3a67)['catch'](()=>{}),await(0x0,_0x589389['sleep'])(_0x7fc5f0),await this[_0x548df1(0x30a)](_0x2cb3e3,0x1388)[_0x548df1(0x499)](()=>{}),await(0x0,_0x589389['sleep'])(_0xa3acf2),_0x41fb7a)return void await this[_0x548df1(0x4bd)]({'exePath':_0x41fb7a,'runAsAdmin':_0x21d237});if(_0x54c1a6)return void await this['startApp']({'startTarget':_0x54c1a6,'runAsAdmin':_0x21d237});const _0x321aa9=_0x2cb3e3['replace'](/\.exe$/i,'');await this['startApp']({'startTarget':_0x321aa9,'runAsAdmin':_0x21d237});}catch(_0x5ae2fb){const _0x301854=_0x5ae2fb?.['message']||String(_0x5ae2fb);throw this['logger'][_0x548df1(0x20b)]('[restart]\x20Failed\x20to\x20restart\x20app:\x20'+_0x301854,_0x5ae2fb?.['stack']),_0x5ae2fb;}}async['closeMainWindow'](_0x12f8c8){const _0x326b04=_0x2889ad,_0x2ded64=_0x12f8c8['replace'](/\.exe$/i,''),_0x3daa48='Get-Process\x20-Name\x20\x22'+this['escapePs'](_0x2ded64)+'\x22\x20-ErrorAction\x20SilentlyContinue\x20|\x20ForEach-Object\x20{\x20$_.CloseMainWindow()\x20|\x20Out-Null\x20}',_0x567714='powershell\x20-NoProfile\x20-ExecutionPolicy\x20Bypass\x20-Command\x20\x22'+this['escapePs'](_0x3daa48)+'\x22';try{await _0x24515e(_0x567714,{'windowsHide':!0x0});}catch(_0x328adb){if(!(_0x328adb?.['message']||String(_0x328adb)||'')[_0x326b04(0x424)]('Cannot\x20find\x20a\x20process'))throw _0x328adb;}}async['forceKill'](_0x5874af,_0x29f4d3=!0x1){const _0x5b836e=_0x2889ad,_0x2ca47b=_0x5874af['replace'](/\.exe$/i,'');try{return void await this[_0x5b836e(0x409)](_0x2ca47b,_0x29f4d3);}catch(_0x20ad98){const _0x347fbd=(_0x20ad98?.[_0x5b836e(0x4ad)]||_0x20ad98?.[_0x5b836e(0x296)]||String(_0x20ad98)||'')['toLowerCase']();if(_0x347fbd[_0x5b836e(0x424)]('cannot\x20find\x20a\x20process')||_0x347fbd[_0x5b836e(0x424)](_0x5b836e(0x433))||_0x347fbd['includes']('cannot\x20find\x20process'))return void this['logger']['debug']('Process\x20not\x20found\x20(expected):\x20'+_0x5874af);if((_0x347fbd[_0x5b836e(0x424)](_0x5b836e(0x2b5))||_0x347fbd['includes']('access\x20denied'))&&!_0x29f4d3){this[_0x5b836e(0x206)]['warn'](_0x5b836e(0x28f)+_0x5874af);try{return void await this['forceKillWithPowerShell'](_0x2ca47b,!0x0);}catch(_0xec88f4){const _0x4c56bd=(_0xec88f4?.[_0x5b836e(0x4ad)]||_0xec88f4?.['stderr']||String(_0xec88f4)||'')['toLowerCase']();if(_0x4c56bd[_0x5b836e(0x424)](_0x5b836e(0x4ca))||_0x4c56bd['includes'](_0x5b836e(0x433)))return;this['logger'][_0x5b836e(0x200)]('PowerShell\x20kill\x20with\x20admin\x20failed,\x20trying\x20taskkill:\x20'+_0x5874af);}}try{let _0x28d06e;if(_0x29f4d3||_0x347fbd[_0x5b836e(0x424)](_0x5b836e(0x320))||_0x347fbd['includes']('access\x20is\x20denied'))_0x28d06e='powershell\x20-NoProfile\x20-ExecutionPolicy\x20Bypass\x20-Command\x20\x22'+(_0x5b836e(0x291)+_0x5874af['replace'](/"/g,'`\x22')+'\x27,\x27/T\x27\x20-Verb\x20RunAs\x20-Wait\x20-WindowStyle\x20Hidden')['replace'](/"/g,'`\x22')[_0x5b836e(0x3c3)](/\$/g,'`$')+'\x22';else _0x28d06e='taskkill\x20/F\x20/IM\x20\x22'+_0x5874af+'\x22\x20/T';await _0x24515e(_0x28d06e,{'windowsHide':!0x0});}catch(_0x5ae80c){const _0xcf4682=(_0x5ae80c?.[_0x5b836e(0x4ad)]||_0x5ae80c?.['stderr']||String(_0x5ae80c)||'')[_0x5b836e(0x1f1)]();if(_0xcf4682['includes']('not\x20found')||_0xcf4682[_0x5b836e(0x424)]('no\x20tasks\x20are\x20running')||_0xcf4682[_0x5b836e(0x424)]('the\x20system\x20cannot\x20find'))return void this['logger']['debug'](_0x5b836e(0x1ec)+_0x5874af);if(_0xcf4682[_0x5b836e(0x424)](_0x5b836e(0x2b5))||_0xcf4682['includes']('access\x20denied'))return void this['logger'][_0x5b836e(0x38c)]('Cannot\x20kill\x20process\x20(access\x20denied):\x20'+_0x5874af+'.\x20Process\x20may\x20require\x20administrator\x20privileges\x20to\x20terminate.');this['logger'][_0x5b836e(0x38c)]('Kill\x20process\x20warning:\x20'+_0xcf4682);}}}async['forceKillWithPowerShell'](_0x316455,_0x4b4b5b=!0x1){const _0x19ee5b=_0x2889ad,_0x4d4277=_0x19ee5b(0x2dc)+_0x316455['replace'](/'/g,'\x27\x27')+'\x27\x20-ErrorAction\x20SilentlyContinue\x20|\x20Stop-Process\x20-Force\x20-ErrorAction\x20Stop';let _0x284d54;_0x284d54=_0x4b4b5b?'powershell\x20-NoProfile\x20-ExecutionPolicy\x20Bypass\x20-Command\x20\x22'+(_0x19ee5b(0x428)+_0x4d4277['replace'](/'/g,'\x27\x27')['replace'](/"/g,'`\x22')+'\x22\x20-Verb\x20RunAs\x20-Wait\x20-WindowStyle\x20Hidden')[_0x19ee5b(0x3c3)](/"/g,'`\x22')['replace'](/\$/g,'`$')+'\x22':_0x19ee5b(0x3f5)+_0x4d4277['replace'](/"/g,'`\x22')['replace'](/\$/g,'`$')+'\x22';try{await _0x24515e(_0x284d54,{'windowsHide':!0x0});}catch(_0x23b7bd){const _0x5119d3=(_0x23b7bd?.['message']||_0x23b7bd?.['stderr']||String(_0x23b7bd)||'')['toLowerCase']();if(_0x5119d3[_0x19ee5b(0x424)]('cannot\x20find\x20a\x20process')||_0x5119d3['includes']('process\x20not\x20found')||_0x5119d3[_0x19ee5b(0x424)]('cannot\x20find\x20process'))return void this['logger']['debug']('Process\x20not\x20found\x20(expected):\x20'+_0x316455);throw _0x23b7bd;}}async['isRunning'](_0x2a0b40){const _0xd1e25=_0x2889ad;try{const _0xa35777=_0xd1e25(0x1fa)+_0x2a0b40+_0xd1e25(0x437),{stdout:_0x4e6ef1}=await _0x24515e(_0xa35777,{'windowsHide':!0x0}),_0x5496bd=_0x4e6ef1['toLowerCase']()['trim']();return!(!_0x5496bd||_0x5496bd[_0xd1e25(0x424)]('no\x20tasks')||_0xd1e25(0x344)===_0x5496bd)&&_0x5496bd['includes'](_0x2a0b40['toLowerCase']());}catch(_0x3e058f){return!0x1;}}async['waitUntilNotRunning'](_0x334a7d,_0x2d71ad){const _0x430417=_0x2889ad,_0x225b7c=Date['now']();for(;Date['now']()-_0x225b7c<_0x2d71ad;){if(!await this[_0x430417(0x4e2)](_0x334a7d))return;await(0x0,_0x589389['sleep'])(0xfa);}this[_0x430417(0x206)]['warn']('Process\x20still\x20running\x20after\x20'+_0x2d71ad+'ms:\x20'+_0x334a7d);}async['startApp'](_0x7a9507){const _0x394576=_0x2889ad,_0x333b28=_0x7a9507['exePath']??_0x7a9507[_0x394576(0x44e)]??'',_0x325da5=_0x7a9507[_0x394576(0x3bb)]??!0x1;if(!_0x333b28)throw new Error('Start\x20target\x20is\x20empty');try{if(_0x325da5){const _0x126642='powershell\x20-NoProfile\x20-ExecutionPolicy\x20Bypass\x20-Command\x20\x22'+('Start-Process\x20-FilePath\x20\x27'+_0x333b28[_0x394576(0x3c3)](/'/g,'\x27\x27')+'\x27\x20-Verb\x20RunAs')[_0x394576(0x3c3)](/"/g,'`\x22')[_0x394576(0x3c3)](/\$/g,'`$')+'\x22';await _0x24515e(_0x126642),this[_0x394576(0x206)]['log']('App\x20started\x20with\x20Administrator\x20privileges:\x20'+_0x333b28);}else{const _0x4e1b0f='start\x20\x22\x22\x20\x22'+_0x333b28+'\x22';await _0x24515e(_0x4e1b0f,{'windowsHide':!0x0}),this[_0x394576(0x206)][_0x394576(0x4dd)]('App\x20started\x20successfully:\x20'+_0x333b28);}await(0x0,_0x589389[_0x394576(0x3b8)])(0x1f4);}catch(_0xa0102f){const _0x1e5770=_0xa0102f?.['message']||String(_0xa0102f);throw this[_0x394576(0x206)]['error']('Failed\x20to\x20start\x20app:\x20'+_0x333b28,_0x1e5770),_0xa0102f;}}[_0x2889ad(0x360)](_0x14a37){return _0x14a37['replace'](/"/g,'`\x22')['replace'](/\$/g,'`$');}};_0x4494b4['WindowsAppGitBashService']=_0xac8c8d,_0x4494b4['WindowsAppGitBashService']=_0xac8c8d=_0x4709a7=_0x3cfe95([(0x0,_0x15b36f[_0x2889ad(0x4cd)])()],_0xac8c8d);},_0x41c1fb=>{_0x41c1fb['exports']=require('child_process');},_0x2f0133=>{_0x2f0133['exports']=require('util');},function(_0x4d60be,_0x308c74,_0x484b77){const _0x331d44=a0_0x4abd;var _0x15d2df,_0x48e58c=this&&this['__decorate']||function(_0x111f9,_0x104ef8,_0x35a173,_0x2b17ec){const _0x8f04eb=a0_0x4abd;var _0x4dacc0,_0x587949=arguments['length'],_0x4d5be5=_0x587949<0x3?_0x104ef8:null===_0x2b17ec?_0x2b17ec=Object[_0x8f04eb(0x4a5)](_0x104ef8,_0x35a173):_0x2b17ec;if(_0x8f04eb(0x2f0)==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x4d5be5=Reflect['decorate'](_0x111f9,_0x104ef8,_0x35a173,_0x2b17ec);else{for(var _0x19c65a=_0x111f9[_0x8f04eb(0x20f)]-0x1;_0x19c65a>=0x0;_0x19c65a--)(_0x4dacc0=_0x111f9[_0x19c65a])&&(_0x4d5be5=(_0x587949<0x3?_0x4dacc0(_0x4d5be5):_0x587949>0x3?_0x4dacc0(_0x104ef8,_0x35a173,_0x4d5be5):_0x4dacc0(_0x104ef8,_0x35a173))||_0x4d5be5);}return _0x587949>0x3&&_0x4d5be5&&Object['defineProperty'](_0x104ef8,_0x35a173,_0x4d5be5),_0x4d5be5;},_0x15f8f4=this&&this['__metadata']||function(_0x9b31c3,_0x45ac7f){const _0x28a0f6=a0_0x4abd;if('object'==typeof Reflect&&_0x28a0f6(0x42d)==typeof Reflect[_0x28a0f6(0x47a)])return Reflect[_0x28a0f6(0x47a)](_0x9b31c3,_0x45ac7f);};Object['defineProperty'](_0x308c74,'__esModule',{'value':!0x0}),_0x308c74['RedisLockService']=void 0x0;const _0x4574bb=_0x484b77(0x2),_0x52a289=_0x484b77(0xf),_0x4472dc=_0x484b77(0x15);let _0x5dcca3=class{constructor(_0x1324e6){const _0x170520=a0_0x4abd;this['redisService']=_0x1324e6,this[_0x170520(0x206)]=new _0x4574bb['Logger']('RedisLockService'),this['DEFAULT_LOCK_TTL']=0x2bf20;}async[_0x331d44(0x22f)](_0x548986,_0x4f460e=this[_0x331d44(0x443)]){const _0x369cae=_0x331d44;try{const _0x45bb68=(0x0,_0x4472dc['randomUUID'])(),_0x39319e=Math[_0x369cae(0x42f)](_0x4f460e/0x3e8),_0x19670e=await this['redisService'][_0x369cae(0x28b)]();return'OK'===await _0x19670e[_0x369cae(0x1f8)](_0x548986,_0x45bb68,'EX',_0x39319e,'NX');}catch(_0x329d3a){return!0x1;}}async['releaseLock'](_0x809ec0){const _0x225531=_0x331d44;try{const _0x2f992a=await this[_0x225531(0x43c)]['getClient'](),_0x47264d=await _0x2f992a['get'](_0x809ec0);if(!_0x47264d)return;0x1===await _0x2f992a['eval']('\x0aif\x20redis.call(\x22GET\x22,\x20KEYS[1])\x20==\x20ARGV[1]\x20then\x0a\x20\x20return\x20redis.call(\x22DEL\x22,\x20KEYS[1])\x0aelse\x0a\x20\x20return\x200\x0aend\x0a',0x1,_0x809ec0,_0x47264d)?this['logger']['log']('Released\x20lock\x20(lockId:\x20'+_0x809ec0+':'+_0x47264d+')'):this[_0x225531(0x206)][_0x225531(0x38c)](_0x225531(0x33a)+_0x809ec0+':'+_0x47264d+')');}catch(_0x27ad26){this['logger'][_0x225531(0x20b)]('Error\x20releasing\x20lock:\x20'+_0x809ec0+'\x20'+_0x27ad26[_0x225531(0x4ad)],_0x27ad26['stack']);}}async['getLock'](_0x34217b){const _0x33f986=_0x331d44;try{return await this['redisService']['get'](_0x34217b)??null;}catch(_0x49d2fc){return this[_0x33f986(0x206)]['error']('['+_0x34217b+']\x20Error\x20getting\x20lock:\x20'+_0x49d2fc[_0x33f986(0x4ad)]),null;}}async['isLocked'](_0x35fbe2){const _0x49027f=_0x331d44;try{return!!await this[_0x49027f(0x3b1)](_0x35fbe2);}catch(_0x2655a2){return this['logger']['error']('['+_0x35fbe2+']\x20Error\x20checking\x20lock\x20status:\x20'+_0x2655a2[_0x49027f(0x4ad)]),!0x1;}}};_0x308c74[_0x331d44(0x3f7)]=_0x5dcca3,_0x308c74[_0x331d44(0x3f7)]=_0x5dcca3=_0x48e58c([(0x0,_0x4574bb[_0x331d44(0x4cd)])(),_0x15f8f4('design:paramtypes',[_0x331d44(0x42d)==typeof(_0x15d2df=void 0x0!==_0x52a289[_0x331d44(0x374)]&&_0x52a289[_0x331d44(0x374)])?_0x15d2df:Object])],_0x5dcca3);},(_0x191717,_0x45b9d4)=>{const _0x330fd8=a0_0x4abd;Object['defineProperty'](_0x45b9d4,_0x330fd8(0x318),{'value':!0x0}),_0x45b9d4['SYSTEM_LOCK_PAUSE_PROCESSING']=_0x45b9d4[_0x330fd8(0x27b)]=void 0x0,_0x45b9d4['SYSTEM_LOCK_BOXPHONE']='system:lock:boxphone',_0x45b9d4['SYSTEM_LOCK_PAUSE_PROCESSING']='system:lock:pauseprocessing';},(_0x37b980,_0x46147e,_0x332110)=>{const _0x3532a3=a0_0x4abd;Object['defineProperty'](_0x46147e,'__esModule',{'value':!0x0}),_0x46147e[_0x3532a3(0x2fa)]=void 0x0;const _0x314d38=_0x332110(0x44),_0x124305=_0x332110(0x3b);_0x46147e['validateObjectResult']=async(_0x251361,_0x59db50)=>{const _0xdfe9df=_0x3532a3,_0x2ad700=(0x0,_0x314d38['plainToInstance'])(_0x251361,_0x59db50,{'enableImplicitConversion':!0x0}),_0x10bdad=await(0x0,_0x124305[_0xdfe9df(0x2c5)])(_0x2ad700,{'whitelist':!0x0,'forbidNonWhitelisted':!0x0,'forbidUnknownValues':!0x0,'validationError':{'target':!0x1,'value':!0x1}});return{'ok':0x0===_0x10bdad['length'],'instance':_0x2ad700,'errors':_0x10bdad};};},_0x6cc806=>{_0x6cc806['exports']=require('class-transformer');},(_0x25e5b5,_0x3db959)=>{Object['defineProperty'](_0x3db959,'__esModule',{'value':!0x0}),_0x3db959['JOB_PRIORITY_KEY']=void 0x0,_0x3db959['JOB_PRIORITY_KEY']='bull:wda-request:priority';},function(_0x5d5e04,_0x3ecd34,_0x2e53ca){const _0x27b35b=a0_0x4abd;var _0x32e9dc,_0x1d9dc9=this&&this['__decorate']||function(_0xf2b8a9,_0x39a0b8,_0x1238da,_0x181e30){const _0x4f1b53=a0_0x4abd;var _0x3d15d3,_0x4460c0=arguments[_0x4f1b53(0x20f)],_0x193cb2=_0x4460c0<0x3?_0x39a0b8:null===_0x181e30?_0x181e30=Object[_0x4f1b53(0x4a5)](_0x39a0b8,_0x1238da):_0x181e30;if(_0x4f1b53(0x2f0)==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x193cb2=Reflect['decorate'](_0xf2b8a9,_0x39a0b8,_0x1238da,_0x181e30);else{for(var _0x2216db=_0xf2b8a9[_0x4f1b53(0x20f)]-0x1;_0x2216db>=0x0;_0x2216db--)(_0x3d15d3=_0xf2b8a9[_0x2216db])&&(_0x193cb2=(_0x4460c0<0x3?_0x3d15d3(_0x193cb2):_0x4460c0>0x3?_0x3d15d3(_0x39a0b8,_0x1238da,_0x193cb2):_0x3d15d3(_0x39a0b8,_0x1238da))||_0x193cb2);}return _0x4460c0>0x3&&_0x193cb2&&Object['defineProperty'](_0x39a0b8,_0x1238da,_0x193cb2),_0x193cb2;},_0x48aae4=this&&this['__metadata']||function(_0x3d2789,_0x2f3b79){const _0x2e10ce=a0_0x4abd;if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect[_0x2e10ce(0x47a)](_0x3d2789,_0x2f3b79);};Object[_0x27b35b(0x38d)](_0x3ecd34,'__esModule',{'value':!0x0}),_0x3ecd34[_0x27b35b(0x422)]=void 0x0;const _0x17bc03=_0x2e53ca(0x2),_0x59913a=_0x2e53ca(0x3),_0x427e2f=_0x2e53ca(0x38);let _0x1b2bbc=class{constructor(_0x3fcf60){this['jobManagerService']=_0x3fcf60,this['logger']=new _0x17bc03['Logger']('WithdrawalController');}async['getQueueStats'](){return await this['jobManagerService']['getQueueStats']();}async[_0x27b35b(0x333)](){const _0x4d8afb=_0x27b35b;return await this[_0x4d8afb(0x2fe)]['debugQueue']();}async[_0x27b35b(0x3e5)](){const _0x29ea9e=_0x27b35b;return this[_0x29ea9e(0x206)]['log'](_0x29ea9e(0x2c0)),await this['jobManagerService']['triggerPickJobs'](0x1),{'success':!0x0,'message':_0x29ea9e(0x4d2),'stats':await this[_0x29ea9e(0x2fe)]['getQueueStats']()};}};_0x3ecd34['WithdrawalController']=_0x1b2bbc,_0x1d9dc9([(0x0,_0x17bc03['Get'])(_0x27b35b(0x300)),(0x0,_0x59913a['ApiOperation'])({'summary':'Get\x20withdrawal\x20queue\x20statistics'}),(0x0,_0x59913a['ApiResponse'])({'status':0xc8,'description':'Queue\x20statistics'}),_0x48aae4(_0x27b35b(0x3c2),Function),_0x48aae4(_0x27b35b(0x2d9),[]),_0x48aae4(_0x27b35b(0x432),Promise)],_0x1b2bbc[_0x27b35b(0x2f9)],'getQueueStats',null),_0x1d9dc9([(0x0,_0x17bc03['Get'])('queue/debug'),(0x0,_0x59913a['ApiOperation'])({'summary':'Get\x20detailed\x20queue\x20debug\x20information'}),(0x0,_0x59913a['ApiResponse'])({'status':0xc8,'description':'Detailed\x20queue\x20debug\x20info'}),_0x48aae4('design:type',Function),_0x48aae4(_0x27b35b(0x2d9),[]),_0x48aae4('design:returntype',Promise)],_0x1b2bbc['prototype'],'debugQueue',null),_0x1d9dc9([(0x0,_0x17bc03[_0x27b35b(0x2f8)])('queue/trigger'),(0x0,_0x59913a['ApiOperation'])({'summary':'Manually\x20trigger\x20job\x20picking'}),(0x0,_0x59913a['ApiResponse'])({'status':0xc8,'description':'Job\x20picking\x20triggered'}),_0x48aae4(_0x27b35b(0x3c2),Function),_0x48aae4('design:paramtypes',[]),_0x48aae4('design:returntype',Promise)],_0x1b2bbc['prototype'],'triggerJobPicking',null),_0x3ecd34[_0x27b35b(0x422)]=_0x1b2bbc=_0x1d9dc9([(0x0,_0x59913a['ApiTags'])('withdrawal'),(0x0,_0x17bc03['Controller'])('api/withdrawal'),_0x48aae4('design:paramtypes',[_0x27b35b(0x42d)==typeof(_0x32e9dc=void 0x0!==_0x427e2f['WithdrawalJobManagerService']&&_0x427e2f['WithdrawalJobManagerService'])?_0x32e9dc:Object])],_0x1b2bbc);},function(_0x9cb011,_0x5970b8,_0x407eee){const _0x49e61a=a0_0x4abd;var _0x3be7fa=this&&this[_0x49e61a(0x290)]||function(_0x48d98c,_0x35aca3,_0x523015,_0x1f416e){const _0x5768e9=_0x49e61a;var _0x5f159b,_0x81cfed=arguments['length'],_0x1fbdaf=_0x81cfed<0x3?_0x35aca3:null===_0x1f416e?_0x1f416e=Object['getOwnPropertyDescriptor'](_0x35aca3,_0x523015):_0x1f416e;if(_0x5768e9(0x2f0)==typeof Reflect&&_0x5768e9(0x42d)==typeof Reflect['decorate'])_0x1fbdaf=Reflect[_0x5768e9(0x40a)](_0x48d98c,_0x35aca3,_0x523015,_0x1f416e);else{for(var _0x41dd36=_0x48d98c[_0x5768e9(0x20f)]-0x1;_0x41dd36>=0x0;_0x41dd36--)(_0x5f159b=_0x48d98c[_0x41dd36])&&(_0x1fbdaf=(_0x81cfed<0x3?_0x5f159b(_0x1fbdaf):_0x81cfed>0x3?_0x5f159b(_0x35aca3,_0x523015,_0x1fbdaf):_0x5f159b(_0x35aca3,_0x523015))||_0x1fbdaf);}return _0x81cfed>0x3&&_0x1fbdaf&&Object['defineProperty'](_0x35aca3,_0x523015,_0x1fbdaf),_0x1fbdaf;};Object['defineProperty'](_0x5970b8,'__esModule',{'value':!0x0}),_0x5970b8['HcBoxModule']=void 0x0;const _0x326521=_0x407eee(0x2),_0x398b7a=_0x407eee(0x48);let _0x55451e=class{};_0x5970b8['HcBoxModule']=_0x55451e,_0x5970b8['HcBoxModule']=_0x55451e=_0x3be7fa([(0x0,_0x326521['Module'])({'providers':[_0x398b7a['HcBoxService']],'exports':[_0x398b7a['HcBoxService']]})],_0x55451e);},function(_0x41d9ce,_0x23c477,_0x555db4){const _0x460ab9=a0_0x4abd;var _0x577f9d,_0x59d16e=this&&this['__decorate']||function(_0x5c4d13,_0x32d4d1,_0x599dba,_0xe24268){const _0x160e1a=a0_0x4abd;var _0x4a1b28,_0x1340c9=arguments[_0x160e1a(0x20f)],_0x2502c8=_0x1340c9<0x3?_0x32d4d1:null===_0xe24268?_0xe24268=Object[_0x160e1a(0x4a5)](_0x32d4d1,_0x599dba):_0xe24268;if(_0x160e1a(0x2f0)==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x2502c8=Reflect['decorate'](_0x5c4d13,_0x32d4d1,_0x599dba,_0xe24268);else{for(var _0x34b5da=_0x5c4d13['length']-0x1;_0x34b5da>=0x0;_0x34b5da--)(_0x4a1b28=_0x5c4d13[_0x34b5da])&&(_0x2502c8=(_0x1340c9<0x3?_0x4a1b28(_0x2502c8):_0x1340c9>0x3?_0x4a1b28(_0x32d4d1,_0x599dba,_0x2502c8):_0x4a1b28(_0x32d4d1,_0x599dba))||_0x2502c8);}return _0x1340c9>0x3&&_0x2502c8&&Object[_0x160e1a(0x38d)](_0x32d4d1,_0x599dba,_0x2502c8),_0x2502c8;},_0x1f48c8=this&&this['__metadata']||function(_0x11e371,_0xe73b89){const _0x13c8b9=a0_0x4abd;if('object'==typeof Reflect&&'function'==typeof Reflect[_0x13c8b9(0x47a)])return Reflect['metadata'](_0x11e371,_0xe73b89);},_0x48755d=this&&this['__param']||function(_0x57f552,_0x4526e9){return function(_0x25369e,_0x2e9b0c){_0x4526e9(_0x25369e,_0x2e9b0c,_0x57f552);};};Object['defineProperty'](_0x23c477,'__esModule',{'value':!0x0}),_0x23c477[_0x460ab9(0x2aa)]=void 0x0;const _0x4d6d93=_0x555db4(0x2),_0x328e82=_0x555db4(0xd),_0x43a764=_0x555db4(0x13),_0x1d0f6d=_0x555db4(0x18);let _0x356759=class{constructor(_0x1e626c){this['wsService']=_0x1e626c,this['logger']=new _0x4d6d93['Logger']('HcBoxService');}async['listDevices'](){const _0x4e8bee=_0x460ab9;try{return await this['wsService'][_0x4e8bee(0x3ac)]();}catch(_0x52cad5){throw this['logger']['error']('Error\x20listing\x20devices:\x20'+_0x52cad5[_0x4e8bee(0x4ad)]),_0x52cad5;}}async['executeTransfer'](_0x5b6d30,_0x9fbe5d){const _0x306036=_0x460ab9;try{this['logger']['log']('Executing\x20transfer\x20for\x20withdrawal\x20'+_0x5b6d30['withdrawalId']+'\x20on\x20device\x20'+_0x9fbe5d);const _0x4cd9e9=this[_0x306036(0x3ed)](_0x5b6d30['bankCode']);return _0x4cd9e9&&(await this['wsService']['launchApp'](_0x9fbe5d,_0x4cd9e9),await(0x0,_0x1d0f6d['sleep'])(0xbb8)),await this[_0x306036(0x1da)]['click'](_0x9fbe5d,0.5,0.3,0.2),await(0x0,_0x1d0f6d['sleep'])(0x7d0),this['logger']['warn'](_0x306036(0x3b0)),this[_0x306036(0x206)][_0x306036(0x4dd)]('Transfer\x20execution\x20completed\x20for\x20withdrawal\x20'+_0x5b6d30['withdrawalId']),!0x0;}catch(_0x120958){throw this['logger']['error']('Error\x20executing\x20transfer\x20for\x20withdrawal\x20'+_0x5b6d30['withdrawalId']+':\x20'+_0x120958['message']),_0x120958;}}[_0x460ab9(0x3ed)](_0x22e9ef){return{'VIETCOMBANK':'com.vietcombank.mobilebanking','TPBANK':'com.tpbank.mobilebanking','TECHCOMBANK':'com.techcombank.mobilebanking'}[_0x22e9ef]||null;}async[_0x460ab9(0x28c)](_0x4feb6b,_0x5d338f,_0x230d0b,_0x1f72a9=0.2){const _0x48750a=_0x460ab9;return this[_0x48750a(0x1da)]['click'](_0x4feb6b,_0x5d338f,_0x230d0b,_0x1f72a9);}async['swipe'](_0xf90547,_0x21bdc9){const _0x4ec4a2=_0x460ab9;return this[_0x4ec4a2(0x1da)]['swipe'](_0xf90547,_0x21bdc9);}async['screen'](_0x492ddc,_0x598725){return this['wsService']['captureScreen'](_0x492ddc,_0x598725);}async['home'](_0x1b894e){const _0x20b2ce=_0x460ab9;return this[_0x20b2ce(0x1da)][_0x20b2ce(0x39f)](_0x1b894e);}async[_0x460ab9(0x3fc)](_0x547a58,_0x1b12f5){const _0x19264b=_0x460ab9;return this['wsService'][_0x19264b(0x3fc)](_0x547a58,_0x1b12f5);}[_0x460ab9(0x2d8)](_0x3be8f7,_0xa7b9d8){const _0x50310f=_0x460ab9;return this['wsService'][_0x50310f(0x2d8)](_0x3be8f7,_0xa7b9d8);}};_0x23c477[_0x460ab9(0x2aa)]=_0x356759,_0x23c477['HcBoxService']=_0x356759=_0x59d16e([(0x0,_0x4d6d93['Injectable'])(),_0x48755d(0x0,(0x0,_0x4d6d93[_0x460ab9(0x458)])(_0x328e82['WEBSOCKET_SERVICE'])),_0x1f48c8(_0x460ab9(0x2d9),['function'==typeof(_0x577f9d=void 0x0!==_0x43a764['IWebSocketService']&&_0x43a764['IWebSocketService'])?_0x577f9d:Object])],_0x356759);},function(_0x3f3cd7,_0x5913a0,_0x5a716e){const _0x1b91aa=a0_0x4abd;var _0x16f712=this&&this['__decorate']||function(_0x151d9a,_0x44f246,_0x478472,_0x5377a4){const _0x94bf7d=a0_0x4abd;var _0xb619c7,_0xba2c85=arguments[_0x94bf7d(0x20f)],_0x5c9c95=_0xba2c85<0x3?_0x44f246:null===_0x5377a4?_0x5377a4=Object['getOwnPropertyDescriptor'](_0x44f246,_0x478472):_0x5377a4;if('object'==typeof Reflect&&_0x94bf7d(0x42d)==typeof Reflect['decorate'])_0x5c9c95=Reflect['decorate'](_0x151d9a,_0x44f246,_0x478472,_0x5377a4);else{for(var _0x2b66e2=_0x151d9a['length']-0x1;_0x2b66e2>=0x0;_0x2b66e2--)(_0xb619c7=_0x151d9a[_0x2b66e2])&&(_0x5c9c95=(_0xba2c85<0x3?_0xb619c7(_0x5c9c95):_0xba2c85>0x3?_0xb619c7(_0x44f246,_0x478472,_0x5c9c95):_0xb619c7(_0x44f246,_0x478472))||_0x5c9c95);}return _0xba2c85>0x3&&_0x5c9c95&&Object['defineProperty'](_0x44f246,_0x478472,_0x5c9c95),_0x5c9c95;};Object['defineProperty'](_0x5913a0,'__esModule',{'value':!0x0}),_0x5913a0[_0x1b91aa(0x379)]=void 0x0;const _0xfa78d1=_0x5a716e(0x2),_0x6a716c=_0x5a716e(0x4a),_0x54285a=_0x5a716e(0xe),_0x2be8f9=_0x5a716e(0x14),_0x3e23d0=_0x5a716e(0x47),_0x55a163=_0x5a716e(0xf),_0x38e29b=_0x5a716e(0x4c);let _0x3cbb37=class{};_0x5913a0['DeviceModule']=_0x3cbb37,_0x5913a0['DeviceModule']=_0x3cbb37=_0x16f712([(0x0,_0xfa78d1['Module'])({'imports':[_0x3e23d0[_0x1b91aa(0x32b)],(0x0,_0xfa78d1['forwardRef'])(()=>_0x38e29b[_0x1b91aa(0x321)])],'controllers':[_0x6a716c[_0x1b91aa(0x1cd)]],'providers':[_0x54285a['DeviceService'],_0x2be8f9[_0x1b91aa(0x474)],_0x55a163[_0x1b91aa(0x374)]],'exports':[_0x54285a['DeviceService'],_0x2be8f9['DeviceLockService']]})],_0x3cbb37);},function(_0x2d6c1a,_0x384bad,_0x45fd20){const _0x38ed23=a0_0x4abd;var _0x2b8e27,_0x531443,_0x128fd9,_0x2532dd=this&&this['__decorate']||function(_0x27fea8,_0x357861,_0x3c2a2a,_0x4a1d92){const _0x55f5f4=a0_0x4abd;var _0x152ea0,_0x4b010a=arguments['length'],_0x17f338=_0x4b010a<0x3?_0x357861:null===_0x4a1d92?_0x4a1d92=Object['getOwnPropertyDescriptor'](_0x357861,_0x3c2a2a):_0x4a1d92;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x17f338=Reflect['decorate'](_0x27fea8,_0x357861,_0x3c2a2a,_0x4a1d92);else{for(var _0x51063d=_0x27fea8[_0x55f5f4(0x20f)]-0x1;_0x51063d>=0x0;_0x51063d--)(_0x152ea0=_0x27fea8[_0x51063d])&&(_0x17f338=(_0x4b010a<0x3?_0x152ea0(_0x17f338):_0x4b010a>0x3?_0x152ea0(_0x357861,_0x3c2a2a,_0x17f338):_0x152ea0(_0x357861,_0x3c2a2a))||_0x17f338);}return _0x4b010a>0x3&&_0x17f338&&Object[_0x55f5f4(0x38d)](_0x357861,_0x3c2a2a,_0x17f338),_0x17f338;},_0x283cbd=this&&this['__metadata']||function(_0x57cc0e,_0x37509a){const _0x4ea219=a0_0x4abd;if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect[_0x4ea219(0x47a)](_0x57cc0e,_0x37509a);},_0x50dcfc=this&&this['__param']||function(_0x401f68,_0xfb5323){return function(_0x8cc4c6,_0x33107b){_0xfb5323(_0x8cc4c6,_0x33107b,_0x401f68);};};Object['defineProperty'](_0x384bad,'__esModule',{'value':!0x0}),_0x384bad['DeviceController']=void 0x0;const _0x22cbba=_0x45fd20(0x2),_0x37861b=_0x45fd20(0xe),_0xefbcc1=_0x45fd20(0x4b),_0x2285e8=_0x45fd20(0xb),_0x19fbe7=_0x45fd20(0x11);let _0x396ce3=class{constructor(_0x74cae6,_0x148f7f){const _0x224cf6=a0_0x4abd;this[_0x224cf6(0x42e)]=_0x74cae6,this[_0x224cf6(0x207)]=_0x148f7f,this['logger']=new _0x22cbba['Logger']('DeviceController');}async['getDevicesPage'](){const _0x24382f=a0_0x4abd;return{'devices':await this[_0x24382f(0x42e)][_0x24382f(0x3ac)](),'serviceStatus':await this[_0x24382f(0x42e)]['getServiceStatus'](),'banks':[_0x24382f(0x47b),'HDBANK','PGBANK','TECHCOMBANK',_0x24382f(0x315),'VIETCOMBANK'],'boxType':_0x19fbe7['config']['boxType']};}async['getDevices'](){const _0x58c4b6=a0_0x4abd;return{'success':!0x0,'data':await this['deviceService'][_0x58c4b6(0x3ac)]()};}async['getDeviceConfig'](_0x33e30c){return{'success':!0x0,'data':await this['deviceService']['getDeviceConfigSafe'](_0x33e30c)};}async[_0x38ed23(0x2c1)](_0x4fd71d){const _0x16a658=_0x38ed23;try{this['logger']['log']('Retry\x20login\x20requested\x20for\x20device\x20'+_0x4fd71d);const _0x17bb63=await this['deviceService']['getDeviceConfig'](_0x4fd71d);if(!_0x17bb63)throw new _0x22cbba[(_0x16a658(0x4a1))]({'success':!0x1,'error':_0x16a658(0x1ff)+_0x4fd71d+'\x20not\x20found\x20or\x20not\x20configured'},_0x22cbba['HttpStatus'][_0x16a658(0x1c9)]);if(!_0x17bb63['bankCode']||''===_0x17bb63['bankCode']['trim']())throw new _0x22cbba[(_0x16a658(0x4a1))]({'success':!0x1,'error':'Device\x20'+_0x4fd71d+'\x20does\x20not\x20have\x20bankCode\x20configured.\x20Please\x20configure\x20bankCode\x20first.'},_0x22cbba[_0x16a658(0x242)]['BAD_REQUEST']);const _0x3ad87d=_0x17bb63['bankCode'][_0x16a658(0x35a)]();return await this['bankService']['login'](_0x3ad87d,_0x4fd71d),{'success':!0x0,'message':'Successfully\x20logged\x20in\x20to\x20'+_0x3ad87d+'\x20on\x20device\x20'+_0x4fd71d};}catch(_0x43cbd4){if(_0x43cbd4 instanceof _0x22cbba['HttpException'])throw _0x43cbd4;throw this['logger']['error'](_0x16a658(0x45d)+_0x4fd71d+':\x20'+_0x43cbd4['message'],_0x43cbd4['stack']),new _0x22cbba['HttpException']({'success':!0x1,'error':_0x43cbd4['message']||'Failed\x20to\x20retry\x20login'},_0x22cbba['HttpStatus'][_0x16a658(0x3ba)]);}}async['updateDeviceConfig'](_0x247ded,_0x43b450){const _0x20a2ab=_0x38ed23;try{this['logger']['log'](_0x20a2ab(0x292)+_0x247ded+':\x20'+JSON['stringify'](_0x43b450));const _0xae565c=await this['deviceService']['getDeviceConfig'](_0x247ded);if(_0x20a2ab(0x4db)===(void 0x0!==_0x43b450['status']?_0x43b450['status']:_0xae565c?.['status']||'deactive')){const _0x143c9c=[],_0x9254d8=void 0x0!==_0x43b450[_0x20a2ab(0x3d8)]?_0x43b450[_0x20a2ab(0x3d8)]:_0xae565c?.[_0x20a2ab(0x3d8)];_0x9254d8&&''!==_0x9254d8[_0x20a2ab(0x223)]()||_0x143c9c[_0x20a2ab(0x353)]('Bank\x20Code\x20l√†\x20b·∫Øt\x20bu·ªôc\x20khi\x20status\x20l√†\x20active');const _0x492e85=void 0x0!==_0x43b450['availableAmount']?_0x43b450['availableAmount']:_0xae565c?.[_0x20a2ab(0x32e)];(null==_0x492e85||_0x492e85<0x0)&&_0x143c9c[_0x20a2ab(0x353)]('Available\x20Amount\x20l√†\x20b·∫Øt\x20bu·ªôc\x20v√†\x20ph·∫£i\x20>=\x200\x20khi\x20status\x20l√†\x20active');const _0x2c4da5=void 0x0!==_0x43b450['password']?_0x43b450['password']:_0xae565c?.[_0x20a2ab(0x3a0)];_0x2c4da5&&''!==_0x2c4da5['trim']()||_0x143c9c[_0x20a2ab(0x353)](_0x20a2ab(0x222));const _0x1b0ea9=void 0x0!==_0x43b450['smartOTP']?_0x43b450['smartOTP']:_0xae565c?.['smartOTP'];if(_0x1b0ea9&&''!==_0x1b0ea9[_0x20a2ab(0x223)]()||_0x143c9c[_0x20a2ab(0x353)]('Smart\x20OTP\x20l√†\x20b·∫Øt\x20bu·ªôc\x20khi\x20status\x20l√†\x20active'),_0x143c9c['length']>0x0)throw new _0x22cbba['HttpException']({'success':!0x1,'error':_0x143c9c['join'](',\x20')},_0x22cbba['HttpStatus'][_0x20a2ab(0x1c9)]);}return{'success':!0x0,'data':await this['deviceService']['updateDeviceConfig'](_0x247ded,_0x43b450)};}catch(_0x28b73b){if(_0x28b73b instanceof _0x22cbba['HttpException'])throw _0x28b73b;throw this['logger']['error']('Error\x20updating\x20device\x20config\x20for\x20'+_0x247ded+':\x20'+_0x28b73b['message'],_0x28b73b['stack']),new _0x22cbba[(_0x20a2ab(0x4a1))]({'success':!0x1,'error':_0x28b73b['message']||_0x20a2ab(0x4c8)},_0x22cbba['HttpStatus']['INTERNAL_SERVER_ERROR']);}}async['getServiceStatus'](){return{'success':!0x0,'data':{'status':await this['deviceService']['getServiceStatus']()}};}async['startService'](){const _0x44a21e=_0x38ed23;return await this[_0x44a21e(0x42e)]['startService']();}async['stopService'](){const _0x4b96c7=_0x38ed23;return await this['deviceService']['setServiceStatus'](_0x4b96c7(0x4ac)),{'success':!0x0,'message':'Service\x20stopped\x20successfully'};}async['deleteDeviceConfig'](_0x1dfe15){const _0x447e3d=_0x38ed23;return await this['deviceService']['deleteDeviceConfig'](_0x1dfe15),{'success':!0x0,'message':_0x447e3d(0x3bd)};}};_0x384bad['DeviceController']=_0x396ce3,_0x2532dd([(0x0,_0x22cbba['Get'])(),(0x0,_0x22cbba[_0x38ed23(0x340)])(_0x38ed23(0x210)),_0x283cbd('design:type',Function),_0x283cbd(_0x38ed23(0x2d9),[]),_0x283cbd('design:returntype',Promise)],_0x396ce3['prototype'],'getDevicesPage',null),_0x2532dd([(0x0,_0x22cbba['Get'])(_0x38ed23(0x49a)),_0x283cbd('design:type',Function),_0x283cbd('design:paramtypes',[]),_0x283cbd('design:returntype',Promise)],_0x396ce3['prototype'],_0x38ed23(0x219),null),_0x2532dd([(0x0,_0x22cbba['Get'])(_0x38ed23(0x447)),_0x50dcfc(0x0,(0x0,_0x22cbba[_0x38ed23(0x25c)])('deviceId')),_0x283cbd('design:type',Function),_0x283cbd(_0x38ed23(0x2d9),[String]),_0x283cbd(_0x38ed23(0x432),Promise)],_0x396ce3['prototype'],'getDeviceConfig',null),_0x2532dd([(0x0,_0x22cbba['Post'])('api/devices/:deviceId/retryLogin'),_0x50dcfc(0x0,(0x0,_0x22cbba[_0x38ed23(0x25c)])('deviceId')),_0x283cbd('design:type',Function),_0x283cbd('design:paramtypes',[String]),_0x283cbd(_0x38ed23(0x432),Promise)],_0x396ce3['prototype'],'retryLogin',null),_0x2532dd([(0x0,_0x22cbba[_0x38ed23(0x3e9)])('api/devices/:deviceId/config'),_0x50dcfc(0x0,(0x0,_0x22cbba['Param'])('deviceId')),_0x50dcfc(0x1,(0x0,_0x22cbba[_0x38ed23(0x3d0)])()),_0x283cbd('design:type',Function),_0x283cbd(_0x38ed23(0x2d9),[String,'function'==typeof(_0x128fd9=void 0x0!==_0xefbcc1['UpdateDeviceConfigDto']&&_0xefbcc1['UpdateDeviceConfigDto'])?_0x128fd9:Object]),_0x283cbd(_0x38ed23(0x432),Promise)],_0x396ce3[_0x38ed23(0x2f9)],'updateDeviceConfig',null),_0x2532dd([(0x0,_0x22cbba['Get'])(_0x38ed23(0x3bf)),_0x283cbd(_0x38ed23(0x3c2),Function),_0x283cbd(_0x38ed23(0x2d9),[]),_0x283cbd('design:returntype',Promise)],_0x396ce3['prototype'],'getServiceStatus',null),_0x2532dd([(0x0,_0x22cbba[_0x38ed23(0x2f8)])('api/service/start'),_0x283cbd('design:type',Function),_0x283cbd('design:paramtypes',[]),_0x283cbd('design:returntype',Promise)],_0x396ce3['prototype'],_0x38ed23(0x20a),null),_0x2532dd([(0x0,_0x22cbba['Post'])('api/service/stop'),_0x283cbd('design:type',Function),_0x283cbd('design:paramtypes',[]),_0x283cbd('design:returntype',Promise)],_0x396ce3['prototype'],_0x38ed23(0x31a),null),_0x2532dd([(0x0,_0x22cbba[_0x38ed23(0x31d)])('api/devices/:deviceId/config'),_0x50dcfc(0x0,(0x0,_0x22cbba[_0x38ed23(0x25c)])(_0x38ed23(0x29b))),_0x283cbd('design:type',Function),_0x283cbd(_0x38ed23(0x2d9),[String]),_0x283cbd('design:returntype',Promise)],_0x396ce3[_0x38ed23(0x2f9)],'deleteDeviceConfig',null),_0x384bad['DeviceController']=_0x396ce3=_0x2532dd([(0x0,_0x22cbba[_0x38ed23(0x43b)])(),_0x283cbd('design:paramtypes',[_0x38ed23(0x42d)==typeof(_0x2b8e27=void 0x0!==_0x37861b['DeviceService']&&_0x37861b['DeviceService'])?_0x2b8e27:Object,_0x38ed23(0x42d)==typeof(_0x531443=void 0x0!==_0x2285e8['BankService']&&_0x2285e8['BankService'])?_0x531443:Object])],_0x396ce3);},function(_0x11cb8b,_0x11fbf8,_0xf73526){const _0x166145=a0_0x4abd;var _0x26520c=this&&this['__decorate']||function(_0x1eefb6,_0x19dd04,_0x11f10a,_0x53fad4){const _0x8a207e=a0_0x4abd;var _0x4dda6c,_0x4f008a=arguments['length'],_0x190331=_0x4f008a<0x3?_0x19dd04:null===_0x53fad4?_0x53fad4=Object[_0x8a207e(0x4a5)](_0x19dd04,_0x11f10a):_0x53fad4;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x190331=Reflect[_0x8a207e(0x40a)](_0x1eefb6,_0x19dd04,_0x11f10a,_0x53fad4);else{for(var _0x6d9e8d=_0x1eefb6['length']-0x1;_0x6d9e8d>=0x0;_0x6d9e8d--)(_0x4dda6c=_0x1eefb6[_0x6d9e8d])&&(_0x190331=(_0x4f008a<0x3?_0x4dda6c(_0x190331):_0x4f008a>0x3?_0x4dda6c(_0x19dd04,_0x11f10a,_0x190331):_0x4dda6c(_0x19dd04,_0x11f10a))||_0x190331);}return _0x4f008a>0x3&&_0x190331&&Object['defineProperty'](_0x19dd04,_0x11f10a,_0x190331),_0x190331;},_0x39a096=this&&this['__metadata']||function(_0x2ddbe4,_0x3d66d9){const _0x3a296e=a0_0x4abd;if(_0x3a296e(0x2f0)==typeof Reflect&&_0x3a296e(0x42d)==typeof Reflect['metadata'])return Reflect['metadata'](_0x2ddbe4,_0x3d66d9);};Object['defineProperty'](_0x11fbf8,_0x166145(0x318),{'value':!0x0}),_0x11fbf8['UpdateDeviceConfigDto']=void 0x0;const _0x22ca14=_0xf73526(0x3b);class _0x594a53{}_0x11fbf8['UpdateDeviceConfigDto']=_0x594a53,_0x26520c([(0x0,_0x22ca14['ValidateIf'])(_0x404e8c=>'active'===_0x404e8c['status']),(0x0,_0x22ca14['IsNotEmpty'])({'message':_0x166145(0x218)}),(0x0,_0x22ca14[_0x166145(0x4b1)])(),(0x0,_0x22ca14['IsOptional'])(),_0x39a096('design:type',String)],_0x594a53[_0x166145(0x2f9)],'bankCode',void 0x0),_0x26520c([(0x0,_0x22ca14[_0x166145(0x2a1)])(_0x2d07f1=>'active'===_0x2d07f1[_0x166145(0x2be)]),(0x0,_0x22ca14['IsNotEmpty'])({'message':'Available\x20Amount\x20is\x20required\x20when\x20status\x20is\x20active'}),(0x0,_0x22ca14['IsNumber'])(),(0x0,_0x22ca14['Min'])(0x0,{'message':_0x166145(0x267)}),(0x0,_0x22ca14['IsOptional'])(),_0x39a096('design:type',Number)],_0x594a53[_0x166145(0x2f9)],_0x166145(0x32e),void 0x0),_0x26520c([(0x0,_0x22ca14[_0x166145(0x2af)])(),(0x0,_0x22ca14['IsString'])(),(0x0,_0x22ca14['IsIn'])([_0x166145(0x4db),'deactive']),_0x39a096('design:type',String)],_0x594a53['prototype'],'status',void 0x0),_0x26520c([(0x0,_0x22ca14['ValidateIf'])(_0x26ed0b=>_0x166145(0x4db)===_0x26ed0b['status']),(0x0,_0x22ca14['IsNotEmpty'])({'message':'Password\x20is\x20required\x20when\x20status\x20is\x20active'}),(0x0,_0x22ca14['IsString'])(),(0x0,_0x22ca14['IsOptional'])(),_0x39a096('design:type',String)],_0x594a53['prototype'],'password',void 0x0),_0x26520c([(0x0,_0x22ca14['ValidateIf'])(_0x409e0a=>'active'===_0x409e0a['status']),(0x0,_0x22ca14[_0x166145(0x24c)])({'message':'Smart\x20OTP\x20is\x20required\x20when\x20status\x20is\x20active'}),(0x0,_0x22ca14['IsString'])(),(0x0,_0x22ca14['IsOptional'])(),_0x39a096('design:type',String)],_0x594a53[_0x166145(0x2f9)],'smartOTP',void 0x0),_0x26520c([(0x0,_0x22ca14['ValidateIf'])(_0x565234=>_0x166145(0x4db)===_0x565234['status']),(0x0,_0x22ca14['IsNotEmpty'])({'message':'Account\x20No\x20is\x20required\x20when\x20status\x20is\x20active'}),(0x0,_0x22ca14['IsString'])(),(0x0,_0x22ca14['IsOptional'])(),_0x39a096('design:type',String)],_0x594a53['prototype'],_0x166145(0x1d6),void 0x0),_0x26520c([(0x0,_0x22ca14[_0x166145(0x2a1)])(_0x2255a1=>_0x166145(0x4db)===_0x2255a1[_0x166145(0x2be)]),(0x0,_0x22ca14['IsNotEmpty'])({'message':'Account\x20Name\x20is\x20required\x20when\x20status\x20is\x20active'}),(0x0,_0x22ca14['IsString'])(),(0x0,_0x22ca14['IsOptional'])(),_0x39a096('design:type',String)],_0x594a53[_0x166145(0x2f9)],'accountName',void 0x0);},function(_0x1b0358,_0x378ca5,_0x1c6d86){const _0x33754f=a0_0x4abd;var _0x55ae66=this&&this[_0x33754f(0x290)]||function(_0x5ba642,_0x14fd8a,_0x2ad8d5,_0x2162e5){const _0x5239db=_0x33754f;var _0x4320bd,_0x1f821f=arguments[_0x5239db(0x20f)],_0x221f96=_0x1f821f<0x3?_0x14fd8a:null===_0x2162e5?_0x2162e5=Object['getOwnPropertyDescriptor'](_0x14fd8a,_0x2ad8d5):_0x2162e5;if(_0x5239db(0x2f0)==typeof Reflect&&'function'==typeof Reflect[_0x5239db(0x40a)])_0x221f96=Reflect['decorate'](_0x5ba642,_0x14fd8a,_0x2ad8d5,_0x2162e5);else{for(var _0x45c784=_0x5ba642['length']-0x1;_0x45c784>=0x0;_0x45c784--)(_0x4320bd=_0x5ba642[_0x45c784])&&(_0x221f96=(_0x1f821f<0x3?_0x4320bd(_0x221f96):_0x1f821f>0x3?_0x4320bd(_0x14fd8a,_0x2ad8d5,_0x221f96):_0x4320bd(_0x14fd8a,_0x2ad8d5))||_0x221f96);}return _0x1f821f>0x3&&_0x221f96&&Object['defineProperty'](_0x14fd8a,_0x2ad8d5,_0x221f96),_0x221f96;};Object['defineProperty'](_0x378ca5,'__esModule',{'value':!0x0}),_0x378ca5[_0x33754f(0x321)]=void 0x0;const _0x21e3c4=_0x1c6d86(0x2),_0x350068=_0x1c6d86(0xb),_0x55e9ab=_0x1c6d86(0xc),_0x36eb03=_0x1c6d86(0x28),_0x131066=_0x1c6d86(0x2f),_0x5e9b3c=_0x1c6d86(0x4d),_0x2daaf7=_0x1c6d86(0x47),_0x2f5b07=_0x1c6d86(0x49),_0x4048b9=_0x1c6d86(0x4e),_0x4bf9c0=_0x1c6d86(0x34),_0xf206a2=_0x1c6d86(0x52),_0x2bc251=_0x1c6d86(0xf),_0x2d9537=_0x1c6d86(0x53),_0x8e977d=_0x1c6d86(0x54),_0x287603=_0x1c6d86(0x32);let _0x2ecb45=class{};_0x378ca5['BankModule']=_0x2ecb45,_0x378ca5['BankModule']=_0x2ecb45=_0x55ae66([(0x0,_0x21e3c4[_0x33754f(0x26b)])({'imports':[_0x2daaf7['HcBoxModule'],(0x0,_0x21e3c4['forwardRef'])(()=>_0x2f5b07['DeviceModule']),_0x4048b9['WebSocketModule'],_0x2d9537['OCRModule'],_0x8e977d[_0x33754f(0x2bf)]],'controllers':[_0x5e9b3c['BankController']],'providers':[_0x350068[_0x33754f(0x440)],_0x55e9ab['AcbService'],_0x36eb03['PgService'],_0x131066['HdBankService'],_0x287603['VietcombankService'],_0x4bf9c0['SessionManagementService'],_0xf206a2[_0x33754f(0x30e)],_0x2bc251['RedisService']],'exports':[_0x350068['BankService']]})],_0x2ecb45);},function(_0x15b5be,_0x13b5b2,_0x406379){const _0x74dfc6=a0_0x4abd;var _0x598792,_0x3d2205,_0x37f859,_0x535f25,_0x451fae=this&&this['__decorate']||function(_0x3bb199,_0x41da8e,_0x528b62,_0x580b63){var _0xd68132,_0x18071d=arguments['length'],_0x392efe=_0x18071d<0x3?_0x41da8e:null===_0x580b63?_0x580b63=Object['getOwnPropertyDescriptor'](_0x41da8e,_0x528b62):_0x580b63;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x392efe=Reflect['decorate'](_0x3bb199,_0x41da8e,_0x528b62,_0x580b63);else{for(var _0x22131f=_0x3bb199['length']-0x1;_0x22131f>=0x0;_0x22131f--)(_0xd68132=_0x3bb199[_0x22131f])&&(_0x392efe=(_0x18071d<0x3?_0xd68132(_0x392efe):_0x18071d>0x3?_0xd68132(_0x41da8e,_0x528b62,_0x392efe):_0xd68132(_0x41da8e,_0x528b62))||_0x392efe);}return _0x18071d>0x3&&_0x392efe&&Object['defineProperty'](_0x41da8e,_0x528b62,_0x392efe),_0x392efe;},_0xb04244=this&&this['__metadata']||function(_0x3ecc69,_0x4c6183){if('object'==typeof Reflect&&'function'==typeof Reflect['metadata'])return Reflect['metadata'](_0x3ecc69,_0x4c6183);},_0xc69607=this&&this['__param']||function(_0x5b05dd,_0xb9f272){return function(_0x14b86c,_0x693380){_0xb9f272(_0x14b86c,_0x693380,_0x5b05dd);};};Object[_0x74dfc6(0x38d)](_0x13b5b2,_0x74dfc6(0x318),{'value':!0x0}),_0x13b5b2['BankController']=void 0x0;const _0x416338=_0x406379(0x2),_0x307d26=_0x406379(0x3),_0x3a5899=_0x406379(0xb),_0x1610d0=_0x406379(0x11),_0x52609c=_0x406379(0x13),_0xda46a=_0x406379(0xd),_0x23ef00=_0x406379(0x1a),_0x21cab7=_0x406379(0x1e),_0x1b93f1=_0x406379(0x1b),_0x2e02f1=_0x406379(0x20);let _0x37bf73=class{constructor(_0x328c5e,_0x4c4dfe,_0x136000,_0x1aa48b){const _0x293e6e=_0x74dfc6;this['bankService']=_0x328c5e,this['wsService']=_0x4c4dfe,this['imagePreprocessingService']=_0x136000,this[_0x293e6e(0x4a3)]=_0x1aa48b,this['logger']=new _0x416338['Logger'](_0x293e6e(0x319));}['getBankService'](_0x4a902f){const _0x558881=_0x74dfc6,_0x188c24=this[_0x558881(0x207)][_0x558881(0x289)](_0x4a902f);if(!_0x188c24)throw new _0x416338['HttpException']({'success':!0x1,'error':'Bank\x20service\x20not\x20found\x20for\x20bank\x20code:\x20'+_0x4a902f+_0x558881(0x215)+this['bankService']['getSupportedBanks']()[_0x558881(0x282)](',\x20')},_0x416338['HttpStatus']['BAD_REQUEST']);return _0x188c24;}async['getDevices'](_0x35fde0){try{return{'success':!0x0,'data':await this['wsService']['listDevices']()};}catch(_0x24f7bd){return this['logger']['error']('Error\x20getting\x20devices:\x20'+_0x24f7bd['message']),{'success':!0x1,'error':_0x24f7bd['message']};}}async['testLaunchApp'](_0x2e01f8,_0xfbdf62){const _0x1bf233=_0x74dfc6;try{const _0x4ddd7d=this['getBankService'](_0x2e01f8);return this['logger']['log']('Testing\x20'+_0x2e01f8+'\x20app\x20launch\x20on\x20device:\x20'+_0xfbdf62),await _0x4ddd7d[_0x1bf233(0x464)](_0xfbdf62),{'success':!0x0,'message':_0x2e01f8+'\x20app\x20launched\x20successfully\x20on\x20device\x20'+_0xfbdf62};}catch(_0x3289c0){return this[_0x1bf233(0x206)]['error']('Error\x20testing\x20'+_0x2e01f8+'\x20app\x20launch:\x20'+_0x3289c0['message']),{'success':!0x1,'error':_0x3289c0['message']};}}async[_0x74dfc6(0x328)](_0x32ebf8,_0x2c931e,_0x7b76d1,_0x20b3bc){const _0x34977c=_0x74dfc6;try{this['logger']['log']('Testing\x20screen\x20capture\x20on\x20device:\x20'+_0x2c931e);const _0x55500e=_0x20b3bc?parseFloat(_0x20b3bc):0.5,_0x56ccda=_0x7b76d1||'test-screen-capture-'+Date['now'](),_0x3e1f94=await this['wsService']['captureScreen'](_0x2c931e,{'quality':_0x55500e,'folderPath':'C:/boxscreen/'+_0x56ccda+_0x34977c(0x47c)});return{'success':!0x0,'message':_0x34977c(0x3cb)+_0x2c931e,'data':{'base64Image':_0x3e1f94,'imageLength':_0x3e1f94?.['length']??0x0}};}catch(_0x11abb3){return this['logger']['error']('Error\x20testing\x20screen\x20capture:\x20'+_0x11abb3['message']),{'success':!0x1,'error':_0x11abb3['message']};}}async['testClickAtCoordinates'](_0x2fc6a3,_0x10f04e,_0x1dcc2c,_0x10f7d7){const _0x5123e1=_0x74dfc6;try{const _0x16e72b=parseFloat(_0x1dcc2c),_0x1b2d92=parseFloat(_0x10f7d7);return isNaN(_0x16e72b)||isNaN(_0x1b2d92)?{'success':!0x1,'error':'Invalid\x20coordinates.\x20x\x20and\x20y\x20must\x20be\x20numbers\x20between\x200\x20and\x201','example':'/api/bank/'+_0x2fc6a3+_0x5123e1(0x26f)}:(this['logger']['log'](_0x5123e1(0x3be)+_0x16e72b+',\x20'+_0x1b2d92+')\x20on\x20device:\x20'+_0x10f04e),await this['wsService']['click'](_0x10f04e,_0x16e72b,_0x1b2d92),{'success':!0x0,'message':'Click\x20completed\x20successfully\x20at\x20coordinates\x20('+_0x16e72b+',\x20'+_0x1b2d92+')\x20on\x20device\x20'+_0x10f04e,'coordinates':{'x':_0x16e72b,'y':_0x1b2d92}});}catch(_0x177ce8){return this[_0x5123e1(0x206)]['error'](_0x5123e1(0x39e)+_0x177ce8['message']),{'success':!0x1,'error':_0x177ce8[_0x5123e1(0x4ad)]};}}async['testSwipe'](_0xaf1ad7,_0x51e3d8,_0x2259ec,_0x55a49a,_0x1402e3,_0x59a0b3,_0x19c1a3,_0x1d6938){const _0x49d57b=_0x74dfc6;try{const _0x539d52='PANDA'===_0x1610d0['config']['boxType'],_0x2b5f6a='HC'===_0x1610d0['config'][_0x49d57b(0x2bc)];if(_0x539d52){if(!_0x1402e3)return{'success':!0x1,'error':'For\x20Panda\x20format:\x20type\x20is\x20required','example':_0x49d57b(0x3e4)+_0xaf1ad7+'/test/swipe/{deviceId}?type=0'};if(!['0','1','2','4','5','6','7','8','9','10'][_0x49d57b(0x424)](_0x1402e3))return{'success':!0x1,'error':'Invalid\x20type.\x20Type\x20must\x20be\x20one\x20of:\x200\x20(Êåâ‰∏ã/press),\x201\x20(Êä¨Ëµ∑/lift),\x202\x20(ÁßªÂä®/move),\x204\x20(ÊªöËΩÆÂêë‰∏ä/scroll\x20up),\x205\x20(ÊªöËΩÆÂêë‰∏ã/scroll\x20down),\x206\x20(‰∏äÊªë/swipe\x20up),\x207\x20(‰∏ãÊªë/swipe\x20down),\x208\x20(Â∑¶Êªë/swipe\x20left),\x209\x20(Âè≥Êªë/swipe\x20right),\x2010\x20(ÁÇπÂáª/click)','example':'/api/bank/'+_0xaf1ad7+'/test/swipe/{deviceId}?type=0'};if(!(['4','5','6','7','8','9']['includes'](_0x1402e3)||_0x2259ec&&_0x55a49a))return{'success':!0x1,'error':_0x49d57b(0x257)+_0x1402e3+':\x20x\x20and\x20y\x20are\x20required','example':_0x49d57b(0x3e4)+_0xaf1ad7+'/test/swipe/{deviceId}?x=50&y=30&type='+_0x1402e3};const _0x1c0ad4={'type':_0x1402e3};if(_0x2259ec&&_0x55a49a){const _0xc7aa32=parseFloat(_0x2259ec),_0x33aa81=parseFloat(_0x55a49a);if(isNaN(_0xc7aa32)||isNaN(_0x33aa81))return{'success':!0x1,'error':_0x49d57b(0x4b6),'example':_0x49d57b(0x3e4)+_0xaf1ad7+'/test/swipe/{deviceId}?x=50&y=30&type='+_0x1402e3};if(_0xc7aa32<0x0||_0xc7aa32>0x64||_0x33aa81<0x0||_0x33aa81>0x64)return{'success':!0x1,'error':'Invalid\x20coordinates.\x20x\x20and\x20y\x20must\x20be\x20between\x200\x20and\x20100\x20for\x20Panda','example':'/api/bank/'+_0xaf1ad7+'/test/swipe/{deviceId}?x=50&y=30&type='+_0x1402e3};_0x1c0ad4['x']=_0xc7aa32['toString'](),_0x1c0ad4['y']=_0x33aa81['toString']();}return this['logger'][_0x49d57b(0x4dd)]('Testing\x20Panda\x20swipe\x20on\x20device:\x20'+_0x51e3d8+'\x20with\x20type='+_0x1402e3+(_0x2259ec&&_0x55a49a?',\x20x='+_0x2259ec+_0x49d57b(0x1ca)+_0x55a49a:_0x49d57b(0x2c8))),await this['wsService'][_0x49d57b(0x33e)](_0x51e3d8,_0x1c0ad4),{'success':!0x0,'message':_0x49d57b(0x423)+_0x51e3d8,'coordinates':{'type':_0x1402e3,..._0x2259ec&&_0x55a49a?{'x':_0x2259ec,'y':_0x55a49a}:{}}};}if(_0x2b5f6a){if(!(_0x2259ec&&_0x55a49a&&_0x59a0b3&&_0x19c1a3))return{'success':!0x1,'error':'For\x20HC\x20format:\x20x,\x20y,\x20endX,\x20and\x20endY\x20are\x20required','example':_0x49d57b(0x3e4)+_0xaf1ad7+_0x49d57b(0x3f6)};const _0x4b988e=parseFloat(_0x2259ec),_0x47f72a=parseFloat(_0x55a49a),_0x557172=parseFloat(_0x59a0b3),_0x455986=parseFloat(_0x19c1a3),_0x193231=_0x1d6938?parseFloat(_0x1d6938):0.2;return isNaN(_0x4b988e)||isNaN(_0x47f72a)||isNaN(_0x557172)||isNaN(_0x455986)?{'success':!0x1,'error':'Invalid\x20coordinates.\x20x,\x20y,\x20endX,\x20and\x20endY\x20must\x20be\x20numbers\x20between\x200\x20and\x201\x20for\x20HC','example':'/api/bank/'+_0xaf1ad7+'/test/swipe/{deviceId}?x=0.2&y=0.5&endX=0.8&endY=0.5&duration=0.3'}:_0x4b988e<0x0||_0x4b988e>0x1||_0x47f72a<0x0||_0x47f72a>0x1||_0x557172<0x0||_0x557172>0x1||_0x455986<0x0||_0x455986>0x1?{'success':!0x1,'error':_0x49d57b(0x2d6),'example':_0x49d57b(0x3e4)+_0xaf1ad7+'/test/swipe/{deviceId}?x=0.2&y=0.5&endX=0.8&endY=0.5&duration=0.3'}:(this[_0x49d57b(0x206)]['log']('Testing\x20HC\x20swipe\x20from\x20('+_0x4b988e+',\x20'+_0x47f72a+_0x49d57b(0x3a3)+_0x557172+',\x20'+_0x455986+')\x20on\x20device:\x20'+_0x51e3d8),await this[_0x49d57b(0x1da)]['swipe'](_0x51e3d8,{'x':_0x4b988e,'y':_0x47f72a,'endX':_0x557172,'endY':_0x455986,'duration':_0x193231}),{'success':!0x0,'message':'HC\x20swipe\x20completed\x20successfully\x20from\x20('+_0x4b988e+',\x20'+_0x47f72a+')\x20to\x20('+_0x557172+',\x20'+_0x455986+_0x49d57b(0x295)+_0x51e3d8,'coordinates':{'start':{'x':_0x4b988e,'y':_0x47f72a},'end':{'x':_0x557172,'y':_0x455986},'duration':_0x193231}});}return{'success':!0x1,'error':_0x49d57b(0x2bb)+_0x1610d0['config'][_0x49d57b(0x2bc)]+'.\x20Must\x20be\x20\x27HC\x27\x20or\x20\x27PANDA\x27'};}catch(_0xcc55eb){return this['logger']['error']('Error\x20testing\x20swipe:\x20'+_0xcc55eb['message']),{'success':!0x1,'error':_0xcc55eb['message']};}}async['testInputNumpadNumber'](_0x318bd6,_0x3b31ab,_0xe7d7c5){const _0x42c613=_0x74dfc6;try{return _0xe7d7c5&&0x0!==_0xe7d7c5['trim']()[_0x42c613(0x20f)]?/^\d+$/['test'](_0xe7d7c5)?(this['logger']['log']('Testing\x20numpad\x20number\x20input\x20\x22'+_0xe7d7c5+'\x22\x20on\x20device:\x20'+_0x3b31ab),await this['wsService']['inputNumpadNumber'](_0x3b31ab,_0xe7d7c5),{'success':!0x0,'message':'Numpad\x20number\x20input\x20completed\x20successfully\x20on\x20device\x20'+_0x3b31ab,'data':{'number':_0xe7d7c5,'digits':_0xe7d7c5['split']('')['map'](_0x26a2c1=>parseInt(_0x26a2c1))}}):{'success':!0x1,'error':'Number\x20must\x20contain\x20only\x20digits\x20(0-9)','example':_0x42c613(0x3e4)+_0x318bd6+'/test/input-numpad/{deviceId}?number=123456'}:{'success':!0x1,'error':'Number\x20is\x20required\x20and\x20cannot\x20be\x20empty','example':'/api/bank/'+_0x318bd6+'/test/input-numpad/{deviceId}?number=123456'};}catch(_0x329ddc){return this[_0x42c613(0x206)][_0x42c613(0x20b)](_0x42c613(0x322)+_0x329ddc['message']),{'success':!0x1,'error':_0x329ddc[_0x42c613(0x4ad)]};}}async['testInputText'](_0x3dd7a0,_0x1e8e5d,_0x363c2d){const _0x2534ec=_0x74dfc6;try{return _0x363c2d&&0x0!==_0x363c2d['trim']()['length']?(this[_0x2534ec(0x206)]['log']('Testing\x20text\x20input\x20\x22'+_0x363c2d+_0x2534ec(0x37b)+_0x1e8e5d),await this['wsService']['inputText'](_0x1e8e5d,_0x363c2d),{'success':!0x0,'message':'Text\x20input\x20completed\x20successfully\x20on\x20device\x20'+_0x1e8e5d}):{'success':!0x1,'error':_0x2534ec(0x355),'example':_0x2534ec(0x3e4)+_0x3dd7a0+'/test/input-text/{deviceId}?text=abc123'};}catch(_0x17d150){return this['logger']['error'](_0x2534ec(0x4c7)+_0x17d150['message']),{'success':!0x1,'error':_0x17d150[_0x2534ec(0x4ad)]};}}async['testPressReturn'](_0x2b8b89,_0x4167b0){const _0x5a4fe2=_0x74dfc6;try{return this['logger']['log']('Testing\x20press\x20return\x20key\x20on\x20device:\x20'+_0x4167b0),await this['wsService'][_0x5a4fe2(0x3ae)](_0x4167b0),{'success':!0x0,'message':_0x5a4fe2(0x202)+_0x4167b0,'note':'This\x20key\x20can\x20dismiss\x20keyboard\x20or\x20submit/enter\x20depending\x20on\x20context'};}catch(_0x330923){return this[_0x5a4fe2(0x206)]['error'](_0x5a4fe2(0x1f5)+_0x330923[_0x5a4fe2(0x4ad)]),{'success':!0x1,'error':_0x330923[_0x5a4fe2(0x4ad)]};}}async[_0x74dfc6(0x1e7)](_0x4848cb,_0x25afe6,_0x5a88c3,_0x458f31,_0x49bff9,_0xb99874){const _0x58c231=_0x74dfc6,_0x29dd2f='C:/testroi';try{await(0x0,_0x23ef00['rm'])(_0x29dd2f,{'recursive':!0x0,'force':!0x0}),this[_0x58c231(0x206)]['log'](_0x58c231(0x377)+_0x29dd2f);}catch(_0x5662c4){this[_0x58c231(0x206)][_0x58c231(0x200)]('Kh√¥ng\x20th·ªÉ\x20x√≥a\x20folder:\x20'+_0x5662c4[_0x58c231(0x4ad)]);}await(0x0,_0x23ef00['mkdir'])(_0x29dd2f,{'recursive':!0x0}),await this[_0x58c231(0x1da)]['captureScreen'](_0x25afe6,{'folderPath':_0x29dd2f});const _0x1cda0a=await this['bankService']['getLatestImagePath'](_0x29dd2f),_0x5f3999=await(0x0,_0x23ef00['readFile'])(_0x1cda0a),_0x3dd355=await this['imagePreprocessingService'][_0x58c231(0x251)](_0x5f3999,{'x':parseFloat(_0x5a88c3),'y':parseFloat(_0x458f31),'width':parseFloat(_0x49bff9),'height':parseFloat(_0xb99874)},void 0x0,{'grayscale':!0x0,'enhanceContrast':!0x0}),_0x3e843e=await this['ocrService'][_0x58c231(0x280)](_0x3dd355['buffer']),_0x479316=_0x29dd2f+'/processed-'+Date['now']()+'.png';return await(0x0,_0x23ef00['writeFile'])(_0x479316,_0x3dd355[_0x58c231(0x399)]),{..._0x3e843e,'normalizedText':(0x0,_0x2e02f1['removeVietnameseTones'])(_0x3e843e[_0x58c231(0x2ad)])};}};_0x13b5b2[_0x74dfc6(0x319)]=_0x37bf73,_0x451fae([(0x0,_0x416338[_0x74dfc6(0x33f)])(_0x74dfc6(0x210)),(0x0,_0x307d26['ApiOperation'])({'summary':'Get\x20list\x20of\x20available\x20devices'}),(0x0,_0x307d26[_0x74dfc6(0x3c1)])({'name':'bankCode','description':_0x74dfc6(0x4e3)}),(0x0,_0x307d26['ApiResponse'])({'status':0xc8,'description':'List\x20of\x20devices\x20retrieved\x20successfully'}),_0xc69607(0x0,(0x0,_0x416338['Param'])(_0x74dfc6(0x3d8))),_0xb04244('design:type',Function),_0xb04244('design:paramtypes',[String]),_0xb04244(_0x74dfc6(0x432),Promise)],_0x37bf73[_0x74dfc6(0x2f9)],'getDevices',null),_0x451fae([(0x0,_0x416338[_0x74dfc6(0x2f8)])('test/launch-app/:deviceId'),(0x0,_0x307d26['ApiOperation'])({'summary':'Test\x20launching\x20bank\x20app\x20on\x20a\x20device'}),(0x0,_0x307d26['ApiParam'])({'name':'bankCode','description':'Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)'}),(0x0,_0x307d26['ApiParam'])({'name':'deviceId','description':_0x74dfc6(0x3a2)}),(0x0,_0x307d26[_0x74dfc6(0x345)])({'status':0xc8,'description':'App\x20launched\x20successfully'}),_0xc69607(0x0,(0x0,_0x416338['Param'])('bankCode')),_0xc69607(0x1,(0x0,_0x416338['Param'])(_0x74dfc6(0x29b))),_0xb04244('design:type',Function),_0xb04244(_0x74dfc6(0x2d9),[String,String]),_0xb04244('design:returntype',Promise)],_0x37bf73['prototype'],'testLaunchApp',null),_0x451fae([(0x0,_0x416338[_0x74dfc6(0x2f8)])('test/capture-screen/:deviceId'),(0x0,_0x307d26['ApiOperation'])({'summary':'Test\x20screen\x20capture\x20on\x20a\x20device'}),(0x0,_0x307d26['ApiParam'])({'name':'bankCode','description':_0x74dfc6(0x4e3)}),(0x0,_0x307d26['ApiParam'])({'name':'deviceId','description':_0x74dfc6(0x3a2)}),(0x0,_0x307d26['ApiQuery'])({'name':_0x74dfc6(0x420),'description':_0x74dfc6(0x229),'required':!0x1}),(0x0,_0x307d26[_0x74dfc6(0x34c)])({'name':'quality','description':'Image\x20quality\x20(0-1,\x20default:\x200.5)','required':!0x1}),(0x0,_0x307d26['ApiResponse'])({'status':0xc8,'description':'Screen\x20captured\x20successfully'}),_0xc69607(0x0,(0x0,_0x416338['Param'])('bankCode')),_0xc69607(0x1,(0x0,_0x416338[_0x74dfc6(0x25c)])('deviceId')),_0xc69607(0x2,(0x0,_0x416338['Query'])(_0x74dfc6(0x420))),_0xc69607(0x3,(0x0,_0x416338[_0x74dfc6(0x454)])('quality')),_0xb04244(_0x74dfc6(0x3c2),Function),_0xb04244('design:paramtypes',[String,String,String,String]),_0xb04244('design:returntype',Promise)],_0x37bf73['prototype'],'testCaptureScreen',null),_0x451fae([(0x0,_0x416338['Post'])(_0x74dfc6(0x1ce)),(0x0,_0x307d26[_0x74dfc6(0x390)])({'summary':_0x74dfc6(0x1d2)}),(0x0,_0x307d26[_0x74dfc6(0x3c1)])({'name':'bankCode','description':'Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)'}),(0x0,_0x307d26['ApiParam'])({'name':'deviceId','description':'Device\x20ID'}),(0x0,_0x307d26['ApiQuery'])({'name':'x','description':'X\x20coordinate\x20(HC:\x200-1,\x20Panda:\x200-100)','required':!0x0}),(0x0,_0x307d26['ApiQuery'])({'name':'y','description':_0x74dfc6(0x266),'required':!0x0}),(0x0,_0x307d26[_0x74dfc6(0x345)])({'status':0xc8,'description':'Click\x20completed\x20successfully'}),_0xc69607(0x0,(0x0,_0x416338[_0x74dfc6(0x25c)])('bankCode')),_0xc69607(0x1,(0x0,_0x416338[_0x74dfc6(0x25c)])('deviceId')),_0xc69607(0x2,(0x0,_0x416338['Query'])('x')),_0xc69607(0x3,(0x0,_0x416338[_0x74dfc6(0x454)])('y')),_0xb04244(_0x74dfc6(0x3c2),Function),_0xb04244('design:paramtypes',[String,String,String,String]),_0xb04244('design:returntype',Promise)],_0x37bf73[_0x74dfc6(0x2f9)],'testClickAtCoordinates',null),_0x451fae([(0x0,_0x416338['Post'])('test/swipe/:deviceId'),(0x0,_0x307d26[_0x74dfc6(0x390)])({'summary':'Test\x20swiping\x20on\x20a\x20device.\x20Format\x20is\x20determined\x20by\x20config.boxType\x20(HC\x20or\x20PANDA)'}),(0x0,_0x307d26['ApiParam'])({'name':'bankCode','description':'Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)'}),(0x0,_0x307d26['ApiParam'])({'name':_0x74dfc6(0x29b),'description':_0x74dfc6(0x3a2)}),(0x0,_0x307d26[_0x74dfc6(0x34c)])({'name':'x','description':'X\x20coordinate\x20(HC:\x200-1,\x20Panda:\x200-100).\x20Required\x20for\x20HC\x20and\x20Panda\x20types\x200,1,2,10.\x20Optional\x20for\x20Panda\x20types\x204,5,6,7,8,9','required':!0x1}),(0x0,_0x307d26['ApiQuery'])({'name':'y','description':'Y\x20coordinate\x20(HC:\x200-1,\x20Panda:\x200-100).\x20Required\x20for\x20HC\x20and\x20Panda\x20types\x200,1,2,10.\x20Optional\x20for\x20Panda\x20types\x204,5,6,7,8,9','required':!0x1}),(0x0,_0x307d26[_0x74dfc6(0x34c)])({'name':'type','description':_0x74dfc6(0x2b2),'required':!0x1}),(0x0,_0x307d26['ApiQuery'])({'name':_0x74dfc6(0x2ae),'description':'End\x20X\x20coordinate\x20for\x20HC\x20(required\x20for\x20HC:\x200-1)','required':!0x1}),(0x0,_0x307d26['ApiQuery'])({'name':'endY','description':'End\x20Y\x20coordinate\x20for\x20HC\x20(required\x20for\x20HC:\x200-1)','required':!0x1}),(0x0,_0x307d26[_0x74dfc6(0x34c)])({'name':_0x74dfc6(0x226),'description':_0x74dfc6(0x486),'required':!0x1}),(0x0,_0x307d26['ApiResponse'])({'status':0xc8,'description':_0x74dfc6(0x256)}),_0xc69607(0x0,(0x0,_0x416338[_0x74dfc6(0x25c)])('bankCode')),_0xc69607(0x1,(0x0,_0x416338['Param'])('deviceId')),_0xc69607(0x2,(0x0,_0x416338['Query'])('x')),_0xc69607(0x3,(0x0,_0x416338['Query'])('y')),_0xc69607(0x4,(0x0,_0x416338['Query'])('type')),_0xc69607(0x5,(0x0,_0x416338['Query'])('endX')),_0xc69607(0x6,(0x0,_0x416338['Query'])(_0x74dfc6(0x491))),_0xc69607(0x7,(0x0,_0x416338[_0x74dfc6(0x454)])('duration')),_0xb04244('design:type',Function),_0xb04244(_0x74dfc6(0x2d9),[String,String,String,String,String,String,String,String]),_0xb04244('design:returntype',Promise)],_0x37bf73[_0x74dfc6(0x2f9)],'testSwipe',null),_0x451fae([(0x0,_0x416338['Post'])(_0x74dfc6(0x389)),(0x0,_0x307d26['ApiOperation'])({'summary':'Test\x20inputting\x20number\x20using\x20numpad\x20layout\x20on\x20a\x20device'}),(0x0,_0x307d26[_0x74dfc6(0x3c1)])({'name':'bankCode','description':_0x74dfc6(0x4e3)}),(0x0,_0x307d26[_0x74dfc6(0x3c1)])({'name':'deviceId','description':'Device\x20ID'}),(0x0,_0x307d26[_0x74dfc6(0x34c)])({'name':_0x74dfc6(0x2bd),'description':'Number\x20string\x20to\x20input\x20(e.g.,\x20\x22123\x22,\x20\x22456789\x22)','required':!0x0}),(0x0,_0x307d26['ApiResponse'])({'status':0xc8,'description':_0x74dfc6(0x4b2)}),_0xc69607(0x0,(0x0,_0x416338['Param'])('bankCode')),_0xc69607(0x1,(0x0,_0x416338[_0x74dfc6(0x25c)])(_0x74dfc6(0x29b))),_0xc69607(0x2,(0x0,_0x416338['Query'])('number')),_0xb04244(_0x74dfc6(0x3c2),Function),_0xb04244('design:paramtypes',[String,String,String]),_0xb04244('design:returntype',Promise)],_0x37bf73['prototype'],_0x74dfc6(0x311),null),_0x451fae([(0x0,_0x416338['Post'])(_0x74dfc6(0x2c9)),(0x0,_0x307d26['ApiOperation'])({'summary':'Test\x20inputting\x20text\x20using\x20keyboard\x20layout\x20on\x20a\x20device'}),(0x0,_0x307d26['ApiParam'])({'name':'bankCode','description':'Bank\x20code\x20(ACB,\x20PGBANK,\x20etc.)'}),(0x0,_0x307d26['ApiParam'])({'name':'deviceId','description':'Device\x20ID'}),(0x0,_0x307d26[_0x74dfc6(0x34c)])({'name':'text','description':_0x74dfc6(0x446),'required':!0x0}),(0x0,_0x307d26['ApiResponse'])({'status':0xc8,'description':'Text\x20input\x20completed\x20successfully'}),_0xc69607(0x0,(0x0,_0x416338['Param'])('bankCode')),_0xc69607(0x1,(0x0,_0x416338['Param'])(_0x74dfc6(0x29b))),_0xc69607(0x2,(0x0,_0x416338['Query'])('text')),_0xb04244('design:type',Function),_0xb04244('design:paramtypes',[String,String,String]),_0xb04244(_0x74dfc6(0x432),Promise)],_0x37bf73['prototype'],'testInputText',null),_0x451fae([(0x0,_0x416338['Post'])('test/press-return/:deviceId'),(0x0,_0x307d26[_0x74dfc6(0x390)])({'summary':'Test\x20pressing\x20return\x20key\x20on\x20a\x20device'}),(0x0,_0x307d26[_0x74dfc6(0x3c1)])({'name':'bankCode','description':_0x74dfc6(0x4e3)}),(0x0,_0x307d26['ApiParam'])({'name':'deviceId','description':_0x74dfc6(0x3a2)}),(0x0,_0x307d26['ApiResponse'])({'status':0xc8,'description':'Return\x20key\x20pressed\x20successfully'}),_0xc69607(0x0,(0x0,_0x416338[_0x74dfc6(0x25c)])('bankCode')),_0xc69607(0x1,(0x0,_0x416338[_0x74dfc6(0x25c)])('deviceId')),_0xb04244('design:type',Function),_0xb04244(_0x74dfc6(0x2d9),[String,String]),_0xb04244('design:returntype',Promise)],_0x37bf73['prototype'],'testPressReturn',null),_0x451fae([(0x0,_0x416338['Post'])('test/roi'),(0x0,_0x307d26[_0x74dfc6(0x390)])({'summary':_0x74dfc6(0x4b5)}),(0x0,_0x307d26['ApiParam'])({'name':_0x74dfc6(0x3d8),'description':_0x74dfc6(0x4e3)}),(0x0,_0x307d26['ApiQuery'])({'name':'deviceId','description':'Device\x20ID'}),(0x0,_0x307d26['ApiQuery'])({'name':'x','description':_0x74dfc6(0x40f),'required':!0x0}),(0x0,_0x307d26[_0x74dfc6(0x34c)])({'name':'y','description':'Y\x20coordinate','required':!0x0}),(0x0,_0x307d26['ApiQuery'])({'name':'width','description':_0x74dfc6(0x23c),'required':!0x0}),(0x0,_0x307d26['ApiQuery'])({'name':'height','description':'Height','required':!0x0}),_0xc69607(0x0,(0x0,_0x416338['Param'])('bankCode')),_0xc69607(0x1,(0x0,_0x416338['Query'])('deviceId')),_0xc69607(0x2,(0x0,_0x416338['Query'])('x')),_0xc69607(0x3,(0x0,_0x416338['Query'])('y')),_0xc69607(0x4,(0x0,_0x416338['Query'])(_0x74dfc6(0x44a))),_0xc69607(0x5,(0x0,_0x416338[_0x74dfc6(0x454)])('height')),_0xb04244('design:type',Function),_0xb04244('design:paramtypes',[String,String,String,String,String,String]),_0xb04244('design:returntype',Promise)],_0x37bf73[_0x74dfc6(0x2f9)],'testRoi',null),_0x13b5b2['BankController']=_0x37bf73=_0x451fae([(0x0,_0x307d26['ApiTags'])('bank'),(0x0,_0x416338['Controller'])('api/bank/:bankCode'),_0xc69607(0x1,(0x0,_0x416338[_0x74dfc6(0x458)])(_0xda46a['WEBSOCKET_SERVICE'])),_0xb04244('design:paramtypes',[_0x74dfc6(0x42d)==typeof(_0x598792=void 0x0!==_0x3a5899['BankService']&&_0x3a5899[_0x74dfc6(0x440)])?_0x598792:Object,'function'==typeof(_0x3d2205=void 0x0!==_0x52609c['IWebSocketService']&&_0x52609c[_0x74dfc6(0x1df)])?_0x3d2205:Object,'function'==typeof(_0x37f859=void 0x0!==_0x21cab7['ImagePreprocessingService']&&_0x21cab7['ImagePreprocessingService'])?_0x37f859:Object,'function'==typeof(_0x535f25=void 0x0!==_0x1b93f1['OCRService']&&_0x1b93f1['OCRService'])?_0x535f25:Object])],_0x37bf73);},function(_0x17e824,_0x5bb13d,_0x2115d3){const _0x407eae=a0_0x4abd;var _0x1787e5=this&&this['__decorate']||function(_0x47f8e8,_0x5a29e8,_0x969c78,_0x242b5b){const _0x3916ca=a0_0x4abd;var _0x29bcfe,_0x34ac8a=arguments['length'],_0x2f3a1e=_0x34ac8a<0x3?_0x5a29e8:null===_0x242b5b?_0x242b5b=Object[_0x3916ca(0x4a5)](_0x5a29e8,_0x969c78):_0x242b5b;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x2f3a1e=Reflect['decorate'](_0x47f8e8,_0x5a29e8,_0x969c78,_0x242b5b);else{for(var _0x27b4ea=_0x47f8e8['length']-0x1;_0x27b4ea>=0x0;_0x27b4ea--)(_0x29bcfe=_0x47f8e8[_0x27b4ea])&&(_0x2f3a1e=(_0x34ac8a<0x3?_0x29bcfe(_0x2f3a1e):_0x34ac8a>0x3?_0x29bcfe(_0x5a29e8,_0x969c78,_0x2f3a1e):_0x29bcfe(_0x5a29e8,_0x969c78))||_0x2f3a1e);}return _0x34ac8a>0x3&&_0x2f3a1e&&Object[_0x3916ca(0x38d)](_0x5a29e8,_0x969c78,_0x2f3a1e),_0x2f3a1e;};Object['defineProperty'](_0x5bb13d,_0x407eae(0x318),{'value':!0x0}),_0x5bb13d[_0x407eae(0x3c9)]=void 0x0;const _0x173ea2=_0x2115d3(0x2),_0x3c354b=_0x2115d3(0x4f),_0x5530f7=_0x2115d3(0x51),_0x4242e=_0x2115d3(0xd),_0x42fa25=_0x2115d3(0x11);let _0x20f15d=class{};_0x5bb13d['WebSocketModule']=_0x20f15d,_0x5bb13d['WebSocketModule']=_0x20f15d=_0x1787e5([(0x0,_0x173ea2['Global'])(),(0x0,_0x173ea2[_0x407eae(0x26b)])({'providers':[{'provide':_0x4242e[_0x407eae(0x49c)],'useClass':_0x407eae(0x3d9)===_0x42fa25[_0x407eae(0x36b)]['boxType']?_0x5530f7['PandaWebSocketService']:_0x3c354b[_0x407eae(0x378)]}],'exports':[_0x4242e['WEBSOCKET_SERVICE']]})],_0x20f15d);},function(_0x419a44,_0x5ad5e8,_0x56d49e){const _0x1ff904=a0_0x4abd;var _0x439539=this&&this['__decorate']||function(_0x3d3e8a,_0x2f83b0,_0x5b4af8,_0x2b7f54){const _0x505f08=a0_0x4abd;var _0x3f2b6e,_0x4b2570=arguments[_0x505f08(0x20f)],_0x176834=_0x4b2570<0x3?_0x2f83b0:null===_0x2b7f54?_0x2b7f54=Object['getOwnPropertyDescriptor'](_0x2f83b0,_0x5b4af8):_0x2b7f54;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x176834=Reflect['decorate'](_0x3d3e8a,_0x2f83b0,_0x5b4af8,_0x2b7f54);else{for(var _0x3d0177=_0x3d3e8a['length']-0x1;_0x3d0177>=0x0;_0x3d0177--)(_0x3f2b6e=_0x3d3e8a[_0x3d0177])&&(_0x176834=(_0x4b2570<0x3?_0x3f2b6e(_0x176834):_0x4b2570>0x3?_0x3f2b6e(_0x2f83b0,_0x5b4af8,_0x176834):_0x3f2b6e(_0x2f83b0,_0x5b4af8))||_0x176834);}return _0x4b2570>0x3&&_0x176834&&Object['defineProperty'](_0x2f83b0,_0x5b4af8,_0x176834),_0x176834;},_0x3736ee=this&&this['__metadata']||function(_0x26bf83,_0x4c8380){const _0x9d4c6c=a0_0x4abd;if('object'==typeof Reflect&&_0x9d4c6c(0x42d)==typeof Reflect[_0x9d4c6c(0x47a)])return Reflect['metadata'](_0x26bf83,_0x4c8380);};Object['defineProperty'](_0x5ad5e8,'__esModule',{'value':!0x0}),_0x5ad5e8['HCWebSocketService']=void 0x0;const _0x3f7da0=_0x56d49e(0x2),_0x1a47e9=_0x56d49e(0x50),_0x2c0e91=_0x56d49e(0x26),_0x1c798c=_0x56d49e(0x18),_0x540f2a=_0x56d49e(0x16);let _0x519612=class{constructor(){const _0x1f3d22=a0_0x4abd;this['logger']=new _0x3f7da0['Logger'](_0x1f3d22(0x378)),this['ws']=null,this['reconnectAttempts']=0x0,this['maxReconnectAttempts']=0xa,this[_0x1f3d22(0x40e)]=0x1388,this[_0x1f3d22(0x1f4)]=[],this['pendingRequests']=new Map(),this['isConnected']=!0x1,this['isProcessingRequest']=!0x1,this[_0x1f3d22(0x369)]='ws://127.0.0.1:26608';}async[_0x1ff904(0x2b8)](){const _0x3c2f47=_0x1ff904;await this[_0x3c2f47(0x2ce)]();}async['onModuleDestroy'](){await this['disconnect']();}async['connect'](){return new Promise((_0x4ef025,_0x29680b)=>{const _0x1076f4=a0_0x4abd;try{this['logger'][_0x1076f4(0x4dd)](_0x1076f4(0x20d)+this[_0x1076f4(0x369)]),this['ws']=new _0x1a47e9(this['wsUrl']),this['ws']['on']('open',()=>{const _0x44c3e7=_0x1076f4;this[_0x44c3e7(0x206)]['log'](_0x44c3e7(0x485)),this[_0x44c3e7(0x37a)]=!0x0,this['reconnectAttempts']=0x0,this['processRequestQueue'](),_0x4ef025();}),this['ws']['on'](_0x1076f4(0x4ad),_0x579947=>{const _0x46580b=_0x1076f4;try{const _0x1a16cc=JSON[_0x46580b(0x294)](_0x579947['toString']());this[_0x46580b(0x384)](_0x1a16cc);}catch(_0x2c46e6){this['logger']['error'](_0x46580b(0x2ef)+_0x2c46e6['message']);}}),this['ws']['on']('error',_0x3a44ca=>{const _0x295ba5=_0x1076f4;this[_0x295ba5(0x206)][_0x295ba5(0x20b)](_0x295ba5(0x413)+_0x3a44ca[_0x295ba5(0x4ad)]),this['isConnected']=!0x1,0x0===this['reconnectAttempts']&&_0x29680b(_0x3a44ca);}),this['ws']['on'](_0x1076f4(0x3a8),()=>{this['logger']['warn']('HC\x20BOX\x20WebSocket\x20closed'),this['isConnected']=!0x1,this['scheduleReconnect']();});}catch(_0x5d84ef){this[_0x1076f4(0x206)]['error']('Error\x20creating\x20WebSocket\x20connection:\x20'+_0x5d84ef['message']),_0x29680b(_0x5d84ef);}});}['scheduleReconnect'](){const _0x53c5fc=_0x1ff904;if(this['reconnectAttempts']>=this['maxReconnectAttempts'])return void this['logger']['error']('Max\x20reconnection\x20attempts\x20reached');this['reconnectAttempts']++;const _0x28e43e=this['reconnectDelay']*this[_0x53c5fc(0x45e)];this[_0x53c5fc(0x206)]['log'](_0x53c5fc(0x24e)+this['reconnectAttempts']+'\x20in\x20'+_0x28e43e+'ms'),setTimeout(()=>{this['connect']()['catch'](_0x4400ac=>{const _0x9f5ba=a0_0x4abd;this['logger'][_0x9f5ba(0x20b)]('Reconnection\x20failed:\x20'+_0x4400ac[_0x9f5ba(0x4ad)]);});},_0x28e43e);}async['disconnect'](){const _0x4cb00d=_0x1ff904;this['ws']&&(this['ws'][_0x4cb00d(0x3a8)](),this['ws']=null,this['isConnected']=!0x1);}['handleMessage'](_0x251f06){const _0x4ffd50=_0x1ff904;if(this['pendingRequests']['size']>0x0){const [_0x17c6e9,_0x56c985]=this[_0x4ffd50(0x2c4)][_0x4ffd50(0x275)]()['next']()[_0x4ffd50(0x2a8)];this['pendingRequests']['delete'](_0x17c6e9),0xc8===_0x251f06['StatusCode']?_0x56c985['resolve'](_0x251f06['result']):_0x56c985[_0x4ffd50(0x461)](new Error('HC\x20BOX\x20error:\x20'+_0x251f06[_0x4ffd50(0x2a4)]));}else this[_0x4ffd50(0x206)][_0x4ffd50(0x38c)]('Received\x20response\x20but\x20no\x20pending\x20requests:\x20'+JSON['stringify'](_0x251f06));}async['processRequestQueue'](){const _0x17f071=_0x1ff904;if(this['isProcessingRequest']||0x0===this[_0x17f071(0x1f4)]['length'])return;if(!this['isConnected']||!this['ws'])return;this['isProcessingRequest']=!0x0;const {request:_0x4c7442,resolve:_0x58bd9e,reject:_0x376d60,timeout:_0x26400f}=this['requestQueue'][_0x17f071(0x387)]();try{_0x58bd9e(await this['_sendRequestOnce'](_0x4c7442,_0x26400f));}catch(_0xe64875){_0x376d60(_0xe64875);}finally{this['isProcessingRequest']=!0x1,this[_0x17f071(0x1f4)]['length']>0x0&&setImmediate(()=>this['processRequestQueue']());}}async['_sendRequestOnce'](_0x11af24,_0x2d445e=0x7530){return new Promise((_0x4d2909,_0x157b2b)=>{const _0x59a630=a0_0x4abd,_0x20f06b=Date[_0x59a630(0x34e)]()[_0x59a630(0x2b1)]()+Math['random']()[_0x59a630(0x2b1)](0x24)['substr'](0x2,0x9);this[_0x59a630(0x2c4)]['set'](_0x20f06b,{'resolve':_0x4d2909,'reject':_0x157b2b});const _0x6795f=setTimeout(()=>{const _0x3953ad=_0x59a630;this[_0x3953ad(0x2c4)][_0x3953ad(0x28d)](_0x20f06b),_0x157b2b(new Error('WebSocket\x20request\x20timeout'));},_0x2d445e),_0x4f8f96=_0x4d2909,_0x1f46b0=_0x157b2b;_0x4d2909=_0x32811e=>{clearTimeout(_0x6795f),_0x4f8f96(_0x32811e);},_0x157b2b=_0x54276a=>{clearTimeout(_0x6795f),_0x1f46b0(_0x54276a);},this['pendingRequests']['set'](_0x20f06b,{'resolve':_0x4d2909,'reject':_0x157b2b});try{this['ws']['send'](JSON[_0x59a630(0x445)](_0x11af24));}catch(_0x51f4de){this['pendingRequests']['delete'](_0x20f06b),clearTimeout(_0x6795f),_0x157b2b(_0x51f4de);}});}async[_0x1ff904(0x4b0)](_0x15d928,_0x63d13e=0x7530){return new Promise((_0x1fe952,_0x36be9b)=>{const _0x2db2d8=a0_0x4abd;this[_0x2db2d8(0x1f4)][_0x2db2d8(0x353)]({'request':_0x15d928,'resolve':_0x1fe952,'reject':_0x36be9b,'timeout':_0x63d13e}),this[_0x2db2d8(0x48e)]();});}async['listDevices'](){const _0x37b9d8=_0x1ff904,_0x267e69=await this[_0x37b9d8(0x4b0)]({'action':'list'});return Array['isArray'](_0x267e69)?_0x267e69:[];}async[_0x1ff904(0x28c)](_0x1d3c74,_0x2e24fa,_0xfe12fb,_0x7cc461=0.2){const _0x20abd6=_0x1ff904,_0x59a92f=Array[_0x20abd6(0x44c)](_0x1d3c74)?_0x1d3c74['join'](','):_0x1d3c74;return this[_0x20abd6(0x4b0)]({'action':'click','comm':{'deviceIds':_0x59a92f,'x':_0x2e24fa,'y':_0xfe12fb,'duration':_0x7cc461}});}async['swipe'](_0xc234d3,_0x5a82d5){const _0x5aca10=Array['isArray'](_0xc234d3)?_0xc234d3['join'](','):_0xc234d3;return this['sendRequest']({'action':'swipe','comm':{'deviceIds':_0x5aca10,..._0x5a82d5}});}async['captureScreen'](_0x56f954,_0x24c2fa){return this['sendRequest']({'action':'screen','comm':{'deviceIds':_0x56f954,...(0x0,_0x540f2a['omit'])(_0x24c2fa,'folderPath'),'filePath':_0x24c2fa['folderPath']}});}async['home'](_0x51fada){const _0x5c739c=_0x1ff904,_0x355cb0=Array[_0x5c739c(0x44c)](_0x51fada)?_0x51fada['join'](','):_0x51fada;return this[_0x5c739c(0x4b0)]({'action':'home','comm':{'deviceIds':_0x355cb0}});}async['launchApp'](_0x14e645,_0x18524c){const _0x16706b=Array['isArray'](_0x14e645)?_0x14e645['join'](','):_0x14e645;return this['sendRequest']({'action':'launchApp','comm':{'deviceIds':_0x16706b,'content':_0x18524c}});}async[_0x1ff904(0x380)](_0x4b1259,_0x39afb7){const _0x1b785d=_0x1ff904,_0x68eb17=Array['isArray'](_0x4b1259)?_0x4b1259['join'](','):_0x4b1259;return this[_0x1b785d(0x4b0)]({'action':_0x1b785d(0x380),'comm':{'deviceIds':_0x68eb17,'content':_0x39afb7}});}['isNumber'](_0x2bd44a){const _0x5b9f93=_0x1ff904;return/^[0-9]$/[_0x5b9f93(0x2ca)](_0x2bd44a);}['isLetter'](_0x416605){return/^[a-zA-Z]$/['test'](_0x416605);}['isSpecialCharInNumberMode'](_0x2a8897){return['@','!']['includes'](_0x2a8897);}async[_0x1ff904(0x4de)](_0x29e024){const _0x3766fb=_0x1ff904,{x:_0x555ae5,y:_0x2e1679}=_0x2c0e91['COMMON_COORDINATES'][_0x3766fb(0x38a)];this['logger']['log']('Switching\x20keyboard\x20mode\x20on\x20device\x20'+_0x29e024+'\x20at\x20coordinates\x20('+_0x555ae5+',\x20'+_0x2e1679+')'),await this['click'](_0x29e024,_0x555ae5,_0x2e1679,0.2),await(0x0,_0x1c798c[_0x3766fb(0x3b8)])(0x1f4),this['logger']['log']('Keyboard\x20mode\x20switched\x20successfully\x20on\x20device\x20'+_0x29e024);}async['pressShiftKey'](_0x228a19){const _0x1f9a29=_0x1ff904,{x:_0x410e94,y:_0x8b2670}=_0x2c0e91[_0x1f9a29(0x273)]['SHIFT_KEY'];this['logger'][_0x1f9a29(0x200)](_0x1f9a29(0x3b7)+_0x228a19+'\x20at\x20coordinates\x20('+_0x410e94+',\x20'+_0x8b2670+')'),await this['click'](_0x228a19,_0x410e94,_0x8b2670,0.2),await(0x0,_0x1c798c[_0x1f9a29(0x3b8)])(0xc8),this['logger'][_0x1f9a29(0x200)]('Shift\x20key\x20pressed\x20successfully\x20on\x20device\x20'+_0x228a19);}async['pressReturnKey'](_0x1f9726){const _0xf07baa=_0x1ff904,{x:_0x1e1146,y:_0x433a1a}=_0x2c0e91['COMMON_COORDINATES']['RETURN_KEY'];this['logger'][_0xf07baa(0x4dd)]('Pressing\x20return\x20key\x20on\x20device\x20'+_0x1f9726+'\x20at\x20coordinates\x20('+_0x1e1146+',\x20'+_0x433a1a+')'),await this[_0xf07baa(0x28c)](_0x1f9726,_0x1e1146,_0x433a1a,0.2),await(0x0,_0x1c798c[_0xf07baa(0x3b8)])(0x1f4),this['logger']['log'](_0xf07baa(0x202)+_0x1f9726);}async['inputText'](_0xeec10e,_0x5c4890){const _0xfb8301=_0x1ff904;if(!_0x5c4890||0x0===_0x5c4890['length'])throw new Error('Password\x20cannot\x20be\x20empty');let _0x5a173d=_0xfb8301(0x396);for(let _0x53a4b7=0x0;_0x53a4b7<_0x5c4890['length'];_0x53a4b7++){const _0x1876b8=_0x5c4890[_0x53a4b7],_0x51b9a0=_0x1876b8['toLowerCase'](),_0x1286da=_0x1876b8!==_0x51b9a0&&this[_0xfb8301(0x32f)](_0x1876b8),_0x3037ba=this['isSpecialCharInNumberMode'](_0x1876b8)?_0x1876b8:_0x51b9a0,_0x498768=_0x2c0e91[_0xfb8301(0x3ec)][_0x3037ba];if(!_0x498768){this[_0xfb8301(0x206)]['warn'](_0xfb8301(0x26d)+_0x1876b8+'\x27\x20not\x20found\x20in\x20keyboard\x20layout.\x20Skipping...');continue;}let _0x4e7850=null;this['isNumber'](_0x51b9a0)?_0x4e7850=_0xfb8301(0x2bd):this[_0xfb8301(0x32f)](_0x51b9a0)?_0x4e7850=_0xfb8301(0x396):this['isSpecialCharInNumberMode'](_0x1876b8)&&(_0x4e7850='number'),_0x4e7850&&_0x5a173d!==_0x4e7850&&(this['logger']['debug']('Switching\x20keyboard\x20to\x20'+_0x4e7850+'\x20mode\x20for\x20character\x20\x27'+_0x1876b8+'\x27'),await this['switchKeyboardMode'](_0xeec10e),_0x5a173d=_0x4e7850),_0x1286da&&'letter'===_0x5a173d&&(this[_0xfb8301(0x206)][_0xfb8301(0x200)](_0xfb8301(0x3ad)+_0x1876b8+'\x27'),await this[_0xfb8301(0x1eb)](_0xeec10e)),this[_0xfb8301(0x206)]['debug']('Clicking\x20key\x20\x27'+_0x3037ba+'\x27'+(_0x1286da?'\x20(uppercase)':'')+'\x20at\x20('+_0x498768['x']+',\x20'+_0x498768['y']+')'),await this['click'](_0xeec10e,_0x498768['x'],_0x498768['y'],0.15),await(0x0,_0x1c798c['sleep'])(0xc8);}this[_0xfb8301(0x206)]['log'](_0xfb8301(0x1f9)+_0xeec10e);}async[_0x1ff904(0x3fc)](_0x36c3f0,_0x5da6ed){if(!_0x5da6ed||0x0===_0x5da6ed['length'])throw new Error('value\x20cannot\x20be\x20empty');for(let _0x17bfbf=0x0;_0x17bfbf<_0x5da6ed['length'];_0x17bfbf++){const _0x161e6f=_0x5da6ed[_0x17bfbf],_0x591125=_0x2c0e91['NUMPAD_LAYOUT'][_0x161e6f];await this['click'](_0x36c3f0,_0x591125['x'],_0x591125['y'],0.15),this['logger']['debug']('Clicking\x20key\x20\x27'+_0x161e6f+'\x27\x20at\x20('+_0x591125['x']+',\x20'+_0x591125['y']+')'),await(0x0,_0x1c798c['sleep'])(0xc8);}}async['transferFile'](_0x4f0fa4,_0x55c285,_0x55fe2e=0x1){return Promise['resolve'](null);}[_0x1ff904(0x28e)](){return this['isConnected'];}};_0x5ad5e8['HCWebSocketService']=_0x519612,_0x5ad5e8[_0x1ff904(0x378)]=_0x519612=_0x439539([(0x0,_0x3f7da0['Injectable'])(),_0x3736ee('design:paramtypes',[])],_0x519612);},_0x291168=>{_0x291168['exports']=require('ws');},function(_0x30e372,_0x171682,_0x2a2e5e){const _0x1dd671=a0_0x4abd;var _0x3de384,_0x5e58f0=this&&this[_0x1dd671(0x290)]||function(_0x58ffb8,_0x13f180,_0x21bd63,_0x5d3dc1){const _0x41235c=_0x1dd671;var _0xd2ef17,_0xad7363=arguments['length'],_0xd29c43=_0xad7363<0x3?_0x13f180:null===_0x5d3dc1?_0x5d3dc1=Object[_0x41235c(0x4a5)](_0x13f180,_0x21bd63):_0x5d3dc1;if(_0x41235c(0x2f0)==typeof Reflect&&'function'==typeof Reflect[_0x41235c(0x40a)])_0xd29c43=Reflect['decorate'](_0x58ffb8,_0x13f180,_0x21bd63,_0x5d3dc1);else{for(var _0x1a227a=_0x58ffb8['length']-0x1;_0x1a227a>=0x0;_0x1a227a--)(_0xd2ef17=_0x58ffb8[_0x1a227a])&&(_0xd29c43=(_0xad7363<0x3?_0xd2ef17(_0xd29c43):_0xad7363>0x3?_0xd2ef17(_0x13f180,_0x21bd63,_0xd29c43):_0xd2ef17(_0x13f180,_0x21bd63))||_0xd29c43);}return _0xad7363>0x3&&_0xd29c43&&Object[_0x41235c(0x38d)](_0x13f180,_0x21bd63,_0xd29c43),_0xd29c43;},_0x22b5b3=this&&this[_0x1dd671(0x3b5)]||function(_0x418dd1,_0x4bd770){const _0x286e0e=_0x1dd671;if(_0x286e0e(0x2f0)==typeof Reflect&&_0x286e0e(0x42d)==typeof Reflect['metadata'])return Reflect['metadata'](_0x418dd1,_0x4bd770);};Object['defineProperty'](_0x171682,_0x1dd671(0x318),{'value':!0x0}),_0x171682['PandaWebSocketService']=void 0x0;const _0x44a56b=_0x2a2e5e(0x2),_0x2fc8b6=_0x2a2e5e(0x50),_0x4e6217=_0x2a2e5e(0x16),_0x2d9e33=_0x2a2e5e(0x18),_0x477684=_0x2a2e5e(0x26),_0x3393c6=_0x2a2e5e(0x2c);let _0x3b8489=class{constructor(_0x32fc76){const _0x3cd44b=_0x1dd671;this['telegramService']=_0x32fc76,this[_0x3cd44b(0x206)]=new _0x44a56b[(_0x3cd44b(0x366))](_0x3cd44b(0x323)),this['ws']=null,this[_0x3cd44b(0x45e)]=0x0,this['maxReconnectAttempts']=0xa,this['reconnectDelay']=0x1388,this[_0x3cd44b(0x1f4)]=[],this[_0x3cd44b(0x2c4)]=new Map(),this[_0x3cd44b(0x37a)]=!0x1,this['isProcessingRequest']=!0x1,this['wsUrl']=_0x3cd44b(0x3dd);}async[_0x1dd671(0x2b8)](){await this['connect']();}async['onModuleDestroy'](){await this['disconnect']();}async[_0x1dd671(0x2ce)](){return new Promise((_0x8de122,_0x2af9d6)=>{const _0x4d3bc8=a0_0x4abd;try{this['logger'][_0x4d3bc8(0x4dd)](_0x4d3bc8(0x258)+this['wsUrl']),this['ws']=new _0x2fc8b6(this['wsUrl']),this['ws']['on'](_0x4d3bc8(0x204),()=>{const _0x48b19c=_0x4d3bc8;this['logger'][_0x48b19c(0x4dd)](_0x48b19c(0x3c6)),this[_0x48b19c(0x37a)]=!0x0,this['reconnectAttempts']=0x0,this['processRequestQueue'](),_0x8de122();}),this['ws']['on']('message',_0x4fe72d=>{const _0x2b35e5=_0x4d3bc8;try{const _0x439ade=_0x4fe72d[_0x2b35e5(0x2b1)](),_0x4de0c8=JSON[_0x2b35e5(0x294)](_0x439ade);this['handleMessage'](_0x4de0c8);}catch(_0x6b25f6){this['logger']['error']('Error\x20parsing\x20WebSocket\x20message:\x20'+_0x6b25f6['message'],_0x6b25f6['stack']),this['logger']['error']('Raw\x20message\x20was:\x20'+_0x4fe72d['toString']());}}),this['ws']['on']('error',_0x28618a=>{const _0x305460=_0x4d3bc8;this['logger']['error'](_0x305460(0x413)+_0x28618a[_0x305460(0x4ad)]),this[_0x305460(0x37a)]=!0x1,0x0===this[_0x305460(0x45e)]&&_0x2af9d6(_0x28618a);}),this['ws']['on']('close',()=>{this['logger']['warn']('Panda\x20BOX\x20WebSocket\x20closed'),this['isConnected']=!0x1,this['scheduleReconnect']();});}catch(_0x3e080f){this['logger'][_0x4d3bc8(0x20b)]('Error\x20creating\x20WebSocket\x20connection:\x20'+_0x3e080f['message']),_0x2af9d6(_0x3e080f);}});}['scheduleReconnect'](){const _0x4ce002=_0x1dd671;if(this[_0x4ce002(0x45e)]>=this['maxReconnectAttempts'])return this[_0x4ce002(0x206)]['error']('Max\x20reconnection\x20attempts\x20reached'),void this['telegramService'][_0x4ce002(0x3a7)]({'text':_0x4ce002(0x3d7)+this['maxReconnectAttempts']+'\x0a<b>Current\x20retry:</b>\x20'+this['reconnectAttempts']+'\x0a<b>Retry\x20delay:</b>\x20'+this['reconnectDelay']+'ms','options':{'parseMode':_0x4ce002(0x361)}});this['reconnectAttempts']++;const _0x58b14a=this[_0x4ce002(0x40e)]*this['reconnectAttempts'];this[_0x4ce002(0x206)]['log']('Scheduling\x20reconnect\x20attempt\x20'+this['reconnectAttempts']+_0x4ce002(0x3db)+_0x58b14a+'ms'),setTimeout(()=>{this['connect']()['catch'](_0x3ff982=>{this['logger']['error']('Reconnection\x20failed:\x20'+_0x3ff982['message']);});},_0x58b14a);}async['disconnect'](){this['ws']&&(this['ws']['close'](),this['ws']=null,this['isConnected']=!0x1);}['handleMessage'](_0x1a0ab3){const _0x3ac1b5=_0x1dd671;if(this['pendingRequests']['size']>0x0){const [_0x48e948,_0x39ead2]=this['pendingRequests'][_0x3ac1b5(0x275)]()['next']()[_0x3ac1b5(0x2a8)];if(this['pendingRequests'][_0x3ac1b5(0x28d)](_0x48e948),0x2710===_0x1a0ab3['code'])_0x39ead2['resolve'](_0x1a0ab3['data']);else{const _0x416974=_0x1a0ab3[_0x3ac1b5(0x4ad)]||'Panda\x20BOX\x20error:\x20'+_0x1a0ab3['code'];_0x39ead2['reject'](new Error(_0x416974));}}else{if(Array[_0x3ac1b5(0x44c)](_0x1a0ab3[_0x3ac1b5(0x246)])&&_0x1a0ab3['data']['length']>0x0&&void 0x0!==_0x1a0ab3['data'][0x0]?.['serial']&&0x2710===_0x1a0ab3[_0x3ac1b5(0x1d9)]){const _0x2431b8=_0x1a0ab3['data'];this['logger'][_0x3ac1b5(0x200)]('Received\x20unsolicited\x20device\x20list\x20update\x20(no\x20pending\x20requests):\x20'+_0x2431b8['length']+'\x20device(s)');}else this[_0x3ac1b5(0x206)]['warn'](_0x3ac1b5(0x22e)+JSON['stringify'](_0x1a0ab3));}}async['processRequestQueue'](){const _0x3db713=_0x1dd671;if(this[_0x3db713(0x1e8)]||0x0===this['requestQueue'][_0x3db713(0x20f)])return;if(!this['isConnected']||!this['ws'])return;this['isProcessingRequest']=!0x0;const {request:_0x14e394,resolve:_0x319c70,reject:_0x311c82,timeout:_0xced541}=this['requestQueue']['shift']();try{_0x319c70(await this['_sendRequestOnce'](_0x14e394,_0xced541));}catch(_0x248982){_0x311c82(_0x248982);}finally{this[_0x3db713(0x1e8)]=!0x1,this[_0x3db713(0x1f4)]['length']>0x0&&setImmediate(()=>this['processRequestQueue']());}}async[_0x1dd671(0x44d)](_0x1ef820,_0x18ea08=0x7530){return new Promise((_0x46a553,_0x39789a)=>{const _0x3bff45=a0_0x4abd,_0x5adc86=Date['now']()['toString']()+Math[_0x3bff45(0x498)]()['toString'](0x24)['substr'](0x2,0x9);this[_0x3bff45(0x2c4)][_0x3bff45(0x1f8)](_0x5adc86,{'resolve':_0x46a553,'reject':_0x39789a});const _0x609e05=setTimeout(()=>{const _0x196e8c=_0x3bff45;this['pendingRequests']['delete'](_0x5adc86),_0x39789a(new Error(_0x196e8c(0x4d8)));},_0x18ea08),_0x469562=_0x46a553,_0x8a0cfd=_0x39789a;_0x46a553=_0x385d31=>{clearTimeout(_0x609e05),_0x469562(_0x385d31);},_0x39789a=_0x5b8d07=>{clearTimeout(_0x609e05),_0x8a0cfd(_0x5b8d07);},this['pendingRequests'][_0x3bff45(0x1f8)](_0x5adc86,{'resolve':_0x46a553,'reject':_0x39789a});try{const _0x144931=JSON['stringify'](_0x1ef820);this['ws']['send'](_0x144931);}catch(_0x32cbb6){this[_0x3bff45(0x206)][_0x3bff45(0x20b)]('Error\x20sending\x20WebSocket\x20request:\x20'+_0x32cbb6['message'],_0x32cbb6['stack']),this['pendingRequests'][_0x3bff45(0x28d)](_0x5adc86),clearTimeout(_0x609e05),_0x39789a(_0x32cbb6);}});}async['sendRequest'](_0x13bc09,_0x42ef8e=0x7530){return new Promise((_0x24e88e,_0x4500ab)=>{const _0x7ce3b2=a0_0x4abd;this['requestQueue']['push']({'request':_0x13bc09,'resolve':_0x24e88e,'reject':_0x4500ab,'timeout':_0x42ef8e}),this[_0x7ce3b2(0x48e)]();});}async['listDevices'](){const _0x440712=_0x1dd671,_0x2e473d=(await this['sendRequest']({'action':_0x440712(0x2e1)}))['map'](_0x2abc87=>({..._0x2abc87,'udid':_0x2abc87['serial']}));return _0x2e473d[_0x440712(0x20f)]<=0x0&&this['logger'][_0x440712(0x20b)]('No\x20devices\x20found!'),_0x2e473d;}async['click'](_0x462e88,_0x2d0790,_0x47a27f,_0x3888f7=0.2){const _0x138a4e=_0x1dd671;return this['sendRequest']({'action':'pointerEvent','devices':Array['isArray'](_0x462e88)?_0x462e88['join'](','):_0x462e88,'data':{'type':'10','x':(0x0,_0x4e6217['toString'])(_0x2d0790),'y':(0x0,_0x4e6217[_0x138a4e(0x2b1)])(_0x47a27f)}});}async['swipe'](_0x2c1868,_0x2d0279){const _0x3beac8=_0x1dd671,_0xac51bf=Array['isArray'](_0x2c1868)?_0x2c1868['join'](','):_0x2c1868;return this['sendRequest']({'action':_0x3beac8(0x4c0),'devices':_0xac51bf,'data':_0x2d0279});}async['captureScreen'](_0x59dc53,_0x530c60){return this['sendRequest']({'action':'screenFile','devices':_0x59dc53,'data':{'savePath':_0x530c60['folderPath']}});}async['home'](_0x7f6776){const _0x182e71=_0x1dd671;return this['sendRequest']({'action':_0x182e71(0x45f),'devices':_0x7f6776,'data':{'type':'2'}});}async['launchApp'](_0x351a6b,_0x542edc){const _0x83d24d=_0x1dd671,_0x5cff1a=Array[_0x83d24d(0x44c)](_0x351a6b)?_0x351a6b[_0x83d24d(0x282)](','):_0x351a6b;return this['sendRequest']({'action':_0x83d24d(0x4bd),'devices':_0x5cff1a,'data':{'app':_0x542edc}});}async[_0x1dd671(0x380)](_0x485597,_0x5d84e7){const _0x318017=_0x1dd671,_0x163a16=Array['isArray'](_0x485597)?_0x485597[_0x318017(0x282)](','):_0x485597;return this[_0x318017(0x4b0)]({'action':'stopApp','devices':_0x163a16,'data':{'app':_0x5d84e7}});}async['switchKeyboardMode'](_0x10e470){const _0x5e0aae=_0x1dd671,{x:_0x354002,y:_0x27dd92}=_0x477684['COMMON_COORDINATES']['KEYBOARD_SWITCH'];this['logger']['log'](_0x5e0aae(0x2f6)+_0x10e470+_0x5e0aae(0x2da)+_0x354002+',\x20'+_0x27dd92+')'),await this[_0x5e0aae(0x28c)](_0x10e470,_0x354002,_0x27dd92,0.2),await(0x0,_0x2d9e33[_0x5e0aae(0x3b8)])(0x1f4),this['logger']['log'](_0x5e0aae(0x29c)+_0x10e470);}async[_0x1dd671(0x1eb)](_0x4bfc09){const _0x27de9e=_0x1dd671,{x:_0x1c5323,y:_0x4b0678}=_0x477684[_0x27de9e(0x273)][_0x27de9e(0x3ab)];this['logger']['debug']('Pressing\x20shift\x20key\x20on\x20device\x20'+_0x4bfc09+'\x20at\x20coordinates\x20('+_0x1c5323+',\x20'+_0x4b0678+')'),await this[_0x27de9e(0x28c)](_0x4bfc09,_0x1c5323,_0x4b0678,0.2),await(0x0,_0x2d9e33['sleep'])(0xc8),this[_0x27de9e(0x206)]['debug']('Shift\x20key\x20pressed\x20successfully\x20on\x20device\x20'+_0x4bfc09);}async['pressReturnKey'](_0x2121fb){const _0x5d627a=_0x1dd671,{x:_0x337019,y:_0x224385}=_0x477684['COMMON_COORDINATES'][_0x5d627a(0x1dc)];await this['click'](_0x2121fb,_0x337019,_0x224385,0.2),await(0x0,_0x2d9e33['sleep'])(0x1f4);}async[_0x1dd671(0x2d8)](_0xa1db09,_0x4a2314){const _0x2a0224=_0x1dd671,_0x4222ad=Array['isArray'](_0xa1db09)?_0xa1db09['join'](','):_0xa1db09;return this['sendRequest']({'action':_0x2a0224(0x2d8),'devices':_0x4222ad,'data':{'content':_0x4a2314}});}async['inputNumpadNumber'](_0x34105,_0x5bd175){const _0x451f6a=_0x1dd671;if(!_0x5bd175||0x0===_0x5bd175['length'])throw new Error('value\x20cannot\x20be\x20empty');for(let _0xe7f3aa=0x0;_0xe7f3aa<_0x5bd175['length'];_0xe7f3aa++){const _0x24a3bf=_0x5bd175[_0xe7f3aa],_0xd3395b=_0x477684['NUMPAD_LAYOUT'][_0x24a3bf];await this[_0x451f6a(0x28c)](_0x34105,_0xd3395b['x'],_0xd3395b['y']),this['logger'][_0x451f6a(0x200)]('Clicking\x20key\x20\x27'+_0x24a3bf+'\x27\x20at\x20('+_0xd3395b['x']+',\x20'+_0xd3395b['y']+')'),await(0x0,_0x2d9e33['sleep'])(0xc8);}}async['transferFile'](_0x476932,_0x1778d5,_0x609fa0=0x1){const _0x3cc5f0=_0x1dd671,_0x4f65ad=Array[_0x3cc5f0(0x44c)](_0x476932)?_0x476932['join'](','):_0x476932;return this['logger']['log']('Transferring\x20file\x20'+_0x1778d5+'\x20to\x20device(s)\x20'+_0x4f65ad+'\x20with\x20fileType\x20'+_0x609fa0),this['sendRequest']({'action':'uploadFile','devices':_0x4f65ad,'data':{'filePath':_0x1778d5,'fileType':_0x609fa0}});}['isConnectedStatus'](){const _0x47e17d=_0x1dd671;return this[_0x47e17d(0x37a)];}};_0x171682[_0x1dd671(0x323)]=_0x3b8489,_0x171682['PandaWebSocketService']=_0x3b8489=_0x5e58f0([(0x0,_0x44a56b['Injectable'])(),_0x22b5b3('design:paramtypes',['function'==typeof(_0x3de384=void 0x0!==_0x3393c6['TelegramService']&&_0x3393c6['TelegramService'])?_0x3de384:Object])],_0x3b8489);},function(_0xa1eb0,_0x41f458,_0x270cdc){const _0x2a2d31=a0_0x4abd;var _0x1bb0e3,_0x4546eb,_0x534224,_0x504515,_0x206acd=this&&this['__decorate']||function(_0x4f53b1,_0x476dae,_0x999de1,_0x356a82){var _0x218f02,_0x41652f=arguments['length'],_0xe42121=_0x41652f<0x3?_0x476dae:null===_0x356a82?_0x356a82=Object['getOwnPropertyDescriptor'](_0x476dae,_0x999de1):_0x356a82;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0xe42121=Reflect['decorate'](_0x4f53b1,_0x476dae,_0x999de1,_0x356a82);else{for(var _0x180b63=_0x4f53b1['length']-0x1;_0x180b63>=0x0;_0x180b63--)(_0x218f02=_0x4f53b1[_0x180b63])&&(_0xe42121=(_0x41652f<0x3?_0x218f02(_0xe42121):_0x41652f>0x3?_0x218f02(_0x476dae,_0x999de1,_0xe42121):_0x218f02(_0x476dae,_0x999de1))||_0xe42121);}return _0x41652f>0x3&&_0xe42121&&Object['defineProperty'](_0x476dae,_0x999de1,_0xe42121),_0xe42121;},_0x5bc39b=this&&this['__metadata']||function(_0x460aff,_0x494761){const _0x198006=a0_0x4abd;if('object'==typeof Reflect&&_0x198006(0x42d)==typeof Reflect[_0x198006(0x47a)])return Reflect['metadata'](_0x460aff,_0x494761);};Object['defineProperty'](_0x41f458,'__esModule',{'value':!0x0}),_0x41f458['SessionRefreshScheduler']=void 0x0;const _0x462661=_0x270cdc(0x2),_0x513d0a=_0x270cdc(0x7),_0x40abd8=_0x270cdc(0xb),_0x2f86f3=_0x270cdc(0xe),_0xe1996e=_0x270cdc(0x34),_0x253534=_0x270cdc(0x41),_0x3cbcab=_0x270cdc(0x42);let _0x199ab1=class{constructor(_0x45d072,_0x46e264,_0x30e085,_0x57bb3c){const _0x66c74e=a0_0x4abd;this['bankService']=_0x45d072,this[_0x66c74e(0x42e)]=_0x46e264,this['sessionManagement']=_0x30e085,this['redisLockService']=_0x57bb3c,this['logger']=new _0x462661['Logger'](_0x66c74e(0x30e));}async['refreshSessions'](){const _0xf62cb1=a0_0x4abd;try{if(await this['redisLockService']['getLock'](_0x3cbcab['SYSTEM_LOCK_BOXPHONE']))return;if(_0xf62cb1(0x4db)!==await this['deviceService']['getServiceStatus']())return;const _0x155708=(await this['deviceService'][_0xf62cb1(0x3ac)]())['filter'](_0x464dd4=>'active'===_0x464dd4['status']&&_0x464dd4['bankCode']);for(const _0x73501e of _0x155708){const _0x24f115=_0x73501e['bankCode'][_0xf62cb1(0x35a)]();try{await this['bankService']['refreshSessionIfNeeded'](_0x73501e[_0xf62cb1(0x23a)],_0x24f115);}catch(_0x2ad49a){this[_0xf62cb1(0x206)]['error']('Error\x20refreshing\x20session\x20for\x20device\x20'+_0x73501e['udid']+',\x20bank\x20'+_0x24f115+':\x20'+_0x2ad49a['message']);}}}catch(_0x4eba39){this['logger']['error']('Error\x20in\x20session\x20refresh\x20scheduler:\x20'+_0x4eba39[_0xf62cb1(0x4ad)]);}}};_0x41f458[_0x2a2d31(0x30e)]=_0x199ab1,_0x206acd([(0x0,_0x513d0a[_0x2a2d31(0x337)])(_0x513d0a['CronExpression']['EVERY_30_SECONDS']),_0x5bc39b('design:type',Function),_0x5bc39b(_0x2a2d31(0x2d9),[]),_0x5bc39b(_0x2a2d31(0x432),Promise)],_0x199ab1[_0x2a2d31(0x2f9)],'refreshSessions',null),_0x41f458['SessionRefreshScheduler']=_0x199ab1=_0x206acd([(0x0,_0x462661[_0x2a2d31(0x4cd)])(),_0x5bc39b('design:paramtypes',['function'==typeof(_0x1bb0e3=void 0x0!==_0x40abd8['BankService']&&_0x40abd8[_0x2a2d31(0x440)])?_0x1bb0e3:Object,'function'==typeof(_0x4546eb=void 0x0!==_0x2f86f3['DeviceService']&&_0x2f86f3['DeviceService'])?_0x4546eb:Object,'function'==typeof(_0x534224=void 0x0!==_0xe1996e['SessionManagementService']&&_0xe1996e['SessionManagementService'])?_0x534224:Object,'function'==typeof(_0x504515=void 0x0!==_0x253534['RedisLockService']&&_0x253534['RedisLockService'])?_0x504515:Object])],_0x199ab1);},function(_0xff5c93,_0x4bfe3c,_0x12c792){const _0x2638a6=a0_0x4abd;var _0x117960=this&&this['__decorate']||function(_0x4895f0,_0x4e6580,_0xa1ae80,_0x17077f){const _0x295c69=a0_0x4abd;var _0x317e98,_0x2e8810=arguments[_0x295c69(0x20f)],_0xf634ce=_0x2e8810<0x3?_0x4e6580:null===_0x17077f?_0x17077f=Object['getOwnPropertyDescriptor'](_0x4e6580,_0xa1ae80):_0x17077f;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0xf634ce=Reflect['decorate'](_0x4895f0,_0x4e6580,_0xa1ae80,_0x17077f);else{for(var _0x1964db=_0x4895f0['length']-0x1;_0x1964db>=0x0;_0x1964db--)(_0x317e98=_0x4895f0[_0x1964db])&&(_0xf634ce=(_0x2e8810<0x3?_0x317e98(_0xf634ce):_0x2e8810>0x3?_0x317e98(_0x4e6580,_0xa1ae80,_0xf634ce):_0x317e98(_0x4e6580,_0xa1ae80))||_0xf634ce);}return _0x2e8810>0x3&&_0xf634ce&&Object['defineProperty'](_0x4e6580,_0xa1ae80,_0xf634ce),_0xf634ce;};Object['defineProperty'](_0x4bfe3c,'__esModule',{'value':!0x0}),_0x4bfe3c['OCRModule']=void 0x0;const _0x30de3e=_0x12c792(0x2),_0x942236=_0x12c792(0x1c),_0x314298=_0x12c792(0x1e),_0x2e5716=_0x12c792(0x1b);let _0x1d626e=class{};_0x4bfe3c['OCRModule']=_0x1d626e,_0x4bfe3c[_0x2638a6(0x455)]=_0x1d626e=_0x117960([(0x0,_0x30de3e[_0x2638a6(0x26b)])({'providers':[_0x942236[_0x2638a6(0x308)],_0x314298['ImagePreprocessingService'],_0x2e5716['OCRService']],'exports':[_0x2e5716[_0x2638a6(0x3e0)],_0x942236['OCRWorkerPoolService'],_0x314298[_0x2638a6(0x30f)]]})],_0x1d626e);},function(_0x17aeec,_0x49b3ab,_0x1b953d){const _0x5494d7=a0_0x4abd;var _0x5d5adf=this&&this['__decorate']||function(_0x2325bb,_0x73bd7,_0x310b36,_0x78b971){const _0x6645f8=a0_0x4abd;var _0x10f716,_0x2dc3a8=arguments[_0x6645f8(0x20f)],_0x566dbc=_0x2dc3a8<0x3?_0x73bd7:null===_0x78b971?_0x78b971=Object['getOwnPropertyDescriptor'](_0x73bd7,_0x310b36):_0x78b971;if('object'==typeof Reflect&&_0x6645f8(0x42d)==typeof Reflect['decorate'])_0x566dbc=Reflect[_0x6645f8(0x40a)](_0x2325bb,_0x73bd7,_0x310b36,_0x78b971);else{for(var _0x4362d8=_0x2325bb[_0x6645f8(0x20f)]-0x1;_0x4362d8>=0x0;_0x4362d8--)(_0x10f716=_0x2325bb[_0x4362d8])&&(_0x566dbc=(_0x2dc3a8<0x3?_0x10f716(_0x566dbc):_0x2dc3a8>0x3?_0x10f716(_0x73bd7,_0x310b36,_0x566dbc):_0x10f716(_0x73bd7,_0x310b36))||_0x566dbc);}return _0x2dc3a8>0x3&&_0x566dbc&&Object[_0x6645f8(0x38d)](_0x73bd7,_0x310b36,_0x566dbc),_0x566dbc;};Object[_0x5494d7(0x38d)](_0x49b3ab,_0x5494d7(0x318),{'value':!0x0}),_0x49b3ab['NotificationModule']=void 0x0;const _0x546701=_0x1b953d(0x2),_0x5c9f3f=_0x1b953d(0x35),_0x16fd12=_0x1b953d(0x36),_0xdcac50=_0x1b953d(0x8),_0x3a1b14=_0x1b953d(0x2c);let _0x25ffb4=class{};_0x49b3ab['NotificationModule']=_0x25ffb4,_0x49b3ab[_0x5494d7(0x2bf)]=_0x25ffb4=_0x5d5adf([(0x0,_0x546701['Global'])(),(0x0,_0x546701['Module'])({'imports':[_0xdcac50[_0x5494d7(0x419)]],'providers':[_0x5c9f3f[_0x5494d7(0x3a6)],_0x16fd12['EzpayBeClientService'],_0x3a1b14[_0x5494d7(0x253)]],'exports':[_0x5c9f3f['NotificationService'],_0x3a1b14['TelegramService']]})],_0x25ffb4);},function(_0x54e12c,_0xc2ab53,_0x5f06a1){const _0x3c1f35=a0_0x4abd;var _0x566d07=this&&this['__decorate']||function(_0x4a0b01,_0x315d92,_0x2502c1,_0x4df9aa){const _0x5bbe72=a0_0x4abd;var _0x1fd697,_0x248d0b=arguments['length'],_0x418dc6=_0x248d0b<0x3?_0x315d92:null===_0x4df9aa?_0x4df9aa=Object[_0x5bbe72(0x4a5)](_0x315d92,_0x2502c1):_0x4df9aa;if('object'==typeof Reflect&&_0x5bbe72(0x42d)==typeof Reflect['decorate'])_0x418dc6=Reflect['decorate'](_0x4a0b01,_0x315d92,_0x2502c1,_0x4df9aa);else{for(var _0x206233=_0x4a0b01['length']-0x1;_0x206233>=0x0;_0x206233--)(_0x1fd697=_0x4a0b01[_0x206233])&&(_0x418dc6=(_0x248d0b<0x3?_0x1fd697(_0x418dc6):_0x248d0b>0x3?_0x1fd697(_0x315d92,_0x2502c1,_0x418dc6):_0x1fd697(_0x315d92,_0x2502c1))||_0x418dc6);}return _0x248d0b>0x3&&_0x418dc6&&Object['defineProperty'](_0x315d92,_0x2502c1,_0x418dc6),_0x418dc6;};Object[_0x3c1f35(0x38d)](_0xc2ab53,'__esModule',{'value':!0x0}),_0xc2ab53[_0x3c1f35(0x309)]=void 0x0;const _0x3667d8=_0x5f06a1(0x2),_0x580d7c=_0x5f06a1(0x3e);let _0x3bfd85=class{};_0xc2ab53['WindowAppModule']=_0x3bfd85,_0xc2ab53['WindowAppModule']=_0x3bfd85=_0x566d07([(0x0,_0x3667d8['Module'])({'providers':[_0x580d7c['WindowsAppGitBashService']],'exports':[_0x580d7c[_0x3c1f35(0x278)]]})],_0x3bfd85);},function(_0x45d2f,_0x2acc84,_0x49c78b){const _0x2f7af5=a0_0x4abd;var _0x186f18=this&&this[_0x2f7af5(0x290)]||function(_0x57fd4a,_0x16b694,_0x4114db,_0x4f3750){const _0x21fa8f=_0x2f7af5;var _0x319ecd,_0x91b1ec=arguments[_0x21fa8f(0x20f)],_0x321a15=_0x91b1ec<0x3?_0x16b694:null===_0x4f3750?_0x4f3750=Object['getOwnPropertyDescriptor'](_0x16b694,_0x4114db):_0x4f3750;if('object'==typeof Reflect&&'function'==typeof Reflect['decorate'])_0x321a15=Reflect['decorate'](_0x57fd4a,_0x16b694,_0x4114db,_0x4f3750);else{for(var _0x35b5e0=_0x57fd4a['length']-0x1;_0x35b5e0>=0x0;_0x35b5e0--)(_0x319ecd=_0x57fd4a[_0x35b5e0])&&(_0x321a15=(_0x91b1ec<0x3?_0x319ecd(_0x321a15):_0x91b1ec>0x3?_0x319ecd(_0x16b694,_0x4114db,_0x321a15):_0x319ecd(_0x16b694,_0x4114db))||_0x321a15);}return _0x91b1ec>0x3&&_0x321a15&&Object['defineProperty'](_0x16b694,_0x4114db,_0x321a15),_0x321a15;};Object[_0x2f7af5(0x38d)](_0x2acc84,'__esModule',{'value':!0x0}),_0x2acc84['RedisLockModule']=void 0x0;const _0x112ff2=_0x49c78b(0x2),_0x576343=_0x49c78b(0xf),_0x134079=_0x49c78b(0x41);let _0x6abedd=class{};_0x2acc84['RedisLockModule']=_0x6abedd,_0x2acc84['RedisLockModule']=_0x6abedd=_0x186f18([(0x0,_0x112ff2[_0x2f7af5(0x3da)])(),(0x0,_0x112ff2['Module'])({'providers':[_0x576343[_0x2f7af5(0x374)],_0x134079['RedisLockService']],'exports':[_0x134079['RedisLockService']]})],_0x6abedd);}],_0x518bb4={};function _0x3a5f13(_0xb7295a){const _0xe23fd8=a0_0x4abd;var _0x32e584=_0x518bb4[_0xb7295a];if(void 0x0!==_0x32e584)return _0x32e584['exports'];var _0x4ce1e3=_0x518bb4[_0xb7295a]={'exports':{}};return _0x25f93d[_0xb7295a]['call'](_0x4ce1e3[_0xe23fd8(0x1c6)],_0x4ce1e3,_0x4ce1e3['exports'],_0x3a5f13),_0x4ce1e3['exports'];}var _0x17c102={};((()=>{const _0x29346c=a0_0x4abd;var _0x5e76ed=_0x17c102;Object[_0x29346c(0x38d)](_0x5e76ed,'__esModule',{'value':!0x0});const _0x4b824d=_0x3a5f13(0x1),_0x30fd60=_0x3a5f13(0x2),_0x43044f=_0x3a5f13(0x3),_0x3d1692=_0x3a5f13(0x4),_0x38d733=_0x3a5f13(0x5),_0x1c5c00=_0x3a5f13(0x11);!(async function(){const _0x31bf8e=_0x29346c,_0x3dab01=await _0x4b824d['NestFactory']['create'](_0x38d733[_0x31bf8e(0x494)],{}),_0x155d28=new _0x30fd60['Logger'](_0x31bf8e(0x24a)),_0x158803=_0x31bf8e(0x38b)===process[_0x31bf8e(0x35d)]['NODE_ENV']?(0x0,_0x3d1692[_0x31bf8e(0x282)])(__dirname,_0x31bf8e(0x39c)):(0x0,_0x3d1692['join'])(process['cwd'](),'src',_0x31bf8e(0x39c));_0x3dab01['setBaseViewsDir'](_0x158803),_0x3dab01[_0x31bf8e(0x1e4)]('ejs'),_0x155d28[_0x31bf8e(0x4dd)]('Views\x20directory:\x20'+_0x158803),_0x3dab01['useGlobalPipes'](new _0x30fd60['ValidationPipe']({'transform':!0x0,'whitelist':!0x0,'forbidNonWhitelisted':!0x0}));const _0x4710f1=new _0x43044f['DocumentBuilder']()['setTitle'](_0x31bf8e(0x3e7))[_0x31bf8e(0x467)](_0x31bf8e(0x1d0))['setVersion']('1.0')['addTag']('bank',_0x31bf8e(0x23e))['addTag'](_0x31bf8e(0x452),'Withdrawal\x20processing')['addTag'](_0x31bf8e(0x4d5),'Device\x20management')['addTag']('hcbox','HC\x20Box\x20integration')[_0x31bf8e(0x453)](),_0xb7180f=_0x43044f[_0x31bf8e(0x36a)][_0x31bf8e(0x414)](_0x3dab01,_0x4710f1);_0x43044f['SwaggerModule']['setup'](_0x31bf8e(0x330),_0x3dab01,_0xb7180f);const _0x5970a0=process['env']['PORT']||0xbba;_0x155d28['log']('üìö\x20Swagger\x20documentation\x20available\x20at:\x20http://localhost:'+_0x5970a0+_0x31bf8e(0x227)),await _0x3dab01['listen'](_0x5970a0),_0x155d28['log'](_0x31bf8e(0x24d)+_0x5970a0),_0x155d28['log'](_0x31bf8e(0x279)+_0x1c5c00['config'][_0x31bf8e(0x2bc)]+'\x20box'),_0x155d28['log']('üåê\x20Device\x20management:\x20http://localhost:'+_0x5970a0);}());})());})()));
//# sourceMappingURL=main.js.map
//# sourceMappingURL=main.js.map